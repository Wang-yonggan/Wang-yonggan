<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Idea的JavaWeb创建</title>
    <url>/2021/12/03/javaWeb/JavaWeb%E5%88%9B%E5%BB%BA/</url>
    <content><![CDATA[<p>[toc]</p>
<h3 id="发现"><a href="#发现" class="headerlink" title="发现"></a>发现</h3><ol>
<li>Filter是单例的，hashcode都一样,并且这个进程和正在使用这个过滤器的Servlet的进程是一样的</li>
<li>Servlet是多例的，每次访问都会创建一个新的</li>
<li>Filter用注解的时候，不会</li>
<li>JavaWeb会自动给每个访问添加cookie(“JSESSIONID”,”id”)</li>
<li>response.addCookie(c)  setMaxAge(1000) 单位是s</li>
<li>对于javaWeb或者springMvc的错误,可以参考运行旁边的 tomcat Localhost，tomcat catlina日志</li>
<li>mvc运行失败可能是war包部署错误</li>
</ol>
<h3 id="基本创建"><a href="#基本创建" class="headerlink" title="基本创建"></a>基本创建</h3><ol>
<li><p>Maven项目，从原型创建，选择</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">org.apache.maven.archetypes:maven-archetype-webapp</span><br></pre></td></tr></table></figure></li>
<li><p>在main下创建源文件夹java，资源文件夹resources</p>
</li>
<li><p>重写WEB-INF/web.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">xmlns</span>=<span class="string">&quot;http://java.sun.com/xml/ns/javaee&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">version</span>=<span class="string">&quot;3.0&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>编辑运行配置，添加本地:tomcat&gt;8.0，部署:添加工件 war exploaded</p>
</li>
</ol>
<h3 id="注解-WebServlet"><a href="#注解-WebServlet" class="headerlink" title="注解@WebServlet"></a>注解@WebServlet</h3><ol>
<li><p>加入依赖 javax.servlet-api-4.0.1.jar</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.0.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>注意@WebServlet的url需要/</p>
</li>
</ol>
<h3 id="过滤器"><a href="#过滤器" class="headerlink" title="过滤器"></a>过滤器</h3><ol>
<li><p>class</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> filter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> util.StringUtil;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.*;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: WangYongGan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2021/12/3 17:06</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyFilter1</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">        <span class="comment">/** FilterConfig 方法</span></span><br><span class="line"><span class="comment">         * getFilterName</span></span><br><span class="line"><span class="comment">         * getServletContext</span></span><br><span class="line"><span class="comment">         * getInitParameter</span></span><br><span class="line"><span class="comment">         * getInitParameterNames</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">        System.out.println(StringUtil.getLastName(getClass().getName())+<span class="string">&quot; id &quot;</span>+<span class="keyword">this</span>.hashCode());</span><br><span class="line">        System.out.println(servletRequest.getRemoteAddr());</span><br><span class="line">        HttpServletRequest request= (HttpServletRequest) servletRequest;</span><br><span class="line">        System.out.println(request.getServletPath());</span><br><span class="line">        System.out.println(request.getContextPath());</span><br><span class="line">        filterChain.doFilter(servletRequest,servletResponse);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>注册 注解: @WebFilter(“/*”)</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>f1<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>filter.MyFilter1<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>f1<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a>Cookie</h3><h3 id="Session"><a href="#Session" class="headerlink" title="Session"></a>Session</h3><h2 id="MVC"><a href="#MVC" class="headerlink" title="MVC"></a>MVC</h2><h3 id="MVC创建"><a href="#MVC创建" class="headerlink" title="MVC创建"></a>MVC创建</h3><ol>
<li><p>创建自定义配置maven工程</p>
</li>
<li><p>加入依赖</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.0.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>配置web资源文件 </p>
<ul>
<li>项目结构-&gt;Facet 加号 web</li>
<li>部署描述符 src/main/webapp/web.xml</li>
<li>Web资源目录 src/main/webapp</li>
</ul>
</li>
<li><p>web.xml配置文件</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>dispatchServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:spring.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>dispatchServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>resources/spring.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:mvc</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/beans/spring-beans-4.2.xsd  http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc-4.2.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.2.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.wyg.controller&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/view/&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span><span class="comment">&lt;!--一定要写对这个//--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suffix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;.jsp&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span><span class="comment">&lt;!--视图解析器  自定义前缀 后缀--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--注解驱动--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:annotation-driven</span>&gt;</span><span class="tag">&lt;/<span class="name">mvc:annotation-driven</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--静态资源  images/a.jpg   images/xx/a.jpg--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--mapping：访问路径    localtion：真实路径,第一个/是webapp根目录--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">mapping</span>=<span class="string">&quot;/images/**&quot;</span> <span class="attr">location</span>=<span class="string">&quot;/images/&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">mvc:resources</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="注解驱动"><a href="#注解驱动" class="headerlink" title="注解驱动"></a>注解驱动</h3><h3 id="资源路径"><a href="#资源路径" class="headerlink" title="资源路径"></a>资源路径</h3>]]></content>
      <categories>
        <category>javaWeb</category>
      </categories>
  </entry>
  <entry>
    <title>http</title>
    <url>/2021/10/31/javaWeb/http/</url>
    <content><![CDATA[<h3 id="Http"><a href="#Http" class="headerlink" title="Http"></a>Http</h3><ol>
<li>Hyper Text Transfer Protocol 超文本传输协议，客户端&lt;—&gt;服务端 数据交换格式<ol>
<li> 基于TCP/IP的高级协议</li>
<li> 默认端口80</li>
<li> 一次请求对应一次响应</li>
<li> 无状态，每个请求独立，不能数据交换</li>
<li>各个版本<ol>
<li>1.0 每个请求都要一次建立连接，断开连接</li>
<li>1.1 请求复用，请求完等一会，等其他的请求复用这个连接</li>
</ol>
</li>
</ol>
<span id="more"></span></li>
</ol>
<h4 id="请求消息格式"><a href="#请求消息格式" class="headerlink" title="请求消息格式"></a>请求消息格式</h4><ol>
<li><p>请求行</p>
<ol>
<li><p>组成请求方式 请求url 请求协议</p>
</li>
<li><p>GET /login.html HTTP/1.1</p>
</li>
<li><p>请求方式</p>
<ol>
<li>Get：请求参数在请求行中,url有限制，不安全（参数可见）</li>
<li>Post: 请求参数在请求体中，url可无限大，安全。</li>
</ol>
</li>
</ol>
</li>
<li><p>请求头</p>
<p>k:v</p>
<p>请求名称：请求头值</p>
<p>get:</p>
<p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20211003214231021.png" alt="image-20211003214231021"></p>
<p>post:</p>
<p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20211003214506976.png" alt="image-20211003214506976"></p>
<p>user-agent：浏览器版本信息（解决浏览器兼容）。</p>
<p>accept:可接受的文件格式</p>
<p>referer: 告诉服务器我从哪里来，</p>
<ol>
<li>防盗链，防止别人盗取链接。</li>
<li>访问统计。</li>
<li>如果直接访问而不是通过连接访问，那么这个值就是null</li>
</ol>
<p>connection: keep-live 1.1版本的请求复用</p>
</li>
<li><p>请求空行，分割请求体和请求头的</p>
</li>
<li><p>请求体(正文,post才有)，封装post请求参数的</p>
</li>
</ol>
<h4 id="响应消息格式"><a href="#响应消息格式" class="headerlink" title="响应消息格式"></a>响应消息格式</h4><ol>
<li><p>响应行</p>
<p>HTTP /2.0 200 OK</p>
<p>协议:版本 状态码</p>
<p>状态码</p>
<ol>
<li>1xx: 服务端未接受全部请求消息</li>
<li>2xx: 成功</li>
<li>3xx: 不在我这。<ol>
<li>302 重定向，在别人哪</li>
<li>304 访问缓存(成功了)，在浏览器的缓存中</li>
</ol>
</li>
<li>4xx: 客户端错误<ol>
<li>401 需要身份认证</li>
<li>403 服务器收到了请求，但拒绝执行，可能是没权限</li>
<li>404 url写错了</li>
<li>405 没有这个get/post方法</li>
<li>414 url过长</li>
</ol>
</li>
<li>5xx: 服务端错误<ol>
<li>500:java报错(1/0)</li>
<li></li>
</ol>
</li>
</ol>
</li>
<li><p>响应头</p>
<p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20211004025720770.png" alt="image-20211004025720770"></p>
<ol>
<li>content-type 响应编码格式(text/html;charset=utf-8)</li>
<li>content-disposition 响应数据格式<ol>
<li>in-line: 当前页面直接显示</li>
<li>attachment:附件(超链接下载)</li>
</ol>
</li>
</ol>
</li>
<li><p>响应空行</p>
</li>
<li><p>响应体</p>
<p>data: html  string json 图片二进制数据</p>
</li>
</ol>
<h4 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h4><ol>
<li><p>url:统一资源定位符:<a href="http://localhost:8080/d2%E4%B8%AD%E5%8D%8E%E4%BA%BA%E6%B0%91%E5%85%B1%E5%92%8C%E5%9B%BD">http://localhost:8080/d2中华人民共和国</a></p>
<p>uri:统一资源标识符:/d2 共和国</p>
</li>
</ol>
]]></content>
      <categories>
        <category>javaWeb</category>
      </categories>
  </entry>
  <entry>
    <title>java四大域对象</title>
    <url>/2021/11/23/javaWeb/%E5%9B%9B%E5%A4%A7%E5%9F%9F%E5%AF%B9%E8%B1%A1/</url>
    <content><![CDATA[<h3 id="java四大域对象-转载"><a href="#java四大域对象-转载" class="headerlink" title="java四大域对象-转载"></a><a href="https://blog.csdn.net/u014253011/article/details/85718649">java四大域对象-转载</a></h3><ol>
<li><p>request HttpServletContext </p>
<ol>
<li><p>生命周期：</p>
<p>在Service方法调用前由服务器创建，传入service方法。整个请求结束，request生命结束。<br>用户发送一个请求，开始，服务器返回响应，请求结束，生命周期结束；</p>
</li>
<li><p>作用范围：整个请求链（请求转发也存在）/一次请求转发的范围</p>
</li>
<li><p>作用：获取请求数据，共享数据，请求转发。</p>
</li>
</ol>
</li>
<li><p>session HttpSession</p>
<ol>
<li><p>生命周期</p>
<p>在第一次调用request.getSession()方法时，服务器会检查是否已经有对应的session，如果没有就在内存中创建一个session并返回。<br>（1）当一段时间内session没有被使用（默认为30分钟），则服务器会销毁该session。<br>（2）如果服务器非正常关闭，没有到期的session也会跟着销毁。<br>（3）如果调用session提供的invalidate()，可以立即销毁session。</p>
</li>
<li></li>
</ol>
</li>
<li><p>application ServletContext</p>
<ol>
<li>生命周期：整个web服务</li>
<li>作用范围：整个web应用</li>
<li>作用：<ol>
<li>读取配置文件</li>
<li>在不同Servlet 之间转发</li>
</ol>
</li>
</ol>
</li>
<li><p>page(jsp)   pageContext</p>
<ol>
<li>可以作为入口对象获取其他三大域对象的引用，获取其所有域中的数据</li>
<li>作用于整个JSP页面，是四大作用域中最小的一个</li>
</ol>
</li>
<li><p>特点</p>
<ol>
<li>之所以他们是域对象，原因是他们都内置了map集合，都有setAttribute和getAttribute方法。</li>
<li>都有生命周期，servlet{init,service,destory}也有生命周期。</li>
</ol>
</li>
<li><p>如果一个数据只在当前jsp页面使用，可以使用pageContext域</p>
<p>如果一个数据，除了在当前Servlet中使用，还要在请求转发中使用，使用request域</p>
<p>如果一个数据，除了现在我自己要用，过一会我自己还要用，存在session域</p>
<p>如果一个数据，除了我自己用其他人也要用，存在ServleContext域中</p>
</li>
<li><p>域对象：能够在自己的作用范围共享数据。</p>
</li>
</ol>
]]></content>
      <categories>
        <category>javaWeb</category>
      </categories>
  </entry>
  <entry>
    <title></title>
    <url>/2022/02/08/linux/linux--%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/</url>
    <content><![CDATA[<ol>
<li><p>nohup(no hang up) 挂起运行  </p>
</li>
<li><p>crontab </p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">crontab</span> -e  <span class="comment">#进入当前用户b</span></span><br></pre></td></tr></table></figure></li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">*    *    *    *    *</span><br><span class="line">-    -    -    -    -</span><br><span class="line">|    |    |    |    |</span><br><span class="line">|    |    |    |    +----- 星期中星期几 (<span class="number">0</span> - <span class="number">6</span>) (星期天 为<span class="number">0</span>)</span><br><span class="line">|    |    |    +---------- 月份 (<span class="number">1</span> - <span class="number">12</span>) </span><br><span class="line">|    |    +--------------- 一个月中的第几天 (<span class="number">1</span> - <span class="number">31</span>)</span><br><span class="line">|    +-------------------- 小时 (<span class="number">0</span> - <span class="number">23</span>)</span><br><span class="line">+------------------------- 分钟 (<span class="number">0</span> - <span class="number">59</span>)</span><br></pre></td></tr></table></figure>

<p>例如：</p>
<ol>
<li><p>每一分钟执行一次 /bin/ls：</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="bullet">*</span> <span class="emphasis">* *</span> <span class="emphasis">* *</span> /bin/ls</span><br></pre></td></tr></table></figure></li>
<li><p>在 12 月内, 每天的早上 6 点到 12 点，每隔 3 个小时 0 分钟执行一次 /usr/bin/backup：</p>
<figure class="highlight basic"><table><tr><td class="code"><pre><span class="line"><span class="symbol">0 </span><span class="number">6</span>-<span class="number">12</span>/<span class="number">3</span> * <span class="number">12</span> * /<span class="keyword">usr</span>/bin/backup</span><br></pre></td></tr></table></figure></li>
<li><p>周一到周五每天下午 5:00 寄一封信给 <a href="mailto:&#97;&#x6c;&#x65;&#120;&#x40;&#100;&#111;&#x6d;&#x61;&#x69;&#110;&#46;&#x6e;&#97;&#x6d;&#101;">&#97;&#x6c;&#x65;&#120;&#x40;&#100;&#111;&#x6d;&#x61;&#x69;&#110;&#46;&#x6e;&#97;&#x6d;&#101;</a>：</p>
<figure class="highlight basic"><table><tr><td class="code"><pre><span class="line"><span class="symbol">0 </span><span class="number">17</span> * * <span class="number">1</span>-<span class="number">5</span> mail -s <span class="string">&quot;hi&quot;</span> alex@domain.<span class="keyword">name</span> &lt; /tmp/maildata</span><br></pre></td></tr></table></figure></li>
<li><p>每月每天的午夜 0 点 20 分, 2 点 20 分, 4 点 20 分….执行 echo “haha”：</p>
<figure class="highlight basic"><table><tr><td class="code"><pre><span class="line"><span class="symbol">20 </span><span class="number">0</span>-<span class="number">23</span>/<span class="number">2</span> * * * echo <span class="string">&quot;haha&quot;</span></span><br></pre></td></tr></table></figure></li>
<li><pre><code>0 */2 * * * /sbin/service httpd restart  意思是每两个小时重启一次apache 

50 7 * * * /sbin/service sshd start  意思是每天7：50开启ssh服务 

50 22 * * * /sbin/service sshd stop  意思是每天22：50关闭ssh服务 

0 0 1,15 * * fsck /home  每月1号和15号检查/home 磁盘 

1 * * * * /home/bruce/backup  每小时的第一分执行 /home/bruce/backup这个文件 

00 03 * * 1-5 find /home &quot;*.xxx&quot; -mtime +4 -exec rm &#123;&#125; \;  每周一至周五3点钟，在目录/home中，查找文件名为*.xxx的文件，并删除4天前的文件。

30 6 */10 * * ls  意思是每月的1、11、21、31日是的6：30执行一次ls命令
</code></pre>
</li>
<li><p>ping baidu.com -c  3 请求三次baidu </p>
</li>
<li><p>ssh-keygen -t rsa 生成rsa型密钥默认在 ~/.ssh中，有两个文件，一个私钥，一个pub公钥</p>
</li>
<li><p>yum 类似于Pip</p>
</li>
<li><p>定时同步时间：0 1 * * * /usr/sbin/ntpdate cn.pool.ntp.org</p>
</li>
<li><p>防火墙</p>
<ol>
<li>systemctl status firewalld.service  查看防火墙状态</li>
<li>systemctl stop firewalld.service 关闭防护墙</li>
<li>systemctl disable firewalld.service 开启</li>
</ol>
</li>
<li></li>
</ol>
]]></content>
  </entry>
  <entry>
    <title>linux命令</title>
    <url>/2022/03/07/linux/linux%E5%91%BD%E4%BB%A4/</url>
    <content><![CDATA[<p>[toc]</p>
<h2 id="一、简单操作"><a href="#一、简单操作" class="headerlink" title="一、简单操作"></a>一、简单操作</h2><h3 id="1-1-文件"><a href="#1-1-文件" class="headerlink" title="1.1 文件"></a>1.1 文件</h3><ol>
<li><p>ls -a 连同带.的隐藏文件文件一起查看</p>
</li>
<li><p>解压  tar xzf ..gz</p>
<table>
<thead>
<tr>
<th>文件类型</th>
<th>压缩</th>
<th>解压</th>
<th>打包</th>
</tr>
</thead>
<tbody><tr>
<td>tar文件</td>
<td>tar文件不是压缩文件</td>
<td>tar -xvf  name.tar</td>
<td>tar -cvf name.jar name</td>
</tr>
<tr>
<td>gz文件</td>
<td>tar -zcvf name.tar.gz name</td>
<td>tar -zxvf name.gz</td>
<td></td>
</tr>
<tr>
<td>zip文件</td>
<td>zip name.zip name</td>
<td>unzip name.zip</td>
<td></td>
</tr>
<tr>
<td>rar文件</td>
<td>rar a name.rar name</td>
<td>rar x name.rar</td>
<td></td>
</tr>
</tbody></table>
</li>
</ol>
<pre><code>1. 说明

    1. c建立新的压缩文件
    2. v 显示操作过程
    3. f 指定文件
    4. x 提取文件
</code></pre>
<ol start="3">
<li><p>删除非空文件夹 rm -rf aaa</p>
</li>
<li><p>搜索文件(非文件夹,- type d表示文件夹) </p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">find  basePath  [1]  name </span><br><span class="line">find / -name name</span><br><span class="line">find . -type d 文件夹 f 文件</span><br><span class="line">find . -ipath &quot;*data*&quot; 文件路径包含data的文件</span><br></pre></td></tr></table></figure></li>
<li><p>查看文件夹大小</p>
<ol>
<li><p>以byte为单位</p>
<p>ls -ll</p>
</li>
<li><p>以KB MB为单位</p>
<p>ls -lh</p>
</li>
</ol>
</li>
</ol>
<span id="more"></span>

<ol start="7">
<li><p>shell可执行</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">chmod +x a.sh</span><br><span class="line">chmod 700 a.sh</span><br></pre></td></tr></table></figure></li>
<li><p>修改文件夹/文件名</p>
<p>mv f1 f2</p>
</li>
</ol>
<h3 id="文件"><a href="#文件" class="headerlink" title="文件"></a>文件</h3><p>chomd</p>
<ol>
<li><p>设置拥有者可读写，其他人不可读写执行</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">chmod</span> <span class="number">600</span> file</span><br></pre></td></tr></table></figure></li>
<li><p>设置所有人可以读写及执行</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">chmod</span> <span class="number">777</span> file</span><br></pre></td></tr></table></figure></li>
<li><p>其他</p>
<figure class="highlight diff"><table><tr><td class="code"><pre><span class="line"><span class="deletion">-rw------- (600)    只有拥有者有读写权限。</span></span><br><span class="line"><span class="deletion">-rw-r--r-- (644)    只有拥有者有读写权限；而属组用户和其他用户只有读权限。</span></span><br><span class="line"><span class="deletion">-rwx------ (700)    只有拥有者有读、写、执行权限。</span></span><br><span class="line"><span class="deletion">-rwxr-xr-x (755)    拥有者有读、写、执行权限；而属组用户和其他用户只有读、执行权限。</span></span><br><span class="line"><span class="deletion">-rwx--x--x (711)    拥有者有读、写、执行权限；而属组用户和其他用户只有执行权限。</span></span><br><span class="line"><span class="deletion">-rw-rw-rw- (666)    所有用户都有文件读、写权限。</span></span><br><span class="line"><span class="deletion">-rwxrwxrwx (777)    所有用户都有读、写、执行权限</span></span><br></pre></td></tr></table></figure></li>
<li></li>
</ol>
<h2 id="二、进程、端口"><a href="#二、进程、端口" class="headerlink" title="二、进程、端口"></a>二、进程、端口</h2><ol>
<li><p>查看redis进程 ps -ef | grep redis</p>
</li>
<li><p>查看端口 lsof -i:8000  </p>
<p>netstat -lnp|grep 3306</p>
</li>
<li><p>杀死进程pid   kill 1002</p>
</li>
</ol>
<h2 id="三、用户"><a href="#三、用户" class="headerlink" title="三、用户"></a>三、用户</h2><ol>
<li><p>删除用户</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">userdel -r username</span></span><br></pre></td></tr></table></figure></li>
<li></li>
</ol>
<h2 id="四、vim"><a href="#四、vim" class="headerlink" title="四、vim"></a>四、vim</h2><ol>
<li>搜索：c    /str</li>
</ol>
<h2 id="五、下载"><a href="#五、下载" class="headerlink" title="五、下载"></a>五、下载</h2><ol>
<li><p>wget</p>
<p>下载url对应的网络资源</p>
</li>
<li><p>yum</p>
<p>一键式安装软件</p>
</li>
<li><p>rpm</p>
<p>用于安装软件，有些软件的压缩包是a.rpm。</p>
</li>
</ol>
]]></content>
      <categories>
        <category>os</category>
      </categories>
  </entry>
  <entry>
    <title>linux高级命令</title>
    <url>/2022/04/24/linux/linux%E9%AB%98%E7%BA%A7%E5%91%BD%E4%BB%A4/</url>
    <content><![CDATA[<p>·</p>
<h2 id="Base"><a href="#Base" class="headerlink" title="Base"></a>Base</h2><h3 id="Sort"><a href="#Sort" class="headerlink" title="Sort"></a>Sort</h3><blockquote>
<p>对文本文件中所有行进行排序。</p>
</blockquote>
<table>
<thead>
<tr>
<th>命令</th>
<th>作用</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>-n  -g</td>
<td>根据数字</td>
<td></td>
</tr>
<tr>
<td>-r</td>
<td>倒序</td>
<td></td>
</tr>
<tr>
<td>-R</td>
<td>随机排序</td>
<td></td>
</tr>
<tr>
<td>-f</td>
<td>忽略大小写</td>
<td></td>
</tr>
<tr>
<td>-k</td>
<td>根据位置，第几个key</td>
<td>ps -ef |sort -nk 2</td>
</tr>
<tr>
<td>-u</td>
<td>去重</td>
<td></td>
</tr>
</tbody></table>
<h2 id="一、查看cpu-内存占用情况"><a href="#一、查看cpu-内存占用情况" class="headerlink" title="一、查看cpu/内存占用情况"></a>一、查看cpu/内存占用情况</h2><ol>
<li><p>free -h 查看内存情况</p>
<p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20211111004922374.png" alt="image-20211111004922374"></p>
<blockquote>
<p>1.CPU占用最多的前10个进程：<br>ps auxw|head -1;ps auxw|sort -rn -k3|head -10<br>2.内存消耗最多的前10个进程<br>ps auxw|head -1;ps auxw|sort -rn -k4|head -10<br>3.虚拟内存使用最多的前10个进程</p>
<p>ps auxw|head -1;ps auxw|sort -rn -k5|head -10</p>
<p>%MEM 进程的内存占用率</p>
<p>VSZ 进程所使用的虚存的大小</p>
<p>RSS实际内存</p>
</blockquote>
</li>
<li><p>具体进程</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">cat /proc/<span class="number">3664</span>(具体进程号)/status　</span><br></pre></td></tr></table></figure></li>
</ol>
<p>​        </p>
<h2 id="二、硬件信息"><a href="#二、硬件信息" class="headerlink" title="二、硬件信息"></a>二、硬件信息</h2><h2 id="三、系统性能监控"><a href="#三、系统性能监控" class="headerlink" title="三、系统性能监控"></a>三、系统性能监控</h2><blockquote>
<ol>
<li>top找到进程</li>
<li>top -p pid 然后按H 找到线程</li>
<li>jstack pid </li>
</ol>
</blockquote>
<ol>
<li><p>top 系统信息</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">时间：top - 09:44:56 </span><br><span class="line">开机天数：up 16 days, 21:23,  </span><br><span class="line">连接人数：1 user, </span><br><span class="line">处理任务平均时间：load average: 9.59, 4.75, 1.92</span><br><span class="line">进程数：Tasks: 145 total,  </span><br><span class="line">正在运行进程数：2 running,</span><br><span class="line">睡眠进程数：143 sleeping,  </span><br><span class="line">停止进程数：0 stopped</span><br><span class="line">冻结进程数：0 zombie</span><br><span class="line">cpu占比：Cpu(s): 99.8%us, </span><br><span class="line">内核占比：0.1%sy, 0.0%ni,  0.2%id,  0.0%wa,  0.0%hi,  0.0%si,  0.0%st</span><br><span class="line">物理总内存Mem:   4147888k total, </span><br><span class="line">已用内存：2493092k used, </span><br><span class="line">空闲内存：1654796k free, </span><br><span class="line">缓存区内存：158188k buffers</span><br><span class="line">虚拟内存：Swap:  5144568k total,       56k used,  5144512k free,  2013180k cached</span><br></pre></td></tr></table></figure></li>
<li><p>查看某个进程  top -p pid  然后按大写H</p>
</li>
</ol>
<h2 id="四、内存、磁盘"><a href="#四、内存、磁盘" class="headerlink" title="四、内存、磁盘"></a>四、内存、磁盘</h2><ol>
<li><p>free 显示内存使用信息</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">free -s 2 每两秒监控一次内存信息</span><br><span class="line">free -bkmh  以b,kb,mb方式显示 h:人类方式显示</span><br></pre></td></tr></table></figure>

<ol>
<li><p>说明</p>
<p>total：总物理内存</p>
<p>Shared：表示多个进程共享的内存总额。</p>
<p>Buffers/cached：表示 磁盘缓存的大小。</p>
<p>swap: 交换区/虚拟内存</p>
</li>
</ol>
</li>
<li><p>fdisk、df</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">-b &lt;大小&gt;             扇区大小(512、1024、2048或4096)</span><br><span class="line">-c[=&lt;模式&gt;]           兼容模式：“dos”或“nondos”(默认)</span><br><span class="line">-h                    打印此帮助文本</span><br><span class="line">-u[=&lt;单位&gt;]           显示单位：“cylinders”(柱面)或“sectors”(扇区，默认)</span><br><span class="line">-v                    打印程序版本</span><br><span class="line">-C &lt;数字&gt;             指定柱面数</span><br><span class="line">-H &lt;数字&gt;             指定磁头数</span><br><span class="line">-S &lt;数字&gt;             指定每个磁道的扇区数</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="五、系统管理"><a href="#五、系统管理" class="headerlink" title="五、系统管理"></a>五、系统管理</h2><ol>
<li><p>ps</p>
<blockquote>
<p>进程信息</p>
</blockquote>
<table>
<thead>
<tr>
<th>参数</th>
<th>作用</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>-a</td>
<td>所有程序</td>
<td></td>
</tr>
<tr>
<td>-A  -e</td>
<td>所有程序</td>
<td></td>
</tr>
<tr>
<td>-u</td>
<td>指定用户</td>
<td>ps -u root</td>
</tr>
<tr>
<td>u</td>
<td>显示用户</td>
<td>ps -e    u</td>
</tr>
<tr>
<td>-f</td>
<td>UID,PPIP,C,STIME</td>
<td></td>
</tr>
<tr>
<td>f   -H</td>
<td>线程父子树状结构</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">ps axo pid,comm,pcpu <span class="comment"># 查看进程的PID、名称以及CPU 占用率</span></span><br><span class="line">ps aux | sort -rnk 4 <span class="comment"># 按内存资源的使用量对进程进行排序</span></span><br><span class="line">ps aux | sort -nk 3  <span class="comment"># 按 CPU 资源的使用量对进程进行排序</span></span><br><span class="line">ps -A <span class="comment"># 显示所有进程信息</span></span><br><span class="line">ps -u root <span class="comment"># 显示指定用户信息</span></span><br><span class="line">ps -efL <span class="comment"># 查看线程数</span></span><br><span class="line">ps -e -o <span class="string">&quot;%C : %p :%z : %a&quot;</span>|sort -k5 -nr <span class="comment"># 查看进程并按内存使用大小排列</span></span><br><span class="line">ps -ef <span class="comment"># 显示所有进程信息，连同命令行</span></span><br><span class="line">ps -ef | grep ssh <span class="comment"># ps 与grep 常用组合用法，查找特定进程</span></span><br><span class="line">ps -C nginx <span class="comment"># 通过名字或命令搜索进程</span></span><br><span class="line">ps aux --sort=-pcpu,+pmem <span class="comment"># CPU或者内存进行排序,-降序，+升序</span></span><br><span class="line">ps -f --forest -C nginx <span class="comment"># 用树的风格显示进程的层次关系</span></span><br><span class="line">ps -o pid,uname,comm -C nginx <span class="comment"># 显示一个父进程的子进程</span></span><br><span class="line">ps -e -o pid,uname=USERNAME,pcpu=CPU_USAGE,pmem,comm <span class="comment"># 重定义标签</span></span><br><span class="line">ps -e -o pid,comm,etime <span class="comment"># 显示进程运行的时间</span></span><br><span class="line">ps -aux | grep named <span class="comment"># 查看named进程详细信息</span></span><br><span class="line">ps -o <span class="built_in">command</span> -p 91730 | sed -n2p <span class="comment"># 通过进程id获取服务名称</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="六、进程"><a href="#六、进程" class="headerlink" title="六、进程"></a>六、进程</h2><ol>
<li><p>jps查看java进程</p>
</li>
<li><p>lsof </p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">lsof</span> -i:<span class="number">8001</span> 产看<span class="number">8001</span>端口的进程</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>lsof</p>
<figure class="highlight tcl"><table><tr><td class="code"><pre><span class="line">lsof -p <span class="keyword">pid</span>    该<span class="keyword">pid</span>打开的文件</span><br><span class="line">lsof filePath   操作该文件的进程</span><br></pre></td></tr></table></figure>

<ol>
<li>含义说明<ol>
<li>commend 进程名称</li>
<li>pid 进程标识</li>
<li>ppid 父进程id</li>
<li>user 进程所有者</li>
<li>fd 文件描述符，表示对该文件的行为  如：读，写，</li>
</ol>
</li>
</ol>
</li>
</ol>
<h2 id="七、网络"><a href="#七、网络" class="headerlink" title="七、网络"></a>七、网络</h2><ol>
<li><p>ifconfig 查看网络设备状态</p>
</li>
<li><p>netstat</p>
</li>
<li><p>查询内网地址：</p>
<ol>
<li>ifconfig </li>
<li>ip a</li>
<li>ip addr</li>
</ol>
</li>
<li><p>查询外网地址</p>
<ol>
<li>curl cip.cc</li>
<li>curl ifconfig.me </li>
</ol>
</li>
</ol>
<h2 id="八、cpu"><a href="#八、cpu" class="headerlink" title="八、cpu"></a>八、cpu</h2><h2 id="九、配置"><a href="#九、配置" class="headerlink" title="九、配置"></a>九、配置</h2><ol>
<li><p>查看位数  uname -a</p>
</li>
<li><p>查看是ubantu还是centos</p>
<ol>
<li><p>cat /etc/issue</p>
</li>
<li><p>uname -n</p>
</li>
</ol>
</li>
</ol>
]]></content>
      <categories>
        <category>os</category>
      </categories>
  </entry>
  <entry>
    <title>shell</title>
    <url>/2022/04/06/linux/shell/</url>
    <content><![CDATA[<h2 id="一、变量"><a href="#一、变量" class="headerlink" title="一、变量"></a>一、变量</h2><blockquote>
<p><strong>赋值</strong>，定义不用$</p>
<p><strong>获取</strong>需要$或者${}</p>
</blockquote>
<h3 id="1-1-定义"><a href="#1-1-定义" class="headerlink" title="1.1 定义"></a>1.1 定义</h3><ol>
<li><p>普通定义：your_name=”runoob.com”</p>
<ol>
<li><p>不需要加$</p>
</li>
<li><p>变量名和等号之间不能有空格</p>
</li>
</ol>
</li>
<li><p>特殊定义</p>
<figure class="highlight mel"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> <span class="keyword">file</span> <span class="keyword">in</span> <span class="string">`ls /etc`</span></span><br><span class="line">或</span><br><span class="line"><span class="keyword">for</span> <span class="keyword">file</span> <span class="keyword">in</span> $(<span class="keyword">ls</span> /etc)</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="1-2-使用"><a href="#1-2-使用" class="headerlink" title="1.2 使用"></a>1.2 使用</h3><blockquote>
<p>需要$</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">your_name=&quot;qinjx&quot;</span><br><span class="line">echo $your_name</span><br><span class="line">echo $&#123;your_name&#125;</span><br><span class="line">echo &quot;I am good at $&#123;your_name&#125;Script&quot;</span><br></pre></td></tr></table></figure>

<h2 id="二、运算符"><a href="#二、运算符" class="headerlink" title="二、运算符"></a>二、运算符</h2><h2 id="三、数据结构"><a href="#三、数据结构" class="headerlink" title="三、数据结构"></a>三、数据结构</h2><h3 id="2-1-字符串"><a href="#2-1-字符串" class="headerlink" title="2.1 字符串"></a>2.1 字符串</h3><h4 id="单引号"><a href="#单引号" class="headerlink" title="单引号"></a>单引号</h4><ul>
<li>单引号里的任何字符都会原样输出，单引号字符串中的变量无效</li>
<li>单引号字串中不能出现单独一个的单引号（对单引号使用转义符后也不行），但可成对出现，作为字符串拼接使用。</li>
</ul>
<h4 id="双引号"><a href="#双引号" class="headerlink" title="双引号"></a>双引号</h4><ul>
<li>双引号里可以有变量</li>
<li>双引号里可以出现转义字符</li>
</ul>
<h4 id="字符串拼接"><a href="#字符串拼接" class="headerlink" title="字符串拼接"></a>字符串拼接</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">greeting=&quot;hello, &quot;$your_name&quot; !&quot;</span><br><span class="line">greeting_1=&quot;hello, $&#123;your_name&#125; !&quot;</span><br></pre></td></tr></table></figure>

<figure class="highlight dust"><table><tr><td class="code"><pre><span class="line"><span class="xml">1. 字符串长度:  $</span><span class="template-tag">&#123;#<span class="name">str</span>&#125;</span><span class="xml"> </span></span><br><span class="line"><span class="xml">2. 子串：$</span><span class="template-variable">&#123;str:1:4&#125;</span><span class="xml"> </span></span><br></pre></td></tr></table></figure>



<h3 id="2-2-数组"><a href="#2-2-数组" class="headerlink" title="2.2 数组"></a>2.2 数组</h3><figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">array_name</span>=(value<span class="number">0</span> value<span class="number">1</span> value<span class="number">2</span> value<span class="number">3</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span>. 单个赋值：array_name<span class="selector-attr">[0]</span>=value0</span><br><span class="line"><span class="number">2</span>. 获取：valuen=$&#123;array_name<span class="selector-attr">[0]</span>&#125;</span><br><span class="line"><span class="number">3</span>. 长度：length=$&#123;<span class="selector-id">#array_name</span><span class="selector-attr">[@]</span>&#125;、$&#123;<span class="selector-id">#array_name</span><span class="selector-attr">[*]</span>&#125;</span><br><span class="line"><span class="number">4</span>. 元素长度：length=$&#123;<span class="selector-id">#array_name</span><span class="selector-attr">[n]</span>&#125;</span><br></pre></td></tr></table></figure>



<h2 id="四、函数"><a href="#四、函数" class="headerlink" title="四、函数"></a>四、函数</h2><h3 id="3-1-自定义函数"><a href="#3-1-自定义函数" class="headerlink" title="3.1 自定义函数"></a>3.1 自定义函数</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">demoFun()&#123;</span><br><span class="line">	echo &quot;第一个参数为 $1 !&quot;</span><br><span class="line">    echo &quot;第二个参数为 $2 !&quot;</span><br><span class="line">    echo &quot;这是我的第一个 shell 函数!&quot;</span><br><span class="line">    return &quot;aaa&quot;</span><br><span class="line">&#125;</span><br><span class="line">echo &quot;-----函数开始执行-----&quot;</span><br><span class="line">demoFun 1 2 </span><br></pre></td></tr></table></figure>

<h4 id="3-12-返回值"><a href="#3-12-返回值" class="headerlink" title="3.12 返回值"></a>3.12 返回值</h4><p> 获得上个返回值 $?</p>
<h4 id="3-11-参数"><a href="#3-11-参数" class="headerlink" title="3.11 参数"></a>3.11 参数</h4><ol>
<li><p>取参：$n  当n&gt;=10时，需要使用${n}来获取参数</p>
</li>
<li><p>参数个数：$#</p>
</li>
<li><p>拿到所有参数</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span>. <span class="variable">$*</span>  <span class="string">&quot;1 2 3&quot;</span></span><br><span class="line"><span class="number">2</span>. <span class="variable">$@</span>   <span class="string">&quot;1&quot;</span> ,<span class="string">&quot;2&quot;</span>, <span class="string">&quot;3&quot;</span></span><br></pre></td></tr></table></figure></li>
<li><p>当前进程号：$$</p>
</li>
</ol>
<h3 id="3-2-函数参数"><a href="#3-2-函数参数" class="headerlink" title="3.2 函数参数"></a>3.2 函数参数</h3><h2 id="五、shell脚本"><a href="#五、shell脚本" class="headerlink" title="五、shell脚本"></a>五、shell脚本</h2><h3 id="4-1-脚本传参"><a href="#4-1-脚本传参" class="headerlink" title="4.1 脚本传参"></a>4.1 脚本传参</h3><p>和shell的函数传参相同，用$n 获取</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo &quot;执行的文件名：$0&quot;;</span><br><span class="line">echo &quot;第一个参数为：$1&quot;;</span><br><span class="line">echo &quot;第二个参数为：$2&quot;;</span><br><span class="line">echo &quot;第三个参数为：$3&quot;;</span><br></pre></td></tr></table></figure>

<h2 id="内置函数"><a href="#内置函数" class="headerlink" title="内置函数"></a>内置函数</h2><ol>
<li><p>scanf   read</p>
</li>
<li><p>print    echo  </p>
</li>
<li><p>获取当前时间 date</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo $(date &quot;+%Y-%m-%d %H:%M:%S&quot;) &gt;&gt; a.txt</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h3><ol>
<li>sh脚本中不能用alias</li>
</ol>
]]></content>
      <categories>
        <category>linux</category>
      </categories>
  </entry>
  <entry>
    <title>xshell的使用</title>
    <url>/2021/10/17/linux/%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE/</url>
    <content><![CDATA[<h3 id="连接VMware"><a href="#连接VMware" class="headerlink" title="连接VMware"></a>连接VMware</h3><ol>
<li><p>配置linux的网络连接</p>
<ol>
<li><p><a href="https://www.cnblogs.com/shireenlee4testing/p/9469650.html">参考-如何使用Xshell连接VMware上的Linux虚拟机</a></p>
</li>
<li><p>在VMware workstation里，点击菜单栏上的【编辑】–&gt;【虚拟网络编辑器】，打开下方的虚拟网络编辑器。</p>
<ol>
<li>选择VMnet8（NAT模式）</li>
<li>管理员模式下取消勾选【使用本地DHCP服务…】</li>
</ol>
</li>
<li><p>net设置查看子网ip和网关ip</p>
<span id="more"></span></li>
<li><p>root下 vi /etc/sysconfig/network-scripts/ifcfg-ens* </p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"><span class="attribute">BOOTPROTO</span>=static</span><br><span class="line"><span class="attribute">IPADDR</span>=192.168.44.3    </span><br><span class="line"><span class="attribute">NETMASK</span>=255.255.255.0</span><br><span class="line"><span class="attribute">GATEWAY</span>=192.168.44.2    				</span><br><span class="line"><span class="attribute">ONBOOT</span>=<span class="literal">yes</span></span><br><span class="line"></span><br><span class="line">192.168.44.0    vmware.net.config.z</span><br><span class="line"><span class="attribute">IPADDR</span>=192.168.44.3    host<span class="built_in"> ip</span></span><br><span class="line"><span class="built_in"></span><span class="attribute">GATEWAY</span>=192.168.44.2   getway----vmware.net.config.getway</span><br></pre></td></tr></table></figure></li>
<li><p>设置DNS</p>
<p>vi /etc/sysconfig/network</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">NETWORKING</span>=<span class="literal">yes</span></span><br><span class="line"><span class="attr">HOSTNAME</span>=slave1</span><br></pre></td></tr></table></figure></li>
<li><p>修改主机名</p>
<p>vim /etc/hostname</p>
<p>slave1</p>
</li>
<li><p>重启网络服务</p>
<ol>
<li>systemctl stop NetworkManager 关闭manager</li>
<li>systemctl restart network</li>
<li>service network restart</li>
</ol>
</li>
<li><p>设置windows的网络连接</p>
<ol>
<li><p>设置VMnet8在Windows上的IP属性，（打开控制面板–&gt;网络和Internet，在右侧点击【更改适配器设置】，进入“网络连接”页面）</p>
<p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20211006230732307.png" alt="image-20211006230732307"></p>
</li>
</ol>
</li>
<li><p>连接 ssh 192.168.44.3</p>
</li>
</ol>
</li>
<li><p>免密连接</p>
<ol>
<li><a href="https://www.cnblogs.com/dadonggg/p/8350423.html">参考—Xshell配置ssh免密码登录-密钥公钥(Public key)</a></li>
<li>ssh登录原理<ol>
<li>客户端发出认证请求；</li>
<li>服务器端使用客户端发送的公钥对一个随机的256位的字符串进行加密，并发送给 客户端；</li>
<li>客户端使用私钥对字符串进行解密，并生成一个MD5值发送给服务器端；</li>
<li>服务器端根据原始随机字符串生成MD5值进行匹配, 确认客户端身份；</li>
<li>至此, 双方互相确认对方身份并建立加密信道, 可以正式进行安全通信。</li>
<li><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20211007002314884.png" alt="image-20211007002314884"></li>
</ol>
</li>
</ol>
</li>
</ol>
<p>cat id_rsa_2048_master.pub &gt;&gt; ~/.ssh/authorized_keys</p>
]]></content>
      <categories>
        <category>utils</category>
      </categories>
  </entry>
  <entry>
    <title>spring事务</title>
    <url>/2022/04/05/spring/spring%E4%BA%8B%E5%8A%A1/</url>
    <content><![CDATA[<p>1</p>
<blockquote>
<p>开启事务的实质–&gt;</p>
<ol>
<li><p>事务创建一个conn</p>
</li>
<li><p>conn.setAutoCommit(false)</p>
</li>
<li><p>target.method</p>
</li>
<li><p>try{</p>
</li>
<li><p>conn.commit</p>
<p>}catch{ conn.rollback}</p>
</li>
<li></li>
</ol>
</blockquote>
<h3 id="传播机制Propagation"><a href="#传播机制Propagation" class="headerlink" title="传播机制Propagation"></a>传播机制Propagation</h3><figure class="highlight"><table><tr><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>PROPAGATION_REQUIRED</td>
<td>如果当前存在事务，则加入该事务；如果当前没有事务，则创建一个新的事务。这是<strong>默认值</strong>。</td>
<td>可重入</td>
</tr>
<tr>
<td>PROPAGATION_REQUIRES_NEW</td>
<td>建一个<strong>新的事务</strong>，如果当前存在事务，则把当前事务<strong>挂起</strong>。</td>
<td>new</td>
</tr>
<tr>
<td>PROPAGATION_SUPPORTS</td>
<td>如果当前存在事务，则加入该事务；如果当前没有事务，则以非事务的方式继续运行</td>
<td>继承</td>
</tr>
<tr>
<td>PROPAGATION_NEVER</td>
<td></td>
<td></td>
</tr>
<tr>
<td>PROPAGATION_NOT_SUPPORTED</td>
<td></td>
<td></td>
</tr>
<tr>
<td>PROPAGATION_MANDATORY</td>
<td></td>
<td></td>
</tr>
<tr>
<td>PROPAGATION_NESTED</td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h3 id="事务失效原因"><a href="#事务失效原因" class="headerlink" title="事务失效原因"></a>事务失效原因</h3><ol>
<li><p>Bean问题</p>
<ol>
<li>类不是@component</li>
</ol>
</li>
<li><p>方法问题</p>
<ol>
<li>方法为非public</li>
</ol>
</li>
<li><p>方法内部问题</p>
<ol>
<li>方法调用了this.方法</li>
<li>方法启动了新的线程</li>
</ol>
</li>
<li><p>异常问题</p>
<ol>
<li><p>事务切面的优先级最低，所以以下情况对AOP切面方法相同。</p>
</li>
<li><p><strong>runtime异常被try catch</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//可以通过</span></span><br><span class="line"><span class="comment">//1. 不catch </span></span><br><span class="line"><span class="comment">//2. catch后再抛出</span></span><br><span class="line"><span class="comment">//3. catch后通过support类手动回滚</span></span><br></pre></td></tr></table></figure></li>
<li><p>抛出了受检异常</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//可以通过指定异常来解决</span></span><br></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p>数据库自身不支持事务</p>
</li>
</ol>
<h4 id="回滚机制"><a href="#回滚机制" class="headerlink" title="回滚机制"></a>回滚机制</h4><ol>
<li>抛出了runtimeExcept或者error</li>
</ol>
<h4 id="编程式事务"><a href="#编程式事务" class="headerlink" title="编程式事务"></a>编程式事务</h4><blockquote>
<ul>
<li><strong>编程式事务</strong>使用TransactionTemplate或者直接使用底层的PlatformTransactionManager。对于编程式事务管理，spring推荐使用TransactionTemplate。</li>
</ul>
</blockquote>
<h4 id="声明式事务"><a href="#声明式事务" class="headerlink" title="声明式事务"></a>声明式事务</h4><blockquote>
<ul>
<li><strong>声明式事务</strong>是建立在AOP之上的。其本质是对方法前后进行拦截，然后在目标方法开始之前创建或者加入一个事务，在执行完目标方法之后根据执行情况提交或者回滚事务。声明式事务最大的优点就是不需要通过编程的方式管理事务，这样就不需要在业务逻辑代码中掺杂事务管理的代码，只需在配置文件中做相关的事务规则声明(或通过基于@Transactional注解的方式)，便可以将事务规则应用到业务逻辑中。</li>
</ul>
</blockquote>
]]></content>
      <categories>
        <category>spring</category>
      </categories>
  </entry>
  <entry>
    <title>spring概念解析</title>
    <url>/2022/03/18/spring/spring%E6%A6%82%E5%BF%B5/</url>
    <content><![CDATA[<p>[toc]</p>
<h2 id="一、基本概念"><a href="#一、基本概念" class="headerlink" title="一、基本概念"></a>一、基本概念</h2><blockquote>
<p>Spring是</p>
</blockquote>
<h3 id="1-核心"><a href="#1-核心" class="headerlink" title="1. 核心"></a>1. 核心</h3><ol>
<li>IOC 控制反转<ol>
<li>DI 依赖注入</li>
</ol>
</li>
<li>AOP 面向切面<ol>
<li>proxy 代理</li>
</ol>
</li>
<li>IOC  = 工厂模式 + XML + 反射</li>
<li>IOC = Bean+Component</li>
<li>DI ,  AOP ，事务</li>
</ol>
<h3 id="2-优点"><a href="#2-优点" class="headerlink" title="2. 优点"></a>2. 优点</h3><ol>
<li><p>降低组件之间的耦合度（互相依赖）</p>
</li>
<li><p>方便开发，降低复杂度: 提供了很多已经实现的辅佐组件</p>
</li>
<li><p>提供了AOP技术，利用它很容易实现如权限拦截，运行期监控等功能 </p>
</li>
<li><p>IOC技术容器提供单例模式支持，开发人员不需要自己编写实现代码.</p>
</li>
<li><p>方便整合其他框架</p>
</li>
<li><p>spring源码是</p>
</li>
<li><p>方便事务操作</p>
</li>
</ol>
<h2 id="二、IOC-控制反转"><a href="#二、IOC-控制反转" class="headerlink" title="二、IOC(控制反转)"></a>二、IOC(控制反转)</h2><h3 id="1-IOC介绍"><a href="#1-IOC介绍" class="headerlink" title="1. IOC介绍"></a>1. IOC介绍</h3><ol>
<li><p>平常</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Person s=<span class="keyword">new</span> Person();<span class="comment">//耦合度太高</span></span><br></pre></td></tr></table></figure></li>
<li><p>现在：引入Ioc，将创建对象的控制权交给spring的ioc，如果需要使用，就用DI(依赖注入)@Autowired.</p>
</li>
</ol>
<span id="more"></span>

<ol start="3">
<li><p>优点：集中管理对象，方便维护，降低了耦合度。</p>
</li>
<li><p>IOC和DI区别</p>
<ol>
<li><p>ioc控制了对象创建的权力。</p>
</li>
<li><p>di是ioc的实现的一步骤。</p>
</li>
</ol>
</li>
<li><p>哪些类放入ioc</p>
<ol>
<li>放入：工具类，dao,service,controller</li>
<li>不放人：实体类，servlet,listener,filter</li>
</ol>
</li>
</ol>
<h3 id="2-IOC配置Bean"><a href="#2-IOC配置Bean" class="headerlink" title="2. IOC配置Bean"></a>2. IOC配置Bean</h3><ol>
<li><p>xml配置：&lt;bean class:path&gt;</p>
<ol>
<li><p>属性</p>
<ol>
<li>set +&lt;properity name value&gt;</li>
<li>set+&lt;properity name ref&gt;</li>
<li>构造注入：&lt;constructor-arg&gt;+index</li>
</ol>
</li>
<li><p>代码</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;aa&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.example.spring_tech.entity.user&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span><span class="attr">value</span>=<span class="string">&quot;11222&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p>注解@Component(@Controller,@Service,@Repostory)</p>
</li>
<li><p>javaConfig:@Configtursion+@Bean，这像是自己实现的ioc，更灵活。</p>
</li>
<li><p>@import</p>
</li>
</ol>
<h3 id="3-IOC获取Bean"><a href="#3-IOC获取Bean" class="headerlink" title="3. IOC获取Bean"></a>3. IOC获取Bean</h3><p>ioc两种获取(接口)</p>
<ul>
<li><p>BeanFactory 内置</p>
<ul>
<li>懒加载，加载配置文件不会创建对象，只有getBean才会创建bean，</li>
</ul>
</li>
<li><p>ApplicationContext </p>
<ul>
<li>饿汉式，加载配置文件的时候就会创建对象</li>
<li>实现类</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ApplicationContext ioc=<span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;/config/beans.xml&quot;</span>);</span><br><span class="line">Student mybean = (Student) ioc.getBean(<span class="string">&quot;mybean&quot;</span>);</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="4-ioc原理"><a href="#4-ioc原理" class="headerlink" title="4. ioc原理"></a>4. ioc原理</h3><ol>
<li><p>简单工厂+反射</p>
</li>
<li><p>code:beanfactory.getBean+(强制类型转换+Class.forName) </p>
</li>
<li><p>ioc实现原理DI技术–&gt;map.put(name,new)</p>
</li>
<li><p>ioc的对象是创建ioc的时候一起同时创建的，不是启动时创建的，也不是使用的时候创建的。</p>
</li>
</ol>
<h3 id="5-紧耦合-松耦合-DIP"><a href="#5-紧耦合-松耦合-DIP" class="headerlink" title="5.紧耦合 松耦合(DIP)"></a>5.紧耦合 松耦合(DIP)</h3><ol>
<li>紧耦合：类之间的高度依赖</li>
<li>松耦合：单一职责原则–&gt;接口分离原则–&gt;依赖倒置原则。</li>
</ol>
<h2 id="二、Bean"><a href="#二、Bean" class="headerlink" title="二、Bean"></a>二、Bean</h2><h3 id="1-bean概念"><a href="#1-bean概念" class="headerlink" title="1. bean概念"></a>1. bean概念</h3><h4 id="2-1-IOC-bean-行为"><a href="#2-1-IOC-bean-行为" class="headerlink" title="2.1 IOC bean 行为"></a>2.1 IOC bean 行为</h4><h5 id="1-Bean注册"><a href="#1-Bean注册" class="headerlink" title="1. Bean注册"></a>1. Bean注册</h5><blockquote>
<p>@Component , @Repository , @ Controller , @Service , @Configration这些注解都是把你要实例化的对象转化成一个Bean，放在IoC容器中，等你要用的时候，它会和上面的@Autowired , @Resource配合到一起，把对象、属性、方法完美组装。</p>
</blockquote>
<h5 id="2-依赖注入"><a href="#2-依赖注入" class="headerlink" title="2. 依赖注入"></a>2. 依赖注入</h5><blockquote>
<p>   @Autowired , @Resource，可以通过byTYPE（@Autowired）、byNAME（@Resource）的方式获取Bean；</p>
</blockquote>
<ol>
<li> 依赖注入的优点</li>
</ol>
<p>   如果没有DI，那么每次都有需要 xmlApplication.getBean()来获取bean</p>
<ol start="2">
<li><p>使用</p>
<ol>
<li><p>通过setter</p>
<p>普通：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;UserService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.example.spring_tech.service.UserServiceImpl&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;userMapper&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;userMapper&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>p命名空间</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;UserService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.example.spring_tech.service.UserServiceImpl&quot;</span> </span></span><br><span class="line"><span class="tag">      <span class="attr">p:userMapper-ref</span>=<span class="string">&quot;userMapper&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>通过构造方法</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;UserService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.example.spring_tech.service.UserServiceImpl&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;userMapper&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;userMapper&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ol>
<h3 id="2-2-Bean属性"><a href="#2-2-Bean属性" class="headerlink" title="2.2 Bean属性"></a>2.2 Bean属性</h3><ol>
<li>bean元素:使用该元素描述需要spring容器管理对象</li>
<li>name属性:给被管理的对象起个名字,获得对象时getBean(“name值”)</li>
<li>Class/Type属性:被管理对象的完整类名  </li>
<li>id属性:与name属性一模一样，名称不可重复，不能使用特殊字符</li>
</ol>
<h3 id="2-bean加载过程"><a href="#2-bean加载过程" class="headerlink" title="2. bean加载过程"></a>2. bean加载过程</h3><h3 id="3-bean生命周期"><a href="#3-bean生命周期" class="headerlink" title="3. bean生命周期"></a>3. bean生命周期</h3><h5 id="3-1-scope属性"><a href="#3-1-scope属性" class="headerlink" title="3.1 scope属性"></a>3.1 scope属性</h5><blockquote>
<p>​    绝大多数情况下，使用单例singleton(默认值)，但是在与struts整合时候，务必要用prototype多例，因为struts2在每次请求都会创建一个新的Action，若为单例，在多请求情况下，每个请求找找spring拿的都是同一个action。</p>
</blockquote>
<ol>
<li>singleton   默认值<br>单例对象   :被标识为单例的对象在spring容器中只会存在一个实例</li>
<li>prototype<br>多例原型:被标识为多例的对象,每次在获得才会被创建,每次创建都是新的对象</li>
<li>request<br>Web环境下,对象与request生命周期一致    </li>
<li>session<br>Web环境下,对象与session生命周期一致</li>
</ol>
<h3 id="4-java-bean-和spring-bean的区别"><a href="#4-java-bean-和spring-bean的区别" class="headerlink" title="4.java bean 和spring bean的区别"></a>4.java bean 和spring bean的区别</h3><ol>
<li>由spring ioc实例化，管理的对象叫做bean.</li>
<li>java bean 是new出来的</li>
<li>都有getter setter</li>
</ol>
<h3 id="5-bean实例化方式"><a href="#5-bean实例化方式" class="headerlink" title="5. bean实例化方式"></a>5. bean实例化方式</h3><ol>
<li><p>无参构造</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userMapper&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.wyg.mapper.UserMapperImpl&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>这样的话就可以通过context获得bean，内部用的是无参构造</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ClassPathXmlApplicationContext app=<span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;applicationConfig.xml&quot;</span>);</span><br><span class="line">Object userMapper = app.getBean(<span class="string">&quot;userMapper&quot;</span>)</span><br></pre></td></tr></table></figure></li>
<li><p>工厂静态方法</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userMapper&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.wyg.factory.StaticFactory&quot;</span> </span></span><br><span class="line"><span class="tag">      <span class="attr">factory-mothon</span>=<span class="string">&quot;getUserMapper&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>这样就可以在创建mapper之前多做些事情(传入参数)</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> UserMapper <span class="title">getUserMapper</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//do something</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> UserMapper(args);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>工厂实例方法</p>
</li>
</ol>
<h2 id="四、AOP"><a href="#四、AOP" class="headerlink" title="四、AOP"></a>四、AOP</h2><blockquote>
<p>​    aop就是将动态代理规范化，约定大于配置。</p>
</blockquote>
<h3 id="1-动态代理"><a href="#1-动态代理" class="headerlink" title="1.动态代理"></a>1.动态代理</h3><ol>
<li><p>作用：创建对象，不改变类的情况下实现功能增强。</p>
</li>
<li><p>两种实现方式：</p>
<ol>
<li>JDK<ol>
<li>要求目标类有接口</li>
<li>若没有接口。可用CGlib，</li>
</ol>
</li>
<li>Proxy</li>
</ol>
</li>
</ol>
<h3 id="2-AOP四要素"><a href="#2-AOP四要素" class="headerlink" title="2. AOP四要素"></a>2. AOP四要素</h3><ol>
<li><p>aspect:切面，增强的功能的代码。</p>
<p>三要素：</p>
<ol>
<li>功能代码函数def doLog()</li>
<li>代码位置(切入点)，一般就是业务代码函数。execution(path.def)</li>
<li>执行时间（before/after）</li>
</ol>
</li>
<li><p>joinpoint:连接点，业务代码。</p>
</li>
<li><p>pointCut切入点,连接点的结合</p>
</li>
<li><p>advice 通知，表示切面功能执行的时间</p>
</li>
</ol>
<h3 id="3-AOP实现"><a href="#3-AOP实现" class="headerlink" title="3. AOP实现"></a>3. AOP实现</h3><ol>
<li>spring,事务处理常用aop（代码多，不常用）</li>
<li>aspectJ:专业aop框架。spring集成了这个框架。<ol>
<li>xml实现：用于事务</li>
<li>注解实现：常见环境下都用注解。<ol>
<li>@Before</li>
<li>@AfterReturn</li>
<li>@Around</li>
<li>@AfterThrowing</li>
<li>@After</li>
</ol>
</li>
<li>切入点表达式execution(public pString]* [com.wyg.user.]getName(..)* exception)</li>
</ol>
</li>
</ol>
<h3 id="4-AOP实现步骤"><a href="#4-AOP实现步骤" class="headerlink" title="4. AOP实现步骤:"></a>4. AOP实现步骤:</h3><ol>
<li><p>加入依赖spring,aspect</p>
</li>
<li><p>创建目标类(接口，实现)</p>
</li>
<li><p>创建切面类</p>
<ol>
<li>加如@aspect</li>
<li>定义增强功能方法，并在方法上加入注解</li>
</ol>
</li>
<li><p>创建spring配置文件：声明对象，交予ioc管理  加入aop标志生成代理类<a href="aop:aspectj-autoproxy/">aop:aspectj-autoproxy/</a>。</p>
</li>
<li><p>xml配最后的<strong>自动代理生成器</strong>标志还是牵线人进行切面类和目标类.业务函数的联系。</p>
</li>
<li><p>execution简化</p>
<ol>
<li>去掉public</li>
<li>用*..</li>
<li>..代替arg</li>
<li>do*代替业务函数</li>
</ol>
</li>
</ol>
<h3 id="spring使用步骤"><a href="#spring使用步骤" class="headerlink" title="spring使用步骤"></a>spring使用步骤</h3><ol>
<li>依赖denpendcy</li>
<li>创建类，dao,service,controller</li>
<li>创建配置文件<bean></li>
<li>创建容器对象ClassPathXmlAppicationContext.getBean()</li>
</ol>
<h4 id="集成mybatis"><a href="#集成mybatis" class="headerlink" title="集成mybatis"></a>集成mybatis</h4><ol>
<li><p>mybatis步骤</p>
<ol>
<li><p>创建对象dao</p>
</li>
<li><p>mapper.xml</p>
</li>
<li><p>创建代理</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//创建工厂</span></span><br><span class="line"><span class="comment">//xml实现</span></span><br><span class="line">String resource = <span class="string">&quot;org/mybatis/example/mybatis-config.xml&quot;</span>;</span><br><span class="line">InputStream inputStream = Resources.getResourceAsStream(resource);</span><br><span class="line">SqlSessionFactory sqlSessionFactory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(inputStream);</span><br><span class="line"></span><br><span class="line"><span class="comment">//java实现</span></span><br><span class="line">DataSource dataSource = BlogDataSourceFactory.getBlogDataSource();</span><br><span class="line">TransactionFactory transactionFactory = <span class="keyword">new</span> JdbcTransactionFactory();</span><br><span class="line">Environment environment = <span class="keyword">new</span> Environment(<span class="string">&quot;development&quot;</span>, transactionFactory, dataSource);</span><br><span class="line">Configuration configuration = <span class="keyword">new</span> Configuration(environment);</span><br><span class="line">configuration.addMapper(BlogMapper.class);</span><br><span class="line">SqlSessionFactory sqlSessionFactory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(configuration);</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取sqlsession</span></span><br><span class="line">SqlSession session = sqlSessionFactory.openSession()</span><br><span class="line"><span class="comment">//创建mapper实例</span></span><br><span class="line">UserMapper mapper = session.getMapper(UserMapper.class);</span><br></pre></td></tr></table></figure></li>
<li><p>mybatis步骤</p>
<ol>
<li><p>依赖mysql-connector-java mybatis</p>
</li>
<li><p>mybatis.config.xml </p>
<ol>
<li>&lt;dataSource&gt;&lt;driver,url,username,password&gt;</li>
<li>&lt;mappers&gt;&lt;mapper resource=”com.wyg.mapper.*.xml”&gt;</li>
</ol>
</li>
<li><p>mapper.xml—-&gt;&lt;select,insert&gt;</p>
</li>
<li><p>javaTest</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="number">1.</span>创建文件流</span><br><span class="line">in=org.apache.ibatis.io.Resources.getResourceAsStream(<span class="string">&quot;.xml&quot;</span>);</span><br><span class="line"><span class="number">2.</span>创建工厂</span><br><span class="line">SqlSessionFactory factory=<span class="keyword">new</span> SqlSessionFactoryBuilder().build(in);</span><br><span class="line"><span class="number">3.</span>创建session</span><br><span class="line">SqlSession sqlsession=factory.openSession();</span><br><span class="line"><span class="number">4.</span>创建mapper</span><br><span class="line">UserMapper userMapper=sqlSession.getMapper(UserMapper.class);</span><br><span class="line"><span class="number">5.</span>调用mapper</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
<li></li>
</ol>
</li>
</ol>
<h3 id="常用注解"><a href="#常用注解" class="headerlink" title="常用注解"></a>常用注解</h3><ol>
<li><p>@Componet —-&gt;一个bean</p>
</li>
<li><p>@Configration —&gt;一本beans，一堆bean</p>
</li>
<li><p>@Bean—&gt;一个生成bean的方法，若干个@Bean常放在@Configration/@Component中，可以加载Conponent不能加载的自定义类。</p>
</li>
<li><p>bean的各个注解</p>
</li>
<li><p>MapperScan:执行类上加入@MapperScan(“com.example.springsecruity.mapper”)</p>
<p>需要加入依赖</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">mybatis-spring-boot-starter</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h3><ol>
<li><p>mysql</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>mybatis</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--mybatis-plus--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- velocity 模板引擎, Mybatis Plus 代码生成器需要 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.velocity<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>velocity-engine-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>spring</p>
</li>
<li><p>springBoot</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>springCloud</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--服务注册nacos--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-ribbon<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--服务调用--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--hystrix依赖，主要是用  @HystrixCommand --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-hystrix<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">       </span><br></pre></td></tr></table></figure></li>
<li><p>swagger</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--swagger--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger-ui<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>单元测试</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>json数据转换</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.google.code.gson<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>gson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="alibaba依赖"><a href="#alibaba依赖" class="headerlink" title="alibaba依赖"></a>alibaba依赖</h4><ol>
<li><p>oss</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliyun.oss<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aliyun-sdk-oss<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>视频点播</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliyun<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aliyun-java-sdk-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>easyExcel</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>easyexcel<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>json</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliyun<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aliyun-java-sdk-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        &lt;/dependency</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ol>
]]></content>
      <categories>
        <category>spring</category>
      </categories>
  </entry>
  <entry>
    <title>spring源码-原理</title>
    <url>/2022/03/31/spring/%E6%BA%90%E7%A0%81-%E5%8E%9F%E7%90%86/</url>
    <content><![CDATA[<h2 id="启动原理"><a href="#启动原理" class="headerlink" title="启动原理"></a>启动原理</h2><h3 id="main"><a href="#main" class="headerlink" title="main"></a>main</h3><p>@SpringBootApplication = (默认属性)@Configuration + @EnableAutoConfiguration + @ComponentScan</p>
<h2 id="一、bean注入"><a href="#一、bean注入" class="headerlink" title="一、bean注入"></a>一、bean注入</h2><h3 id="Component的加载"><a href="#Component的加载" class="headerlink" title="@Component的加载"></a>@Component的加载</h3><blockquote>
<p>@ComponentScan没指定会自动扫描本包下的Component，</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">loadClass</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//获得scan路径</span></span><br><span class="line">        <span class="keyword">final</span> ComponentScan annotation = LoginApplication.class.getAnnotation(ComponentScan.class);</span><br><span class="line">        String scanPath=annotation.value()[<span class="number">0</span>];</span><br><span class="line">        <span class="comment">//过的本jar的classLoder</span></span><br><span class="line">        ClassLoader classLoader=<span class="keyword">this</span>.getClass().getClassLoader();</span><br><span class="line">        <span class="comment">//获得资源</span></span><br><span class="line">        <span class="keyword">final</span> URL resource = classLoader.getResource(scanPath);</span><br><span class="line">        File file=<span class="keyword">new</span> File(resource.getFile());</span><br><span class="line">        <span class="keyword">final</span> File[] files = file.listFiles(f-&gt;f.getPath().endsWith(<span class="string">&quot;.class&quot;</span>));<span class="comment">//获得路径下的所有class文件</span></span><br><span class="line">        <span class="comment">//加载component;</span></span><br><span class="line">        <span class="keyword">for</span> (File f : files) &#123;</span><br><span class="line">            <span class="keyword">final</span> String path = f.getAbsoluteFile().getPath();</span><br><span class="line">            String className=path.substring(path.indexOf(<span class="string">&quot;com.wyg&quot;</span>),path.indexOf(<span class="string">&quot;.class&quot;</span>));</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">//加载类</span></span><br><span class="line">                Class clazz =classLoader.loadClass(className);</span><br><span class="line">                <span class="comment">//判断是否为bean</span></span><br><span class="line">                <span class="keyword">if</span>(clazz.isAnnotationPresent(Component.class))&#123;</span><br><span class="line">                    putTypeToMap(clazz);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="创建类型池—-beanDefinetionMap"><a href="#创建类型池—-beanDefinetionMap" class="headerlink" title="创建类型池—-beanDefinetionMap"></a>创建类型池—-beanDefinetionMap</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> ConcurrentHashMap&lt;String, BeanDefinition&gt; beanDefinitionMap = <span class="keyword">new</span> ConcurrentHashMap&lt;&gt;();</span><br><span class="line"> <span class="function"><span class="keyword">void</span> <span class="title">putTypeToMap</span><span class="params">(Class type)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> Component annotation = (Component) type.getAnnotation(Component.class);</span><br><span class="line">        String name = annotation.value();</span><br><span class="line">        BeanDefinition beanDefinition = <span class="keyword">new</span> BeanDefinition();</span><br><span class="line">        beanDefinition.setType(type);</span><br><span class="line">        beanDefinitionMap.put(name, beanDefinition);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="创建单例池"><a href="#创建单例池" class="headerlink" title="创建单例池"></a>创建单例池</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//获得单例池</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">putObjectToMap</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (String name : beanDefinitionMap.keySet()) &#123;</span><br><span class="line">        <span class="keyword">final</span> BeanDefinition beanDefinition = beanDefinitionMap.get(name);</span><br><span class="line">        <span class="keyword">if</span> (beanDefinition.getScope().equals(<span class="string">&quot;single&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">final</span> Object bean = createBean(name,beanDefinition);</span><br><span class="line">            singleMap.put(name, bean);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="获得bean"><a href="#获得bean" class="headerlink" title="获得bean"></a>获得bean</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function">Object <span class="title">getBean</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">final</span> BeanDefinition beanDefinition = beanDefinitionMap.get(name);</span><br><span class="line">       <span class="keyword">if</span> (beanDefinition.getScope().equals(<span class="string">&quot;signle&quot;</span>)) &#123;</span><br><span class="line">           <span class="comment">//单例模式--&gt;</span></span><br><span class="line">           Object bean = singleMap.get(name);</span><br><span class="line">           <span class="keyword">if</span> (bean == <span class="keyword">null</span>) &#123;</span><br><span class="line">               bean = createBean(name,beanDefinition);</span><br><span class="line">               singleMap.put(name, bean);</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">return</span> bean;</span><br><span class="line">       &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">           <span class="keyword">return</span> createBean(name,beanDefinition);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>



<h3 id="创建bean—单例模式"><a href="#创建bean—单例模式" class="headerlink" title="创建bean—单例模式"></a>创建bean—单例模式</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//创建单例bean</span></span><br><span class="line">    <span class="function">Object <span class="title">createBean</span><span class="params">(String beanName,BeanDefinition beanDefinition)</span> </span>&#123;</span><br><span class="line">        Class type = beanDefinition.getType();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//依赖注入</span></span><br><span class="line">            <span class="keyword">final</span> Object bean = type.newInstance();</span><br><span class="line">            <span class="keyword">for</span> (Field field : type.getDeclaredFields()) &#123;</span><br><span class="line">                <span class="keyword">if</span>(field.isAnnotationPresent(Autowired.class))&#123;</span><br><span class="line">                    field.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">                    field.set(bean,getBean(field.getName()));<span class="comment">//注入bean</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(bean <span class="keyword">instanceof</span> BeanNameAware)</span><br><span class="line">                ((BeanNameAware)bean).setBeanName(beanName);</span><br><span class="line">            <span class="keyword">if</span>(bean <span class="keyword">instanceof</span> InitializingBean)&#123;</span><br><span class="line">                ((InitializingBean)bean).afterPropertiesSet();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> bean;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="依赖注入问题"><a href="#依赖注入问题" class="headerlink" title="依赖注入问题"></a>依赖注入问题</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//创建单例bean</span></span><br><span class="line"> <span class="function">Object <span class="title">createBean</span><span class="params">(BeanDefinition beanDefinition)</span> </span>&#123;</span><br><span class="line">     Class type = beanDefinition.getType();</span><br><span class="line">     <span class="keyword">try</span> &#123;</span><br><span class="line">         <span class="comment">//依赖注入</span></span><br><span class="line">         <span class="keyword">final</span> Object bean = type.newInstance();</span><br><span class="line">         <span class="keyword">for</span> (Field field : type.getDeclaredFields()) &#123;</span><br><span class="line">             <span class="keyword">if</span>(field.isAnnotationPresent(Autowired.class))&#123;</span><br><span class="line">                 field.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">                 field.set(bean,getBean(field.getName()));<span class="comment">//注入bean</span></span><br><span class="line">             &#125;</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">return</span> bean;</span><br><span class="line">     &#125; <span class="keyword">catch</span> (InstantiationException | IllegalAccessException e) &#123;</span><br><span class="line">         e.printStackTrace();</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>



<h3 id="初始化接口"><a href="#初始化接口" class="headerlink" title="初始化接口"></a>初始化接口</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">b</span> <span class="keyword">implements</span> <span class="title">InitializingBean</span></span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterPropertiesSet</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20220318173240631.png" alt="image-20220318173240339"></p>
<h2 id="几种工厂"><a href="#几种工厂" class="headerlink" title="几种工厂"></a>几种工厂</h2><p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/AnnotationConfigApplicationContext.png" alt="AnnotationConfigApplicationContext"></p>
<h3 id="BeanFactory"><a href="#BeanFactory" class="headerlink" title="BeanFactory"></a>BeanFactory</h3><blockquote>
<p>IOC的根接口,给除了的IOC容器的实现提供了规范</p>
<p><strong>XMLBeanFactory</strong></p>
<p><strong>ApplicationContext</strong> </p>
<p><strong>ClassPathXmlApplicationContext</strong> </p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">getBean</span><span class="params">(String name)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">containsBean</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isSingleton</span><span class="params">(String name)</span> <span class="keyword">throws</span> NoSuchBeanDefinitionException </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> String[] getAliases(String name) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> String[<span class="number">0</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="FactoryBean"><a href="#FactoryBean" class="headerlink" title="FactoryBean"></a>FactoryBean</h3><blockquote>
<p>FactoryBean是一个可以生产bean的工厂(自身也是一个Bean)，有点类似工厂方法模式。</p>
<p>它用来创建beanx工厂，工厂生产beanx，可以自定义Beanx是否为单例，只需要重写方法就ok</p>
<p>这个接口的方法可以对比工厂方法模式(参考oneNode.设计模式.工厂方法模式)</p>
</blockquote>
<blockquote>
<p>产生的bean也归spring管理，可以autowire</p>
<p>和普通的@Component区别</p>
<ol>
<li>初始时机早于Spring的普通bean，所有不能依赖注入</li>
<li>该的class方式可变，@Component是写死的</li>
<li>提供了很多实现，比如ListFactoryBean,MapFactoryBean</li>
</ol>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ListFactoryBean</span> <span class="keyword">extends</span> <span class="title">AbstractFactoryBean</span>&lt;<span class="title">List</span>&lt;<span class="title">Object</span>&gt;&gt; </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> List&lt;?&gt; sourceList;<span class="comment">//源list</span></span><br><span class="line">	<span class="keyword">private</span> Class&lt;? extends List&gt; targetListClass;<span class="comment">//class</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSourceList</span><span class="params">(List&lt;?&gt; sourceList)</span> </span>&#123;<span class="keyword">this</span>.sourceList = sourceList;&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTargetListClass</span><span class="params">(<span class="meta">@Nullable</span> Class&lt;? extends List&gt; targetListClass)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.targetListClass = targetListClass;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Class&lt;List&gt; <span class="title">getObjectType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> List.class;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> List&lt;Object&gt; <span class="title">createInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		....</span><br><span class="line">		List&lt;Object&gt; result = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">if</span> (<span class="keyword">this</span>.targetListClass != <span class="keyword">null</span>) &#123;</span><br><span class="line">			result = BeanUtils.instantiateClass(<span class="keyword">this</span>.targetListClass);<span class="comment">//class.newInstance();</span></span><br><span class="line">		&#125;</span><br><span class="line">  		....</span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="ApplicationContext"><a href="#ApplicationContext" class="headerlink" title="ApplicationContext"></a>ApplicationContext</h3><blockquote>
<p>完善的BeanFactory，该IOC除了提供bean的基本管理还提供以下功能</p>
<p>• MessageSource, 提供国际化的消息访问<br>• 资源访问，如URL和文件<br>• 事件传播<br>• 载入多个（有继承关系）上下文 ，使得每一个上下文都专注于一个特定的层次，比如应用的web层; </p>
</blockquote>
<h3 id="AnnotationConfigApplicationContext"><a href="#AnnotationConfigApplicationContext" class="headerlink" title="AnnotationConfigApplicationContext"></a>AnnotationConfigApplicationContext</h3>]]></content>
      <categories>
        <category>spring</category>
      </categories>
  </entry>
  <entry>
    <title>hexo使用</title>
    <url>/2021/11/06/utils/blog/</url>
    <content><![CDATA[<p>搭建个人博客</p>
<ol>
<li><p>下载node.js</p>
</li>
<li><p>npm下载cnpm</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">npm install -g cnpm  --registry=https:<span class="regexp">//</span>registry.npm.taobao.org</span><br></pre></td></tr></table></figure>

<span id="more"></span></li>
<li><p>下载hexo </p>
<figure class="highlight avrasm"><table><tr><td class="code"><pre><span class="line">cnpm install -g hexo-<span class="keyword">cli</span></span><br></pre></td></tr></table></figure></li>
<li><p>创建目录</p>
</li>
<li><p>hexo初始化blog 和deployer</p>
<figure class="highlight coffeescript"><table><tr><td class="code"><pre><span class="line">cd blog</span><br><span class="line">hexo init</span><br><span class="line"><span class="built_in">npm</span> install hexo-deployer-git --save</span><br><span class="line"><span class="built_in">npm</span> i hexo-renderer-swig</span><br></pre></td></tr></table></figure>

<p>或者</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">git clone https:<span class="regexp">//gi</span>tee.com<span class="regexp">/weilining/</span>hexo-starter.git blog</span><br><span class="line">cd blog</span><br><span class="line">git submodule init</span><br><span class="line">git submodule update</span><br><span class="line">npm config set registry http:<span class="regexp">//</span>registry.npm.taobao.org</span><br><span class="line">npm i</span><br><span class="line">npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure></li>
<li><p>hexo g 生成静态文件</p>
</li>
<li><p>启动(localhost:4000)</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">hexo</span> s -p <span class="number">4000</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="操作"><a href="#操作" class="headerlink" title="操作"></a>操作</h3><ol>
<li><p>创建文章</p>
<figure class="highlight 1c"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;文章&quot;</span></span><br></pre></td></tr></table></figure></li>
<li><p>生成静态文件</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">hexo g</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="通过github搭建"><a href="#通过github搭建" class="headerlink" title="通过github搭建"></a>通过github搭建</h3><ol>
<li><p>创建public仓库 name/name.github.io    </p>
</li>
<li><p>下载插件</p>
<figure class="highlight ada"><table><tr><td class="code"><pre><span class="line">cnpm install <span class="comment">--save hexo-deployer-git</span></span><br></pre></td></tr></table></figure></li>
<li><p>修改config.yml</p>
<figure class="highlight dts"><table><tr><td class="code"><pre><span class="line"><span class="symbol">deploy:</span></span><br><span class="line"><span class="symbol">  type:</span> git</span><br><span class="line"><span class="symbol">  repo:</span> https:<span class="comment">//github.com/Wang-yonggan/Wang-yonggan.github.io.git</span></span><br><span class="line"><span class="symbol">  branch:</span> master</span><br></pre></td></tr></table></figure></li>
<li><p>分类：</p>
<ol>
<li>```<br>hexo new page categories<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">   <span class="number">2</span>.  index.md加入<span class="keyword">type</span>: categories</span><br><span class="line"></span><br><span class="line"><span class="number">5</span>. hexo clean &amp;&amp; hexo g &amp;&amp; hexo s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### 主题</span></span><br><span class="line"></span><br><span class="line"><span class="number">1</span>. git <span class="keyword">clone</span> <span class="title">..  themes</span>/name</span><br><span class="line"></span><br></pre></td></tr></table></figure>
git clone <a href="https://github.com/litten/hexo-theme-yilia.git">https://github.com/litten/hexo-theme-yilia.git</a> themes/yilia</li>
</ol>
<p>git clone <a href="https://github.com/theme-next/hexo-theme-next">https://github.com/theme-next/hexo-theme-next</a> themes/next</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">   </span><br><span class="line"></span><br><span class="line"><span class="bullet">2.</span> vim config.yml</span><br><span class="line"></span><br><span class="line">   theme:name</span><br><span class="line"></span><br><span class="line"><span class="bullet">3.</span> hexo clean</span><br><span class="line"></span><br><span class="line"><span class="section">### config.yml</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">1.</span> webset</span><br><span class="line"><span class="bullet">   1.</span> title 标题</span><br><span class="line"><span class="bullet">   2.</span> subtitle 副标题</span><br><span class="line"><span class="bullet">   3.</span> description 网站描述 seo</span><br><span class="line"><span class="bullet">   4.</span> author 作者</span><br><span class="line"><span class="bullet">   5.</span> language 语言</span><br><span class="line"><span class="bullet">   6.</span> timezone 时区</span><br><span class="line"></span><br><span class="line"><span class="bullet">2.</span> URL</span><br><span class="line"></span><br><span class="line">   url：网站的网址</span><br><span class="line">   root：网站的根目录</span><br><span class="line">   permalink：文章的永久链接格式，可以在permalink这里配置，如默认中的配置，在hello world文章中就会是这样的url</span><br><span class="line"></span><br><span class="line"><span class="bullet">3.</span> directory</span><br><span class="line"><span class="bullet">   1.</span> source<span class="emphasis">_dir：存放hexo文章的文件夹，我们写的md文件都放在这个配置对应的文件夹下，默认值是source</span></span><br><span class="line"><span class="emphasis">   2. public_</span>dir：存放hexo g生成的文件，执行hexo g后根目录就会出现这个文件夹，默认值是public</span><br><span class="line"><span class="bullet">   3.</span> tag<span class="emphasis">_dir：按标签存放文章的目录，默认值是tags，如果我们给文章添加标签，使用hexo g时public文件夹下就会多出一个tags文件夹（根据我们的配置文件夹名不同），这里给hello-world.md添加一个tags</span></span><br><span class="line"><span class="emphasis">   4. archive_</span>dir：归档文件夹，存放归档文件，默认值为archives</span><br><span class="line"><span class="bullet">   5.</span> category<span class="emphasis">_dir：分类文件夹，按分类存放的文件，和上面的tags一样，只要在文章中的Font-matter添加了categories就会在使用hexo g构造时出现相应的文件夹</span></span><br><span class="line"><span class="emphasis">   6. code_</span>dir：Include code 文件夹，source<span class="emphasis">_dir 下的子目录，默认值为downloads/code</span></span><br><span class="line"><span class="emphasis">   7. i18n_</span>dir：国际化（i18n）文件夹，默认值:lang</span><br><span class="line"><span class="bullet">   8.</span> skip<span class="emphasis">_render：跳过指定文件的渲染，匹配到的文件将会被不做改动复制到public文件夹下，如果路径对应的是我们的文章，那会直接忽略掉该文章，我们这样设置来忽略掉hello-world.md文件</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">### issue</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">1. 下载主题没有显示：</span></span><br><span class="line"><span class="emphasis">   1. 文件夹名问题</span></span><br><span class="line"><span class="emphasis">   2. config未该</span></span><br><span class="line"><span class="emphasis">   3. 没有clean+g+d</span></span><br><span class="line"><span class="emphasis">   4. gitee没有更行部署</span></span><br><span class="line"><span class="emphasis">   </span></span><br><span class="line"><span class="emphasis">2. 部署其他文件夹</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">   1. 每次hexo d之前copy 文件到posts，但是我发现文件的创建时间被改变了</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">   2. 将hexo的source文件路径改为ana-notes，但是这样没办法生成目录</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">   3. 最终选择copy+python修改文件创建时间的方式 </span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">      具体bat代码</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">      ````</span></span><br><span class="line"><span class="emphasis">      echo 清空posts文件夹</span></span><br><span class="line"><span class="emphasis">      rd /s /q %post_</span>path%</span><br><span class="line"><span class="code">      md %post_path%</span></span><br><span class="line"><span class="code">      echo 递归copy文件</span></span><br><span class="line"><span class="code">      xcopy /y /e %src_path% %post_path%</span></span><br><span class="line"><span class="code">      echo 还原时间</span></span><br><span class="line"><span class="code">      python E:\data-ana\ana-notes\工具\tools\get_blog_create_time.py</span></span><br><span class="line"><span class="code">      echo 提交</span></span><br><span class="line"><span class="code">      hexo clean &amp;&amp; hexo g &amp;&amp; hexo d</span></span><br><span class="line"><span class="code">      ````</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">      </span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="bullet">3.</span> 修改config.yml后报错：yml格式是:后面有空格</span><br><span class="line"></span><br><span class="line"><span class="bullet">4.</span> 实现gitee page自动提交：</span><br><span class="line"></span><br><span class="line">   nodejs+puppeteer(xpath)</span><br><span class="line">   </span><br><span class="line"><span class="bullet">5.</span> 注意，特殊字符尽量不用</span><br><span class="line"></span><br><span class="line"><span class="bullet">   1.</span> 小括号</span><br><span class="line"><span class="bullet">   2.</span> 大括号</span><br><span class="line"><span class="bullet">   3.</span> 中括号</span><br><span class="line">   </span><br><span class="line"><span class="bullet">6.</span> git config --global core.autocrlf false换行转义</span><br><span class="line"></span><br><span class="line"><span class="bullet">7.</span> github</span><br><span class="line"></span><br><span class="line"><span class="bullet">   1.</span> git config --global http.sslVerify &quot;false&quot;</span><br><span class="line"></span><br><span class="line"><span class="section">### config</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">1.</span> 切换中文language</span><br><span class="line"></span><br><span class="line">   zh-CN</span><br><span class="line"></span><br><span class="line"><span class="section">### next&lt;-landscape</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">0.</span> http://theme-next.iissnan.com/</span><br><span class="line"></span><br><span class="line"><span class="bullet">1.</span> 更换主题</span><br><span class="line"></span><br><span class="line">   config--&gt;schemes</span><br><span class="line"></span><br><span class="line"><span class="bullet">2.</span> 设置头像avater</span><br><span class="line"></span><br><span class="line"><span class="bullet">3.</span> 社交图标</span><br><span class="line"></span><br><span class="line">   social<span class="emphasis">_icons</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">   https://fontawesome.com/v5.15/icons?d=gallery&amp;p=2</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">4. 首页全文</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">   auto_</span>excerpt</span><br><span class="line"></span><br><span class="line">   &lt;!--more--&gt;</span><br><span class="line"></span><br><span class="line"><span class="bullet">5.</span> 网站图标</span><br><span class="line"></span><br><span class="line">   <span class="code">```python</span></span><br><span class="line"><span class="code">   favicon:aaaa.avg</span></span><br><span class="line"><span class="code">   source/image/aaaa.avg</span></span><br></pre></td></tr></table></figure></li>
<li><p>背景</p>
<p>canvas</p>
</li>
<li><p>加载进度条 pace</p>
</li>
<li><p>读进度条：scrollpercent</p>
</li>
<li><p>评论</p>
<p>changyan</p>
</li>
<li><p>搜索</p>
</li>
</ol>
   <figure class="highlight dts"><table><tr><td class="code"><pre><span class="line">npm install hexo-generator-searchdb --save</span><br><span class="line"></span><br><span class="line">hexo-config</span><br><span class="line"><span class="symbol">search:</span></span><br><span class="line"><span class="symbol">  path:</span> search.xml</span><br><span class="line"><span class="symbol">  field:</span> post</span><br><span class="line"><span class="symbol">  format:</span> html</span><br><span class="line"><span class="symbol">  limit:</span> <span class="number">10000</span></span><br><span class="line">config</span><br><span class="line"><span class="symbol">local_search:</span></span><br></pre></td></tr></table></figure>

<ol start="11">
<li><p>不算子（访问次数）：busuanzi_count</p>
</li>
<li><p>隐藏底盘:footer.powered</p>
</li>
<li><p>修改字体大小</p>
<p>打开<code>\themes\next\source\css\ _variables\base.styl</code>文件，将<code>$font-size-base</code>改成<code>16px</code>，如下所示：</p>
<figure class="highlight gams"><table><tr><td class="code"><pre><span class="line"><span class="meta"><span class="meta-keyword">$font</span>-size-base            =16px</span></span><br></pre></td></tr></table></figure></li>
<li><p>夜间模式darkmode</p>
</li>
<li><p>网站丝滑motion true</p>
</li>
<li><p>three</p>
</li>
<li><p>移动端回顶onmobile</p>
<p>pc端：back2top</p>
</li>
<li><p>阅读进度：reading_progress</p>
</li>
<li><p>阅读进度保存：bookmark</p>
</li>
<li><p>github图标：github_banner</p>
</li>
<li><p>font：字体设置</p>
</li>
<li><p>代码高亮hexo.config</p>
<ol>
<li>highlight</li>
<li>prismjs二选1</li>
</ol>
</li>
</ol>
<h3 id="plugin"><a href="#plugin" class="headerlink" title="plugin"></a>plugin</h3><ol>
<li><p>代码高亮</p>
<figure class="highlight stata"><table><tr><td class="code"><pre><span class="line">npm install hexo-prism-<span class="keyword">plugin</span> --<span class="keyword">save</span></span><br></pre></td></tr></table></figure></li>
<li><p>字数统计</p>
<figure class="highlight coffeescript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">npm</span> i –save hexo-wordcount</span><br></pre></td></tr></table></figure>

<p>theme.config</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">post_wordcount:</span></span><br><span class="line">  <span class="attr">item_text:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">wordcount:</span> <span class="literal">true</span> <span class="comment">#单篇文章字数</span></span><br><span class="line">  <span class="attr">min2read:</span> <span class="literal">true</span> <span class="comment">#单篇阅读时长</span></span><br><span class="line">  <span class="attr">totalcount:</span> <span class="literal">true</span> <span class="comment">#站点总字数</span></span><br><span class="line">  <span class="attr">separated_meta:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure></li>
<li><p>搜索</p>
<ol>
<li>下载依赖</li>
</ol>
<figure class="highlight ada"><table><tr><td class="code"><pre><span class="line">npm install hexo-generator-searchdb <span class="comment">--save</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>修改hexo.config</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">search:</span><br><span class="line">  path: search.xml</span><br><span class="line">  field: post</span><br><span class="line">  format: html</span><br><span class="line">  <span class="built_in">limit</span>: 10000</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>修改theme.config</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">local_search:</span><br></pre></td></tr></table></figure></li>
<li><p>几何背景</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">cd <span class="keyword">next</span></span><br><span class="line">git clone https:<span class="regexp">//gi</span>thub.com<span class="regexp">/theme-next/</span>theme-<span class="keyword">next</span>-canvas-ribbon source<span class="regexp">/lib/</span>canvas-ribbon</span><br></pre></td></tr></table></figure>

<p>theme.config</p>
<p>canvas_ribbon</p>
</li>
<li><p>字数统计</p>
<p>npm install hexo-word-counter</p>
<p>clean g s</p>
</li>
</ol>
<h3 id="hexo-next主题颜色"><a href="#hexo-next主题颜色" class="headerlink" title="hexo-next主题颜色"></a>hexo-next主题颜色</h3><ol>
<li><p>normal </p>
<p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20211106211457578.png" alt="image-20211106211457578"></p>
</li>
<li><p>night </p>
<p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20211106211538248.png" alt="image-20211106211538248"></p>
</li>
<li><p>night eighties  </p>
<p>同上</p>
</li>
<li><p>night blue </p>
<p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20211106211631863.png"></p>
</li>
<li><p>night bright</p>
<p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20211106211858696.png" alt="image-20211106211858696"></p>
</li>
<li><p>solarized </p>
<p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20211106211916484.png" alt="image-20211106211916484"></p>
</li>
<li><p>solarized dark </p>
<p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20211106211957848.png" alt="image-20211106211957848"></p>
</li>
<li><p>galactic</p>
</li>
</ol>
<p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20211106212045168.png" alt="image-20211106212045168"></p>
<h2 id="个人博客"><a href="#个人博客" class="headerlink" title="个人博客"></a>个人博客</h2><h3 id="思想"><a href="#思想" class="headerlink" title="思想"></a>思想</h3><ol>
<li>笔记、博客分离</li>
<li>删除+拷贝</li>
<li>时间记录json</li>
</ol>
<h3 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h3><ol>
<li>删除posts</li>
<li>拷贝到posts</li>
<li>删除小文件</li>
<li>删除私人文件</li>
<li>加载文件时间数据</li>
<li>根据时间数据更新posts下的文件创建时间</li>
<li>启动Hexo</li>
</ol>
<h3 id="对于保存时间的考虑"><a href="#对于保存时间的考虑" class="headerlink" title="对于保存时间的考虑"></a>对于保存时间的考虑</h3><ol>
<li>文件名称：时间  —&gt; 相对路径：时间<ol>
<li>先修改源md文件日期（想要的日期）</li>
<li>然后保存成新的json文件</li>
</ol>
</li>
<li>该源md文件创建时间的必要性<ol>
<li>假设我在一台新的电脑上，所有的源md文件创建时间都是2022.5.5 那么当我更改了文件名后，json数据里肯定是找不到这个文件原来的创建时间的，所以每次换电脑后都需要根据Json数据更改一次，也仅需要改一次创建时间。</li>
</ol>
</li>
</ol>
<h3 id="一键式部署"><a href="#一键式部署" class="headerlink" title="一键式部署"></a>一键式部署</h3><ol>
<li><p>bt.bat</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">e:</span><br><span class="line"><span class="built_in">set</span> post_path=e:\blog\<span class="built_in">source</span>\_posts</span><br><span class="line"><span class="built_in">set</span> src_path=<span class="string">&quot;E:\data-ana\ana-notes\experience&quot;</span></span><br><span class="line"><span class="built_in">echo</span> 删除文件t</span><br><span class="line">rd /s /q %post_path%</span><br><span class="line"><span class="built_in">echo</span> 创建空文件夹t 并进入</span><br><span class="line">md %post_path%</span><br><span class="line"><span class="built_in">echo</span> 拷贝文件</span><br><span class="line">xcopy /y /e %src_path% %post_path%</span><br><span class="line"><span class="built_in">echo</span> 删除小文件</span><br><span class="line">python %mytools%\file-util\delete_lit_file.py</span><br><span class="line"><span class="built_in">echo</span> 还原时间</span><br><span class="line">python %mytools%\file-util\get_blog_create_time.py</span><br><span class="line"><span class="built_in">cd</span> %post_path%</span><br><span class="line"><span class="built_in">echo</span> 删除非文件夹的文件</span><br><span class="line">del /q *</span><br><span class="line"><span class="built_in">echo</span> 删除<span class="built_in">test</span>文件夹</span><br><span class="line">del /q <span class="built_in">test</span>\*</span><br><span class="line"><span class="built_in">echo</span> 删除面试文件夹</span><br><span class="line">del /q 面试\*</span><br><span class="line">del /q 八股文\*</span><br><span class="line"><span class="built_in">echo</span> 删除不出版的文件</span><br><span class="line">del /q unpub\*</span><br><span class="line"><span class="built_in">echo</span> 删除未完成的文件</span><br><span class="line">del /q uncp\*</span><br><span class="line">del /q other\*</span><br><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line"><span class="built_in">echo</span> hexo启动</span><br><span class="line">hexo clean &amp;&amp; hexo g &amp;&amp; hexo d</span><br></pre></td></tr></table></figure></li>
<li><p>delete_lit_file.py</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line">_posts = <span class="string">r&#x27;E:\blog\source\_posts&#x27;</span></span><br><span class="line"><span class="keyword">for</span> root, dirs, files <span class="keyword">in</span> os.walk(_posts):</span><br><span class="line">    <span class="keyword">for</span> file <span class="keyword">in</span> files:</span><br><span class="line">        path_temp = os.path.join(root, file)</span><br><span class="line">        <span class="keyword">if</span> os.stat(path_temp).st_size &lt; <span class="number">2</span> * <span class="number">1024</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;del:\t&quot;</span>, path_temp)</span><br><span class="line">            os.remove(path_temp)</span><br></pre></td></tr></table></figure></li>
<li><p>get_blog_create_time.py</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> pywintypes</span><br><span class="line"><span class="keyword">from</span> win32con <span class="keyword">import</span> FILE_FLAG_BACKUP_SEMANTICS</span><br><span class="line"><span class="keyword">from</span> win32con <span class="keyword">import</span> FILE_SHARE_WRITE</span><br><span class="line"><span class="keyword">from</span> win32file <span class="keyword">import</span> CloseHandle</span><br><span class="line"><span class="keyword">from</span> win32file <span class="keyword">import</span> CreateFile</span><br><span class="line"><span class="keyword">from</span> win32file <span class="keyword">import</span> GENERIC_WRITE</span><br><span class="line"><span class="keyword">from</span> win32file <span class="keyword">import</span> OPEN_EXISTING</span><br><span class="line"><span class="keyword">from</span> win32file <span class="keyword">import</span> SetFileTime</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">TimeStampToTime</span>(<span class="params">timestamp</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;把时间戳转化为时间: 1479264792 to 2016-11-16 10:53:12&#x27;&#x27;&#x27;</span></span><br><span class="line">    timeStruct = time.localtime(timestamp)</span><br><span class="line">    <span class="keyword">return</span> time.strftime(<span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>, timeStruct)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_FileSize</span>(<span class="params">filePath</span>):</span></span><br><span class="line">    fsize = os.path.getsize(filePath)</span><br><span class="line">    fsize = fsize / <span class="built_in">float</span>(<span class="number">1024</span> * <span class="number">1024</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">round</span>(fsize, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_FileModifyTime</span>(<span class="params">filePath</span>):</span></span><br><span class="line">    t = os.path.getmtime(filePath)</span><br><span class="line">    <span class="keyword">return</span> TimeStampToTime(t)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_FileCreateTime</span>(<span class="params">filePath</span>):</span></span><br><span class="line">    t = os.path.getctime(filePath)</span><br><span class="line">    <span class="keyword">return</span> TimeStampToTime(t)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">set_file_time</span>(<span class="params">filename, updatetime, access_time</span>):</span></span><br><span class="line">    <span class="comment"># 先传修改时间，再传访问时间</span></span><br><span class="line">    filename = os.path.abspath(filename)</span><br><span class="line">    new_updatetime = time.mktime(time.strptime(updatetime, <span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>))</span><br><span class="line">    new_access_time = time.mktime(time.strptime(access_time, <span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>))</span><br><span class="line">    os.utime(filename, (new_access_time, new_updatetime))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">modify_file_create_time</span>(<span class="params">path, create_time_str, update_time_str=<span class="string">&#x27;&#x27;</span>, access_time_str=<span class="string">&#x27;&#x27;</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;定义文件或文件夹的创建、修改、访问时间&quot;&quot;&quot;</span></span><br><span class="line">    path = os.path.abspath(path)</span><br><span class="line">    <span class="keyword">if</span> os.path.exists(path):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            format_str = <span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>  <span class="comment"># 时间格式</span></span><br><span class="line">            f = CreateFile(path, GENERIC_WRITE, FILE_SHARE_WRITE, <span class="literal">None</span>, OPEN_EXISTING,</span><br><span class="line">                           FILE_FLAG_BACKUP_SEMANTICS, <span class="number">0</span>)</span><br><span class="line">            create_time = pywintypes.Time(time.mktime(time.strptime(create_time_str, format_str)))</span><br><span class="line">            <span class="comment"># 连同修改修改时间</span></span><br><span class="line">            <span class="comment"># update_time = pywintypes.Time(time.mktime(time.strptime(update_time_str, format_str)))</span></span><br><span class="line">            <span class="comment"># access_time = pywintypes.Time(time.mktime(time.strptime(access_time_str, format_str)))</span></span><br><span class="line">            <span class="comment"># SetFileTime(f, create_time, update_time, access_time)</span></span><br><span class="line">            SetFileTime(f, create_time)</span><br><span class="line">            CloseHandle(f)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&#x27;修改成功:<span class="subst">&#123;path&#125;</span>--&gt;<span class="subst">&#123;create_time_str&#125;</span>&#x27;</span>)</span><br><span class="line">            <span class="comment"># print(&#x27;成功:(&#123;&#125;)/(&#123;&#125;)/(&#123;&#125;)&#x27;.format(create_time_str, update_time_str, access_time_str))</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;失败:&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(e))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;路径不存在:&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(path))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tran_time</span>(<span class="params">src, _posts</span>):</span></span><br><span class="line">    t = get_FileCreateTime(src)</span><br><span class="line">    modify_file_create_time(_posts, t)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">x1</span>():</span></span><br><span class="line">    path = <span class="string">r&quot;e:/a.txt&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;文件大小&quot;</span>, get_FileSize(path))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;创建时间&quot;</span>, get_FileCreateTime(path))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;修改时间&quot;</span>, get_FileModifyTime(path))</span><br><span class="line">    set_file_time(path, <span class="string">&#x27;2018-01-08 10:50:20&#x27;</span>, <span class="string">&#x27;2019-07-15 04:03:01&#x27;</span>)</span><br><span class="line">    cTime = <span class="string">&quot;2021-01-01 01:01:01&quot;</span>  <span class="comment"># 创建时间</span></span><br><span class="line">    modify_file_create_time(path, cTime)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    os.chdir(<span class="string">&quot;e:/tools/file-util&quot;</span>)</span><br><span class="line">    src = <span class="string">r&#x27;E:\data-ana\ana-notes\experience&#x27;</span></span><br><span class="line">    _posts = <span class="string">r&#x27;E:\blog\source\_posts&#x27;</span></span><br><span class="line">    f = <span class="built_in">open</span>(<span class="string">&quot;fileInfo.json&quot;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    data = json.load(f)</span><br><span class="line">    f.close()</span><br><span class="line">    <span class="keyword">for</span> root, dirs, files <span class="keyword">in</span> os.walk(src):</span><br><span class="line">        <span class="keyword">for</span> file <span class="keyword">in</span> files:</span><br><span class="line">            <span class="comment"># root: &#x27;E:\data-ana\ana-notes\experience\abc&#x27;</span></span><br><span class="line">            <span class="comment"># dirs: abc下的文件夹</span></span><br><span class="line">            <span class="comment"># files: abc下的文件</span></span><br><span class="line">            <span class="comment"># path_temp: 据对路径</span></span><br><span class="line">            path_temp = os.path.join(root, file)</span><br><span class="line">            <span class="comment"># relative : 文件相对experience路径</span></span><br><span class="line">            relative = path_temp.split(<span class="string">&#x27;experience&#x27;</span>)[<span class="number">1</span>]</span><br><span class="line">            <span class="comment"># path_posts: posts地址</span></span><br><span class="line">            path_posts = _posts + relative</span><br><span class="line">            <span class="comment"># 时间问题</span></span><br><span class="line">            <span class="comment"># 1. 创建时间</span></span><br><span class="line">            createKey = file + <span class="string">&#x27;::create&#x27;</span>;</span><br><span class="line">            updateKey = file + <span class="string">&#x27;::update&#x27;</span>;</span><br><span class="line"></span><br><span class="line">            oldCreate = data.get(createKey)</span><br><span class="line">            <span class="keyword">if</span> oldCreate:</span><br><span class="line">                modify_file_create_time(path_posts, oldCreate)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                data.update(&#123;createKey: get_FileCreateTime(path_temp)&#125;)</span><br><span class="line">            <span class="comment"># 2. 更新时间</span></span><br><span class="line">            <span class="comment"># 获得当下更新时间</span></span><br><span class="line">            updateNow = get_FileModifyTime(path_temp)</span><br><span class="line">            data.update(&#123;updateKey: updateNow&#125;)</span><br><span class="line">    f = <span class="built_in">open</span>(<span class="string">&#x27;fileInfo.json&#x27;</span>, <span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    json.dump(data, f, ensure_ascii=<span class="literal">False</span>)</span><br><span class="line">    f.close()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># for path_temp in dic.keys():</span></span><br><span class="line">    <span class="comment">#     file = path_temp.split(&#x27;experience&#x27;)[1]</span></span><br><span class="line">    <span class="comment">#     path_posts = _posts + file</span></span><br><span class="line">    <span class="comment">#     modify_file_create_time(path_posts, dic.get(path_temp))</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>utils</category>
      </categories>
  </entry>
  <entry>
    <title>Git的使用</title>
    <url>/2021/09/24/utils/git/</url>
    <content><![CDATA[<p>[toc]</p>
<h2 id="一、Git概念"><a href="#一、Git概念" class="headerlink" title="一、Git概念"></a>一、Git概念</h2><ol>
<li><p>手工式版本控制</p>
<ol>
<li><p>特点</p>
<ol>
<li>每改一次备份一次</li>
<li>协同更改需要同时U盘copy</li>
</ol>
</li>
<li><p>问题</p>
<ol>
<li>备份</li>
<li>代码还原</li>
<li>协同开发</li>
<li>代码追溯(追责)</li>
</ol>
</li>
<li><p>区</p>
<ol>
<li>workspace 现在的代码</li>
<li>index 暂存区(索引区)，在.git/index</li>
<li>repository 本地仓库  </li>
</ol>
<p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20211102012109951.png" alt="image-20211102012109951"></p>
</li>
</ol>
<span id="more"></span></li>
<li><p>解决：<font color='red'>版本控制</font>结束了手动管理多个“版本”的史前时代，进入到版本控制的20世纪。</p>
</li>
<li><p>集中式版本控制SVN/CVS</p>
<ol>
<li>版本库都放在集中式服务器</li>
<li>使用前先从集中式服务器copy过来</li>
<li>修改完后在上传到集中服务器</li>
</ol>
</li>
<li><p>分布式版本控制（共享版本库）</p>
<ol>
<li>每个人都有所有的版本，gitee/github也算个人</li>
<li>一个人修改了A那么直接上传就会记录这个修改内容</li>
<li>本地有所有的版本</li>
</ol>
</li>
</ol>
<h2 id="二、Git操作"><a href="#二、Git操作" class="headerlink" title="二、Git操作"></a>二、Git操作</h2><h3 id="2-1-基本步骤"><a href="#2-1-基本步骤" class="headerlink" title="2.1 基本步骤"></a>2.1 基本步骤</h3><ol>
<li><p>安装完成先自报家门</p>
<figure class="highlight verilog"><table><tr><td class="code"><pre><span class="line">git <span class="keyword">config</span> --<span class="keyword">global</span> user<span class="variable">.name</span> <span class="string">&quot;Your Name&quot;</span></span><br><span class="line">git <span class="keyword">config</span> --<span class="keyword">global</span> user<span class="variable">.email</span> <span class="string">&quot;email@example.com&quot;</span></span><br><span class="line">git <span class="keyword">config</span> 	--list</span><br></pre></td></tr></table></figure>

<p>git config 命令的 –global 表示整个电脑的git都设置为这个身份</p>
</li>
<li><p>创建版本库</p>
<figure class="highlight dos"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="built_in">mkdir</span> blog</span><br><span class="line"><span class="built_in">cd</span> blog</span><br><span class="line">git init</span><br></pre></td></tr></table></figure></li>
<li><p>写文件</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">touch readme.txt</span><br><span class="line">git <span class="keyword">add</span> .</span><br><span class="line">git <span class="keyword">commit</span> -m &quot;wrote a file&quot;</span><br></pre></td></tr></table></figure>

<p><code>.</code>表示当前目录</p>
</li>
</ol>
<h3 id="查看状态"><a href="#查看状态" class="headerlink" title="查看状态"></a>查看状态</h3><p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20211004192710237.png" alt="image-20211004192710237"></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git status  <span class="comment">#提交状态 显示未add和未commit的信息</span></span><br><span class="line">gti status -s <span class="comment"># 简单状态信息  红色：未add 绿色：未commit  </span></span><br></pre></td></tr></table></figure>

<h3 id="2-2-文件对比"><a href="#2-2-文件对比" class="headerlink" title="2.2 文件对比"></a>2.2 文件对比</h3><h4 id="2-2-1-git-diff"><a href="#2-2-1-git-diff" class="headerlink" title="2.2.1 git diff"></a>2.2.1 git diff</h4><p>git diff –stat   摘要</p>
<ol>
<li><p>工作区和暂存区对比</p>
<blockquote>
<p>也就是看看 工作区新的内容</p>
<p>git add . 之后 git diff 就不会有任何输出，因为现在workspack和index相同</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git diff</span><br><span class="line">git diff a.txt</span><br></pre></td></tr></table></figure></li>
<li><p>暂存区和本地仓库对比</p>
<blockquote>
<p>也就是看看 暂存区新的内容</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git diff --cached  <span class="comment">#完整信息</span></span><br><span class="line">git diff --cached --<span class="built_in">stat</span>    <span class="comment">#摘要</span></span><br></pre></td></tr></table></figure></li>
<li><p>本地和远程对比</p>
</li>
</ol>
<h4 id="2-2-2-git-status"><a href="#2-2-2-git-status" class="headerlink" title="2.2.2 git status"></a>2.2.2 git status</h4><p>git status</p>
<p>git status -s</p>
<p>git status –short</p>
<h3 id="2-3-查看日志"><a href="#2-3-查看日志" class="headerlink" title="2.3 查看日志"></a>2.3 查看日志</h3><h4 id="git-log"><a href="#git-log" class="headerlink" title="git log"></a>git log</h4><h4 id="git-show"><a href="#git-show" class="headerlink" title="git show"></a>git show</h4><blockquote>
<p>查看最近一次提交的内容，</p>
</blockquote>
<h3 id="2-3-版本撤回"><a href="#2-3-版本撤回" class="headerlink" title="2.3 版本撤回"></a>2.3 版本撤回</h3><ol>
<li><p>版本撤回</p>
<ol>
<li><p>回到上上个版本</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">git <span class="keyword">reset</span> <span class="comment">--hard HEAD^^</span></span><br></pre></td></tr></table></figure></li>
<li><p>–hard表示</p>
</li>
<li><p>git reset –head 版本id/head都可以回退</p>
</li>
<li><p>如果撤多了那么别叉掉窗口，几下最近几次commit-id的前机会还可以回撤</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line">git reset <span class="params">--hard</span> <span class="keyword">cd</span>0c</span><br></pre></td></tr></table></figure></li>
<li><p>如果不小心叉掉了，git reflog还可以查看各个commit-id</p>
<p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20211004183507316.png" alt="image-20211004183507316"></p>
<p>最下面是第一次commit</p>
<p>然后根据git reset commit-id 回退版本</p>
</li>
<li><p>但是，如果你的工作区没有add就进行了版本撤回，那么就会找不到你这此更改的内容。</p>
</li>
<li><p>如果你的工作区已经add到了缓存区，</p>
</li>
</ol>
</li>
<li><p>撤销修改</p>
<ol>
<li><p>丢弃工作区，工作区&lt;—暂存区</p>
<figure class="highlight ada"><table><tr><td class="code"><pre><span class="line">git checkout <span class="comment">-- readme.txt</span></span><br></pre></td></tr></table></figure></li>
<li><p>丢掉暂存区，暂存区&lt;—版本库</p>
<figure class="highlight maxima"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">reset</span> head readme.txt</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p>删除文件</p>
<p>rm readme.txt</p>
<ol>
<li><p>整体删除</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">git rm/<span class="keyword">add</span> readme.txt</span><br><span class="line">git <span class="keyword">commit</span> -m &quot;&quot;</span><br></pre></td></tr></table></figure></li>
<li><p>撤回删除(从暂存区拿回)</p>
<figure class="highlight ada"><table><tr><td class="code"><pre><span class="line">git checkout <span class="comment">-- test.txt</span></span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ol>
<h5 id="远程仓库"><a href="#远程仓库" class="headerlink" title="远程仓库"></a>远程仓库</h5><ol>
<li><p>添加远程仓库</p>
<figure class="highlight llvm"><table><tr><td class="code"><pre><span class="line">git remote <span class="keyword">add</span> origin git<span class="title">@github.com</span>:Wang-yonggan/test.git</span><br></pre></td></tr></table></figure></li>
<li><p>远程库的名字就是<code>origin</code>，这是Git默认的叫法把本地库的内容推送到远程，用<code>git push</code>命令，实际上是把当前分支<code>master</code>推送到远程。</p>
</li>
<li><p>由于远程库是空的，我们第一次推送<code>master</code>分支时，加上了<code>-u</code>参数，Git不但会把本地的<code>master</code>分支内容推送的远程新的<code>master</code>分支，还会把本地的<code>master</code>分支和远程的<code>master</code>分支关联起来，在以后的推送或者拉取时就可以简化命令。</p>
<p>以后只需要</p>
<figure class="highlight maxima"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">push</span> <span class="built_in">origin</span> master</span><br></pre></td></tr></table></figure></li>
<li><p>查看远程仓库状态</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">git remote -v</span></span><br></pre></td></tr></table></figure></li>
<li><p>解除远程仓库关系</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">git remote rm origin</span></span><br></pre></td></tr></table></figure></li>
<li><p>克隆(支持两种协议)</p>
<ol>
<li>https 默认</li>
<li>git 更快，有的公司不支持</li>
</ol>
</li>
<li><p>远程删除一个文件夹</p>
<ol>
<li>git rm -r –cached dir  –&gt;撤回 git reset dir</li>
<li>git rm –cached file</li>
<li>git  commit</li>
<li>git push</li>
</ol>
</li>
</ol>
<h5 id="分支管理"><a href="#分支管理" class="headerlink" title="分支管理"></a>分支管理</h5><ol>
<li><p>创建分支</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">git branch dev</span></span><br></pre></td></tr></table></figure></li>
<li><p>切换分支</p>
<p>checkout==switch</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">git checkout dev</span></span><br></pre></td></tr></table></figure></li>
<li><p>查看有哪些分支</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">git branch</span></span><br></pre></td></tr></table></figure></li>
<li><p>合并分支(只有撤回到master下面这句才有效)</p>
<figure class="highlight cos"><table><tr><td class="code"><pre><span class="line">git <span class="keyword">merge</span> dev</span><br></pre></td></tr></table></figure></li>
<li><p>删除分支</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">git branch -d dev</span></span><br></pre></td></tr></table></figure></li>
<li><p>如果分支有内容更改，需要-D 强制删除</p>
</li>
<li><p>远程分支master&lt;—–&gt;本地分支master</p>
</li>
<li><p>本地的分支会共享暂存区，但版本库独立，即分支master创建并add到暂存区的a文件如果被分支dev commit了，那么再切换到master就没有这个文件。</p>
</li>
<li><p>分支冲突</p>
<p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20211004221917099.png" alt="image-20211004221917099"></p>
<p>修改+add+commit手动合并</p>
</li>
</ol>
<h5 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h5><ol>
<li><p>tag标签</p>
<p>​    标签与commit-id对应关系</p>
<ol>
<li><p>创建tag</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">git <span class="keyword">tag</span> <span class="title">v1</span>.<span class="number">0</span></span><br></pre></td></tr></table></figure></li>
<li><p>根据commit-id创建tag</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">git <span class="keyword">tag</span> <span class="title">v0</span>.<span class="number">8</span> abcde</span><br></pre></td></tr></table></figure></li>
<li><p>上传tags</p>
<figure class="highlight armasm"><table><tr><td class="code"><pre><span class="line"><span class="symbol">git</span> <span class="keyword">push</span> orgin <span class="built_in">v1</span>.<span class="number">0</span></span><br><span class="line"><span class="symbol">git</span> <span class="keyword">push</span> orgin --tags</span><br></pre></td></tr></table></figure></li>
<li><p>删除tags</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line">git push origin <span class="symbol">:refs/tags/v0</span>.<span class="number">9</span></span><br></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p>忽略文件</p>
<ol>
<li><p>文件内容(!表示非)</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line">*<span class="string">.txt</span>*</span><br><span class="line">!<span class="string">.gitignore</span></span><br></pre></td></tr></table></figure></li>
<li><p>强制添加</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">git add -f <span class="module-access"><span class="module"><span class="identifier">App</span>.</span></span><span class="keyword">class</span></span><br></pre></td></tr></table></figure></li>
<li><p>例子</p>
<ol>
<li>忽略.o和.a文件 : *.[oa]</li>
<li>忽略目录d: d/</li>
<li>* ？：代表任意的一个字符<br>  * ＊：代表任意数目的字符<br>  * {!ab}：必须不是此类型<br>  * {ab,bb,cx}：代表ab,bb,cx中任一类型即可<br>  * [abc]：代表a,b,c中任一字符即可<br>  * [ ^abc]：代表必须不是a,b,c中任一字符</li>
<li></li>
</ol>
</li>
</ol>
</li>
<li><p>别名</p>
<ol>
<li><p>st=status</p>
<figure class="highlight verilog"><table><tr><td class="code"><pre><span class="line">git <span class="keyword">config</span> --<span class="keyword">global</span> <span class="keyword">alias</span><span class="variable">.st</span> status</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ol>
<h3 id="Gi退回"><a href="#Gi退回" class="headerlink" title="Gi退回"></a>Gi退回</h3><ol>
<li>分支</li>
<li>版本<ol>
<li>HEAD表示当前版本</li>
<li>HEAD^^表示上上一个版本</li>
<li>HEAD~100表示上100个版本</li>
</ol>
</li>
<li></li>
</ol>
<h3 id="Git合并"><a href="#Git合并" class="headerlink" title="Git合并"></a>Git合并</h3><ol>
<li>fast合并和非fast合并</li>
<li>rebase合并和merge</li>
</ol>
<h3 id="Git合并冲突"><a href="#Git合并冲突" class="headerlink" title="Git合并冲突"></a>Git合并冲突</h3><ol>
<li>当两个分支同时修改一个文件的时候就会有分支冲突，需要手动更改</li>
<li>报错 Merge complict</li>
</ol>
<h3 id="做过的配置"><a href="#做过的配置" class="headerlink" title="做过的配置"></a>做过的配置</h3><ol>
<li><p>git config –global http.sslVerify true   </p>
<p>push 失败 SSL</p>
</li>
<li><p>push 到github失败，网速问题</p>
<p>使用@git协议</p>
<ol>
<li><p>github加入自己的本机的ssh</p>
</li>
<li><p>将本机的.git的里面的comfig.remote修改为项目的ssh链接</p>
<p><a href="mailto:&#x67;&#x69;&#x74;&#64;&#x67;&#105;&#116;&#104;&#x75;&#x62;&#x2e;&#x63;&#111;&#109;">&#x67;&#x69;&#x74;&#64;&#x67;&#105;&#116;&#104;&#x75;&#x62;&#x2e;&#x63;&#111;&#109;</a>:Wang-yonggan/Wang-yonggan.github.io.git</p>
<p><a href="https://github.com/Wang-yonggan/Wang-yonggan.github.io.git">https://github.com/Wang-yonggan/Wang-yonggan.github.io.git</a></p>
</li>
</ol>
</li>
</ol>
<h3 id="更改远程url"><a href="#更改远程url" class="headerlink" title="更改远程url"></a>更改远程url</h3><ol>
<li><p>set-url</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git remote set-url origin https://github.com/url1/url2</span><br></pre></td></tr></table></figure></li>
<li><p>rm add</p>
<figure class="highlight mipsasm"><table><tr><td class="code"><pre><span class="line">git remote rm <span class="keyword">orgin</span></span><br><span class="line"><span class="keyword"></span>git remote <span class="keyword">add </span><span class="keyword">orgin </span>[]</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="三、远程仓库"><a href="#三、远程仓库" class="headerlink" title="三、远程仓库"></a>三、远程仓库</h2><figure class="highlight mipsasm"><table><tr><td class="code"><pre><span class="line">git remote -v  查看当前.git文件 所有的远程仓库</span><br><span class="line">git remote -rm name</span><br><span class="line">git remote rename old_name new_name</span><br><span class="line">git remote <span class="keyword">add </span>[<span class="keyword">shortname] </span>[url] 添加远程仓库</span><br><span class="line">git remote <span class="keyword">add </span><span class="keyword">origin </span>git@github.com:a.git   <span class="keyword">origin为名称</span></span><br><span class="line"><span class="keyword"></span>git push -u <span class="keyword">origin </span>maste</span><br></pre></td></tr></table></figure>

<h3 id="拉取远程仓库的更新"><a href="#拉取远程仓库的更新" class="headerlink" title="拉取远程仓库的更新"></a>拉取远程仓库的更新</h3><figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">git fetch</span></span><br></pre></td></tr></table></figure>

<ul>
<li>执行 <code>git fetch origin master</code> 时，它的意思是从名为 <strong>origin</strong> 的远程上拉取名为 <strong>master</strong> 的分支到本地分支 <strong>origin/master</strong> 中</li>
<li>执行 <code>git merge origin/master</code> 时，它的意思是合并名为 <strong>origin/master</strong> 的分支到当前所在分支。</li>
<li>执行 <code>git push origin master</code> 时，它的意思是推送本地的 <strong>master</strong> 分支远程 <strong>origin</strong>，</li>
<li>还可以一次性拉取多个分支的代码：<code>git fetch origin master stable oldstable</code>；</li>
<li>也还可以一次性合并多个分支的代码：<code>git merge origin/master hotfix-2275 hotfix-2276 hotfix-2290</code>；</li>
</ul>
<h2 id="四、分支"><a href="#四、分支" class="headerlink" title="四、分支"></a>四、分支</h2><blockquote>
</blockquote>
<h3 id="checkout"><a href="#checkout" class="headerlink" title="checkout"></a>checkout</h3><blockquote>
<p>主要用于创建分支和切换分支</p>
</blockquote>
<h3 id="branch"><a href="#branch" class="headerlink" title="branch"></a>branch</h3><blockquote>
<p>列出，创建，删除分支</p>
</blockquote>
<h2 id="五、命令参数表"><a href="#五、命令参数表" class="headerlink" title="五、命令参数表"></a>五、命令参数表</h2><blockquote>
<p><a href="https://git-scm.com/docs">https://git-scm.com/docs</a></p>
</blockquote>
<h3 id="4-1-git-add"><a href="#4-1-git-add" class="headerlink" title="4.1 git add"></a>4.1 git add</h3><table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h3 id="git-config"><a href="#git-config" class="headerlink" title="git config"></a>git config</h3><table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>–global var value</td>
<td>给变量赋值</td>
<td></td>
</tr>
<tr>
<td>–list</td>
<td>显示所有变量</td>
<td></td>
</tr>
<tr>
<td>var</td>
<td>显示var的值</td>
<td></td>
</tr>
<tr>
<td>–list –local</td>
<td>显示局部变量</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h2 id="五、其他"><a href="#五、其他" class="headerlink" title="五、其他"></a>五、其他</h2><h3 id="5-1-核心配置文件"><a href="#5-1-核心配置文件" class="headerlink" title="5.1 核心配置文件"></a>5.1 核心配置文件</h3><blockquote>
<p>~/.gitconfig</p>
</blockquote>
]]></content>
      <categories>
        <category>utils</category>
      </categories>
  </entry>
  <entry>
    <title>vuepress</title>
    <url>/2021/12/13/utils/vuepress/</url>
    <content><![CDATA[<h2 id="一、基本使用"><a href="#一、基本使用" class="headerlink" title="一、基本使用"></a>一、基本使用</h2><ol>
<li><p>.vuepress文件夹，所有 VuePress 相关的文件都将会被放在这里</p>
<ol>
<li><p>一个 VuePress 网站必要的配置文件是 <code>.vuepress/config.js</code>，它应该导出一个 JavaScript 对象：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="attr">title</span>: <span class="string">&#x27;Hello VuePress&#x27;</span>,</span><br><span class="line">  <span class="attr">description</span>: <span class="string">&#x27;Just playing around&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p>官网 <a href="https://vuepress.vuejs.org/zh/guide/getting-started.html">https://vuepress.vuejs.org/zh/guide/getting-started.html</a></p>
</li>
<li><p>启动 npm run  docs:dev</p>
</li>
<li></li>
</ol>
<h2 id="二、md文件内配置"><a href="#二、md文件内配置" class="headerlink" title="二、md文件内配置"></a>二、md文件内配置</h2><p>默认主题提供了一些选项，让你可以去自定义导航栏（navbar）、 侧边栏（sidebar）和 首页（homepage） </p>
<h3 id="2-1-Header"><a href="#2-1-Header" class="headerlink" title="2.1 Header"></a>2.1 Header</h3><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">home:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">heroImage:</span> <span class="string">/hero.png</span></span><br><span class="line"><span class="attr">heroText:</span> <span class="string">Hero</span> <span class="string">标题</span></span><br><span class="line"><span class="attr">tagline:</span> <span class="string">Hero</span> <span class="string">副标题</span></span><br><span class="line"><span class="comment"># navbar: false 禁用导航栏</span></span><br><span class="line"><span class="attr">actionText:</span> <span class="string">快速上手</span> <span class="string">→</span></span><br><span class="line"><span class="attr">actionLink:</span> <span class="string">/zh/guide/</span></span><br><span class="line"><span class="attr">features:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">title:</span> <span class="string">简洁至上</span></span><br><span class="line">  <span class="attr">details:</span> <span class="string">以</span> <span class="string">Markdown</span> <span class="string">为中心的项目结构，以最少的配置帮助你专注于写作。</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">title:</span> <span class="string">Vue驱动</span></span><br><span class="line">  <span class="attr">details:</span> <span class="string">享受</span> <span class="string">Vue</span> <span class="string">+</span> <span class="string">webpack</span> <span class="string">的开发体验，在</span> <span class="string">Markdown</span> <span class="string">中使用</span> <span class="string">Vue</span> <span class="string">组件，同时可以使用</span> <span class="string">Vue</span> <span class="string">来开发自定义主题。</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">title:</span> <span class="string">高性能</span></span><br><span class="line">  <span class="attr">details:</span> <span class="string">VuePress</span> <span class="string">为每个页面预渲染生成静态的</span> <span class="string">HTML，同时在页面被加载的时候，将作为</span> <span class="string">SPA</span> <span class="string">运行。</span></span><br><span class="line"><span class="attr">footer:</span> <span class="string">MIT</span> <span class="string">Licensed</span> <span class="string">|</span> <span class="string">Copyright</span> <span class="string">©</span> <span class="number">2018</span><span class="string">-present</span> <span class="string">Evan</span> <span class="string">You</span></span><br><span class="line"><span class="meta">---</span></span><br></pre></td></tr></table></figure>

<h3 id="2-2-Frontmatter"><a href="#2-2-Frontmatter" class="headerlink" title="2.2 Frontmatter"></a>2.2 Frontmatter</h3><h4 id="2-2-1-首页"><a href="#2-2-1-首页" class="headerlink" title="2.2.1 首页"></a>2.2.1 首页</h4><table>
<thead>
<tr>
<th>关键字</th>
<th>功能</th>
<th>用例</th>
</tr>
</thead>
<tbody><tr>
<td>home</td>
<td>是否首页</td>
<td>home: true</td>
</tr>
<tr>
<td>heroImage</td>
<td>首页图片的 URL</td>
<td># Public 文件路径 heroImage: /images/hero.png</td>
</tr>
<tr>
<td>heroText</td>
<td>首页标题</td>
<td></td>
</tr>
<tr>
<td>tagline</td>
<td>首页标语,则默认使用站点 <a href="https://v2.vuepress.vuejs.org/zh/reference/config.html#description">description</a></td>
<td></td>
</tr>
<tr>
<td>actions</td>
<td>首页按钮</td>
<td>actions:   - text: 快速上手     link: /zh/guide/getting-started.html     type: primary</td>
</tr>
<tr>
<td>features</td>
<td>首页下三件简述</td>
<td></td>
</tr>
<tr>
<td>footer</td>
<td>首页页脚</td>
<td></td>
</tr>
<tr>
<td>footerHtml</td>
<td>是否允许页脚中使用 HTML</td>
<td></td>
</tr>
</tbody></table>
<h4 id="2-2-2-普通页面"><a href="#2-2-2-普通页面" class="headerlink" title="2.2.2 普通页面"></a>2.2.2 普通页面</h4><table>
<thead>
<tr>
<th>关键字</th>
<th>功能</th>
<th>用例</th>
</tr>
</thead>
<tbody><tr>
<td>editLink</td>
<td>编辑此页</td>
<td></td>
</tr>
<tr>
<td>editLinkPattern</td>
<td>本页面中 <em>编辑此页</em> 链接的 Pattern</td>
<td><a href="https://v2.vuepress.vuejs.org/zh/reference/default-theme/config.html#editlinkpattern">三项</a></td>
</tr>
<tr>
<td>sidebar</td>
<td>配置侧边栏</td>
<td></td>
</tr>
<tr>
<td>navbar</td>
<td>导航栏配置</td>
<td></td>
</tr>
<tr>
<td>contributors</td>
<td>贡献者列表</td>
<td></td>
</tr>
</tbody></table>
<h3 id="2-3-搜索框"><a href="#2-3-搜索框" class="headerlink" title="2.3 搜索框"></a>2.3 搜索框</h3><h4 id="1-内置搜索"><a href="#1-内置搜索" class="headerlink" title="1. 内置搜索"></a>1. 内置搜索</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// .vuepress/config.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="attr">themeConfig</span>: &#123;</span><br><span class="line">    <span class="attr">search</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">searchMaxSuggestions</span>: <span class="number">10</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="页面滚动"><a href="#页面滚动" class="headerlink" title="页面滚动"></a>页面滚动</h3><h3 id="自定义页面类"><a href="#自定义页面类" class="headerlink" title="自定义页面类"></a>自定义页面类</h3><h3 id="特定页面的自定义布局"><a href="#特定页面的自定义布局" class="headerlink" title="特定页面的自定义布局"></a>特定页面的自定义布局</h3><h2 id="三、配置"><a href="#三、配置" class="headerlink" title="三、配置"></a>三、配置</h2><h3 id="3-1-基本项"><a href="#3-1-基本项" class="headerlink" title="3.1 基本项"></a>3.1 基本项</h3><table>
<thead>
<tr>
<th>关键字</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>lang</td>
<td>语言</td>
</tr>
<tr>
<td>title</td>
<td>标题</td>
</tr>
<tr>
<td>description</td>
<td>描述</td>
</tr>
<tr>
<td>base</td>
<td>git-page相对地址</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h3 id="3-2主题配置"><a href="#3-2主题配置" class="headerlink" title="3.2主题配置"></a>3.2主题配置</h3><ol>
<li> logo logo地址</li>
<li>navbar 导航栏</li>
<li>sidebar 侧边栏</li>
</ol>
<h4 id="3-2-1-导航栏"><a href="#3-2-1-导航栏" class="headerlink" title="3.2.1 导航栏"></a>3.2.1 导航栏</h4><ol>
<li><p>logo</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">   </span><br></pre></td></tr></table></figure></li>
<li><p>导航栏连接</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// .vuepress/config.js</span></span><br><span class="line"><span class="keyword">module</span>.<span class="keyword">exports</span> = &#123;</span><br><span class="line">  themeConfig: &#123;</span><br><span class="line">    nav: [</span><br><span class="line">      &#123; text: <span class="string">&#x27;Home&#x27;</span>, link: <span class="string">&#x27;/&#x27;</span> &#125;,</span><br><span class="line">      &#123; text: <span class="string">&#x27;Guide&#x27;</span>, link: <span class="string">&#x27;/guide/&#x27;</span> &#125;,</span><br><span class="line">      &#123; text: <span class="string">&#x27;External&#x27;</span>, link: <span class="string">&#x27;https://google.com&#x27;</span> &#125;,</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>当你提供了一个 <code>items</code> 数组而不是一个单一的 <code>link</code> 时，它将显示为一个 <code>下拉列表</code> </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// .vuepress/config.js</span></span><br><span class="line"><span class="keyword">module</span>.<span class="keyword">exports</span> = &#123;</span><br><span class="line">  themeConfig: &#123;</span><br><span class="line">    nav: [</span><br><span class="line">      &#123;</span><br><span class="line">        text: <span class="string">&#x27;Languages&#x27;</span>,</span><br><span class="line">        ariaLabel: <span class="string">&#x27;Language Menu&#x27;</span>,</span><br><span class="line">        items: [</span><br><span class="line">          &#123; text: <span class="string">&#x27;Chinese&#x27;</span>, link: <span class="string">&#x27;/language/chinese/&#x27;</span> &#125;,</span><br><span class="line">          &#123; text: <span class="string">&#x27;Japanese&#x27;</span>, link: <span class="string">&#x27;/language/japanese/&#x27;</span> &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>此外，你还可以通过嵌套的 <code>items</code> 来在 <code>下拉列表</code> 中设置分组：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// .vuepress/config.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="attr">themeConfig</span>: &#123;</span><br><span class="line">    <span class="attr">nav</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">text</span>: <span class="string">&#x27;Languages&#x27;</span>,</span><br><span class="line">        <span class="attr">items</span>: [</span><br><span class="line">          &#123; <span class="attr">text</span>: <span class="string">&#x27;Group1&#x27;</span>, <span class="attr">items</span>: [<span class="comment">/*  */</span>] &#125;,</span><br><span class="line">          &#123; <span class="attr">text</span>: <span class="string">&#x27;Group2&#x27;</span>, <span class="attr">items</span>: [<span class="comment">/*  */</span>] &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>禁用</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">themeConfig: &#123;</span><br><span class="line">  navbar: <span class="keyword">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="3-2-2-侧边栏"><a href="#3-2-2-侧边栏" class="headerlink" title="3.2.2 侧边栏"></a>3.2.2 侧边栏</h4><h5 id="3-2-2-1-基本配置"><a href="#3-2-2-1-基本配置" class="headerlink" title="3.2.2.1 基本配置"></a>3.2.2.1 基本配置</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">sidebar: [</span><br><span class="line">     &#123;</span><br><span class="line">       text: <span class="string">&#x27;Guide&#x27;</span>,</span><br><span class="line">       link: <span class="string">&#x27;/guide/&#x27;</span>,</span><br><span class="line">       children: [</span><br><span class="line">         &#123;</span><br><span class="line">           text: <span class="string">&#x27;github&#x27;</span>,</span><br><span class="line">           link: <span class="string">&#x27;https://github.com&#x27;</span>,</span><br><span class="line">           children: [],</span><br><span class="line">         &#125;,</span><br><span class="line">         <span class="string">&#x27;/guide/a.md&#x27;</span>,</span><br><span class="line">         <span class="string">&#x27;/guide/b.md&#x27;</span>,</span><br><span class="line">         <span class="string">&#x27;/guide/c.md&#x27;</span></span><br><span class="line">       ],</span><br><span class="line">     &#125;,</span><br><span class="line">     <span class="string">&#x27;/bar/README.md&#x27;</span>,</span><br><span class="line">   ],</span><br></pre></td></tr></table></figure>

<h5 id="3-2-2-2-注意"><a href="#3-2-2-2-注意" class="headerlink" title="3.2.2.2 注意"></a>3.2.2.2 注意</h5><p>‘/bar/README.md’ 像这种直接写路径的一定要写title</p>
<h5 id="3-2-2-3-侧边栏分组"><a href="#3-2-2-3-侧边栏分组" class="headerlink" title="3.2.2.3 侧边栏分组"></a>3.2.2.3 侧边栏分组</h5><h5 id="3-2-2-4-自动生成侧栏"><a href="#3-2-2-4-自动生成侧栏" class="headerlink" title="3.2.2.4 自动生成侧栏"></a>3.2.2.4 自动生成侧栏</h5><h5 id="3-2-2-5-禁用侧边栏"><a href="#3-2-2-5-禁用侧边栏" class="headerlink" title="3.2.2.5 禁用侧边栏"></a>3.2.2.5 禁用侧边栏</h5><h2 id="四、新增Md渲染"><a href="#四、新增Md渲染" class="headerlink" title="四、新增Md渲染"></a>四、新增Md渲染</h2><h3 id="4-1-内置组件"><a href="#4-1-内置组件" class="headerlink" title="4.1 内置组件"></a>4.1 内置组件</h3><h4 id="4-1-1-Badge-标识"><a href="#4-1-1-Badge-标识" class="headerlink" title="4.1.1 Badge 标识"></a>4.1.1 Badge 标识</h4><ol>
<li><p>语法</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> VuePress - <span class="xml"><span class="tag">&lt;<span class="name">Badge</span> <span class="attr">type</span>=<span class="string">&quot;warning&quot;</span> <span class="attr">text</span>=<span class="string">&quot;v2&quot;</span> <span class="attr">vertical</span>=<span class="string">&quot;middle&quot;</span> /&gt;</span></span></span><br></pre></td></tr></table></figure></li>
<li><p>属性</p>
<ol>
<li>type 类型：’tip’ | ‘warning’ | ‘danger’</li>
<li>vertical 位置：’top’ | ‘middle’ | ‘bottom’ | undefined</li>
</ol>
</li>
</ol>
<h4 id="4-1-2-CodeGroup-多类型代码"><a href="#4-1-2-CodeGroup-多类型代码" class="headerlink" title="4.1.2 CodeGroup 多类型代码"></a>4.1.2 CodeGroup 多类型代码</h4><h4 id="4-1-3-自定义容器"><a href="#4-1-3-自定义容器" class="headerlink" title="4.1.3 自定义容器"></a>4.1.3 自定义容器</h4><ol>
<li><p>语法</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">::: <span class="xml"><span class="tag">&lt;<span class="name">type</span>&gt;</span></span> [title]</span><br><span class="line">[content]</span><br><span class="line">:::</span><br></pre></td></tr></table></figure></li>
<li><p>属性</p>
<ol>
<li>type 类型：tip、warning、danger、details</li>
<li>title 标题  容器提示语</li>
<li>content 内容</li>
</ol>
</li>
</ol>
<h4 id="4-2-渲染"><a href="#4-2-渲染" class="headerlink" title="4.2 渲染"></a>4.2 渲染</h4><h4 id="4-2-1-链接"><a href="#4-2-1-链接" class="headerlink" title="4.2.1 链接"></a>4.2.1 链接</h4><ol>
<li>绝对路径链接 带外链接符号 </li>
<li>相对路径链接 不带</li>
</ol>
<h4 id="4-2-2-标题锚点"><a href="#4-2-2-标题锚点" class="headerlink" title="4.2.2 标题锚点"></a>4.2.2 标题锚点</h4><h4 id="4-2-3-Emoji"><a href="#4-2-3-Emoji" class="headerlink" title="4.2.3 Emoji"></a>4.2.3 <a href="https://github.com/ikatyang/emoji-cheat-sheet">Emoji</a></h4><h4 id="4-2-4-目录"><a href="#4-2-4-目录" class="headerlink" title="4.2.4 目录"></a>4.2.4 目录</h4><h4 id="4-2-5-代码块"><a href="#4-2-5-代码块" class="headerlink" title="4.2.5 代码块"></a>4.2.5 代码块</h4><ol>
<li>行高亮</li>
<li>可编译</li>
</ol>
<h2 id="五、插件"><a href="#五、插件" class="headerlink" title="五、插件"></a>五、插件</h2><h3 id="5-1-google-analytics-网络流量分析"><a href="#5-1-google-analytics-网络流量分析" class="headerlink" title="5.1  google-analytics 网络流量分析"></a>5.1  google-analytics 网络流量分析</h3><h3 id="5-2-search-搜索"><a href="#5-2-search-搜索" class="headerlink" title="5.2 search 搜索"></a>5.2 search 搜索</h3><ol>
<li><p>下载</p>
<figure class="highlight stata"><table><tr><td class="code"><pre><span class="line">npm install vuepress-<span class="keyword">plugin</span>-fulltext-<span class="keyword">search</span></span><br></pre></td></tr></table></figure></li>
<li><p> vi docs/.vuepress/config.js</p>
</li>
</ol>
   <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">module</span>.<span class="keyword">exports</span> = &#123;</span><br><span class="line"><span class="comment">// .</span></span><br><span class="line">plugins: [<span class="string">&#x27;fulltext-search&#x27;</span>],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-3-pwa-渐进式web"><a href="#5-3-pwa-渐进式web" class="headerlink" title="5.3  pwa 渐进式web"></a>5.3  pwa 渐进式web</h3><h2 id="六、主题"><a href="#六、主题" class="headerlink" title="六、主题"></a>六、主题</h2>]]></content>
      <categories>
        <category>util</category>
      </categories>
  </entry>
  <entry>
    <title>docker</title>
    <url>/2022/04/24/%E5%88%86%E5%B8%83%E5%BC%8F/docker/</url>
    <content><![CDATA[<h2 id="一、概念"><a href="#一、概念" class="headerlink" title="一、概念"></a>一、概念</h2><ol>
<li>docker与虚拟机<ol>
<li>虚拟机是创建一个新的操作系统，重量级</li>
<li>docker是把递归找到各个依赖，环境，配置，然后打包，轻量级</li>
</ol>
</li>
</ol>
<h3 id="1-2-组件"><a href="#1-2-组件" class="headerlink" title="1.2 组件"></a>1.2 组件</h3><h4 id="1-2-1-镜像"><a href="#1-2-1-镜像" class="headerlink" title="1.2.1 镜像"></a>1.2.1 镜像</h4><figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">[<span class="symbol">repority</span>]:<span class="link">[tag] </span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>类：docker将所需要的环境，依赖，配置打包到一起，叫镜像。</p>
</blockquote>
<h4 id="1-2-2-容器"><a href="#1-2-2-容器" class="headerlink" title="1.2.2 容器"></a>1.2.2 容器</h4><blockquote>
<p>实例：</p>
</blockquote>
<h4 id="1-2-3-数据卷"><a href="#1-2-3-数据卷" class="headerlink" title="1.2.3 数据卷"></a>1.2.3 数据卷</h4><blockquote>
<p>类似共享内存 volume</p>
<ol>
<li>容器数据持久化</li>
<li>外部机器和容器间通信</li>
<li>容器之间通信</li>
</ol>
</blockquote>
<ol>
<li>数据卷是宿<strong>主机</strong>中的一个目录或文件</li>
<li>当容器目录和数据卷目录绑定后，<strong>对方的修改会立即同步</strong></li>
<li>一个数据卷可以被多个容器同时<strong>挂载</strong></li>
<li>一个容器也可以被挂载多个数据卷</li>
</ol>
<h3 id="1-3-架构"><a href="#1-3-架构" class="headerlink" title="1.3 架构"></a>1.3 架构</h3><ol>
<li>c/s架构</li>
<li>clinet发送命令，server回应返回</li>
</ol>
<h2 id="二、操作"><a href="#二、操作" class="headerlink" title="二、操作"></a>二、操作</h2><h3 id="2-1-安装"><a href="#2-1-安装" class="headerlink" title="2.1 安装"></a>2.1 安装</h3><ol>
<li><p>下载</p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line">curl -fsSL <span class="keyword">https</span>://<span class="built_in">get</span>.docker.com | bash -s docker <span class="comment">--mirror Aliyun</span></span><br></pre></td></tr></table></figure></li>
<li><p>镜像加速</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">sudo mkdir -p <span class="regexp">/etc/</span>docker</span><br><span class="line">sudo tee <span class="regexp">/etc/</span>docker/daemon.json &lt;&lt;-<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;registry-mirrors&quot;</span>: [<span class="string">&quot;https://zck14spt.mirror.aliyuncs.com&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl restart docker</span><br></pre></td></tr></table></figure></li>
<li><p>启动docker   systemctl start docker</p>
</li>
</ol>
<h3 id="2-2-镜像"><a href="#2-2-镜像" class="headerlink" title="2.2 镜像"></a>2.2 镜像</h3><ol>
<li><p>查看镜像</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></table></figure></li>
<li><p>查找镜像</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker search 镜像名称</span><br></pre></td></tr></table></figure></li>
<li><p>从docker.hub拉取远程镜像</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">docker pull redis:<span class="number">3.4</span></span><br></pre></td></tr></table></figure></li>
<li><p>删除镜像</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">docker rmi 镜像id / 删除指定本地镜像</span><br></pre></td></tr></table></figure></li>
<li><p>推送 docker push</p>
</li>
<li><p>保存  docker save -o test nginx:latest</p>
</li>
<li><p> 加载 docker load</p>
</li>
<li><p>构建 docker builder</p>
</li>
</ol>
<h3 id="2-3-远程仓库"><a href="#2-3-远程仓库" class="headerlink" title="2.3 远程仓库"></a>2.3 远程仓库</h3><p>docker search mysql<br>docker pull mysql:5.7</p>
<h3 id="2-4-容器"><a href="#2-4-容器" class="headerlink" title="2.4 容器"></a>2.4 容器</h3><ol>
<li><p>创建/启动容器</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">docker run -it --name=c1 redis:5 /bin/bash</span> </span><br><span class="line">docker run -it -p 9000:8080 app </span><br><span class="line">docker run --name rds-d redis redis-server --save 60 1 --loglevel warning</span><br><span class="line">docker run --name rds -p 6379:6379 -d redis</span><br><span class="line"><span class="meta">#</span><span class="bash"> -p a:b 用a映射b  a可以任意一个服务器free的端口,b为镜像内容器的端口，比如tomcat默认是8080</span>        </span><br><span class="line"><span class="meta">#</span><span class="bash"> -d  后台运行</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -t 创建并进入</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -i 允许输入(交互式bash)</span></span><br></pre></td></tr></table></figure></li>
<li><p>查看容器</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">docker ps # 查看正在运行的容器</span><br><span class="line">docker ps –a # 查看所有容器</span><br><span class="line">docker logs  name  查看name的日志</span><br></pre></td></tr></table></figure></li>
<li><p>进入容器</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">docker exec -it name bash  <span class="comment">//执行命令;</span></span><br><span class="line">docker exec mycentos </span><br></pre></td></tr></table></figure></li>
<li><p>暂停</p>
<figure class="highlight autohotkey"><table><tr><td class="code"><pre><span class="line">docker unpause  <span class="keyword">pause</span></span><br></pre></td></tr></table></figure></li>
<li><p>停止/启动</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">docker stop name</span><br><span class="line">docker start name</span><br></pre></td></tr></table></figure></li>
<li><p>删除</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">docker rm name</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="2-5-数据卷"><a href="#2-5-数据卷" class="headerlink" title="2.5 数据卷"></a>2.5 数据卷</h3><h4 id="数据卷操作"><a href="#数据卷操作" class="headerlink" title="数据卷操作"></a>数据卷操作</h4><p>docker volume+</p>
<ol>
<li>create 创建</li>
<li>inspect 显示信息</li>
<li>ls 列出</li>
<li>rm 删除</li>
<li>prune 删除未使用到的</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">docker run -it --name=c1 –v ~/java:/root/test imageName </span><br><span class="line"><span class="comment">//目录必须是绝对路径</span></span><br><span class="line"><span class="comment">// 如果目录不存在，会自动创建</span></span><br></pre></td></tr></table></figure>

<h4 id="数据卷容器"><a href="#数据卷容器" class="headerlink" title="数据卷容器"></a>数据卷容器</h4><p>映射数据卷 -v  a:b</p>
<ol>
<li><p>创建数据卷容器 -v /volume</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">docker run –it --name=c3 –v /volume centos:<span class="number">7</span> /bin/bash </span><br></pre></td></tr></table></figure></li>
<li><p>直接挂载</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">docker run -it --name=c1 –v <span class="regexp">/root/</span>java<span class="regexp">/test:/</span>root/test imageName </span><br></pre></td></tr></table></figure></li>
<li><p>创建容器并挂载   –volumes-from c3</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">docker run –it --name=c1 --volumes-from c3 centos:<span class="number">7</span> /bin/bash</span><br><span class="line">docker run –it --name=c2 --volumes-from c3 centos:<span class="number">7</span> /bin/bash  </span><br></pre></td></tr></table></figure></li>
</ol>
<ol>
<li><p>实例</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mkdir mysql</span><br><span class="line">cd mysql </span><br><span class="line">docker run -id -p 3307:3306 -v $PWD/conf:/etc/mysql/conf.d -v $PWD/logs:/logs \</span><br><span class="line">-v $PWD/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=root mysql:5.7</span><br><span class="line"><span class="meta">#</span><span class="bash"> -v 映射</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="variable">$PWD</span>当前文件夹</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -e 参数</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="三、自定义镜像"><a href="#三、自定义镜像" class="headerlink" title="三、自定义镜像"></a>三、自定义镜像</h2><h3 id="3-1-镜像结构"><a href="#3-1-镜像结构" class="headerlink" title="3.1 镜像结构"></a>3.1 镜像结构</h3><blockquote>
<p>linux基础–&gt; 环境变量–&gt; mysql的依赖—&gt; mysql —&gt; mysql配置 –&gt; entryPoint 入口脚本</p>
<p>分层结构，这样的<strong>优点是其中一个变了只需要改变这个层</strong>，不需要全部更改</p>
</blockquote>
<h3 id="3-2dockerFile"><a href="#3-2dockerFile" class="headerlink" title="3.2dockerFile"></a>3.2dockerFile</h3><blockquote>
<p>dockerFile，指令文件</p>
<p>用于快速构建(build)镜像</p>
</blockquote>
<ol>
<li><p>dockerfile语法</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"><span class="keyword">FROM</span>：定制的镜像都是基于 <span class="keyword">FROM</span> 的镜像，这里的 nginx 就是定制需要的基础镜像。后续的操作都是基于 nginx。</span><br><span class="line"></span><br><span class="line">RUN：用于执行后面跟着的命令行命令,每一个run创建一层。有以下俩种格式：</span><br><span class="line">	<span class="builtin-name">RUN</span> [<span class="string">&quot;可执行文件&quot;</span>, <span class="string">&quot;参数1&quot;</span>, <span class="string">&quot;参数2&quot;</span>]</span><br><span class="line">	<span class="builtin-name">RUN</span> &lt;命令行命令&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>dickerfile 构建镜像</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">docker build -f app.jar -t appName:version</span><br><span class="line"># -f 指定df路径  -t指定新的镜像的名字和版本</span><br></pre></td></tr></table></figure></li>
<li><p>镜像启动（创建容器）</p>
</li>
</ol>
<h3 id="docker-compose-服务编排"><a href="#docker-compose-服务编排" class="headerlink" title="docker compose 服务编排"></a>docker compose 服务编排</h3><blockquote>
<p>用于快速构建分布式集群项目</p>
<p>按照一定规则批量管理容器</p>
<p>比如 定义启动顺序，</p>
</blockquote>
<h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><ol>
<li><p>容器转换成镜像</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">docker commit id name:version</span><br></pre></td></tr></table></figure></li>
<li><p>压缩</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">docker</span> </span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="docker镜像原理"><a href="#docker镜像原理" class="headerlink" title="docker镜像原理"></a>docker镜像原理</h4><ol>
<li>docker镜像其实是一个文件层次系统</li>
<li></li>
</ol>
]]></content>
  </entry>
  <entry>
    <title>hadoop的启动</title>
    <url>/2021/11/14/%E5%88%86%E5%B8%83%E5%BC%8F/hadoop%E5%90%AF%E5%8A%A8/</url>
    <content><![CDATA[<p>[toc]</p>
<h2 id="一、-基本环境"><a href="#一、-基本环境" class="headerlink" title="一、 基本环境"></a>一、 基本环境</h2><ol>
<li><p>获取主机名字 master、s1、s2</p>
</li>
<li><p>时钟同步</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/usr/</span>sbin/ntpdate cn.pool.ntp.org</span><br></pre></td></tr></table></figure></li>
<li><p>关闭防火墙</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">systemctl stop firewalld.service</span><br></pre></td></tr></table></figure>

<span id="more"></span></li>
<li><p>编辑host 以对应ping 如：</p>
<figure class="highlight accesslog"><table><tr><td class="code"><pre><span class="line"><span class="number">10.42.0.93</span> master</span><br><span class="line"><span class="number">10.42.0.94</span> slave01</span><br><span class="line"><span class="number">10.42.0.95</span> slave02</span><br></pre></td></tr></table></figure></li>
<li><p>测试ping是否成功</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">ping <span class="keyword">master</span> <span class="title">-c</span> <span class="number">3</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="二、联机"><a href="#二、联机" class="headerlink" title="二、联机"></a>二、联机</h2><ol>
<li><p>生成公钥</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">ssh-keygen -t rsa</span></span><br></pre></td></tr></table></figure></li>
<li><p>公钥备份文件</p>
<figure class="highlight arcade"><table><tr><td class="code"><pre><span class="line">cat ~<span class="regexp">/.ssh/i</span>d_rsa.pub &gt;&gt; ~<span class="regexp">/.ssh/</span>authorized_keys</span><br></pre></td></tr></table></figure></li>
<li><p>修改文件权限</p>
<figure class="highlight arcade"><table><tr><td class="code"><pre><span class="line">chmod <span class="number">600</span> ~<span class="regexp">/.ssh/</span>authorized_keys</span><br></pre></td></tr></table></figure></li>
<li><p>将专用密钥添加到 ssh-agent 的高速缓存中</p>
<figure class="highlight arcade"><table><tr><td class="code"><pre><span class="line">ssh-add ~<span class="regexp">/.ssh/i</span>d_rsa</span><br></pre></td></tr></table></figure></li>
<li><p>公钥转移到其他机器</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line">scp ~<span class="regexp">/.ssh/</span>authorized_keys zkpk<span class="meta">@slave01</span>:~<span class="regexp">/.ssh/</span></span><br></pre></td></tr></table></figure></li>
<li><p>其他机器也生成密钥</p>
</li>
<li><p>测试远程   ssh s1</p>
</li>
</ol>
<h2 id="三、安装java"><a href="#三、安装java" class="headerlink" title="三、安装java"></a>三、安装java</h2><ol>
<li><p>root下解压</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">tar -xzvf <span class="regexp">/home/</span>zkpk<span class="regexp">/tgz/</span>jdk-<span class="number">8</span>u131-linux-x64.tar.gz -C <span class="regexp">/usr/</span>java</span><br></pre></td></tr></table></figure></li>
<li><p>修改环境变量</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">gedit <span class="regexp">/home/</span>zkpk/.bash_profile</span><br><span class="line">	export JAVA_HOME=<span class="regexp">/usr/</span>java<span class="regexp">/jdk1.8.0_131/</span></span><br><span class="line">	export PATH=<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$PATH</span></span><br><span class="line">source <span class="regexp">/home/</span>zkpk/.bash_profile</span><br></pre></td></tr></table></figure></li>
<li><p>其他机器同样安装</p>
</li>
<li><p>测试java：java -version</p>
</li>
</ol>
<h2 id="四、安装hadoop"><a href="#四、安装hadoop" class="headerlink" title="四、安装hadoop"></a>四、安装hadoop</h2><ol>
<li><p>解压</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">tar -xzvf <span class="regexp">/home/</span>zkpk<span class="regexp">/tgz/</span>hadoop-<span class="number">2.7</span>.<span class="number">3</span>.tar.gz –C <span class="regexp">/home/</span>zkpk</span><br></pre></td></tr></table></figure></li>
<li><p>修改java环境变量</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">gedit <span class="regexp">/home/</span>zkpk<span class="regexp">/hadoop-2.7.3/</span>etc<span class="regexp">/hadoop/</span>hadoop-env.sh</span><br><span class="line"> 	export JAVA_HOME=<span class="regexp">/usr/</span>java<span class="regexp">/jdk1.8.0_131/</span></span><br><span class="line">gedit ~<span class="regexp">/hadoop-2.7.3/</span>etc<span class="regexp">/hadoop/y</span>arn-env.sh</span><br><span class="line">	export JAVA_HOME=<span class="regexp">/usr/</span>java<span class="regexp">/jdk1.8.0_131/</span></span><br></pre></td></tr></table></figure></li>
<li><p>其他配置</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">1.配置core-site.xml 文件</span><br><span class="line">gedit  ~/hadoop-2.7.3/etc/hadoop/core-site.xml</span><br><span class="line">	<span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line">    <span class="meta">&lt;?xml-stylesheet type=&quot;text/xsl&quot; href=&quot;configuration.xsl&quot;?&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Put site-specific property overrides in this file. --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">name</span>&gt;</span>fs.defaultFS<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">value</span>&gt;</span>hdfs://master:9000<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.tmp.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">value</span>&gt;</span>/home/zkpk/hadoopdata<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">2.配置hdfs-site.xml文件</span><br><span class="line">gedit  ~/hadoop-2.7.3/etc/hadoop/hdfs-site.xml</span><br><span class="line">    <span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line">    <span class="meta">&lt;?xml-stylesheet type=&quot;text/xsl&quot; href=&quot;configuration.xsl&quot;?&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Put site-specific property overrides in this file. --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.replication<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>2<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">3.配置yarn-site.xml文件</span><br><span class="line">gedit  ~/hadoop-2.7.3/etc/hadoop/yarn-site.xml</span><br><span class="line">    <span class="meta">&lt;?xml version=&quot;1.0&quot;?&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.aux-services<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>mapreduce_shuffle<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>master:18040<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.scheduler.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>master:18030<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.resource-tracker.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>master:18025<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.admin.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>master:18141<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.webapp.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>master:18088<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">4.配置mapred-site.xml文件</span><br><span class="line">cp ~/hadoop-2.7.3/etc/hadoop/mapred-site.xml.template  ~/hadoop-2.7.3/etc/hadoop/mapred-site.xml</span><br><span class="line">gedit ~/hadoop-2.7.3/etc/hadoop/mapred-site.xml</span><br><span class="line">    <span class="meta">&lt;?xml version=&quot;1.0&quot;?&gt;</span></span><br><span class="line">    <span class="meta">&lt;?xml-stylesheet type=&quot;text/xsl&quot; href=&quot;configuration.xsl&quot;?&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.framework.name<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>yarn<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>配置slaves文件</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">gedit ~<span class="regexp">/hadoop-2.7.3/</span>etc<span class="regexp">/hadoop/</span>slaves</span><br><span class="line">    slave01</span><br><span class="line">    slave02</span><br></pre></td></tr></table></figure></li>
<li><p>创建Hadoop数据目录</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">mkdir hadoopdata</span><br></pre></td></tr></table></figure></li>
<li><p>将配置好的hadoop文件夹复制到从节点</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">scp</span> -r hadoop-<span class="number">2</span>.<span class="number">7</span>.<span class="number">3</span> zkpk@slave<span class="number">01</span>:~/</span><br></pre></td></tr></table></figure></li>
<li><p>配置环境变量</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">gedit ~/.bash_profile</span><br><span class="line">    #HADOOP</span><br><span class="line">    <span class="builtin-name">export</span> <span class="attribute">HADOOP_HOME</span>=/home/zkpk/hadoop-2.7.3</span><br><span class="line">    <span class="builtin-name">export</span> <span class="attribute">PATH</span>=<span class="variable">$HADOOP_HOME</span>/bin:$HADOOP_HOME/sbin:$PATH</span><br><span class="line">source ~/.bash_profile</span><br></pre></td></tr></table></figure></li>
<li><p>其他机器同样配置环境变量</p>
</li>
<li><p>在master格式化磁盘</p>
<figure class="highlight dos"><table><tr><td class="code"><pre><span class="line">hdfs namenode -<span class="built_in">format</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="五、启动检测"><a href="#五、启动检测" class="headerlink" title="五、启动检测"></a>五、启动检测</h2><ol>
<li>start-all.sh</li>
<li>jps查看</li>
<li><a href="http://master:50070/%E6%9F%A5%E7%9C%8B">http://master:50070/查看</a></li>
<li><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20210911183155100.png" alt="image-20210911183155100"></li>
</ol>
]]></content>
      <categories>
        <category>hadoop</category>
      </categories>
  </entry>
  <entry>
    <title>kafka</title>
    <url>/2022/03/10/%E5%88%86%E5%B8%83%E5%BC%8F/kafka/</url>
    <content><![CDATA[<h2 id="一、概述"><a href="#一、概述" class="headerlink" title="一、概述"></a>一、概述</h2><blockquote>
<p>Kafka是一个分布式的、可水平扩展的、基于发布/订阅模式的、支持容错的消息系统。</p>
</blockquote>
<h3 id="1-1-消息队列"><a href="#1-1-消息队列" class="headerlink" title="1.1 消息队列"></a>1.1 消息队列</h3><blockquote>
<p>事件流</p>
</blockquote>
<h4 id="1-1-1-点对点模型"><a href="#1-1-1-点对点模型" class="headerlink" title="1.1.1 点对点模型"></a>1.1.1 点对点模型</h4><p>一对一，一个客户端，一个服务端</p>
<h4 id="1-1-2-发布订阅模型"><a href="#1-1-2-发布订阅模型" class="headerlink" title="1.1.2 发布订阅模型"></a>1.1.2 发布订阅模型</h4><p>多对一，多个客户端，一个服务端</p>
<h3 id="1-2-介绍"><a href="#1-2-介绍" class="headerlink" title="1.2 介绍"></a>1.2 介绍</h3><ol>
<li>基于scala，zookeeper</li>
<li>发布-订阅消息系统，用于离线和实时的消息处理业务系统中</li>
<li>临时存储+持久化磁盘</li>
<li>基于自己的高性能<a href="https://kafka.apache.org/protocol.html">TCP 网络协议进行通信的</a></li>
</ol>
<h3 id="1-3-功能"><a href="#1-3-功能" class="headerlink" title="1.3 功能"></a>1.3 功能</h3><ol>
<li><strong>发布</strong>（写入）+ <strong>订阅</strong>（读取）事件流，包括从其他系统持续导入/导出数据 。</li>
<li>持久可靠地 <strong>存储</strong>事件流</li>
<li>在事件发生时或回顾性地<strong>处理</strong>事件流</li>
</ol>
<h3 id="1-4-特性"><a href="#1-4-特性" class="headerlink" title="1.4 特性"></a>1.4 特性</h3><ol>
<li>高可用，高并发，高吞吐量</li>
<li>可持久化，可拓展</li>
</ol>
<h3 id="1-5-场景"><a href="#1-5-场景" class="headerlink" title="1.5 场景"></a>1.5 场景</h3><ol>
<li><p>主要：异步处理</p>
<ol>
<li>异步发送短信</li>
<li>异步注册信息</li>
<li>等一切可以不需要及时响应，甚至是根本不需要响应的请求。</li>
</ol>
</li>
<li><p>系统解耦</p>
<blockquote>
<p>在代码层面：耦合一个1000多行的函数，里面的逻辑非常的复杂，维护成本很高。解耦合就是把代码提取出来，分成各个小的函数，每个函数都有他的意义，都有一个函数入口，该需求只需要认准一个函数更改，很方便，也能将函数复用。</p>
<p>在业务开发上：耦合就是要完成一个很大的系统，然后开始从头到尾的设计，解耦就是将系统分成各个模块，比如权限模块，支付模块，文件模块等等，这些模块可以分布式部署，远程调用，代码复用等等。</p>
</blockquote>
<ol>
<li>系统A与B通过Kafka进行基于队列的远程调用</li>
</ol>
</li>
<li><p>流量削峰</p>
<ol>
<li>交卷的时候</li>
<li>抢购的时候</li>
</ol>
</li>
</ol>
<h2 id="二、核心概念"><a href="#二、核心概念" class="headerlink" title="二、核心概念"></a>二、核心概念</h2><p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/1.%E6%9C%80%E7%AE%80%E5%8D%95Kafka%E9%9B%86%E7%BE%A4%E7%BB%93%E6%9E%84%E5%9B%BE.png" alt="1.最简单Kafka集群结构图"></p>
<h3 id="2-1-Base"><a href="#2-1-Base" class="headerlink" title="2.1 Base"></a>2.1 Base</h3><h4 id="2-1-1-topic"><a href="#2-1-1-topic" class="headerlink" title="2.1.1 topic"></a>2.1.1 topic</h4><blockquote>
<p>类似于一个mysql表，主题是一个逻辑概念，用于生产者发布数据，消费者拉取数据</p>
</blockquote>
<ul>
<li>Kafka中的主题必须要有标识符，而且是唯一的，Kafka中可以有任意数量的主题，没有数量上的限制</li>
<li>在主题中的消息是有结构的，一般一个主题包含某一类消息</li>
<li>一旦生产者发送消息到主题中，这些消息就不能被更改</li>
</ul>
<h4 id="2-1-2-事件"><a href="#2-1-2-事件" class="headerlink" title="2.1.2 事件"></a>2.1.2 事件</h4><p>一个事件包括{key,value,date,others}，就是一个生产者生产的消息</p>
<h4 id="2-1-3-分区"><a href="#2-1-3-分区" class="headerlink" title="2.1.3 分区"></a>2.1.3 分区</h4><blockquote>
<p>数据分到不同的机器上，就可以分担单台服务器的IO压力，类似于分库分表</p>
</blockquote>
<p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20220510030817891.png" alt="image-20220510030817891"></p>
<h4 id="2-1-4-副本"><a href="#2-1-4-副本" class="headerlink" title="2.1.4 副本"></a>2.1.4 副本</h4><blockquote>
<p>确保单个数据节点故障也能使用</p>
</blockquote>
<p>Kafka 使用 Topic 来组织数据，每个 Topic 被分为若干个 Partition。每个 Partition 有多个副本。每个 broker 可以保存成百上千个属于不同 Topic 和 Partition 的副本。<strong>Kafka 副本的本质是一个只能追加写入的提交日志</strong>。</p>
<h4 id="2-1-5-Broker"><a href="#2-1-5-Broker" class="headerlink" title="2.1.5 Broker"></a>2.1.5 Broker</h4><ul>
<li>Kafka服务器进程，</li>
<li>生产者、消费者都要连接broker</li>
<li>一个集群由多个broker组成，功能实现Kafka集群的负载均衡、容错</li>
</ul>
<h4 id="2-1-6-offset"><a href="#2-1-6-offset" class="headerlink" title="2.1.6 offset"></a>2.1.6 offset</h4><blockquote>
<p>针对分区而言，下标</p>
</blockquote>
<h3 id="2-2-集群"><a href="#2-2-集群" class="headerlink" title="2.2 集群"></a>2.2 集群</h3><h4 id="2-2-1-集群"><a href="#2-2-1-集群" class="headerlink" title="2.2.1 集群"></a>2.2.1 集群</h4><blockquote>
<p>broker—注册–&gt;Zookeeper&lt;—订阅—-Kafka</p>
</blockquote>
<ol>
<li>Kafka 使用 Zookeeper 来维护集群成员的信息。</li>
<li>每个 broker 都有一个唯一标识符，这个标识符可以在配置文件里指定，也可以自动生成。在 broker 启动的时候，它通过创建临时节点把自己的 ID 注册到 Zookeeper。</li>
<li>Kafka 组件订阅 Zookeeper 的 /broker/ids 路径，当有 broker 加入集群或退出集群时，这些组件就可以获得通知。</li>
<li>kafka集群在各个服务器上备份topic分区中日志</li>
</ol>
<h4 id="2-2-2-ZooKeeper"><a href="#2-2-2-ZooKeeper" class="headerlink" title="2.2.2 ZooKeeper"></a>2.2.2 ZooKeeper</h4><ol>
<li><p>ZooKeeper 两个重要特性：</p>
<ul>
<li><p>客户端会话结束时，ZooKeeper 就会删除临时节点。</p>
</li>
<li><p>客户端注册监听它关心的节点，当节点状态发生变化（数据变化、子节点增减变化）时，ZooKeeper 服务会通知客户端。</p>
</li>
</ul>
</li>
<li><p>zookeeper作用</p>
<ul>
<li><p><strong>管理和协调broker</strong>，通知生产者和消费者Kafka集群中有新的broker加入、或者Kafka集群中出现<br>故障的broker。</p>
</li>
<li><p>存储Kafka的元数据（例如：有多少topic、partition、consumer）</p>
</li>
</ul>
</li>
</ol>
<h4 id="2-2-3-Leader"><a href="#2-2-3-Leader" class="headerlink" title="2.2.3 Leader"></a>2.2.3 Leader</h4><p>每个分区都有多个副本，比如partition3有副本1，2，3，那么推举为副本2为<strong>leader</strong>，1，3为<strong>follower</strong></p>
<h4 id="2-2-4-Follower"><a href="#2-2-4-Follower" class="headerlink" title="2.2.4 Follower"></a>2.2.4 Follower</h4><p>AR = ISR + OSR</p>
<ol>
<li><p>AR</p>
<p>分区的所有副本称为 「AR」（Assigned Replicas——已分配的副本）</p>
</li>
<li><p>ISR</p>
<p>所有与leader副本保持一定程度同步的副本（包括 leader 副本在内）组成 「ISR」（In-Sync Replicas——在同步中的副本）</p>
</li>
<li><p>OSR</p>
<p>由于follower副本同步滞后过多的副本（不包括 leader 副本）</p>
</li>
</ol>
<h4 id="2-2-5-Controller"><a href="#2-2-5-Controller" class="headerlink" title="2.2.5 Controller"></a>2.2.5 Controller</h4><blockquote>
<p>基于zookeeper选举一个Broker作为总控制器，责管理所有分区Partition和副本follower的状态。</p>
</blockquote>
<ol>
<li><p>非Controller的Broker都会在controller设置一个watch，以至于contoller能及时发现broker挂掉了</p>
</li>
<li><p>当某个分区的leader副本出现故障时，由控制器负责为该分区选举新的leader副本。并通过RPC通知X</p>
<p>X: 订阅该信息的Broker或者说是需要为此为改变的Broker</p>
</li>
<li><p>当检测到某个分区的ISR集合发生变化时，由控制器负责通知所有broker更新其元数据信息。</p>
</li>
<li><p>当使用kafka-topics.sh脚本为某个topic增加分区数量时，同样还是由控制器负责让新分区被其他节点感知 到。</p>
</li>
</ol>
<h4 id="2-2-6-为什么controller基于zk，而leader不基于zk"><a href="#2-2-6-为什么controller基于zk，而leader不基于zk" class="headerlink" title="2.2.6 为什么controller基于zk，而leader不基于zk"></a>2.2.6 为什么controller基于zk，而leader不基于zk</h4><p>容易脑裂</p>
<p>Kafka集群如果业务很多的情况下，会有很多的partition</p>
<p>假设某个broker宕机，就会出现很多的partiton都需要重新选举leader</p>
<p>如果使用zookeeper选举leader，会给zookeeper带来巨大的压力。所以，kafka中leader的选举不能使用ZK来实现</p>
<h3 id="2-3-其他"><a href="#2-3-其他" class="headerlink" title="2.3 其他"></a>2.3 其他</h3><h4 id="2-3-1-消费者组"><a href="#2-3-1-消费者组" class="headerlink" title="2.3.1 消费者组"></a>2.3.1 消费者组</h4><p>是对消费者的扩展，当一个消费者消费的数据过大的时候，并行消费分区    </p>
<ul>
<li>使用消费者组来共同消费数据，比如[A-E]消费数据[0-200]，增加了可扩展性</li>
<li>就算其中ABC挂掉了，0-200最终也能被消费掉，增加了容错性</li>
</ul>
<h4 id="2-3-1-生产者"><a href="#2-3-1-生产者" class="headerlink" title="2.3.1 生产者"></a>2.3.1 生产者</h4><p>​    生产者即数据的发布者，该角色将消息发布到Kafka的topic中。broker接收到生产者发送的消息后，将该消息追加到当前用于追加数据的segment文件中。生产者发送的消息，存储到一个partition中，生产者也可以指定数据存储的partition。</p>
<h4 id="ack模式"><a href="#ack模式" class="headerlink" title="ack模式"></a>ack模式</h4><p>是否启用确认模式</p>
<h4 id="Connectors"><a href="#Connectors" class="headerlink" title="Connectors"></a>Connectors</h4><p>Kafka的连接器可以将数据库中的数据导入到Kafka，也可以将Kafka的数据导出到数据库中</p>
<h4 id="Stream-Processors"><a href="#Stream-Processors" class="headerlink" title="Stream Processors"></a>Stream Processors</h4><p>流处理器可以Kafka中拉取数据，也可以将数据写入到Kafka中。</p>
<h2 id="三、操作"><a href="#三、操作" class="headerlink" title="三、操作"></a>三、操作</h2><h3 id="3-1-命令行"><a href="#3-1-命令行" class="headerlink" title="3.1 命令行"></a>3.1 命令行</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 创建名为test的主题</span></span><br><span class="line">bin/kafka-topics.sh --create --bootstrap-server 192.168.100.3:9092 --topic <span class="built_in">test</span></span><br><span class="line"><span class="comment"># 查看目前Kafka中的主题</span></span><br><span class="line">bin/kafka-topics.sh --list --bootstrap-server 192.168.100.3:9092</span><br><span class="line"><span class="comment"># kafka内置测试</span></span><br><span class="line"><span class="comment"># 生产消息</span></span><br><span class="line">bin/kafka-console-producer.sh --broker-list 192.168.100.3:9092 --topic <span class="built_in">test</span></span><br><span class="line"><span class="comment"># 消费消息</span></span><br><span class="line">bin/kafka-console-consumer.sh --bootstrap-server 192.168.100.3:9092 --topic <span class="built_in">test</span> --from-beginning</span><br></pre></td></tr></table></figure>



<h3 id="3-2-kafkatools"><a href="#3-2-kafkatools" class="headerlink" title="3.2 kafkatools"></a>3.2 kafkatools</h3><p>wget <a href="https://www.kafkatool.com/download2/offsetexplorer_64bit.exe">https://www.kafkatool.com/download2/offsetexplorer_64bit.exe</a></p>
<p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20220510020120532.png" alt="image-20220510020120532"></p>
<h4 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h4><ol>
<li>broker 节点</li>
<li>topic<ol>
<li>t1 表1</li>
<li>_consumer_offset   消费下标</li>
</ol>
</li>
<li>consumers<ol>
<li>console_consumer-1 消费者1 </li>
</ol>
</li>
</ol>
<h2 id="四、JavaAPI"><a href="#四、JavaAPI" class="headerlink" title="四、JavaAPI"></a>四、JavaAPI</h2><h3 id="4-1-依赖"><a href="#4-1-依赖" class="headerlink" title="4.1 依赖"></a>4.1 依赖</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- kafka客户端工具 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.kafka<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>kafka-clients<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.4.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 工具类 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- SLF桥接LOG4J日志 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-log4j12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.16<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">log4j.rootLogger</span>=<span class="string">INFO,stdout</span></span><br><span class="line"><span class="meta">log4j.appender.stdout</span>=<span class="string">org.apache.log4j.ConsoleAppender </span></span><br><span class="line"><span class="meta">log4j.appender.stdout.layout</span>=<span class="string">org.apache.log4j.PatternLayout </span></span><br><span class="line"><span class="meta">log4j.appender.stdout.layout.ConversionPattern</span>=<span class="string">%5p - %m%n</span></span><br></pre></td></tr></table></figure>

]]></content>
  </entry>
  <entry>
    <title>vue</title>
    <url>/2021/11/30/%E5%89%8D%E7%AB%AF/vue/</url>
    <content><![CDATA[<p>[toc]</p>
<h3 id="一、组件化"><a href="#一、组件化" class="headerlink" title="一、组件化"></a>一、组件化</h3><ol>
<li><p>传统方式</p>
<ol>
<li>每个部位都需要引入一个css,js文件<ul>
<li>代码复用率低</li>
<li>依赖关系混乱，各个js组件还会互相引入</li>
</ul>
</li>
</ol>
</li>
<li><p>组件步骤</p>
<ol>
<li><p>创建组件 </p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> student = Vue.extend(&#123;  </span><br><span class="line">    <span class="attr">template</span>:<span class="string">`   </span></span><br><span class="line"><span class="string">				&lt;div&gt;</span></span><br><span class="line"><span class="string">					&lt;h2&gt;学生姓名：&#123;&#123;studentName&#125;&#125;&lt;/h2&gt;</span></span><br><span class="line"><span class="string">					&lt;h2&gt;学生年龄：&#123;&#123;age&#125;&#125;&lt;/h2&gt;</span></span><br><span class="line"><span class="string">				&lt;/div&gt;</span></span><br><span class="line"><span class="string">			`</span>,<span class="comment">//组件模板(结构样式)</span></span><br><span class="line">    <span class="function"><span class="title">data</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="attr">studentName</span>:<span class="string">&#x27;张三&#x27;</span>,</span><br><span class="line">            <span class="attr">age</span>:<span class="number">18</span></span><br><span class="line">        &#125;    <span class="comment">//组件数据</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li>
<li><p>注册组件</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Vue.component(<span class="string">&#x27;hello&#x27;</span>,hello)<span class="comment">//全局组件</span></span><br><span class="line"><span class="keyword">new</span> Vue(&#123;  <span class="comment">//局部组件</span></span><br><span class="line">    <span class="attr">el</span>:<span class="string">&#x27;#root&#x27;</span>,</span><br><span class="line">    <span class="attr">data</span>:&#123;</span><br><span class="line">        <span class="attr">msg</span>:<span class="string">&#x27;你好啊！&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//第二步：注册组件（局部注册）</span></span><br><span class="line">    <span class="attr">components</span>:&#123;</span><br><span class="line">        school,</span><br><span class="line">        student</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li>
<li><p>使用组件</p>
</li>
</ol>
</li>
</ol>
<h3 id="二、单文件组件"><a href="#二、单文件组件" class="headerlink" title="二、单文件组件"></a>二、单文件组件</h3><ol>
<li><p>代码</p>
</li>
<li><p>只支持三种标签</p>
<ol>
<li><blockquote>
<p>模板 </template></p>
</blockquote>
</li>
<li><blockquote>
<p>业务代码<script></p>
</blockquote>
</li>
<li><blockquote>
<p>样式<style></p>
</blockquote>
</li>
</ol>
</li>
<li><p>props和data区别</p>
<ol>
<li><p>props是tag的attrs</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;Student name=<span class="string">&quot;李四&quot;</span> sex=<span class="string">&quot;女&quot;</span> :age=<span class="string">&quot;18&quot;</span>/&gt;  <span class="comment">//其中:是动态绑定，也就是说:后面是一个vue表达式excp，@click()h</span></span><br></pre></td></tr></table></figure></li>
<li><p>相同点，都可以用vm.name获得</p>
</li>
<li><p>props是传进来的，不能修改，对于需要修改的props，可以使用data辅助</p>
</li>
<li><p>props和data的变量名不能相同，data的优先级&gt;props</p>
</li>
</ol>
</li>
<li><p>mixin混合</p>
<blockquote>
<p>就是把两个vue混合到一起，继承的一种变形</p>
</blockquote>
<ul>
<li>全局混合，在app.vue中import，那么每个新的vue文件都会混合这个import的vm</li>
</ul>
</li>
<li><p>render: h =&gt; h(App)</p>
<p>  其中render函数是一个vue的默认命名，vue会调用这个函数，传入一个h，这个h是另一个函数，h函数的作用是渲染vue文件或者其他标签。</p>
</li>
<li><p>过滤器—&gt;管道符的承载</p>
</li>
<li><p>组件间通信</p>
<p>1. </p>
</li>
</ol>
<h3 id="三、vue里面的后端理念"><a href="#三、vue里面的后端理念" class="headerlink" title="三、vue里面的后端理念"></a>三、vue里面的后端理念</h3><ol>
<li>代理getter,setter</li>
<li>data单例/多例模式<ol>
<li>写成data{}就是单例模式，任意一个vue改变值，全部的vue都会改变</li>
<li>写成data(){return}就是多例，每次使用都是返回新的。</li>
</ol>
</li>
</ol>
<h3 id="组件间通信"><a href="#组件间通信" class="headerlink" title="组件间通信"></a>组件间通信</h3><ol>
<li>父传子： props</li>
<li>子传父：父define f(data)  —&gt;props(f)—&gt;子调用f传入data</li>
</ol>
<h4 id="全局组件通信"><a href="#全局组件通信" class="headerlink" title="全局组件通信"></a>全局组件通信</h4><h3 id="四、组件自定义事件"><a href="#四、组件自定义事件" class="headerlink" title="四、组件自定义事件"></a>四、组件自定义事件</h3><ol>
<li></li>
</ol>
]]></content>
  </entry>
  <entry>
    <title>web算法</title>
    <url>/2021/12/21/%E5%BC%80%E5%8F%91/web%E7%AE%97%E6%B3%95/</url>
    <content><![CDATA[<h2 id="一、限流算法"><a href="#一、限流算法" class="headerlink" title="一、限流算法"></a>一、限流算法</h2><blockquote>
<p>在开发高并发系统时，有三把利器用来保护系统：缓存、降级和限流。</p>
</blockquote>
<h3 id="1-1-计数器算法"><a href="#1-1-计数器算法" class="headerlink" title="1.1 计数器算法"></a>1.1 计数器算法</h3><p>规定1分钟1个ip只能100次请求，所有ip只能10000此请求</p>
<p>问题：用户A在00:59发送了100次请求，又在01:00发送了100次请求，这就相当于2秒内发送了200次，也可能会压垮服务器。</p>
<h3 id="1-2-滑动窗口算法"><a href="#1-2-滑动窗口算法" class="headerlink" title="1.2 滑动窗口算法"></a>1.2 滑动窗口算法</h3><p>这里的1分钟是滑动的，而非一定是00:00-01:00</p>
<h3 id="1-3-令牌桶算法"><a href="#1-3-令牌桶算法" class="headerlink" title="1.3 令牌桶算法"></a>1.3 令牌桶算法</h3><blockquote>
<p>基于总量，每个能被处理的请求都被分配一个令牌，规定令牌总数有上限</p>
</blockquote>
<h3 id="1-4-漏桶算法"><a href="#1-4-漏桶算法" class="headerlink" title="1.4 漏桶算法"></a>1.4 漏桶算法</h3><blockquote>
<p>基于速率，规定每秒处理次数有上限</p>
</blockquote>
<h3 id=""><a href="#" class="headerlink" title=""></a></h3><h2 id="二、加密算法"><a href="#二、加密算法" class="headerlink" title="二、加密算法"></a>二、加密算法</h2><h3 id="2-1-MD5算法"><a href="#2-1-MD5算法" class="headerlink" title="2.1 MD5算法"></a>2.1 <a href="https://blog.csdn.net/UtopiaOfArtoria/article/details/82429467">MD5算法</a></h3><blockquote>
<p>MD5,是一种信息摘要算法。简单来说，就是把一段信息（明文），通过一种有损的方式压缩成定长的字符（32位密文）。因为这种压缩方式是会损失信息的，所以是无法还原出“明文”的。虽然无法从数学上破解MD5算法，但由于现在计算机具备强大的计算能力，还是可以通过“穷举法”破解该算法。如果想用该算法加密，还可以通过“加盐”的方式提高解密难度。该算法允许多传一个参数”salt”,指定通过MD5加密的次数，这样是能够提高解密难度的。</p>
</blockquote>
<p><a href="https://stackoverflow.com/questions/8852668/what-is-the-clash-rate-for-md5">md5冲突概率</a></p>
<h3 id="2-2-SHA算法"><a href="#2-2-SHA算法" class="headerlink" title="2.2 SHA算法"></a>2.2 SHA算法</h3><blockquote>
<p>安全散列算法。与MD5算法的特点是一致的，SHA-1摘要比MD5摘长,长度是40位，因此更难破解。</p>
</blockquote>
<h3 id="2-3-RSA算法"><a href="#2-3-RSA算法" class="headerlink" title="2.3 RSA算法"></a>2.3 RSA算法</h3><blockquote>
<p>一种非常常用的不对称加密算法。</p>
</blockquote>
<h4 id="2-3-1-原理"><a href="#2-3-1-原理" class="headerlink" title="2.3.1 原理"></a>2.3.1 原理</h4><p>基于一个十分简单的数论事实：将两个大素数相乘十分容易，但是想要对其乘积进行因式分解却极其困难，因此可以将乘积公开作为加密密钥。</p>
<h4 id="2-3-2-场景"><a href="#2-3-2-场景" class="headerlink" title="2.3.2 场景"></a>2.3.2 场景</h4><p>java-web项目使用RSA算法加密的场景再现：</p>
<p>为每个客户(User)生成一对密钥(keyPairs)，<br>将公钥(publicKey)通过URL接口向前端公开，私钥(userId:privateKey)保存在数据库或redis中，<br>然后前端客户可以通过公钥加密自己的信息（前端用JS进行RSA公钥加密），后端通过该用户对应的私钥解析出用户信息(后端用Java进行RSA私钥解密)，再将用户信息保存在数据库。</p>
<h3 id="2-3-3-非对称加密缺陷"><a href="#2-3-3-非对称加密缺陷" class="headerlink" title="2.3.3 非对称加密缺陷"></a>2.3.3 非对称加密缺陷</h3><p>​    非对称性加密依然没有解决数据传输的安全性问题，比如A想向B发数据，B首先生成一对密钥(公钥和私钥)，然后将公钥发给A，A拿到B发给他的公钥有就可以使用公钥加密数据后发给B，然而在B公钥发送给A的这个过程中，很有可能会被第三方C截获，C截获到B的公钥后，也使用B的公钥加密数据，然后发给B，B接收到数据后就晕了，因为搞不清楚接收到的数据到底是A发的还是C发的，这是其中一个问题，另一个问题就是，C截获到B发的公钥后，C可以自己生成一对密钥(公钥和私钥)，然后发给A，A拿到公钥后就以为是B发给他的，然后就使用公钥加密数据发给B，发送给B的过程中被C截获下来，由于A是用C发给他的公钥加密数据的，而C有私钥，因此就可以解密A加密过后的内容了，而B接收到A发给他的数据后反而解不开了，因为数据是用C的公钥加密的，B没有C的私钥，所以就无法解密。</p>
<p>​    所以，非对称性加密存在一个问题：A想向B发数据，A如何确定拿到的公钥一定是B发的呢？那么如何解决这个问题呢？只能靠一个第三方机构(CA机构，即证书授权中心(Certificate Authority )，或称证书授权机构)来担保。A想向B发数据，B首先将公钥发给CA机构，CA机构拿到B的公钥后跑到B的家里问：这是你发的公钥吗？B确认过后说是：没错，是我发的！那么此时CA机构就会为B的公钥做担保，生成一份数字证书给B，数字证书包含了CA的担保认证签名和B的公钥，B拿到CA的这份数字证书后，就发给A，A拿到数字证书后，看到上有CA的签名，就可以确定当前拿到的公钥是B发的，那么就可以放心大胆地使用公钥加密数据，然后发给B了。</p>
<h3 id="2-4-Base64编码-非加密"><a href="#2-4-Base64编码-非加密" class="headerlink" title="2.4 Base64编码(非加密)"></a>2.4 Base64编码(非加密)</h3><h2 id="三、https连接器"><a href="#三、https连接器" class="headerlink" title="三、https连接器"></a>三、https连接器</h2><p>　　明白了互联网上的加密原理之后，下面来看看浏览器与服务器交互时，浏览器想将数据加密后再发送给服务器，那么该怎么做呢？服务器首先要向浏览器出示一份数字证书，浏览器看到数字证书后，就可以使用数字证书里面的公钥加密数据，所以要想做浏览器和服务器的加密数据传输，那么首先得针对服务器生成一份数字证书。然后再配置一下服务器，让服务器收到浏览器的请求之后，会向浏览器出示它的数字证书。</p>
]]></content>
      <categories>
        <category>开发</category>
      </categories>
  </entry>
  <entry>
    <title>hadoop概述</title>
    <url>/2022/05/04/%E5%A4%A7%E6%95%B0%E6%8D%AE/Hadoop%E6%A6%82%E8%BF%B0/</url>
    <content><![CDATA[<h2 id="一、概念"><a href="#一、概念" class="headerlink" title="一、概念"></a>一、概念</h2><h3 id="1-1-数据分析"><a href="#1-1-数据分析" class="headerlink" title="1.1 数据分析"></a>1.1 数据分析</h3><blockquote>
<p>大数据：体量volume、种类variety、低价值密度、速度快、具有可靠性</p>
</blockquote>
<h4 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h4><ol>
<li>当下分析、现状分析、实时分析、streaming</li>
<li>过去分析，原因分析、离线分析、批处理</li>
<li>未来分析，预测分析、机器学习、ML</li>
</ol>
<h4 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h4><ol>
<li>明确目的<ol>
<li>数据分析方法论</li>
</ol>
</li>
<li>数据收集<ol>
<li>业务数据</li>
<li>日志</li>
<li>爬虫</li>
<li>公开数据，excel</li>
</ol>
</li>
<li>数据处理<ol>
<li>数据清洗</li>
<li>准换、计算、提取</li>
<li>变成干净、规则、结构化的数据</li>
</ol>
</li>
<li>数据分析<ol>
<li>数据分析方法</li>
<li>专门软件</li>
</ol>
</li>
<li>数据展现<ol>
<li>数据可视化</li>
<li>数据挖掘</li>
</ol>
</li>
<li>报告编写</li>
</ol>
<h3 id="1-2-分布式"><a href="#1-2-分布式" class="headerlink" title="1.2 分布式"></a>1.2 分布式</h3><blockquote>
<p>分布式：多台机器、每台机器部署不同机器</p>
<p>集群：多台机器、每台机器部署相同组件</p>
</blockquote>
<h3 id="1-3-资源调度策略"><a href="#1-3-资源调度策略" class="headerlink" title="1.3 资源调度策略"></a>1.3 资源调度策略</h3><blockquote>
<p>YARN资源调度器为Scheduler，以在yarn-site.xml中的yarn.resourcemanager.scheduler.class进行配置策略</p>
</blockquote>
<ol>
<li>FIFO，先来先服务</li>
<li>Capacity(默认)，权重</li>
<li>Fair，时间片</li>
</ol>
<h2 id="二、Hadoop"><a href="#二、Hadoop" class="headerlink" title="二、Hadoop"></a>二、Hadoop</h2><blockquote>
<p>狭义：Hadoop软件</p>
<p>广义：Hadoop生态</p>
<p>起源：谷歌三篇论文，捐给apache、2008开源</p>
</blockquote>
<h3 id="2-1-组件"><a href="#2-1-组件" class="headerlink" title="2.1 组件"></a>2.1 组件</h3><h4 id="2-1-1-HDFS集群"><a href="#2-1-1-HDFS集群" class="headerlink" title="2.1.1 HDFS集群"></a>2.1.1 HDFS集群</h4><blockquote>
<p>，HDFS使用多台计算机存储文件, 并且提供统一的访问接口, 像是访问一个普通文件系统一样使用分布式文件系统</p>
</blockquote>
<p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20220504191146557.png" alt="image-20220504191146557"></p>
<p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20220504171122154.png" alt="image-20220504171122154"></p>
<p>分布式文件系统</p>
<ol>
<li><p>主角色 NameNode</p>
<ol>
<li>用于维护、管理文件系统元数据</li>
<li>用户hdfs dfs访问的就是这个角色</li>
<li>基于内存+磁盘持久化</li>
</ol>
</li>
<li><p>从角色 DataNode</p>
<ol>
<li>真正存储数据的地方</li>
<li>随时向NN汇报自己负责的块列表</li>
</ol>
</li>
<li><p>主角色辅助角色 SecondaryNameNode，辅助NameNode完成大任务。</p>
</li>
</ol>
<h5 id="上传流程"><a href="#上传流程" class="headerlink" title="上传流程"></a>上传流程</h5><ol>
<li>客户端创建DistributedFileSystem对象</li>
<li>调用create方法，发送RPC请求，让NameNode创建文件</li>
<li>NameNode接收到请求并响应，客户端将结果封装成FSDataOutputStream输出流</li>
<li>客户端向FSDataOutputStream写出数据</li>
<li>开始流式传输  客户端—-&gt;第一个DataNode—-&gt;第二个DataNode—-&gt;第三个DataNode</li>
<li>ACK数据校验  客户端&lt;—-第一个DataNode&lt;—-第二个DataNode&lt;—-第三个DataNode</li>
<li>客户端FSDataOutputStream.close()</li>
</ol>
<h5 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h5><ol>
<li><p>pipeline，管道实时传输，而非复制</p>
</li>
<li><p>ACK应答机制</p>
</li>
<li><p>默认三副本</p>
</li>
</ol>
<h4 id="2-1-2-YARM"><a href="#2-1-2-YARM" class="headerlink" title="2.1.2 YARM"></a>2.1.2 YARM</h4><blockquote>
<p>8081端口</p>
</blockquote>
<p>分布式资源管理、资源调度系统</p>
<h5 id="组件"><a href="#组件" class="headerlink" title="组件"></a>组件</h5><ol>
<li><p>主角色 ResouceManage  RM，集群层面</p>
<ol>
<li>决定系统中所有应用程序之间资源分配的最终权限，即最终仲裁</li>
<li>接收用户的作业提交，并通过NM分配、管理各个机器上的计算资源</li>
</ol>
</li>
<li><p>从角色  NodeManager NM ， 集群层面</p>
<ol>
<li>负责管理本机器上的计算资源。</li>
</ol>
</li>
<li><p>应用 ApplicationMaster  AM   ，应用层面</p>
<ol>
<li>应用程序内的“老大”，负责程序内部各阶段的资源申请，监督程序的执行情况</li>
<li>用户提交的每个应用程序均包含一个AM</li>
</ol>
</li>
<li><p>客户端 Client ，引用层面</p>
</li>
<li><p>容器 Container，资源的抽象</p>
</li>
</ol>
<h5 id="作业提交流程"><a href="#作业提交流程" class="headerlink" title="作业提交流程"></a>作业提交流程</h5><p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20220504183246347.png" alt="image-20220504183246347"></p>
<p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20220504185350484.png" alt="image-20220504185350484"></p>
<ol>
<li>MR作业提交 Client–&gt;RM <ol>
<li>用户提交作业jar包（下面的描述：MR==jar==作业）</li>
</ol>
</li>
<li>资源的申请 MrAppMaster–&gt;RM<ol>
<li>RM找到一个可用的Container，</li>
<li>RM让这个Container的NM在Container中运行这个jar的ApplicationMaster（AM是前置处理，任何一个程序作业都有对应的AM）</li>
</ol>
</li>
<li>MR作业状态汇报 Container（Map|Reduce Task）–&gt;Container（MrAppMaster） <ol>
<li>AM启动成功，向RM注册信息（现在可在web上看到信息了）</li>
<li>AM向RM申请资源</li>
<li>mapTask，reduceTask 运行</li>
</ol>
</li>
<li>节点的状态汇报 NM–&gt;RM<ol>
<li>NM–&gt;MR 汇报</li>
<li>MR–&gt;RM 汇报</li>
</ol>
</li>
</ol>
<h4 id="2-1-3-MapReduce"><a href="#2-1-3-MapReduce" class="headerlink" title="2.1.3 MapReduce"></a>2.1.3 MapReduce</h4><blockquote>
<p>8088端口 MR</p>
</blockquote>
<p>分布式计算引擎、分而治之思想</p>
<h5 id="流程"><a href="#流程" class="headerlink" title="流程"></a>流程</h5><p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20220504183156480.png" alt="image-20220504183156480"></p>
<h5 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h5><ol>
<li>易于变成</li>
<li>方便扩展</li>
<li>高容错性</li>
<li>适合离线处理</li>
</ol>
<h5 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h5><ol>
<li>实时计算差</li>
<li>不能流式计算</li>
</ol>
<h5 id="实例进程"><a href="#实例进程" class="headerlink" title="实例进程"></a>实例进程</h5><ol>
<li>MPAppMaster,负责整个MR程序的协调</li>
<li>MapTask，负责map阶段的处理</li>
<li>ReduceTask 负责reduce阶段处理</li>
</ol>
<h5 id="阶段组成"><a href="#阶段组成" class="headerlink" title="阶段组成"></a>阶段组成</h5><p>(map,reduce)串行化：[(map,reduce)，(map,reduce)，(map,reduce)]</p>
<h3 id="2-2-特点"><a href="#2-2-特点" class="headerlink" title="2.2 特点"></a>2.2 特点</h3><ol>
<li>扩容能力</li>
<li>效率高</li>
<li>成本低</li>
<li>可靠性</li>
<li>技术与业务解耦、技术就有通用性、具体到应用需要用户自行操作</li>
<li></li>
</ol>
<h3 id="2-3-版本变迁"><a href="#2-3-版本变迁" class="headerlink" title="2.3 版本变迁"></a>2.3 版本变迁</h3><h4 id="开源版本"><a href="#开源版本" class="headerlink" title="开源版本"></a>开源版本</h4><ol>
<li>更新快</li>
<li>2.0提出YARM</li>
<li>3.0主要是性能优化</li>
</ol>
<h4 id="商业版"><a href="#商业版" class="headerlink" title="商业版"></a>商业版</h4><ol>
<li>稳定</li>
</ol>
<h3 id="2-4-生态圈"><a href="#2-4-生态圈" class="headerlink" title="2.4 生态圈"></a>2.4 生态圈</h3><p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20220504171948802.png" alt="image-20220504171948802"></p>
<p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20220504121903697.png" alt="image-20220504121903697"></p>
<ol>
<li>Spark</li>
</ol>
<h2 id="三、实例"><a href="#三、实例" class="headerlink" title="三、实例"></a>三、实例</h2><h3 id="3-1-wordCount"><a href="#3-1-wordCount" class="headerlink" title="3.1 wordCount"></a>3.1 wordCount</h3><blockquote>
<p>三个阶段</p>
</blockquote>
<p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/Word-count-program-flow-executed-with-MapReduce.png" alt="Word-count-program-flow-executed-with-MapReduce"></p>
<h4 id="map"><a href="#map" class="headerlink" title="map"></a>map</h4><p>将单词切分</p>
<h4 id="shuffle"><a href="#shuffle" class="headerlink" title="shuffle"></a>shuffle</h4><p>根据默认排序将数据打乱分配</p>
<h4 id="reduce"><a href="#reduce" class="headerlink" title="reduce"></a>reduce</h4><p>合并结果</p>
<h2 id="四、命令"><a href="#四、命令" class="headerlink" title="四、命令"></a>四、命令</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"> HDFS集群</span><br><span class="line">start-dfs.sh </span><br><span class="line">stop-dfs.sh </span><br><span class="line"> YARN集群</span><br><span class="line">start-yarn.sh</span><br><span class="line">stop-yarn.sh</span><br><span class="line"> Hadoop集群</span><br><span class="line">start-all.sh</span><br><span class="line">stop-all.sh </span><br></pre></td></tr></table></figure>

<p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20220504204148494.png" alt="image-20220504204148494"></p>
<p>[官方命令](<a href="https://hadoop.apache.org/docs/r3.3.0/hadoop-project-dist/hadoop-common/FileSystemShell.html">Apache Hadoop 3.3.0 – Overview</a>)</p>
<h3 id="hdfs"><a href="#hdfs" class="headerlink" title="hdfs"></a>hdfs</h3><ol>
<li>创建文件夹   hadoop fs -mkdir /itcast</li>
<li>上传文件 hadoop fs -put zookeeper.out /itcast </li>
<li>下载 hadoop fs -get /itcast/zookeeper.out /. </li>
<li>查看文件列表 hadoop fs -ls /</li>
<li>查看文件 hadoop fs -cat a.txt</li>
<li>拷贝 cp</li>
<li>追加 appendToFile</li>
<li>移动 mv</li>
</ol>
]]></content>
  </entry>
  <entry>
    <title>Hbase</title>
    <url>/2022/05/06/%E5%A4%A7%E6%95%B0%E6%8D%AE/Hbase/</url>
    <content><![CDATA[<h2 id="一、概述"><a href="#一、概述" class="headerlink" title="一、概述"></a>一、概述</h2><p><a href="https://hbase.apache.org/book.html">https://hbase.apache.org/book.html</a></p>
<h3 id="1-1-Hbase"><a href="#1-1-Hbase" class="headerlink" title="1.1 Hbase"></a>1.1 Hbase</h3><p>​    HBase是BigTable的开源java版本。是建立在HDFS之上，提供高可靠性、高性能、列存储、可伸缩、实时读写，主用来存储结构化和半结构化的松散数据，NoSQL的数据库系统。</p>
<p>​    Hadoop擅长于存储各种格式的庞大的数据，任意的格式甚至非结构化的处理，要查找数据必须搜索整个数据集， 如果要进行随机读取数据，效率较低。</p>
<p>​    2007年开始，2010成为Apache项目</p>
<h3 id="1-2-性质"><a href="#1-2-性质" class="headerlink" title="1.2 性质"></a>1.2 性质</h3><ol>
<li>HBase仅能通过主键(row key)和主键的range来检索数据</li>
<li>支持单行事务，不支持ACID</li>
<li>支持分布式，支持HDFS</li>
<li>原生支持计算引擎</li>
<li>Hbase中支持的数据类型：byte[]</li>
<li>面向列蔟的kv数据库</li>
</ol>
<h3 id="1-3-特点"><a href="#1-3-特点" class="headerlink" title="1.3 特点"></a>1.3 特点</h3><ol>
<li>大：一个表可以有上十亿行，上百万列</li>
<li>面向列:面向列(族)的存储和权限控制，列(族)独立检索</li>
<li>稀疏:对于为空(null)的列，并不占用存储空间，因此，表可以设计的非常稀疏</li>
<li></li>
</ol>
<h3 id="1-4-场景"><a href="#1-4-场景" class="headerlink" title="1.4 场景"></a>1.4 场景</h3><ol>
<li>新闻、网页、图片存储在HBase之中</li>
<li>时序数据(OpenTSDB模块)</li>
<li>用户画像，是一个比较大的稀疏矩阵</li>
<li>轨迹、气象网格之类，滴滴打车的轨迹数据等时空数据</li>
<li>爬虫数据</li>
<li>数据备份</li>
</ol>
<h2 id="二、核心概念"><a href="#二、核心概念" class="headerlink" title="二、核心概念"></a>二、核心概念</h2><h3 id="2-1-数据模型"><a href="#2-1-数据模型" class="headerlink" title="2.1 数据模型"></a>2.1 数据模型</h3><p><img src="E:\data-ana\ana-notes\experience\大数据\image-20220510154140056.png" alt="image-20220510154140056"></p>
<p>表</p>
<p>行  rowkey ：</p>
<p><img src="E:\data-ana\ana-notes\experience\大数据\image-20220510155452822.png" alt="image-20220510155452822"></p>
<ul>
<li><a href="https://blog.csdn.net/elizabethxxy/article/details/109280185">https://blog.csdn.net/elizabethxxy/article/details/109280185</a></li>
<li>RowKey：用于唯一标识Hbase中的一条数据（记录），不可重复，按照字典顺序排序，只能存储64k的<strong>字节数据</strong>，因此一般要求设计RowKey要简短。</li>
<li>TimeStamp：HBase自动赋值时间戳(也可自己实现)，作为版本号，64位整型。Hbase每个cell存储单元（k:v）对同一份数据有多个版本，通过实践戳来区分版本之间的差异，按时间倒叙排序。</li>
<li>CF(ColumnFamily):列族，可包含多列。权限控制，存储以及调优都是在列族层面进行的。HBase把同一列族里面的数据存储在同一目录下，由几个文件保存（StoreFile）。</li>
<li>Column:列，对应key，一列可以在多个版本中维护不同数据。</li>
<li>Value:数据。</li>
<li>Cell:是未解析的<strong>字节数组</strong>。由{rowkey, column(=<family>+<qualifier>),version}唯一确定的单元。由rowkey，列族，列，版本唯一确定一个单元。中的数据，没有类型，全部是字节码形式存储。</li>
</ul>
<p>​    </p>
<h2 id="三、shell"><a href="#三、shell" class="headerlink" title="三、shell"></a>三、shell</h2><p><a href="https://www.yiibai.com/hbase/hbase_shell.html">教程</a></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">./start-dfs.sh</span><br><span class="line">./start-hbase.sh</span><br><span class="line">hhase shellf</span><br></pre></td></tr></table></figure>

<p><a href="http://c2:16010/master-status">http://c2:16010/master-status</a></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># hbase-shell中</span></span><br><span class="line">status</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="四、phoenix"><a href="#四、phoenix" class="headerlink" title="四、phoenix"></a>四、phoenix</h2><h2 id="五、java"><a href="#五、java" class="headerlink" title="五、java"></a>五、java</h2>]]></content>
      <categories>
        <category>大数据</category>
      </categories>
  </entry>
  <entry>
    <title>大数据安装</title>
    <url>/2022/05/06/%E5%A4%A7%E6%95%B0%E6%8D%AE/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%89%E8%A3%85/</url>
    <content><![CDATA[<h2 id="一、Hadoop"><a href="#一、Hadoop" class="headerlink" title="一、Hadoop"></a>一、Hadoop</h2><h3 id="1-1-前提"><a href="#1-1-前提" class="headerlink" title="1.1 前提"></a>1.1 前提</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 安装java</span></span><br><span class="line">wget https://repo.huaweicloud.com/java/jdk/8u201-b09/jdk-8u201-linux-i586.tar.gz</span><br><span class="line"><span class="comment"># 配置环境变量</span></span><br><span class="line">vim /etc/profile </span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line"><span class="comment"># 安装ssh  #目的就是可以免密ssh localhost</span></span><br><span class="line">sudo apt-get install ssh openssh-server</span><br><span class="line">ssh-keygen -t rsa</span><br><span class="line">cat ~/.ssh/id_rsa.pub &gt;&gt; authorized_keys</span><br><span class="line">ssh-copy-id -i /root/.ssh/id_rsa.pub root@localhost</span><br><span class="line">ssh localhost</span><br><span class="line"><span class="comment"># 其他</span></span><br><span class="line">yum install glibc.i686 </span><br></pre></td></tr></table></figure>



<h3 id="1-2-安装"><a href="#1-2-安装" class="headerlink" title="1.2 安装"></a>1.2 安装</h3><ol>
<li><p>wget <a href="http://mirrors.hust.edu.cn/apache/hadoop/core/stable/hadoop-2.7.1.tar.gz">http://mirrors.hust.edu.cn/apache/hadoop/core/stable/hadoop-2.7.1.tar.gz</a></p>
</li>
<li><p>tar -zxvf hadoop-2.7.1.tar.gz</p>
</li>
<li><p>vim etc/hadoop/core-site.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.tmp.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>file:/root/data/hadoop<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>Abase for other temporary directories.<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>fs.defaultFS<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>hdfs://localhost:9000<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>vim mapred-site.xml.template </p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapred.job.tracker<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>localhost:9001<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>vim hdfs-site.xml </p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.replication<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.name.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>file:/root/data/hadoop/dfs/name<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.datanode.data.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>file:/root/data/hadoop/dfs/data<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>vim start-dfs.sh <strong>和</strong> stop-dfs.sh </p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">HDFS_DATANODE_USER=root</span><br><span class="line">HADOOP_SECURE_DN_USER=hdfs</span><br><span class="line">HDFS_NAMENODE_USER=root</span><br><span class="line">HDFS_SECONDARYNAMENODE_USER=root</span><br></pre></td></tr></table></figure></li>
<li><p>vim start-yarn.sh <strong>和</strong> stop-yarn.sh文件 </p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">YARN_RESOURCEMANAGER_USER=root</span><br><span class="line">HADOOP_SECURE_DN_USER=yarn</span><br><span class="line">YARN_NODEMANAGER_USER=root</span><br></pre></td></tr></table></figure></li>
<li><p>vim etc/hadoop/hadoop.env.sh </p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> JAVA_HOME=<span class="string">&quot;/root/config/jdk1.8.0_2&quot;</span></span><br></pre></td></tr></table></figure></li>
<li><p>vim /etc/profile <strong>和</strong> hadoop-env.sh</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> HADOOP_HOME=/root/config/hadoop-3.1.0</span><br><span class="line"><span class="built_in">export</span> HADOOP_OPTS=<span class="string">&quot;-Djava.library.path=<span class="variable">$HADOOP_HOME</span>/lib:<span class="variable">$HADOOP_COMMON_LIB_NATIVE_DIR</span>&quot;</span></span><br><span class="line"><span class="built_in">export</span> HADOOP_COMMON_LIB_NATIVE_DIR=<span class="variable">$HADOOP_HOME</span>/lib/native</span><br><span class="line"><span class="built_in">export</span> HADOOP_OPTS=<span class="string">&quot;-Djava.library.path=<span class="variable">$HADOOP_HOME</span>/lib&quot;</span></span><br><span class="line"><span class="built_in">export</span> JAVA_LIBRARY_PATH=<span class="variable">$HADOOP_HOME</span>/lib/native</span><br></pre></td></tr></table></figure></li>
<li><p>bin/hdfs namenode -format</p>
</li>
<li><p>启动datanode： ./sbin/hadoop-daemon.sh start datanode    </p>
</li>
</ol>
<h3 id="1-3-验证"><a href="#1-3-验证" class="headerlink" title="1.3 验证"></a>1.3 验证</h3><ol>
<li>yarn <a href="http://c2:8088/cluster">http://c2:8088/cluster</a></li>
<li>hdfs <a href="http://c2:50070/">http://c2:50070</a>   hadoop3 改为9870</li>
<li>spark 4040/jobs</li>
</ol>
<h3 id="1-4-更换版本"><a href="#1-4-更换版本" class="headerlink" title="1.4 更换版本"></a>1.4 更换版本</h3><blockquote>
<p>目前方案就是重新下载，然后重新配置</p>
</blockquote>
<h2 id="二、Hbase"><a href="#二、Hbase" class="headerlink" title="二、Hbase"></a>二、Hbase</h2><h3 id="2-1-前提"><a href="#2-1-前提" class="headerlink" title="2.1 前提"></a>2.1 前提</h3><ol>
<li>java</li>
<li>hadoop 并启动</li>
</ol>
<h3 id="2-2-安装"><a href="#2-2-安装" class="headerlink" title="2.2 安装"></a>2.2 安装</h3><ol>
<li><p>找到与Hadoop对应的版本 2.4.x</p>
<p><a href="https://hbase.apache.org/book.html#hadoop">https://hbase.apache.org/book.html#hadoop</a></p>
</li>
<li><p>找到镜像，解压</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">wget https://mirrors.cloud.tencent.com/apache/hbase/2.4.11/hbase-2.4.11-bin.tar.gz</span><br></pre></td></tr></table></figure></li>
<li><p>vim hbase-env.sh</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> JAVA_HOME=/root/config/jdk1.8.0_201</span><br><span class="line"><span class="built_in">export</span> HBASE_MANAGES_ZK=<span class="literal">true</span> <span class="comment">#是否使用HBase自带的zookeeper环境</span></span><br><span class="line"><span class="built_in">export</span> HBASE_CLASSPATH=/root/config/hbase-2.4.11/conf   <span class="comment"># hbase 配置文件所在路径</span></span><br></pre></td></tr></table></figure></li>
<li><p>vim hbase-site.xm</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- HBase数据在HDFS中的存放的路径 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.rootdir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hdfs://localhost:9000/hb<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Hbase的运行模式。false是单机模式，true是分布式模式。若为false,Hbase和Zookeeper会</span></span><br><span class="line"><span class="comment">运行在同一个JVM里面 --&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.cluster.distributed<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>false<span class="tag">&lt;/<span class="name">value</span>&gt;</span><span class="comment">&lt;!--为false的话不会其他机器不能访问2181--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- ZooKeeper的地址 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.zookeeper.quorum<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>localhost<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--远程地址--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--        &lt;value&gt;node1.itcast.cn,node2.itcast.cn,node3.itcast.cn&lt;/value&gt;--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- ZooKeeper快照的存储位置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.zookeeper.property.dataDir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>/root/data/zookpeer/data<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- V2.1版本，在分布式情况下, 设置为false --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    &lt;property&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        &lt;name&gt;hbase.unsafe.stream.capability.enforce&lt;/name&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        &lt;value&gt;false&lt;/value&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    &lt;/property&gt;--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>vim /etc/profile</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> HBASE_HOME=/root/config/hbase-2.4.11</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$&#123;HBASE_HOME&#125;</span>/bin:<span class="variable">$&#123;HBASE_HOME&#125;</span>/sbin</span><br></pre></td></tr></table></figure></li>
<li><p>vim regionservers  </p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">localhost <span class="comment">#单机版</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="2-3-启动"><a href="#2-3-启动" class="headerlink" title="2.3 启动"></a>2.3 启动</h3><ol>
<li>./bin/start-hbase.sh</li>
<li>jps查看</li>
<li>./bin/hbase shell</li>
<li>list</li>
</ol>
<h3 id="2-4-对于自己安装的zk"><a href="#2-4-对于自己安装的zk" class="headerlink" title="2.4 对于自己安装的zk"></a>2.4 对于自己安装的zk</h3><ol>
<li><p>拷贝配置</p>
<p>cp /zk/conf/zoo.cfg  hbase/conf</p>
</li>
<li><p>vim hbase-site.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.cluster.distributed<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span><span class="comment">&lt;!--为false的话不会其他机器不能访问2181--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- ZooKeeper的地址 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.zookeeper.quorum<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>主机名:2181<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--远程地址--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--        &lt;value&gt;node1.itcast.cn,node2.itcast.cn,node3.itcast.cn&lt;/value&gt;--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>vim hbase-env.sh</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> HBASE_MANAGES_ZK=<span class="literal">false</span></span><br></pre></td></tr></table></figure></li>
<li><p>zk清空hbase</p>
</li>
<li></li>
</ol>
<h2 id="三、Phoenix"><a href="#三、Phoenix" class="headerlink" title="三、Phoenix"></a>三、Phoenix</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">wget https://repo.huaweicloud.com/apache/phoenix/phoenix-5.1.2/phoenix-hbase-2.4-5.1.2-bin.tar.gz</span><br></pre></td></tr></table></figure>

<p>p = /root/config/phoenix-hbase-2.4-5.1.2-bin</p>
<ol>
<li><p>复制</p>
<p>cp p/phoenix-*.jar hbase-2.1.0/lib/</p>
</li>
<li><p>vim hbase-site.xml</p>
</li>
</ol>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"> 	<span class="tag">&lt;<span class="name">name</span>&gt;</span>phoenix.schema.isNamespaceMappingEnabled<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>false<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 支持索引预写日志编码 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.regionserver.wal.codec<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>org.apache.hadoop.hbase.regionserver.wal.IndexedWALEditCodec<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h4><p>./bin/sqlline.py localhost:2181</p>
<h2 id="四、zookeeper"><a href="#四、zookeeper" class="headerlink" title="四、zookeeper"></a>四、zookeeper</h2><h3 id="4-1-安装"><a href="#4-1-安装" class="headerlink" title="4.1 安装"></a>4.1 安装</h3><ol>
<li><p>下载  -bin.tar.gz</p>
<p>wget <a href="https://repo.huaweicloud.com/apache/zookeeper/zookeeper-3.5.7/apache-zookeeper-3.5.7-bin.tar.gz">https://repo.huaweicloud.com/apache/zookeeper/zookeeper-3.5.7/apache-zookeeper-3.5.7-bin.tar.gz</a></p>
</li>
<li><p>配置</p>
<ol>
<li><p>cd conf</p>
</li>
<li><p>cp zoo_salmle.csg  zoo.cfg</p>
</li>
<li><p>vim zoo.cfg</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">dataDir=/data/zookeeper  </span><br><span class="line">server.1=192.168.255.128:2887:3887 </span><br></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p>写入server.id</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> 1 /data/zookeeper/myid </span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="启动验证"><a href="#启动验证" class="headerlink" title="启动验证"></a>启动验证</h3><p>zkServer.sh start</p>
<p>zkCli.sh -server meip:2181</p>
<p>[参考]</p>
<ol>
<li><a href="https://m.php.cn/article/486140.html">hadoop</a> </li>
</ol>
]]></content>
  </entry>
  <entry>
    <title>mysql知识</title>
    <url>/2021/11/08/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql%E7%9F%A5%E8%AF%86/</url>
    <content><![CDATA[<p>[toc]</p>
<h2 id="一、字符类型"><a href="#一、字符类型" class="headerlink" title="一、字符类型"></a>一、字符类型</h2><h4 id="1-1-utf8mb4-utf8-区别"><a href="#1-1-utf8mb4-utf8-区别" class="headerlink" title="1.1 utf8mb4 utf8 区别"></a>1.1 utf8mb4 utf8 区别</h4><blockquote>
<p>unicode是打算用两个字节保留所有字体，但由于设计问题没有推广出来。utf8是对unicode的改进，中文的utf8占3个字节，部分占4个字节 </p>
</blockquote>
<ul>
<li>MySQL在5.5.3之后增加了这个utf8mb4的编码，mb4就是most bytes 4的意思，专门用来兼容四字节的unicode。</li>
<li>好在utf8mb4是utf8的超集，除了将编码改为utf8mb4外不需要做其他转换。当然，为了节省空间，一般情况下使用utf8也就够了。</li>
</ul>
<h3 id="1-2-GBK和GB2312"><a href="#1-2-GBK和GB2312" class="headerlink" title="1.2 GBK和GB2312"></a>1.2 GBK和GB2312</h3><blockquote>
<p>是中国人编写的对ASCLL的中文扩展，GBK包括了GB2312 的所有内容，是升级版。</p>
</blockquote>
<p>​    最初的 UTF-8 格式使用一至六个字节，最大能编码 31 位字符。最新的 UTF-8 规范只使用一到四个字节，最大能编码21位，正好能够表示所有的 17个 Unicode 平面。utf8 是 Mysql 中的一种字符集，只支持最长三个字节的 UTF-8字符，也就是 Unicode 中的基本多文本平面。Mysql 中的 utf8 为什么只支持持最长三个字节的 UTF-8字符呢？可能是因为 Mysql 刚开始开发那会，Unicode 还没有辅助平面这一说呢。</p>
<p>​    那时候，Unicode 委员会还做着 “65535 个字符足够全世界用了”的美梦。Mysql 中的字符串长度算的是字符数而非字节数，对于 CHAR 数据类型来说，需要为字符串保留足够的长。当使用 utf8 字符集时，需要保留的长度就是 utf8 最长字符长度乘以字符串长度，所以这里理所当然的限制了 utf8 最大长度为 3，比如 CHAR(100) Mysql 会保留 300字节长度。</p>
<p>​    至于后续的版本为什么不对 4 字节长度的 UTF-8 字符提供支持，我想一个是为了向后兼容性的考虑，还有就是基本多文种平面之外的字符确实很少用到。要在 Mysql 中保存 4 字节长度的 UTF-8 字符，需要使用 utf8mb4 字符集，但只有 5.5.3 版本以后的才支持（查看版本： select version();）。</p>
<p>​    为了获取更好的兼容性，应该总是使用 utf8mb4 而非 utf8. 对于 CHAR 类型数据，utf8mb4 会多消耗一些空间，根据 Mysql 官方建议，使用 VARCHAR 替代 CHAR。</p>
<span id="more"></span>

<h2 id="二、数据类型"><a href="#二、数据类型" class="headerlink" title="二、数据类型"></a>二、数据类型</h2><h3 id="2-1-字符"><a href="#2-1-字符" class="headerlink" title="2.1 字符"></a>2.1 字符</h3><table>
<thead>
<tr>
<th>类型</th>
<th>名称</th>
<th>范围</th>
</tr>
</thead>
<tbody><tr>
<td>char</td>
<td>定长字符串</td>
<td>255</td>
</tr>
<tr>
<td>varchar</td>
<td>变长字符串</td>
<td>65535</td>
</tr>
</tbody></table>
<h3 id="2-2-文本text"><a href="#2-2-文本text" class="headerlink" title="2.2 文本text"></a>2.2 文本text</h3><table>
<thead>
<tr>
<th>类型</th>
<th>名称</th>
<th>范围</th>
</tr>
</thead>
<tbody><tr>
<td>tinytext</td>
<td></td>
<td>255</td>
</tr>
<tr>
<td>text</td>
<td></td>
<td>65535（2^16 64K）</td>
</tr>
<tr>
<td>mediumtext</td>
<td></td>
<td>16777215（2^24 16M）</td>
</tr>
<tr>
<td>longtext</td>
<td></td>
<td>4294967295（2^32 4G）</td>
</tr>
</tbody></table>
<h3 id="2-3-二进制大对象-blob"><a href="#2-3-二进制大对象-blob" class="headerlink" title="2.3 二进制大对象 blob"></a>2.3 二进制大对象 blob</h3><table>
<thead>
<tr>
<th>类型</th>
<th>名称</th>
<th>范围</th>
</tr>
</thead>
<tbody><tr>
<td>tinyblob</td>
<td></td>
<td>255</td>
</tr>
<tr>
<td>blob</td>
<td></td>
<td>65535</td>
</tr>
<tr>
<td>mediumblob</td>
<td></td>
<td>16777215</td>
</tr>
<tr>
<td>longblob</td>
<td></td>
<td>4294967295</td>
</tr>
</tbody></table>
<h3 id="2-4-数值"><a href="#2-4-数值" class="headerlink" title="2.4 数值"></a>2.4 数值</h3><table>
<thead>
<tr>
<th>类型</th>
<th>名称</th>
<th>范围</th>
</tr>
</thead>
<tbody><tr>
<td>TINYINT</td>
<td>最小整数</td>
<td></td>
</tr>
<tr>
<td>SMALLINT</td>
<td>小整数</td>
<td></td>
</tr>
<tr>
<td>MEDIUMINT</td>
<td>中整数</td>
<td></td>
</tr>
<tr>
<td>INT</td>
<td>整数</td>
<td></td>
</tr>
<tr>
<td>BIGINT</td>
<td>大整数</td>
<td></td>
</tr>
<tr>
<td>DECIMAL(P,D)</td>
<td><a href="https://www.cnblogs.com/owenma/p/7097602.html">精确小数</a></td>
<td>1&lt;P&lt;65，0&lt;D&lt;30</td>
</tr>
<tr>
<td>FLOAT</td>
<td>单精度浮点</td>
<td></td>
</tr>
<tr>
<td>DOUBAL</td>
<td>双精度浮点</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h3 id="2-5-时间"><a href="#2-5-时间" class="headerlink" title="2.5 时间"></a>2.5 时间</h3><table>
<thead>
<tr>
<th>类型</th>
<th>名称</th>
<th>范围</th>
</tr>
</thead>
<tbody><tr>
<td>Date</td>
<td>日期</td>
<td>1000-01-01到9999-12-31</td>
</tr>
<tr>
<td>Time</td>
<td>时间</td>
<td>-838:59:59到838:59:59</td>
</tr>
<tr>
<td>DATETIME</td>
<td>日期时间</td>
<td>1000-01-01 00:00:00到9999-12-31 23:59:59</td>
</tr>
<tr>
<td>TIMESTAMP</td>
<td>时间戳</td>
<td>1970-01-01 00:00:00到2037年</td>
</tr>
<tr>
<td>YEAR</td>
<td>年</td>
<td>4位格式：1901到2155，2位格式：1970-2069(70-69)，或：0000</td>
</tr>
</tbody></table>
<h4 id="TIMESTAM和datetime-区别"><a href="#TIMESTAM和datetime-区别" class="headerlink" title="TIMESTAM和datetime 区别"></a>TIMESTAM和datetime 区别</h4><ol>
<li>存储方式<ul>
<li>TIMESTAMP，它把客户端插入的时间从当前时区转化为UTC（世界标准时间）进行存储。查询时，将其又转化为客户端当前时区进行返回。</li>
<li>DATETIME，不做任何改变，基本上是原样输入和输出。</li>
</ul>
</li>
<li>占字节数<ol>
<li>datetime占用8个字节</li>
<li>timestamp占用4个字节</li>
</ol>
</li>
<li>默认值<ol>
<li>datetime null</li>
<li>timestamp 当前时间</li>
</ol>
</li>
<li>两者所能存储的时间范围不一样 </li>
<li>对于跨时区的业务，TIMESTAMP更为合适，</li>
</ol>
<h3 id="2-6-数据类型大小"><a href="#2-6-数据类型大小" class="headerlink" title="2.6 数据类型大小"></a>2.6 数据类型大小</h3><ol>
<li>varchar(50) 表示最多50个字符，包括汉字</li>
<li>varchar变长，char 定长，定长时间效率高，空间效率差</li>
<li>int(n)中不论n指定为多少，范围都一样-2<del>31</del>2^31-1，都能插入9位数字。n只是用来控制显示而已，如果为int(4)，插入一个1，显示时也会用空格补齐到4个字节  </li>
<li>text 64KB longtext 4G</li>
<li>1k能写大概</li>
</ol>
<h2 id="三、关键字"><a href="#三、关键字" class="headerlink" title="三、关键字"></a>三、关键字</h2><h3 id="3-1-in和exists"><a href="#3-1-in和exists" class="headerlink" title="3.1 in和exists"></a>3.1 in和exists</h3><ol>
<li><p><a href="https://blog.csdn.net/codesweetpotato/article/details/109700424">in流程</a></p>
<p>对于 in 查询来说，会先执行子查询，如上边的 t2 表，然后把查询得到的结果和外表 t1 做<a href="https://so.csdn.net/so/search?from=pc_blog_highlight&q=%E7%AC%9B%E5%8D%A1%E5%B0%94%E7%A7%AF">笛卡尔积</a>，再通过条件进行筛选（这里的条件就是指 name 是否相等），把每个符合条件的数据都加入到结果集中。</p>
</li>
<li><p>exists执行流程</p>
<p>对于 exists 来说，是先查询遍历外表 t1 ，然后每次遍历时，再检查在内表是否符合匹配条件，即检查是否存在 name 相等的数据。</p>
</li>
</ol>
<h3 id="3-2-join三种"><a href="#3-2-join三种" class="headerlink" title="3.2 join三种"></a>3.2 join三种</h3><ol>
<li><p>简单join 即inner join</p>
<p>复杂度也是最高的，O(mn)</p>
<p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20220408150634927.png" alt="image-20220408150634927"></p>
</li>
</ol>
<h3 id="3-2-value和values区别"><a href="#3-2-value和values区别" class="headerlink" title="3.2 value和values区别"></a>3.2 value和values区别</h3><ol>
<li>value插入多行快,values单行快</li>
</ol>
<h3 id="3-3-drop-delete-truncate-区别"><a href="#3-3-drop-delete-truncate-区别" class="headerlink" title="3.3 drop delete truncate 区别"></a>3.3 drop delete truncate 区别</h3><ul>
<li>delete语句执行删除的过程是每次从表中删除一行，并且同时将该行的删除操作作为事务记录在日志中保存以便进行进行回滚操作</li>
<li>truncate table 则一次性地从表中删除所有的数据并不把单独的删除操作记录记入日志保存，删除行是不能恢复的,不会激活触发器，速度快</li>
<li> drop删除整个表（结构和数据）不能回滚，不会触发触发器</li>
</ul>
<h2 id="四、其他"><a href="#四、其他" class="headerlink" title="四、其他"></a>四、其他</h2><h3 id="4-1-null值"><a href="#4-1-null值" class="headerlink" title="4.1 null值"></a>4.1 null值</h3><ol>
<li><p>null和空值的区别：</p>
<ol>
<li>null占空间，空值不占空间</li>
<li>&lt;&gt;’’会同时过滤空值和null值</li>
<li>定义为NOT NULL的字段只能插入空值，不能插入null值</li>
<li>对于timestamp数据类型，如果往这个数据类型插入的列插入NULL值，则出现的值是当前系统时间。插入空值，则会出现 ‘0000-00-00 00:00:00’ </li>
</ol>
</li>
<li><p>注意插入的null是 不带引号的</p>
</li>
<li><p>&lt;=&gt; 比较操作符（不同于 = 运算符），当比较的的两个值相等或者都为 NULL 时返回 true。</p>
</li>
<li><p>count()统计某列的记录数的时候，不会记录NULL值</p>
</li>
<li><p>order by()  null值最小</p>
</li>
<li><p>group by() null为一组</p>
</li>
<li><p>索引不会包含有NULL值的列</p>
<blockquote>
<p>只要列中包含有NULL值都将不会被包含在索引中，复合索引中只要有一列含有NULL值，那么这一列对于此复合索引将失效。所以在数据库设计时尽量不让字段的默认值为NULL</p>
</blockquote>
</li>
</ol>
<h3 id="4-2-change和modify"><a href="#4-2-change和modify" class="headerlink" title="4.2 change和modify"></a>4.2 change和modify</h3><ol>
<li><p>modify改类型和约束   alter table  name  modify old_name 类型 </p>
</li>
<li><p>change修改类型   alter table name change old_name  new_name  类型</p>
<ol>
<li><p>modify和change的区别: modify是原地换，change是去掉以前的新建一个所以</p>
<ol>
<li>change修改需要指定两次表名</li>
<li>只有change可以修改表名 </li>
</ol>
</li>
<li><p>注意 修改类型原来的类型会被去除 (除了primary key)</p>
</li>
</ol>
</li>
</ol>
<h2 id="五、数据恢复"><a href="#五、数据恢复" class="headerlink" title="五、数据恢复"></a>五、数据恢复</h2><h3 id="binlog2sql"><a href="#binlog2sql" class="headerlink" title="binlog2sql"></a>binlog2sql</h3>]]></content>
      <categories>
        <category>数据库</category>
      </categories>
  </entry>
  <entry>
    <title>mysql系统表</title>
    <url>/2022/02/09/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql%E7%B3%BB%E7%BB%9F%E8%A1%A8/</url>
    <content><![CDATA[<p>·</p>
<h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><table>
<thead>
<tr>
<th>库名</th>
<th>表数量</th>
<th>视图数量</th>
</tr>
</thead>
<tbody><tr>
<td>information_schema</td>
<td>61</td>
<td>0</td>
</tr>
<tr>
<td>mysql</td>
<td>32</td>
<td>0</td>
</tr>
<tr>
<td>performance_schema</td>
<td>87</td>
<td>0</td>
</tr>
<tr>
<td>sys</td>
<td>1</td>
<td>100</td>
</tr>
</tbody></table>
<h2 id="一、infomation-schema"><a href="#一、infomation-schema" class="headerlink" title="一、infomation_schema"></a>一、infomation_schema</h2><blockquote>
<p>信息数据库，保存着关于MySQL其他数据库的信息。如数据库名，数据库的表，表栏的数据类型与访问权限等</p>
</blockquote>
<table>
<thead>
<tr>
<th>表名</th>
<th>作用</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>数据库-表-字段-索引你</td>
<td></td>
<td></td>
</tr>
<tr>
<td>SCHEMATA</td>
<td>数据库信息(名称，字符类型)</td>
<td>show database</td>
</tr>
<tr>
<td>TABLES</td>
<td>表信息(属于哪个数据库，自增id，创建时间，行数，数据大小，字符，引擎)</td>
<td>show tables</td>
</tr>
<tr>
<td>columns</td>
<td>行信息</td>
<td>desc</td>
</tr>
<tr>
<td>user_privileges</td>
<td>用户权限</td>
<td></td>
</tr>
<tr>
<td>key_columns_usage</td>
<td>表的索引信息</td>
<td>show key</td>
</tr>
<tr>
<td><strong>锁信息</strong></td>
<td></td>
<td></td>
</tr>
<tr>
<td>innodb_trx</td>
<td></td>
<td></td>
</tr>
<tr>
<td>innodb_locks</td>
<td></td>
<td></td>
</tr>
<tr>
<td>innodb_lock_wait</td>
<td></td>
<td></td>
</tr>
<tr>
<td><strong>其他</strong></td>
<td></td>
<td></td>
</tr>
<tr>
<td>files</td>
<td>mysql用到的文件</td>
<td></td>
</tr>
</tbody></table>
<h2 id="二、mysql"><a href="#二、mysql" class="headerlink" title="二、mysql"></a>二、mysql</h2><blockquote>
<p>主要是权限的信息</p>
</blockquote>
<table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>user</td>
<td>用户列、权限列、安全列、资源控制列</td>
<td></td>
</tr>
<tr>
<td>innodb_table_stas</td>
<td>表信息， 更新时间，行数</td>
<td></td>
</tr>
</tbody></table>
<h2 id="三、performance-scheme"><a href="#三、performance-scheme" class="headerlink" title="三、performance_scheme"></a>三、performance_scheme</h2><blockquote>
<p>PERFORMANCE_SCHEMA这个功能默认是关闭的。需要设置参数： performance_schema 才可以启动该功能，这个参数是静态参数，只能写在my.cnf 中 不能动态修改。</p>
</blockquote>
<table>
<thead>
<tr>
<th>表名</th>
<th>作用</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>users</td>
<td>用户连接的次数，当前连接数</td>
<td></td>
</tr>
<tr>
<td>hosts</td>
<td>类似于users表</td>
<td></td>
</tr>
<tr>
<td>accounts</td>
<td>是users+hosts</td>
<td></td>
</tr>
<tr>
<td>threads</td>
<td>当前存活线程(ip,username,状态)</td>
<td></td>
</tr>
<tr>
<td>gloable_variables</td>
<td>全局变量</td>
<td></td>
</tr>
</tbody></table>
<h2 id="四、sys"><a href="#四、sys" class="headerlink" title="四、sys"></a>四、sys</h2><p>配置更改表</p>
<ul>
<li>variable ： 配置选项名称</li>
<li>value ： 配置选项值</li>
<li>set_time ： 该行配置修改的时间</li>
<li>set_by ： 该行配置信息修改者，如果从被安装没有修改过，那么这个数据应该为NULL</li>
</ul>
]]></content>
  </entry>
  <entry>
    <title>mysql索引</title>
    <url>/2022/02/13/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql%E7%B4%A2%E5%BC%95/</url>
    <content><![CDATA[<p>​    </p>
<h2 id="一、索引原理"><a href="#一、索引原理" class="headerlink" title="一、索引原理"></a>一、索引原理</h2><blockquote>
<p>索引原理：</p>
<p>索引是一种利用某种规则的数据结构与实际数据的关系加快数据查找的功能；索引数据节点中有着实际文件的位置，因为索引是根据特定的规则和算法构建的,在查找的时候遵循索引的规则可以快速查找到对应数据的节点，从而达到快速查找数据的效果；其实宏观来说索引其实是一种概念而不是具体的某项技术，只是我们在某个技术中运用得比较广泛和鲜明（比如说数据库）渐渐的有了特定领域的标签，其实在生活中索引的使用无处不在，比如说：书本里的目录；读书时的座位号，考试编号都有类似索引的功能;</p>
<p>总结来所有通过某规则数据结构和实际目标关联，根据特定规则算法快速寻址的功能都可以称之为索引；</p>
</blockquote>
<h3 id="术语"><a href="#术语" class="headerlink" title="术语"></a>术语</h3><h4 id="索引覆盖"><a href="#索引覆盖" class="headerlink" title="索引覆盖"></a>索引覆盖</h4><blockquote>
<p>正好命中索引，不需要回表</p>
<p>select id,name from user  索引覆盖的前提是name有索引，因为name的索引表中存储的是（name,id），一个表就存储了name和id</p>
</blockquote>
<h4 id="索引下推"><a href="#索引下推" class="headerlink" title="索引下推"></a>索引下推</h4><figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="section">联合索引的情况:</span></span><br><span class="line">	对索引中包含的字段先做判断，过滤掉不符合条件的记录，减少回表字数。</span><br></pre></td></tr></table></figure>

<p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20220404235036297.png" alt="image-20220404235036297"></p>
<p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20220404235043708.png" alt="image-20220404235043708"></p>
<h2 id="二、索引结构"><a href="#二、索引结构" class="headerlink" title="二、索引结构"></a>二、索引结构</h2><h3 id="1-1-为什么是b-树"><a href="#1-1-为什么是b-树" class="headerlink" title="1.1 为什么是b+树"></a>1.1 为什么是b+树</h3><ol>
<li>索引的表象是一个目录</li>
<li>底层原理   [字段值,地址] 某种数据结构的映射</li>
</ol>
<h3 id="1-2-排序的结构"><a href="#1-2-排序的结构" class="headerlink" title="1.2 排序的结构"></a>1.2 排序的结构</h3><ol>
<li>二叉树   —&gt; 递增有序的情况    <strong>树高度==n</strong></li>
<li>AVL 平衡二叉树   旋转次数多</li>
<li>红黑树 弱平衡二叉树         弊端: 高度高</li>
<li>B树   m叉树+平衡查找树     扩大横分叉，高度可控</li>
<li>B+树  每个节点从左到右一次递增<ol>
<li>非叶子节点不存数据，只存冗余索引</li>
<li>叶子节点从大到小相互连接</li>
<li>每个页16KB<ol>
<li>如果满了  节点分裂  高度增加</li>
</ol>
</li>
</ol>
</li>
</ol>
<h4 id="B-树相对于B树优点"><a href="#B-树相对于B树优点" class="headerlink" title="B+树相对于B树优点"></a>B+树相对于B树优点</h4><ol>
<li>非叶子节点都存有冗余，这样的目的是为了让叶子节点存有所有的数据</li>
<li>非叶子节点<strong>不带有指向记录</strong>的指针，则一个块可以存储更多的索引项，如此可以降低树的高度。</li>
<li>叶子节点之间有指针连接，则在范围扫描时避免了在内部节点来回移动。</li>
</ol>
<h4 id="B-树搜索过程"><a href="#B-树搜索过程" class="headerlink" title="B+树搜索过程"></a>B+树搜索过程</h4><ol>
<li>根据冗余索引找到data叶子节点</li>
<li>把data加载到内存 然后二分查找</li>
</ol>
<h4 id="特别的"><a href="#特别的" class="headerlink" title="特别的"></a>特别的</h4><ol>
<li>如果只有一层  那么就相当于二分查找 ，但是，但是这意味着把所有的数据加载到内存，内存吃不消。 </li>
<li>hash表<ol>
<li>数组+链表</li>
<li>hash运算—&gt;存到链表(hash冲突直接加在链表尾部)</li>
<li><strong>不支持范围查找</strong></li>
<li>不支持模糊查询</li>
<li>大量重复数据，会严重影响查询性能</li>
</ol>
</li>
<li>mysql的memory支持hash索引，一般hash索引用于名字，而不用于数字</li>
<li>innodb不支持hash索引，</li>
</ol>
<h2 id="三、索引分类"><a href="#三、索引分类" class="headerlink" title="三、索引分类"></a>三、索引分类</h2><blockquote>
<p>索引分类 innodb才有   mylsam没有分类</p>
<blockquote>
<p>主键是不能为null的唯一索引</p>
<p>唯一索引null可以出现多次,</p>
<p>普通索引的所有值都能出现多次</p>
</blockquote>
</blockquote>
<h3 id="3-1-聚集索引："><a href="#3-1-聚集索引：" class="headerlink" title="3.1 聚集索引："></a>3.1 聚集索引：</h3><blockquote>
<p> InnoDB必须要有，且只有一个聚集索引</p>
<ol>
<li>如果表定义了PK，则PK就是聚集索引；</li>
<li>如果表没有定义PK，则第一个not NULL unique列是聚集索引；</li>
<li>否则，InnoDB会创建一个隐藏的row-id作为聚集索引；</li>
</ol>
</blockquote>
<blockquote>
<p>存(id,data)    </p>
<p>数据按照索引的顺序来存储的，索引的顺序与表中记录的物理顺序一致。对于聚集索引，叶子结点即存储了真实的数据行，不再有另外单独的数据页。 在一张表上最多只能创建一个聚集索引，因为真实数据的物理顺序只能有一种</p>
</blockquote>
<ol>
<li><p>索引和数据一起存储 ，找到了索引就是找到了数据</p>
</li>
<li><p>一个文件 idb</p>
</li>
<li><p><strong>优势</strong>：</p>
<ol>
<li>直接拿到数据，不需要二次查询。</li>
<li>范围查询好</li>
<li>是否排序的场合</li>
</ol>
</li>
<li><p>劣势</p>
<ol>
<li><p>维护差，需要大量操作</p>
</li>
<li><p>使用uuid做主键，插入就会变得随机性，</p>
</li>
<li><p>id很大的化，辅助索引也会占用很大的空间</p>
<blockquote>
<p>辅助索引就是存(age,id)</p>
</blockquote>
</li>
</ol>
</li>
</ol>
<h3 id="3-2-非聚集-稀疏，二级索引-索引："><a href="#3-2-非聚集-稀疏，二级索引-索引：" class="headerlink" title="3.2 非聚集(稀疏，二级索引)索引："></a>3.2 非聚集(稀疏，二级索引)索引：</h3><blockquote>
<p>存储(key,主键)</p>
</blockquote>
<ol>
<li><p>查完得到主键</p>
</li>
<li><p>再回表去主键索引查询位置</p>
</li>
</ol>
<p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20220320213638194.png" alt="image-20220320213638194"></p>
<p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20220320213755722.png" alt="image-20220320213755722"></p>
<h3 id="3-3-联合索引"><a href="#3-3-联合索引" class="headerlink" title="3.3 联合索引"></a>3.3 联合索引</h3><ol>
<li><p>底层</p>
</li>
<li><p>最左前缀原则(a,b,c)</p>
<ol>
<li><p>为什么最左前缀</p>
<p>在相同的a下才会排序b</p>
<p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20211014212733501.png" alt="image-20211014212733501"></p>
</li>
<li></li>
</ol>
</li>
</ol>
<h3 id="3-4-全文索引"><a href="#3-4-全文索引" class="headerlink" title="3.4 全文索引"></a>3.4 全文索引</h3><blockquote>
<p>5.6之后开始支持全文索引，</p>
</blockquote>
<p>基于分词器，</p>
<h2 id="三、索引选择"><a href="#三、索引选择" class="headerlink" title="三、索引选择"></a>三、索引选择</h2><h3 id="3-1-B-树索引"><a href="#3-1-B-树索引" class="headerlink" title="3.1 B+树索引"></a>3.1 B+树索引</h3><h4 id="优势"><a href="#优势" class="headerlink" title="优势"></a>优势</h4><ol>
<li>完全匹配</li>
<li>范围匹配</li>
<li>前缀匹配（左模糊）</li>
</ol>
<h4 id="限制"><a href="#限制" class="headerlink" title="限制"></a>限制</h4><ol>
<li>对于index(a,b,c)，有最左原则，也就是只有选了a才能用索引</li>
</ol>
<h3 id="3-2-hash索引"><a href="#3-2-hash索引" class="headerlink" title="3.2 hash索引"></a>3.2 hash索引</h3><h4 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h4><ol>
<li>简单</li>
<li>快</li>
</ol>
<h4 id="限制-1"><a href="#限制-1" class="headerlink" title="限制"></a>限制</h4><ol>
<li>不能范围</li>
<li>不能排序</li>
<li>不能模糊查询</li>
<li>考虑hash冲突</li>
</ol>
<h2 id="四、索引创建原则"><a href="#四、索引创建原则" class="headerlink" title="四、索引创建原则"></a>四、索引创建原则</h2><h3 id="需要建立索引"><a href="#需要建立索引" class="headerlink" title="需要建立索引"></a>需要建立索引</h3><ol>
<li>该字段经常select+where, update+where delete where</li>
<li>需要分组、排序的字段</li>
<li>唯一的字段</li>
</ol>
<h3 id="不需要建立索引"><a href="#不需要建立索引" class="headerlink" title="不需要建立索引"></a>不需要建立索引</h3><ol>
<li><p>数据量小不建立</p>
</li>
<li><p>经常update,delete,insert</p>
</li>
<li><p>不经常where</p>
</li>
<li><p>数据重复严重 </p>
<blockquote>
<p>索引的目的是为了加速，比如把sex建立索引，加速太小，反而还需要维护索引，不如全表扫描</p>
</blockquote>
</li>
<li><p>字段长度太大</p>
</li>
</ol>
<h2 id="五、索引失效"><a href="#五、索引失效" class="headerlink" title="五、索引失效"></a>五、索引失效</h2><blockquote>
<p>模：代表模糊查询。</p>
<p>型：代表数据类型。  str要用引号引起来</p>
<p>数：代表函数。</p>
<p>空：是Null的意思。</p>
<p>​    单列索引不存储null值，复合索引不存储全为null的值。</p>
<p>​    Null值的特殊性就在于参与的运算大多取值为null。这样的话，null值实际上是不能参与进建索引的过程</p>
<p>运：代表运算。</p>
<p>最：代表最左原则。</p>
<p>快：全表扫描更快的意思</p>
<p>or ：A or B 都有单独索引才不会失效</p>
<p>不等于 </p>
</blockquote>
<h2 id="六、索引调优"><a href="#六、索引调优" class="headerlink" title="六、索引调优"></a>六、索引调优</h2><h3 id="6-1-长字段索引"><a href="#6-1-长字段索引" class="headerlink" title="6.1 长字段索引"></a>6.1 长字段索引</h3><p>字符串长度太大不适合索引</p>
]]></content>
  </entry>
  <entry>
    <title>mysql调优1</title>
    <url>/2022/02/07/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql%E8%B0%83%E4%BC%981/</url>
    <content><![CDATA[<p>[toc]</p>
<h3 id="四大方面"><a href="#四大方面" class="headerlink" title="四大方面"></a>四大方面</h3><ol>
<li><p>设计：存储引擎，字段类型，视图，范式与逆范式。</p>
</li>
<li><p>功能：索引，缓存，分区分表。</p>
</li>
<li><p>架构：主从复制，读写分离，负载均衡。</p>
</li>
<li><p>SQL语句：测试，经验。</p>
<span id="more"></span></li>
</ol>
<h3 id="设计"><a href="#设计" class="headerlink" title="设计"></a>设计</h3><ol>
<li>存储引擎<ol>
<li>innodb 形容的是表  <ol>
<li>支持ACID</li>
<li></li>
</ol>
</li>
<li>myisam<ol>
<li>miy文件  索引</li>
</ol>
</li>
</ol>
</li>
<li>variables<br><a href="https://www.cnblogs.com/goldenstones/p/6362434.html">参考</a><ol>
<li>key_buffer_size</li>
<li>max_connections</li>
<li>key_blocks_u</li>
<li>created_tmp</li>
</ol>
</li>
</ol>
<h3 id="索引优化"><a href="#索引优化" class="headerlink" title="索引优化"></a>索引优化</h3><ol>
<li><p>explain</p>
</li>
<li><p>文件</p>
<ol>
<li>frm是描抄述了表的结构</li>
<li>MYD保存了表的数据记录</li>
<li>MYI则是表的索引</li>
<li>opt记录数据库的选项</li>
<li>数据库的字符集设置</li>
</ol>
</li>
<li><p>uuid当主键的问题</p>
<ol>
<li>UUID 太长了、占用空间大，<strong>作为主键性能太差</strong>了</li>
<li>UUID 不具有有序性，会导致 B+ 树索引在写的时候有过多的随机写操作</li>
<li>innodb推荐用整形递增  减少B+树索引分裂的次数</li>
</ol>
</li>
<li><p>如果没有设置主键</p>
<ol>
<li>有唯一字段：用这个唯一字段建造B+树</li>
<li>没有唯一 字段：创建隐藏列 这样效率很低</li>
</ol>
</li>
<li><p>索引的建立提高了select效率 降低了update,insert效率</p>
</li>
<li><p>索引的建立</p>
<ol>
<li><p>原则1：需要将选择度高的列放在前面。所谓选择度，即COUNT(DISTINCT(列名))/COUNT(列名)。</p>
<p>比如性别 1  0  就不能建立索引</p>
</li>
<li><p>原则2：较频繁查询的字段创建索引  较频繁更改的字段不建立索引</p>
</li>
<li><p>原则3：不出现在where的字段不建立索引 </p>
</li>
<li><p>必须有主键</p>
</li>
<li><p>原则4：数据量小的不要索引</p>
</li>
<li><p>原则5：字段值长的不建议索引</p>
</li>
</ol>
</li>
<li><h4 id="索引失效"><a href="#索引失效" class="headerlink" title="索引失效"></a>索引失效</h4><ol>
<li><p>前缀原则1  abc%会用索引</p>
</li>
<li><p>前缀原则2  联合索引(a,b,c)会a  ab  abc的方式使用索引</p>
</li>
</ol>
</li>
</ol>
<h3 id="查询优化"><a href="#查询优化" class="headerlink" title="查询优化"></a>查询优化</h3><ol>
<li>in和exist的区别<ol>
<li>exist适合 子查询中表数据大于外查询表中数据的业务场景</li>
<li>in:适合外部表数据大于子查询的表数据的业务场景</li>
</ol>
</li>
<li></li>
</ol>
<h3 id="缓存优化"><a href="#缓存优化" class="headerlink" title="缓存优化"></a>缓存优化</h3><h3 id="分区分表"><a href="#分区分表" class="headerlink" title="分区分表"></a>分区分表</h3><h3 id="图片"><a href="#图片" class="headerlink" title="图片"></a>图片</h3><ol>
<li><p>b+tree和btree的区别<img src="C:\Users\22453\AppData\Roaming\Typora\typora-user-images\image-20211015020343225.png" alt="image-20211015020343225"></p>
</li>
<li></li>
</ol>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ol>
<li><a href="https://www.cnblogs.com/sharpest/p/10390035.html">cnblog</a></li>
<li><a href="https://www.cnblogs.com/sharpest/p/10390035.html">优化10大技巧-cn</a></li>
<li><a href="https://blog.csdn.net/wukuaiyang/article/details/78755097?utm_term=b+%E6%A0%91%E5%92%8C%E4%BA%8C%E5%88%86%E6%9F%A5%E6%89%BE&utm_medium=distribute.pc_aggpage_search_result.none-task-blog-2~all~sobaiduweb~default-0-78755097&spm=3001.4430">索引-B+树-csdn</a></li>
</ol>
]]></content>
      <categories>
        <category>数据库</category>
      </categories>
  </entry>
  <entry>
    <title>mysql-log</title>
    <url>/2022/04/10/%E6%95%B0%E6%8D%AE%E5%BA%93/%E6%97%A5%E5%BF%97/</url>
    <content><![CDATA[<p><a href="https://www.cnblogs.com/cswiki/p/15816371.html">转载</a></p>
<h2 id="binlog-持久化"><a href="#binlog-持久化" class="headerlink" title="binlog 持久化"></a>binlog 持久化</h2><p>这里引入了一个新的概念：binlog cache</p>
<p>从名字就能看出来，binlog cache 其实就是一片内存区域，充当缓存的作用。</p>
<p>每个线程都有自己 binlog cache 区域，<strong>在事务运行的过程中，MySQL 会先把日志写到 binlog cache 中，等到事务真正提交的时候，再统一把 binlog cache 中的数据写到 binlog 文件中</strong>。（binlog cache 有很多个，binlog 文件只有一个！）</p>
<p>事实上，这个从 binlog cache 写到 binlog 文件中的操作，并<strong>不</strong>就是落盘操作了，这里仅仅是把 binlog 写到了文件系统的 page cache 上（这一步对应下图中的 <code>write</code> 操作）。</p>
<blockquote>
<p>简单解释下文件系统的 page cache：</p>
<p>CPU 如果要访问外部磁盘上的文件，需要首先将这些文件的内容拷贝到内存中，由于硬件的限制，从磁盘到内存的数据传输速度是很慢的，如果现在物理内存有空余，干嘛不用这些空闲内存来缓存一些磁盘的文件内容呢，<strong>这部分用作缓存磁盘文件的内存就叫做 page cache</strong>。</p>
<p>很多同学看到这里可能觉得特别特别熟悉，是的，和 CPU 里的高速缓存是不是很像？两者其实都是利用的局部性原理，只不过<strong>高速缓存是 CPU 缓存内存的数据，而 page cache 是内存缓存磁盘的数据</strong>，这也体现了操作系统内存层次结构分级的思想。</p>
</blockquote>
<p>所以，最后需要把 page cache 中的数据同步到磁盘上，才算真正完成了 binlog 的持久化（这一步对应下图中的 <code>fsync</code> 操作）。一般情况下，我们认为 <code>fsync</code> 才占磁盘的 IOPS (Input/Output Operations Per Second)</p>
<p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20220410143626228.png" alt="image-20220410143626228"></p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">write 和 fsync 的时机，是由参数 sync_binlog 控制的：</span><br><span class="line"></span><br><span class="line">sync_binlog = <span class="number">0</span>，每次提交事务的时候，只进行 write，不进行 fsync</span><br><span class="line">sync_binlog = <span class="number">1</span>候，每次提交事务的时候，执行 write 和 fsync</span><br><span class="line">sync_binlog = N(N&gt;<span class="number">1</span>)，每次提交事务的时候，执行 write，累积 N 个事务后再执行 fsync</span><br><span class="line">可以看出来，如果业务场景涉及到的 IO 操作很多的话，可以适当增大 sync_binlog 的值，提高性能。但是也存在一定的风险，比如你设置成 <span class="number">100</span>，万一在第 <span class="number">80</span> 个事务提交的时候数据库宕机了，那这些事务的 binlog 日志由于没有执行 fsync，也就丢失了。</span><br></pre></td></tr></table></figure>

<h2 id="redolog-持久化"><a href="#redolog-持久化" class="headerlink" title="redolog 持久化"></a>redolog 持久化</h2><p>类比 binlog，在事务执行过程中，binlog 都是存在 binlog cache 中，redolog 也有这样一块内存区域，叫作 <strong>redolog buffer</strong>。</p>
<p><strong>在事务运行的过程中，MySQL 会先把日志写到 redolog buffer 中，等到事务真正提交的时候，再统一把 redolog buffer 中的数据写到 redolog 文件中</strong>。和 binlog 的落盘操作一样，这个从 redolog buffer 写到 redolog 文件中的操作，并<strong>不</strong>就是落盘操作了，这里仅仅是把 redolog 写到了文件系统的 page cache 上，最后还需要执行 <code>fsync</code> 才能够实现真正的落盘。</p>
<p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20220410143800256.png" alt="image-20220410143800256"></p>
<p>解释下 redo log buffer？</p>
<p>在一个事务的更新过程中，日志是要写多次的。比如下面这个事务：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">begin</span>;</span><br><span class="line">	<span class="keyword">insert</span> <span class="keyword">into</span> table1 ...</span><br><span class="line">	<span class="keyword">insert</span> <span class="keyword">into</span> table2 ...</span><br><span class="line"><span class="keyword">commit</span>;</span><br></pre></td></tr></table></figure>

<p>这个事务要往两个表 table1 和 table2 中插入记录，为了确保这个事务不被拆开，一次性的完整写入日志文件中，在插入数据的过程中，我们需要把生成的日志都先保存起来。redolog buffer 就是这么一个用来先存 redo 日志的地方。</p>
<p>也就是说，在执行第一条 insert 语句的时候，redolog buffer 也就写入了这条记录的日志。</p>
<p>不同于 binlog cache 每个线程都有一个，<strong>redolog buffer 只有那么一个</strong>。</p>
<p>事实上，日志写到 redolog buffer 是很快的，wirte 到 page cache 也差不多，但是 fsync 持久化到磁盘的速度就慢多了，为了控制 redo log 的写入策略，InnoDB 提供了 <code>innodb_flush_log_at_trx_commit</code> 参数，它有三种可能取值：</p>
<ul>
<li><code>innodb_flush_log_at_trx_commit = 0</code>，每次事务提交的时候，都只是把 redolog 留在 redolog buffer 中</li>
<li><code>innodb_flush_log_at_trx_commit = 1</code>，每次事务提交的时候，都执行 fsync 将 redolog 直接持久化到磁盘</li>
<li><code>innodb_flush_log_at_trx_commit = 2</code>，每次事务提交的时候，都只执行 write 将 redolog 写到文件系统的 page cache 中</li>
</ul>
<p>说了这么多，各位小伙伴们对 binlog 和 redolog 的持久化机制想必都有所了解了，我们来看文题：<strong>事务还没提交的时候，redolog 能不能被持久化到磁盘呢</strong>？</p>
<p>先说答案，答案就是<strong>有可能</strong>。</p>
<p>分析下 redolog 可能存在的三种状态（binlog 也差不多）：</p>
<ul>
<li>事务执行过程中，存在 MySQL 的进程内存中的 redolog buffer 中</li>
<li>事务提交，执行 write 操作存在文件系统的 page cache 中，但是没有执行 fsync 操作持久化到磁盘</li>
<li>事务提交，执行 fsync 操作持久化到磁盘</li>
</ul>
<p>至于为什么说事务还没提交的时候，redolog 也有可能被持久化到磁盘呢？</p>
<p>InnoDB 有一个后台线程，每隔 1 秒轮询一次，具体的操作是这样的：</p>
<ol>
<li>调用 write 将 redolog buffer 中的日志写到文件系统的 page cache，</li>
<li>然后调用 fsync 持久化到磁盘。而在事务执行中间过程的 redolog 都是直接写在 redolog buffer 中的，也就是说，一个没有提交的事务的 redolog，也是有可能会被后台线程一起持久化到磁盘的。</li>
</ol>
<p>另外，除了后台线程每秒一次的轮询操作外，还有两种场景会让一个没有提交的事务的 redolog 写盘：</p>
<ol>
<li><p>innodb_flush_log_at_trx_commit 设置是 1，这样并行的某个事务提交的时候，就会顺带将这个事务的 redolog buffer 持久化到磁盘</p>
<p>举个例子，假设事务 A 执行到一半，已经写了一些 redolog 到 redolog buffer 中，这时候有另外一个事务 B 提交，按照 innodb_flush_log_at_trx_commit = 1 的逻辑，事务 B 要把 redolog buffer 里的日志全部持久化到磁盘，这时候，就会带上事务 A 在 redolog buffer 里的日志一起持久化到磁盘</p>
</li>
<li><p>redo log buffer 占用的空间达到 redolo buffer 大小（由参数 <code>innodb_log_buffer_size</code> 控制，默认是 8MB）一半的时候，后台线程会主动写盘。不过由于这个事务并没有提交，所以这个写盘动作只是 write 到了文件系统的 page cache，仍然是在内存中，并没有调用 fsync 真正落盘</p>
</li>
</ol>
<hr>
<p>最后放上这道题的背诵版：</p>
<blockquote>
<p>🥸 <strong>面试官</strong>：</p>
<ul>
<li>问题：事务还没提交的时候，redo log 能不能被持久化到磁盘呢？</li>
<li>相关问题：MySQL 是如何保证数据不丢失的呢？</li>
</ul>
<p>😎 <strong>小牛肉</strong>：事务还没有提交的时候，redo log 是有可能被持久化到磁盘的。</p>
<p>redolog 的具体落盘操作是这样的：在事务运行的过程中，MySQL 会先把日志写到 redolog buffer 中，等到事务真正提交的时候，再统一把 redolog buffer 中的数据写到 redolog 文件中。不过这个从 redolog buffer 写到 redolog 文件中的操作也就是 write 并不就是落盘操作了，这里仅仅是把 redolog 写到了文件系统的 page cache 上，最后还需要执行 fsync 才能够实现真正的落盘。</p>
<p>也就是说，redolog 其实存在三种状态：</p>
<ul>
<li>事务执行过程中，存在 MySQL 的进程内存中的 redolog buffer 中</li>
<li>事务提交，执行 write 操作存在文件系统的 page cache 中，但是没有执行 fsync 操作持久化到磁盘</li>
<li>事务提交，执行 fsync 操作持久化到磁盘</li>
</ul>
<p>额为什么说事务还没提交的时候，redolog 也有可能被持久化到磁盘呢？</p>
<p>主要有三种可能的原因：</p>
<ol>
<li>第一种情况：InnoDB 有一个后台线程，每隔 1 秒轮询一次，具体的操作是这样的：调用 write 将 redolog buffer 中的日志写到文件系统的 page cache，然后调用 fsync 持久化到磁盘。而在事务执行中间过程的 redolog 都是直接写在 redolog buffer 中的，也就是说，一个没有提交的事务的 redolog，也是有可能会被后台线程一起持久化到磁盘的。</li>
<li>第二种情况：innodb_flush_log_at_trx_commit 设置是 1，这个参数的意思就是，每次事务提交的时候，都执行 fsync 将 redolog 直接持久化到磁盘（还有 0 和 2 的选择，0 表示每次事务提交的时候，都只是把 redolog 留在 redolog buffer 中；2 表示每次事务提交的时候，都只执行 write 将 redolog 写到文件系统的 page cache 中）。举个例子，假设事务 A 执行到一半，已经写了一些 redolog 到 redolog buffer 中，这时候有另外一个事务 B 提交，按照 innodb_flush_log_at_trx_commit = 1 的逻辑，事务 B 要把 redolog buffer 里的日志全部持久化到磁盘，这时候，就会带上事务 A 在 redolog buffer 里的日志一起持久化到磁盘</li>
<li>第二种情况：redo log buffer 占用的空间达到 redolog buffer 大小（由参数 <code>innodb_log_buffer_size</code> 控制，默认是 8MB）一半的时候，后台线程会主动写盘。不过由于这个事务并没有提交，所以这个写盘动作只是 write 到了文件系统的 page cache，仍然是在内存中，并没有调用 fsync 真正落盘</li>
</ol>
</blockquote>
]]></content>
  </entry>
  <entry>
    <title>微服务</title>
    <url>/2022/05/14/%E6%9E%B6%E6%9E%84/%E5%BE%AE%E6%9C%8D%E5%8A%A1/</url>
    <content><![CDATA[<h2 id="一、微服务的概念"><a href="#一、微服务的概念" class="headerlink" title="一、微服务的概念"></a>一、微服务的概念</h2><h3 id="1-1-服务注册与发现"><a href="#1-1-服务注册与发现" class="headerlink" title="1.1 服务注册与发现"></a>1.1 服务注册与发现</h3><ul>
<li>服务注册：将自身服务信息注册到注册中心。{IP+Port，自身状态, 访问协议等信 }。</li>
<li>服务发现:  服务实例通过注册中心，获取到注册到其中的服务实例的信息。</li>
</ul>
<h3 id="1-2-负载均衡"><a href="#1-2-负载均衡" class="headerlink" title="1.2 负载均衡"></a>1.2 负载均衡</h3><h3 id="1-3-熔断"><a href="#1-3-熔断" class="headerlink" title="1.3 熔断"></a>1.3 熔断</h3><ol>
<li><p>概念</p>
<p>在互联网系统中，当下游服务因访问压力过大而响应变慢或失败，上游服务为了保护系统整体的可用性，可以暂时切断对下游服务的调用。这种牺牲局部，保全整体的措施就叫做熔断。</p>
</li>
<li><p>雪崩</p>
<p>此时若有大量的请求涌入，容器的线程资源会被消耗完毕，导致服务瘫痪。服务与服务之间的依赖性，故障会传播，造成连锁反应，会对整个微服务系统造成灾难性的严重后果。</p>
</li>
<li><p>解决</p>
<ol>
<li><p>隔离</p>
<p>就是服务拆分，这也是微服务的原因之一</p>
</li>
<li><p>服务降级</p>
<p>限流，拒绝服务，推迟服务</p>
</li>
<li><p>熔断</p>
<p>直接通过fallback就行返回，牺牲局部，保全整体的措施就叫做熔断。</p>
</li>
</ol>
</li>
</ol>
<h3 id="1-4-链路追踪"><a href="#1-4-链路追踪" class="headerlink" title="1.4 链路追踪"></a>1.4 链路追踪</h3><p>​    一次请求涉及到多个服务。互联网应用构建在不同的软件模块集上，这些软件模块，有可能是由不同的团队开发、可能使用不同的编程语言来实现、有可能布在了几千台服务器，横跨多个不同的数据中心。因此，就需要对一次请求涉及的多个<strong>服务链路进行日志记录，性能监控即链路追踪</strong>.</p>
<h3 id="1-5-网关"><a href="#1-5-网关" class="headerlink" title="1.5 网关"></a>1.5 网关</h3><p>请求由网关层统一接入和输出。一个网关的基本功能有：<strong>统一接入、安全防护、协议适配、流量管控、长短链接支持、容错能力</strong>。有了网关之后，各个API服务提供团队可以专注于自己的的业务逻辑处理，而API网关更专注于<strong>安全、流量、路由</strong>等问题</p>
<h3 id="1-6-配置中心"><a href="#1-6-配置中心" class="headerlink" title="1.6 配置中心"></a>1.6 配置中心</h3><p>提供了统一的配置信息管理服务,可以实时的通知各个服务获取最新的配置信息</p>
<h3 id="1-7-结构"><a href="#1-7-结构" class="headerlink" title="1.7 结构"></a>1.7 结构</h3><h4 id="1-7-1-依赖结构"><a href="#1-7-1-依赖结构" class="headerlink" title="1.7.1 依赖结构"></a>1.7.1 依赖结构</h4><p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20220514175425003.png" alt="image-20220514175425003"></p>
<h2 id="二、注册中心"><a href="#二、注册中心" class="headerlink" title="二、注册中心"></a>二、注册中心</h2><h3 id="2-1-常见的注册中心"><a href="#2-1-常见的注册中心" class="headerlink" title="2.1 常见的注册中心"></a>2.1 常见的注册中心</h3><ol>
<li>Zookeeper<br>zookeeper它是一个分布式服务框架，是Apache Hadoop 的一个子项目，它主要是用来解决分布式应<br>用中经常遇到的一些数据管理问题，如：统一命名服务、状态同步服务、集群管理、分布式应用配置项<br>的管理等。简单来说zookeeper=文件系统+监听通知机制。</li>
<li>Eureka<br>Eureka是在Java语言上，基于Restful Api开发的服务注册与发现组件，Springcloud Netflix中的重要组<br>件</li>
<li>Consul<br>Consul是由HashiCorp基于Go语言开发的支持多数据中心分布式高可用的服务发布和注册服务软件，<br>采用Raft算法保证服务的一致性，且支持健康检查。</li>
<li>Nacos<br>简单来说 Nacos 就是注册中心 + 配置中心的组合，帮助我们解决微服务开发必会涉及到的服务注册与发现，服务配置，服务管理等问题。</li>
</ol>
<p>组件名 语言 CAP 一致性算法 服务健康检查 对外暴露接口<br>Eureka Java AP 无 可配支持 HTTP<br>Consul Go CP Raft 支持 HTTP/DNS<br>Zookeeper Java CP Paxos 支持 客户端<br>Nacos Java AP Raft 支持 HTTP</p>
<table>
<thead>
<tr>
<th>组件名</th>
<th>语言</th>
<th>CAP</th>
<th>一致性</th>
<th>服务健康检查</th>
<th>对外暴露接口</th>
</tr>
</thead>
<tbody><tr>
<td>Nacos</td>
<td>Java</td>
<td>AP</td>
<td>Raft</td>
<td>支持</td>
<td>HTTP</td>
</tr>
<tr>
<td>Eureka</td>
<td>Java</td>
<td>AP</td>
<td>无</td>
<td>可配置支持</td>
<td>HTTP</td>
</tr>
<tr>
<td>Consul</td>
<td>Go</td>
<td>CP</td>
<td>Raft</td>
<td>支持</td>
<td>HTTP、DNS</td>
</tr>
<tr>
<td>Zookeeper</td>
<td>Java</td>
<td>CP</td>
<td>Paxos</td>
<td>支持</td>
<td>客户端</td>
</tr>
</tbody></table>
<h3 id="2-2-Eureka"><a href="#2-2-Eureka" class="headerlink" title="2.2 Eureka"></a>2.2 Eureka</h3><h4 id="2-2-1-角色"><a href="#2-2-1-角色" class="headerlink" title="2.2.1 角色"></a>2.2.1 角色</h4><ol>
<li><p>服务</p>
<p>提供服务注册和发现</p>
</li>
<li><p>服务提供者</p>
<p>将自身服务注册到Eureka，从而使服务消费方能够找到</p>
</li>
<li><p>消费者</p>
<p>从Eureka获取注册服务列表，从而能够消费服务</p>
</li>
</ol>
<h4 id="2-2-2-特性"><a href="#2-2-2-特性" class="headerlink" title="2.2.2 特性"></a>2.2.2 特性</h4><blockquote>
<p>Eureka通过心跳检测、健康检查和客户端缓存等机制，提高了系统的灵活性、可伸缩性和可用性</p>
</blockquote>
<ol>
<li>周期性地向Eureka Server发送<strong>心跳</strong>（默认周期为30秒）以续约自己的信息。如果Eureka Server在一定时间内没有接收到某个微服务节点的心跳，Eureka Server将会注销该微服务节点（默认90秒）</li>
<li>每个Eureka Server同时也是Eureka Client，多个Eureka Server之间通过<strong>复制的方式</strong>完成服务注册表的同步；</li>
<li>Eureka Client会<strong>缓存</strong>Eureka Server中的信息。即使所有的Eureka Server节点都宕掉，服务消费者依然可以使用缓存中的信息找到服务提供者。</li>
<li>Eureka Server在运行期间，**会统计心跳失败的比例在15分钟之内是否低于85%**，如果出现低于的情况（在单机调试的时候很容易满足，实际在生产环境上通常是由于网络不稳定导致），Eureka Server会将当前的实例注册信息保护起来，同时提示这个警告。保护模式主要用于一组客户端和Eureka Server之间存在网络分区场景下的保护。一旦进入保护模式，Eureka Server将会尝试保护其服务注册表中的</li>
</ol>
<h4 id="2-2-3-元数据"><a href="#2-2-3-元数据" class="headerlink" title="2.2.3 元数据"></a>2.2.3 元数据</h4><blockquote>
<p>标准元数据和自定义元数据，在程序中可以使用DiscoveryClient 获取指定微服务的所有元数据信息</p>
</blockquote>
<ul>
<li><p>标准元数据：主机名、IP地址、端口号、状态页和健康检查等信息，这些信息都会被发布在服务注<br>册表中，用于服务之间的调用。</p>
</li>
<li><p>自定义元数据：可以使用eureka.instance.metadata-map配置，符合KEY/VALUE的存储格式。这<br>些元数据可以在远程客户端中访问。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> DiscoveryClient discoveryClient;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//根据微服务名称从注册中心获取相关的元数据信息</span></span><br><span class="line">    List&lt;ServiceInstance&gt; instances = discoveryClient.getInstances(<span class="string">&quot;ep-mail&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (ServiceInstance instance : instances) &#123;</span><br><span class="line">    	System.out.println(instance);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="2-2-4-高可用"><a href="#2-2-4-高可用" class="headerlink" title="2.2.4 高可用"></a>2.2.4 高可用</h4><p>Eureka Server可以通过运行多个实例并相互注册的方式实现高可用部署，Eureka Server实例会彼此增量地同步信息，从而确保所有节点数据一致。事实上，节点之间相互注册是Eureka Server的默认行为。</p>
<h4 id="搭建"><a href="#搭建" class="headerlink" title="搭建"></a>搭建</h4><h5 id="server"><a href="#server" class="headerlink" title="server"></a>server</h5><figure class="highlight clean"><table><tr><td class="code"><pre><span class="line">```</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 	三、RPC与负载均衡</span><br><span class="line"></span><br><span class="line">### <span class="number">3.1</span> Ribbon</span><br><span class="line"></span><br><span class="line">&gt; Eureka内置，有助于控制 HTTP 和 TCP客户端行为，Ribbon自动的从注册中心中获取服务提供者的列表信息，并基于内置的负载均衡算法，请求服务。</span><br><span class="line"></span><br><span class="line">#### <span class="number">3.1</span><span class="number">.1</span> 负载均衡策略</span><br><span class="line"></span><br><span class="line">+  **默认**：轮询</span><br><span class="line">+ 哈希</span><br><span class="line">+ 随机</span><br><span class="line">+ 加权</span><br><span class="line"></span><br><span class="line">#### <span class="number">3.1</span><span class="number">.2</span> 使用</span><br><span class="line"></span><br><span class="line">由于是Eureka内置的，所以默认情况是不需要配置的‘</span><br><span class="line"></span><br><span class="line">```java</span><br><span class="line"><span class="comment">//注入bean</span></span><br><span class="line">@LoadBalanced</span><br><span class="line">@Bean</span><br><span class="line">public RestTemplate restTemplate()&#123;</span><br><span class="line">	return new RestTemplate();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//调用</span></span><br><span class="line">String result = restTemplate.getForObject(<span class="string">&quot;http://ep-mail/test&quot;</span>, String.<span class="keyword">class</span>);</span><br></pre></td></tr></table></figure>





<h3 id="3-2-Feign"><a href="#3-2-Feign" class="headerlink" title="3.2 Feign"></a>3.2 Feign</h3><h4 id="3-2-1-介绍"><a href="#3-2-1-介绍" class="headerlink" title="3.2.1 介绍"></a>3.2.1 介绍</h4><blockquote>
<p>Netflix的声明式，模板化的HTTP客户端，<strong>集成了Ribbon</strong></p>
<p>更加便捷，优雅的调用HTTP API</p>
</blockquote>
<h4 id="3-2-2-配置"><a href="#3-2-2-配置" class="headerlink" title="3.2.2 配置"></a>3.2.2 配置</h4><h5 id="3-2-2-1-基本"><a href="#3-2-2-1-基本" class="headerlink" title="3.2.2.1 基本"></a>3.2.2.1 基本</h5><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">feign:</span></span><br><span class="line">    <span class="attr">client:</span></span><br><span class="line">        <span class="attr">config:</span></span><br><span class="line">        <span class="attr">feignName:</span> <span class="comment">##定义FeginClient的名称</span></span><br><span class="line">        <span class="attr">connectTimeout:</span> <span class="number">5000</span> <span class="comment"># 相当于Request.Options</span></span><br><span class="line">        <span class="attr">readTimeout:</span> <span class="number">5000</span> <span class="comment"># 相当于Request.Options</span></span><br><span class="line">        <span class="comment"># 配置Feign的日志级别，相当于代码配置方式中的Logger</span></span><br><span class="line">        <span class="attr">loggerLevel:</span> <span class="string">full</span></span><br><span class="line">        <span class="comment"># Feign的错误解码器，相当于代码配置方式中的ErrorDecoder</span></span><br><span class="line">        <span class="attr">errorDecoder:</span> <span class="string">com.example.SimpleErrorDecoder</span></span><br><span class="line">        <span class="comment"># 配置重试，相当于代码配置方式中的Retryer</span></span><br><span class="line">        <span class="attr">retryer:</span> <span class="string">com.example.SimpleRetryer</span></span><br><span class="line">        <span class="comment"># 配置拦截器，相当于代码配置方式中的RequestInterceptor</span></span><br><span class="line">        <span class="attr">requestInterceptors:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">com.example.FooRequestInterceptor</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">com.example.BarRequestInterceptor</span></span><br><span class="line">        <span class="attr">decode404:</span> <span class="literal">false</span>  <span class="comment">#配置熔断不处理404异常</span></span><br></pre></td></tr></table></figure>

<h5 id="3-2-2-2-压缩"><a href="#3-2-2-2-压缩" class="headerlink" title="3.2.2.2 压缩"></a>3.2.2.2 压缩</h5><p>支持对请求和响应进行GZIP压缩，以减少通信过程中的性能损耗。可以对请求的数据类型，以及触发压缩的大小下限进行设置。</p>
<h4 id="3-2-3-使用"><a href="#3-2-3-使用" class="headerlink" title="3.2.3 使用"></a>3.2.3 使用</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//1. Main.class注解</span></span><br><span class="line"><span class="meta">@EnableFeignClients</span></span><br><span class="line"><span class="comment">//2. 编写接口</span></span><br><span class="line"><span class="meta">@FeignClient(name=&quot;ep_mail&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ProductFeginClient</span> </span>&#123;</span><br><span class="line">	<span class="meta">@RequestMapping(value = &quot;/product/&#123;id&#125;&quot;,method = RequestMethod.GET)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Product <span class="title">findById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//3. 调用</span></span><br></pre></td></tr></table></figure>

<h2 id="四、熔断"><a href="#四、熔断" class="headerlink" title="四、熔断"></a>四、熔断</h2><h3 id="4-1-Hystrix"><a href="#4-1-Hystrix" class="headerlink" title="4.1 Hystrix"></a>4.1 Hystrix</h3><h4 id="4-1-2-介绍"><a href="#4-1-2-介绍" class="headerlink" title="4.1.2 介绍"></a>4.1.2 介绍</h4><blockquote>
<p>Netflix开源的一个延迟和容错库</p>
</blockquote>
<p>Hystrix主要通过以下几点实现延迟和容错。</p>
<p>包裹请求：使用HystrixCommand包裹对依赖的调用逻辑，每个命令在独立线程中执行。这使用<br>了设计模式中的“命令模式”。<br>跳闸机制：当某服务的错误率超过一定的阈值时，Hystrix可以自动或手动跳闸，停止请求该服务<br>一段时间。<br>资源隔离：Hystrix为每个依赖都维护了一个小型的线程池（或者信号量）。如果该线程池已满，<br>发往该依赖的请求就被立即拒绝，而不是排队等待，从而加速失败判定。<br>监控：Hystrix可以近乎实时地监控运行指标和配置的变化，例如成功、失败、超时、以及被拒绝<br>的请求等。<br>回退机制：当请求失败、超时、被拒绝，或当断路器打开时，执行回退逻辑。回退逻辑由开发人员<br>自行提供，例如返回一个缺省值。<br>自我修复：断路器打开一段时间后，会自动进入“半开”状态</p>
<h4 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-hystrix<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">hystrix:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//不基于feign，在一个Controller类中</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;testHystrix&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;testHystrix&quot;)</span></span><br><span class="line"><span class="meta">@HystrixCommand(fallbackMethod = &quot;back&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ApiResult <span class="title">testHystrix</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Random r = <span class="keyword">new</span> Random();</span><br><span class="line">    String result = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> (r.nextInt(<span class="number">10</span>) &gt; <span class="number">5</span>)</span><br><span class="line">        result = mailFeign.test2();</span><br><span class="line">    <span class="keyword">else</span> result = mailFeign.test();</span><br><span class="line">    <span class="keyword">return</span> ApiResult.ok().data(result);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">back</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;back&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//基于Feign的，需要配置两个类</span></span><br><span class="line"><span class="comment">//1. 配置back类</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MailFeignBack</span> <span class="keyword">implements</span> <span class="title">MailFeign</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">test2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;back&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//2. 配置Fegin</span></span><br><span class="line"><span class="meta">@FeignClient(name = &quot;ep-mail&quot;, fallback = MailFeignBack.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MailFeign</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;test2&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">test2</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="4-2-Sentinel"><a href="#4-2-Sentinel" class="headerlink" title="4.2 Sentinel"></a>4.2 Sentinel</h3><h2 id="个人理解"><a href="#个人理解" class="headerlink" title="个人理解"></a>个人理解</h2><ol>
<li>多个实例的运行<ul>
<li>多个eureka server就是为了高可用</li>
<li>多个privider就是为了负载均衡</li>
</ul>
</li>
</ol>
<h2 id="遇到的坑"><a href="#遇到的坑" class="headerlink" title="遇到的坑"></a>遇到的坑</h2><ol>
<li><p>依赖出错</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">//父工程需要指定Packaging为pom</span><br><span class="line"><span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>依赖错误</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">而不是</span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>子父工程错误</p>
<p>见1.7 以来结构</p>
</li>
<li><p>没有eureka web</p>
<p>因为没加注解  @EnableEurekaServer</p>
</li>
<li><p>服务调用失败</p>
<p>因为请求路径错误  注册信息不用能**下划线_**而是中划线</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">1. spring.application.name=ep-mail</span><br><span class="line">2. http://ep-mail/<span class="built_in">test</span></span><br></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>架构</category>
      </categories>
  </entry>
  <entry>
    <title>common-lang3</title>
    <url>/2021/11/06/%E7%BB%84%E4%BB%B6/common-lang3/</url>
    <content><![CDATA[<h1 id="common-lang3-参考"><a href="#common-lang3-参考" class="headerlink" title="common-lang3 参考"></a><a href="https://www.jianshu.com/p/1886903ed14c">common-lang3 参考</a></h1><p>[toc]</p>
<h3 id="ArrayUtils"><a href="#ArrayUtils" class="headerlink" title="ArrayUtils"></a>ArrayUtils</h3><p>集合工具类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//创建数组</span></span><br><span class="line">String[] array = ArrayUtils.toArray(<span class="string">&quot;1&quot;</span>, <span class="string">&quot;2&quot;</span>);</span><br><span class="line"><span class="comment">//判断两个数据是否相等，如果内容相同， 顺序相同 则返回 true</span></span><br><span class="line">ArrayUtils.isEquals(arr1,arr2);</span><br><span class="line"><span class="comment">//判断数组中是否包含某一对象</span></span><br><span class="line">ArrayUtils.contains(arr, <span class="string">&quot;33&quot;</span>);</span><br><span class="line"><span class="comment">//二维数组转换成MAP</span></span><br><span class="line">Map map = ArrayUtils.toMap(<span class="keyword">new</span> String[][] &#123; </span><br><span class="line">    &#123; <span class="string">&quot;RED&quot;</span>, <span class="string">&quot;#FF0000&quot;</span> &#125;, &#123; <span class="string">&quot;GREEN&quot;</span>, <span class="string">&quot;#00FF00&quot;</span> &#125;, &#123; <span class="string">&quot;BLUE&quot;</span>, <span class="string">&quot;#0000FF&quot;</span> &#125; &#125;);</span><br></pre></td></tr></table></figure>

<h3 id="DateUtils"><a href="#DateUtils" class="headerlink" title="DateUtils"></a>DateUtils</h3><p>日期工具类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//日期加n天</span></span><br><span class="line">DateUtils.addDays(<span class="keyword">new</span> Date(), n);</span><br><span class="line"><span class="comment">//判断是否同一天</span></span><br><span class="line">DateUtils.isSameDay(date1, date2);</span><br><span class="line"><span class="comment">//字符串时间转换为Date</span></span><br><span class="line">DateUtils.parseDate(str, parsePatterns);</span><br></pre></td></tr></table></figure>

<h3 id="1、StringUtils"><a href="#1、StringUtils" class="headerlink" title="1、StringUtils"></a>1、StringUtils</h3><p>操作字符串的工具类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//首字母大小写转换</span></span><br><span class="line">StringUtils.capitalize(<span class="string">&quot;cat&quot;</span>);<span class="comment">//---&quot;Cat&quot;</span></span><br><span class="line">StringUtils.uncapitalize(<span class="string">&quot;Cat&quot;</span>);<span class="comment">//---&quot;cat&quot;</span></span><br><span class="line"><span class="comment">//去除字符串中的&quot;\n&quot;, &quot;\r&quot;, or &quot;\r\n&quot;</span></span><br><span class="line">StringUtils.chomp(<span class="string">&quot;abc\r\n&quot;</span>);<span class="comment">//---&quot;abc&quot;</span></span><br><span class="line"><span class="comment">//判断一字符串是否包含另一字符串</span></span><br><span class="line">StringUtils.contains(<span class="string">&quot;abc&quot;</span>, <span class="string">&quot;z&quot;</span>);<span class="comment">//---false</span></span><br><span class="line">StringUtils.containsIgnoreCase(<span class="string">&quot;abc&quot;</span>, <span class="string">&quot;A&quot;</span>);<span class="comment">//---true</span></span><br><span class="line"><span class="comment">//删除字符串中的梭有空格</span></span><br><span class="line">StringUtils.deleteWhitespace(<span class="string">&quot;   ab  c  &quot;</span>);<span class="comment">//---&quot;abc&quot;</span></span><br><span class="line"><span class="comment">//检查字符串结尾后缀是否匹配</span></span><br><span class="line">StringUtils.endsWith(<span class="string">&quot;abcdef&quot;</span>, <span class="string">&quot;def&quot;</span>);<span class="comment">//---true</span></span><br><span class="line">StringUtils.endsWithIgnoreCase(<span class="string">&quot;ABCDEF&quot;</span>, <span class="string">&quot;def&quot;</span>);<span class="comment">//---true</span></span><br><span class="line">StringUtils.endsWithAny(<span class="string">&quot;abcxyz&quot;</span>, <span class="keyword">new</span> String[] &#123;<span class="keyword">null</span>, <span class="string">&quot;xyz&quot;</span>, <span class="string">&quot;abc&quot;</span>&#125;);<span class="comment">//---true</span></span><br><span class="line"><span class="comment">//判断两字符串是否相同</span></span><br><span class="line">StringUtils.equalsIgnoreCase(<span class="string">&quot;abc&quot;</span>, <span class="string">&quot;ABC&quot;</span>);<span class="comment">//---true</span></span><br><span class="line"><span class="comment">//比较字符串数组内的所有元素的字符序列，起始一致则返回一致的字符串，若无则返回&quot;&quot;</span></span><br><span class="line">StringUtils.getCommonPrefix(<span class="keyword">new</span> String[] &#123;<span class="string">&quot;abcde&quot;</span>, <span class="string">&quot;abxyz&quot;</span>&#125;);<span class="comment">//---&quot;ab&quot;</span></span><br><span class="line"><span class="comment">//判断字符串大写、小写</span></span><br><span class="line">StringUtils.isAllUpperCase(<span class="string">&quot;ABC&quot;</span>);<span class="comment">//---true</span></span><br><span class="line"><span class="comment">//判断是否为空(注：isBlank与isEmpty 区别)</span></span><br><span class="line">StringUtils.isBlank(<span class="keyword">null</span>);StringUtils.isBlank(<span class="string">&quot;&quot;</span>);StringUtils.isBlank(<span class="string">&quot; &quot;</span>);<span class="comment">//---true</span></span><br><span class="line">StringUtils.isNoneBlank(<span class="string">&quot; &quot;</span>, <span class="string">&quot;bar&quot;</span>);<span class="comment">//---false</span></span><br><span class="line">StringUtils.isEmpty(<span class="keyword">null</span>);StringUtils.isEmpty(<span class="string">&quot;&quot;</span>);<span class="comment">//---true</span></span><br><span class="line">StringUtils.isEmpty(<span class="string">&quot; &quot;</span>);<span class="comment">//---false</span></span><br><span class="line">StringUtils.isNoneEmpty(<span class="string">&quot; &quot;</span>, <span class="string">&quot;bar&quot;</span>);<span class="comment">//---true</span></span><br><span class="line"><span class="comment">//判断字符串数字</span></span><br><span class="line">StringUtils.isNumeric(<span class="string">&quot;123&quot;</span>);<span class="comment">//---false</span></span><br><span class="line">StringUtils.isNumericSpace(<span class="string">&quot;12 3&quot;</span>);<span class="comment">//---true</span></span><br><span class="line"><span class="comment">//数组中加入分隔符号</span></span><br><span class="line"><span class="comment">//StringUtils.join([1, 2, 3], ‘;‘);//---&quot;1;2;PKJjkkaf&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//大小写转换</span></span><br><span class="line">StringUtils.upperCase(<span class="string">&quot;aBc&quot;</span>);<span class="comment">//---&quot;ABC&quot;</span></span><br><span class="line">StringUtils.lowerCase(<span class="string">&quot;aBc&quot;</span>);<span class="comment">//---&quot;abc&quot;</span></span><br><span class="line">StringUtils.swapCase(<span class="string">&quot;The dog has a BONE&quot;</span>);<span class="comment">//---&quot;tHE DOG HAS A bone&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//替换字符串内容……（replacePattern、replceOnce）</span></span><br><span class="line">StringUtils.replace(<span class="string">&quot;aba&quot;</span>, <span class="string">&quot;a&quot;</span>, <span class="string">&quot;z&quot;</span>);<span class="comment">//---&quot;zbz&quot;</span></span><br><span class="line">StringUtils.overlay(<span class="string">&quot;abcdef&quot;</span>, <span class="string">&quot;zz&quot;</span>, <span class="number">2</span>, <span class="number">4</span>);<span class="comment">//---&quot;abzzef&quot;(指定区域)</span></span><br><span class="line">StringUtils.replaceEach(<span class="string">&quot;abcde&quot;</span>, <span class="keyword">new</span> String[]&#123;<span class="string">&quot;ab&quot;</span>, <span class="string">&quot;d&quot;</span>&#125;,</span><br><span class="line">                        <span class="keyword">new</span> String[]&#123;<span class="string">&quot;w&quot;</span>, <span class="string">&quot;t&quot;</span>&#125;);<span class="comment">//---&quot;wcte&quot;(多组指定替换ab-&gt;w，d-&gt;t)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//重复字符</span></span><br><span class="line">StringUtils.repeat(‘e‘, <span class="number">3</span>);<span class="comment">//---&quot;eee&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//反转字符串</span></span><br><span class="line">StringUtils.reverse(<span class="string">&quot;bat&quot;</span>);<span class="comment">//---&quot;tab&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//删除某字符</span></span><br><span class="line">StringUtils.remove(<span class="string">&quot;queued&quot;</span>, ‘u‘);<span class="comment">//---&quot;qeed&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//分割字符串</span></span><br><span class="line">StringUtils.split(<span class="string">&quot;a..b.c&quot;</span>, ‘.‘);<span class="comment">//---[&quot;a&quot;, &quot;b&quot;, &quot;c&quot;]</span></span><br><span class="line">StringUtils.split(<span class="string">&quot;ab:cd:ef&quot;</span>, <span class="string">&quot;:&quot;</span>, <span class="number">2</span>);<span class="comment">//---[&quot;ab&quot;, &quot;cd:ef&quot;]</span></span><br><span class="line">StringUtils.splitByWholeSeparator(<span class="string">&quot;ab-!-cd-!-ef&quot;</span>, <span class="string">&quot;-!-&quot;</span>, <span class="number">2</span>);<span class="comment">//---[&quot;ab&quot;, &quot;cd-!-ef&quot;]</span></span><br><span class="line">StringUtils.splitByWholeSeparatorPreserveAllTokens(<span class="string">&quot;ab::cd:ef&quot;</span>, <span class="string">&quot;:&quot;</span>);<span class="comment">//-[&quot;ab&quot;,&quot; &quot;,&quot;cd&quot;,&quot;ef&quot;]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//去除首尾空格，类似trim……（stripStart、stripEnd、stripAll、stripAccents）</span></span><br><span class="line">StringUtils.strip(<span class="string">&quot; ab c &quot;</span>);<span class="comment">//---&quot;ab c&quot;</span></span><br><span class="line">StringUtils.stripToNull(<span class="keyword">null</span>);<span class="comment">//---null</span></span><br><span class="line">StringUtils.stripToEmpty(<span class="keyword">null</span>);<span class="comment">//---&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//截取字符串</span></span><br><span class="line">StringUtils.substring(<span class="string">&quot;abcd&quot;</span>, <span class="number">2</span>);<span class="comment">//---&quot;cd&quot;</span></span><br><span class="line">StringUtils.substring(<span class="string">&quot;abcdef&quot;</span>, <span class="number">2</span>, <span class="number">4</span>);<span class="comment">//---&quot;cd&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//left、right从左(右)开始截取n位字符</span></span><br><span class="line">StringUtils.left(<span class="string">&quot;abc&quot;</span>, <span class="number">2</span>);<span class="comment">//---&quot;ab&quot;</span></span><br><span class="line">StringUtils.right(<span class="string">&quot;abc&quot;</span>, <span class="number">2</span>);<span class="comment">//---&quot;bc&quot;</span></span><br><span class="line"><span class="comment">//从第n位开始截取m位字符       n  m</span></span><br><span class="line">StringUtils.mid(<span class="string">&quot;abcdefg&quot;</span>, <span class="number">2</span>, <span class="number">4</span>);<span class="comment">//---&quot;cdef&quot;</span></span><br><span class="line"></span><br><span class="line">StringUtils.substringBefore(<span class="string">&quot;abcba&quot;</span>, <span class="string">&quot;b&quot;</span>);<span class="comment">//---&quot;a&quot;</span></span><br><span class="line">StringUtils.substringBeforeLast(<span class="string">&quot;abcba&quot;</span>, <span class="string">&quot;b&quot;</span>);<span class="comment">//---&quot;abc&quot;</span></span><br><span class="line">StringUtils.substringAfter(<span class="string">&quot;abcba&quot;</span>, <span class="string">&quot;b&quot;</span>);<span class="comment">//---&quot;cba&quot;</span></span><br><span class="line">StringUtils.substringAfterLast(<span class="string">&quot;abcba&quot;</span>, <span class="string">&quot;b&quot;</span>);<span class="comment">//---&quot;a&quot;</span></span><br><span class="line"></span><br><span class="line">StringUtils.substringBetween(<span class="string">&quot;tagabctag&quot;</span>, <span class="string">&quot;tag&quot;</span>);<span class="comment">//---&quot;abc&quot;</span></span><br><span class="line">StringUtils.substringBetween(<span class="string">&quot;yabczyabcz&quot;</span>, <span class="string">&quot;y&quot;</span>, <span class="string">&quot;z&quot;</span>);<span class="comment">//---&quot;abc&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="2、RandomStringUtils"><a href="#2、RandomStringUtils" class="headerlink" title="2、RandomStringUtils"></a>2、RandomStringUtils</h3><p>随机数工具类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//随机生成n位数数字</span></span><br><span class="line">RandomStringUtils.randomNumeric(n);</span><br><span class="line"><span class="comment">//在指定字符串中生成长度为n的随机字符串</span></span><br><span class="line">RandomStringUtils.random(n, <span class="string">&quot;abcdefghijk&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="3、NumberUtils"><a href="#3、NumberUtils" class="headerlink" title="3、NumberUtils"></a>3、NumberUtils</h3><p>数字工具类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//从数组中选出最大值</span></span><br><span class="line">NumberUtils.max(<span class="keyword">new</span> <span class="keyword">int</span>[] &#123; <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span> &#125;);<span class="comment">//---4</span></span><br><span class="line"><span class="comment">//判断字符串是否全是整数</span></span><br><span class="line">NumberUtils.isDigits(<span class="string">&quot;153.4&quot;</span>);<span class="comment">//--false</span></span><br><span class="line"><span class="comment">//判断字符串是否是有效数字</span></span><br><span class="line">NumberUtils.isNumber(<span class="string">&quot;0321.1&quot;</span>);<span class="comment">//---false    </span></span><br></pre></td></tr></table></figure>



]]></content>
      <categories>
        <category>组件</category>
      </categories>
  </entry>
  <entry>
    <title>http请求</title>
    <url>/2022/04/25/%E7%BB%84%E4%BB%B6/http%E8%AF%B7%E6%B1%82/</url>
    <content><![CDATA[<h2 id="HttpClient"><a href="#HttpClient" class="headerlink" title="HttpClient"></a>HttpClient</h2><h4 id="get请求"><a href="#get请求" class="headerlink" title="get请求"></a>get请求</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//创建cilent对象</span></span><br><span class="line">CloseableHttpClient httpClient = HttpClientBuilder.create().build();</span><br><span class="line"><span class="comment">//创建一个get对象</span></span><br><span class="line">HttpGet request = <span class="keyword">new</span> HttpGet(uri);</span><br><span class="line"><span class="comment">//execute 得到 response</span></span><br><span class="line">CloseableHttpResponse response = httpClient.execute(request, HttpClientContext.create());</span><br><span class="line"><span class="comment">///取得响应结果并处理</span></span><br><span class="line">service(response);</span><br><span class="line"><span class="comment">//关闭HttpClient</span></span><br><span class="line">response.close();</span><br><span class="line">client.close();</span><br></pre></td></tr></table></figure>

<h4 id="post请求"><a href="#post请求" class="headerlink" title="post请求"></a>post请求</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//创建httpclient对象</span></span><br><span class="line">CloseableHttpClient client = HttpClients.createDefault();</span><br><span class="line"><span class="comment">//创建post方式请求对象</span></span><br><span class="line">HttpPost httpPost = <span class="keyword">new</span> HttpPost(url);</span><br><span class="line"><span class="comment">//装填参数</span></span><br><span class="line">StringEntity postBody = <span class="keyword">new</span> StringEntity(<span class="string">&quot;[&quot;</span> + jsonObject.toString() + <span class="string">&quot;]&quot;</span>, <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">postBody.setContentType(<span class="keyword">new</span> BasicHeader(HTTP.CONTENT_TYPE,<span class="string">&quot;application/json;charset=utf-8&quot;</span>));</span><br><span class="line"><span class="comment">//设置参数到请求对象中</span></span><br><span class="line">httpPost.setEntity(postBody);</span><br><span class="line"><span class="comment">//设置header信息</span></span><br><span class="line"><span class="comment">//指定报文头【Content-type】、【User-Agent】</span></span><br><span class="line">httpPost.setHeader(<span class="string">&quot;Content-type&quot;</span>, <span class="string">&quot;application/json;charset=utf-8&quot;</span>);</span><br><span class="line"><span class="comment">//执行请求操作，并拿到结果（同步阻塞）</span></span><br><span class="line">CloseableHttpResponse response = <span class="keyword">null</span>;</span><br><span class="line"><span class="comment">//关闭</span></span><br></pre></td></tr></table></figure>

<h4 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.httpcomponents<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>httpclient<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.5.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="Spring-RestTemplate"><a href="#Spring-RestTemplate" class="headerlink" title="Spring RestTemplate"></a>Spring RestTemplate</h2><h3 id="get"><a href="#get" class="headerlink" title="get"></a>get</h3><h3 id="post"><a href="#post" class="headerlink" title="post"></a>post</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> String uri=<span class="string">&quot;http://114.55.253.244:8001/user/login&quot;</span>;</span><br><span class="line">Map&lt;String,String&gt;params=<span class="keyword">new</span> HashMap&lt;&gt;();<span class="comment">//也可以用fastjson</span></span><br><span class="line">params.put(<span class="string">&quot;username&quot;</span>,<span class="string">&quot;test1&quot;</span>);</span><br><span class="line">params.put(<span class="string">&quot;password&quot;</span>,<span class="string">&quot;test2&quot;</span>);</span><br><span class="line"><span class="keyword">final</span> String s = restTemplate.postForObject(uri, params, String.class);</span><br><span class="line"><span class="keyword">final</span> ResponseEntity&lt;String&gt; entity = restTemplate.postForEntity(uri, params, String.class);</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line">restTemplate.postForObject(uri, params, String.class);</span><br><span class="line"><span class="comment">//进入  RestTemplate</span></span><br><span class="line">RequestCallback requestCallback = httpEntityCallback(request, responseType);<span class="comment">//封装requst(对应params)</span></span><br><span class="line"><span class="comment">//这里 Object的parms被封装成了HttpEntity--&gt;requestEntity = new HttpEntity&lt;&gt;(requestBody);</span></span><br><span class="line"><span class="keyword">return</span> execute(url, HttpMethod.POST, requestCallback, responseExtractor, uriVariables);</span><br><span class="line"><span class="comment">//进入 RestTemplate</span></span><br><span class="line">URI expanded = getUriTemplateHandler().expand(url, uriVariables);</span><br><span class="line"><span class="keyword">return</span> doExecute(expanded, method, requestCallback, responseExtractor);</span><br><span class="line"><span class="comment">//进入 RestTemplate</span></span><br><span class="line">ClientHttpRequest request = createRequest(url, method);</span><br><span class="line">requestCallback.doWithRequest(request)<span class="comment">// ::核心</span></span><br><span class="line">	<span class="comment">//进入RestTemplate.HttpEntityRequestCallback</span></span><br><span class="line">    -&gt;</span><br><span class="line">response = request.execute();<span class="comment">//拿到结果</span></span><br><span class="line">handleResponse(url, method, response);<span class="comment">//封装，处理结果</span></span><br><span class="line"><span class="comment">//进入</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//进入</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//进入</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//进入</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//进入</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//进入</span></span><br></pre></td></tr></table></figure>

]]></content>
  </entry>
  <entry>
    <title>spring-easyExcel</title>
    <url>/2021/11/27/%E7%BB%84%E4%BB%B6/easyExcel/</url>
    <content><![CDATA[<p>[toc]</p>
<h3 id="easyExcel"><a href="#easyExcel" class="headerlink" title="easyExcel"></a>easyExcel</h3><ol>
<li><p>依赖</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>easyexcel<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!-- poi office --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.poi<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>poi<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;poi.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<span id="more"></span></li>
<li><p>entity</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ExcelProperty(&quot;字典名称&quot;)</span></span><br><span class="line"><span class="keyword">private</span> String name;</span><br><span class="line"><span class="meta">@ColumnWidth(50)</span> <span class="comment">//设置g宽度</span></span><br><span class="line"><span class="meta">@ExcelProperty(&quot;字典描述&quot;)</span></span><br><span class="line"><span class="keyword">private</span> String description;</span><br><span class="line"><span class="meta">@DateTimeFormat(&quot;yyyy年MM月dd日HH时mm分ss秒&quot;)</span><span class="comment">//设置时间格式</span></span><br><span class="line"><span class="meta">@NumberFormat(&quot;#.##%&quot;)</span><span class="comment">//设置小数格式</span></span><br><span class="line"><span class="meta">@ExcelIgnore</span> <span class="comment">//加了这个注解会忽略该字段</span></span><br><span class="line"><span class="meta">@ContentRowHeight</span> <span class="comment">//指定表体行高</span></span><br><span class="line"><span class="meta">@HeadRowHeight</span> <span class="comment">//指定表头行高</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>FileUtil.下载</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">downloadEasyExcel</span><span class="params">(HttpServletResponse response, List&lt;T&gt; ExcelBases)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">       String fileName = URLEncoder.encode(<span class="string">&quot;DictData&quot;</span>, <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">       response.setContentType(<span class="string">&quot;application/vnd.ms-excel&quot;</span>);</span><br><span class="line">       response.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">       response.setHeader(<span class="string">&quot;Content-disposition&quot;</span>, <span class="string">&quot;attachment;filename=&quot;</span> + fileName + <span class="string">&quot;.xlsx&quot;</span>);</span><br><span class="line">       <span class="comment">// excel头策略</span></span><br><span class="line">       WriteCellStyle headWriteCellStyle = <span class="keyword">new</span> WriteCellStyle();</span><br><span class="line">       WriteFont headWriteFont = <span class="keyword">new</span> WriteFont();</span><br><span class="line">       headWriteFont.setFontHeightInPoints((<span class="keyword">short</span>) <span class="number">11</span>);</span><br><span class="line">       headWriteFont.setBold(<span class="keyword">false</span>);</span><br><span class="line">       headWriteCellStyle.setWriteFont(headWriteFont);</span><br><span class="line">       <span class="comment">// excel内容策略</span></span><br><span class="line">       WriteCellStyle contentWriteCellStyle = <span class="keyword">new</span> WriteCellStyle();</span><br><span class="line">       WriteFont contentWriteFont = <span class="keyword">new</span> WriteFont();</span><br><span class="line">       contentWriteFont.setFontHeightInPoints((<span class="keyword">short</span>) <span class="number">11</span>);</span><br><span class="line">       contentWriteCellStyle.setWriteFont(contentWriteFont);</span><br><span class="line">       <span class="comment">// 设置handler</span></span><br><span class="line">       HorizontalCellStyleStrategy styleStrategy = <span class="keyword">new</span> HorizontalCellStyleStrategy(headWriteCellStyle, contentWriteCellStyle);</span><br><span class="line">       <span class="comment">/** 导出数据查询方法*/</span></span><br><span class="line">       EasyExcel.write(response.getOutputStream(), ExcelBases.get(<span class="number">0</span>).getClass())</span><br><span class="line">               .sheet(<span class="string">&quot;下载excel服务&quot;</span>)</span><br><span class="line">               .registerWriteHandler(styleStrategy)</span><br><span class="line">               .doWrite(ExcelBases);</span><br><span class="line">   </span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></li>
<li><p>上传</p>
</li>
<li><p>关键 下载的时候controller return null</p>
</li>
</ol>
]]></content>
      <categories>
        <category>spring</category>
      </categories>
  </entry>
  <entry>
    <title>web组件</title>
    <url>/2021/11/06/%E7%BB%84%E4%BB%B6/web%E7%BB%84%E4%BB%B6/</url>
    <content><![CDATA[<p>[toc]</p>
<h3 id="thymeleaf"><a href="#thymeleaf" class="headerlink" title="thymeleaf"></a>thymeleaf</h3><ol>
<li><p>步骤</p>
<ol>
<li><p>controller传入Model model</p>
</li>
<li><p>```java<br>model.addAttribute(“name”, “xxxxx”);</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">3. html加入命名空间</span><br><span class="line"></span><br><span class="line">   ```html</span><br><span class="line">   &lt;html <span class="attribute">lang</span>=<span class="string">&quot;en&quot;</span>   xmlns:<span class="attribute">th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>html调用</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">th:text</span>=<span class="string">&quot;&#x27;hello&#x27; +$&#123;name&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ol>
<span id="more"></span>

<h3 id="mybaitsplus"><a href="#mybaitsplus" class="headerlink" title="mybaitsplus"></a>mybaitsplus</h3><ol>
<li><p>步骤</p>
<ol>
<li><p>依赖</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>mybatis-plus-latest-version<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ol>
<h3 id="Spring-Security"><a href="#Spring-Security" class="headerlink" title="Spring Security"></a>Spring Security</h3><ol>
<li><p> 核心功能</p>
</li>
<li><p>登录认证</p>
</li>
<li><p>用户授权</p>
</li>
<li><p>防止伪造身份</p>
</li>
<li><p>特点</p>
<ol>
<li>和spring无缝连接</li>
<li>功能强大，使用简单</li>
<li>重量级，依赖多</li>
</ol>
</li>
<li><p>使用步骤</p>
<ol>
<li><p>依赖</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>启动</p>
<p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20211005014215091.png" alt="image-20211005014215091"></p>
</li>
<li><p>原理：本质是一个过滤器—过滤器—过滤器的链</p>
<ol>
<li><p>登录拦截—&gt;Authentication</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">FilterSecurityInterceptor.doFilter</span><br><span class="line">UsernamePasswordAuthenticationFilter.doFilter <span class="comment">//拦截post的login</span></span><br></pre></td></tr></table></figure></li>
<li><p>过滤器加载：</p>
<ol>
<li><p>加入依赖后springBoot自动加入security配置</p>
<ol>
<li><p>初始化: intiDelegate(WebConfigContext/WebApplicationContext)</p>
<p>wac.getBean(filterName”FilterChainProxy”)</p>
</li>
<li><p>FilterChainProxy.doFilter-&gt;doFilterInternal把所有的过滤器加载到List</p>
</li>
</ol>
</li>
</ol>
</li>
<li><p>两个接口：用于自定义数据库认证</p>
<ol>
<li>@UserDetailsService 用户，基于UsernamaPassword过滤器</li>
<li>@PasswordEncoder 加密密码</li>
</ol>
</li>
<li><p>认证</p>
<ol>
<li><p>设置用户名和密码</p>
<ol>
<li><p>通过配置文件—pro</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">spring.security.user.name</span>=<span class="string">wang</span></span><br><span class="line"><span class="meta">spring.security.user.password</span>=<span class="string">123456</span></span><br></pre></td></tr></table></figure></li>
<li><p>通过继承配置类—WebSecurityConfigerAdapter</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Adapter</span> <span class="keyword">extends</span> <span class="title">WebSecurityConfigurerAdapter</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        BCryptPasswordEncoder passwordEncoder=<span class="keyword">new</span> BCryptPasswordEncoder();</span><br><span class="line">        String password = passwordEncoder.encode(<span class="string">&quot;123456&quot;</span>);<span class="comment">//设置密码</span></span><br><span class="line">      auth.inMemoryAuthentication().withUser(<span class="string">&quot;wang&quot;</span>).password(password).roles(<span class="string">&quot;admin&quot;</span>);<span class="comment">//配置</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>报错</p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line">There <span class="keyword">is</span> no PasswordEncoder mapped <span class="keyword">for</span> <span class="keyword">the</span> <span class="built_in">id</span> <span class="string">&quot;null&quot;</span></span><br></pre></td></tr></table></figure>

<p>原因：没有加载到PasswordEncoder这个类</p>
<p>解决：手动在@Component里面加入@Bean</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line">    <span class="function">PasswordEncoder <span class="title">passwordEncoderxxx</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> BCryptPasswordEncoder();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>自定义实现类查询数据库(实际开发)</p>
<ol>
<li><p>没有配置文件的配置，没有WebSecurityConfigerAdapter，那么security就会找UserDetailService接口的是实现类</p>
</li>
<li><p>步骤</p>
<ol>
<li><p>创建UserDetailService手工辅助Bean,并返回一个完整的用于认证和权限鉴定的User{username,password,authorities}</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">UserMapper userMapper;</span><br><span class="line"><span class="meta">@Service(&quot;userDetailsService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserService</span> <span class="keyword">implements</span> <span class="title">UserDetailsService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> UserDetails <span class="title">loadUserByUsername</span><span class="params">(String s)</span> <span class="keyword">throws</span> UsernameNotFoundException </span>&#123;</span><br><span class="line">        List&lt;GrantedAuthority&gt; authorities = AuthorityUtils.commaSeparatedStringToAuthorityList(<span class="string">&quot;role&quot;</span>);<span class="comment">//加入权限</span></span><br><span class="line">        <span class="comment">//通过数据库获取用户名和密码，这里会自动比较密码是否真确，因为之前已经拦截过user.name和user.password了</span></span><br><span class="line">        String name = <span class="string">&quot;wang&quot;</span>;</span><br><span class="line">        String password = <span class="string">&quot;123&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> User(name,</span><br><span class="line">                <span class="keyword">new</span> BCryptPasswordEncoder().encode(password), authorities);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
<li><p>创建WebSecurityConfigerAdapter的子类进行</p>
<ol>
<li><p>认证:configure(AuthenticationManagerBuilder auth)</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MySecurityConfig</span> <span class="keyword">extends</span> <span class="title">WebSecurityConfigurerAdapter</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDetailsService userDetailsService;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;认证&quot;</span>);</span><br><span class="line">        auth.userDetailsService(userDetailsService).passwordEncoder(<span class="keyword">new</span> BCryptPasswordEncoder());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
<li><p>权限鉴定:  void configure(HttpSecurity http)  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        http.formLogin()<span class="comment">//自定义登录</span></span><br><span class="line">                .loginPage(<span class="string">&quot;/login.html&quot;</span>)<span class="comment">//登录页面---&gt;去另一个configure认证---&gt;认证完---&gt;原路径</span></span><br><span class="line">                .loginProcessingUrl(<span class="string">&quot;/user/login&quot;</span>)<span class="comment">//登录访问路径--&gt;postController</span></span><br><span class="line">                .defaultSuccessUrl(<span class="string">&quot;/test/index&quot;</span>).permitAll()<span class="comment">//登录成功页面</span></span><br><span class="line">                .and().authorizeRequests().antMatchers(<span class="string">&quot;/&quot;</span>,<span class="string">&quot;/test/hi&quot;</span>,<span class="string">&quot;/user/login&quot;</span>).permitAll()<span class="comment">//不需要认证的界面</span></span><br><span class="line">                .anyRequest().authenticated()</span><br><span class="line">                .and().csrf().disable();<span class="comment">//关闭csrf防护。</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
<li><p>权限鉴定步骤:</p>
<ol>
<li>用户登录访问任意需要认证的路径，比如/test/hello,”/test/hi”不行。</li>
<li>会跳转到/login.html，用户输入用户名和密码，访问login.html的post表单地址,这个地址对应loginProcessingUrl(“/user/login”)。</li>
<li>认证成功后跳转回/test/hello</li>
<li>失败</li>
<li>暂时没发现defaultSuccessUrl作用</li>
<li>注意login.html必须是username,password</li>
<li>bug—-&gt;我的测试页面一直不需要认证，原因是浏览器没关闭，cookie自带的信息帮我认证了。</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
<li><p>角色权限</p>
<ol>
<li><p>基于角色/权限访问</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//只有admin才能访问index----&gt;userService从数据库拿到设置权限</span></span><br><span class="line"><span class="comment">//                .antMatchers(&quot;/test/index&quot;).hasAnyAuthority(&quot;admin&quot;)//全部权限</span></span><br><span class="line">                .antMatchers(<span class="string">&quot;test/index&quot;</span>).hasAnyAuthority(<span class="string">&quot;admin,user&quot;</span>)<span class="comment">//任意权限</span></span><br><span class="line"><span class="comment">//                .antMatchers(&quot;/test/index&quot;).hasRole(&quot;&quot;)</span></span><br><span class="line">                .anyRequest().authenticated()</span><br><span class="line">                .and().csrf().disable();<span class="comment">//关闭csrf防护。</span></span><br></pre></td></tr></table></figure>

<ol>
<li>hasAuthority 全部权限</li>
<li>hasAnyAutority 任意权限</li>
<li>hasRole 全部角色</li>
<li>hasAnyRole 任意角色</li>
</ol>
</li>
<li><p>设置权限、角色</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;GrantedAuthority&gt; authorities = AuthorityUtils.commaSeparatedStringToAuthorityList(<span class="string">&quot;ROLE_admin,admin&quot;</span>);</span><br></pre></td></tr></table></figure></li>
<li><p>加入无权限页面</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">http.exceptionHandling().accessDeniedPage(<span class="string">&quot;/unauth.html&quot;</span>);</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p>基于注解而非配置链.antMatchers(“test/index”).hasAnyAuthority(“admin,user”)的方式</p>
<ol>
<li>@EnableGlobalMethodSecurity(securedEnabled = true) AppRun开启鉴权注解模式</li>
<li>@Secured 用户是否拥有运行这个Controller方法的角色</li>
<li>@PreAuthorize 进入方法前</li>
<li>@PostAuthorize 方法执行后进行鉴权</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
</ol>
<h5 id="一些理解"><a href="#一些理解" class="headerlink" title="一些理解"></a>一些理解</h5><ol>
<li>感觉SpringSecurity就是一个拿着cookie和客户端请求乱跑的组件。哪里请求鉴权哪里。</li>
<li></li>
</ol>
<h3 id="MybatisPlus"><a href="#MybatisPlus" class="headerlink" title="MybatisPlus"></a>MybatisPlus</h3><ol>
<li>SpringBoot配置文件pro</li>
</ol>
<ol>
<li>server.port=9090 端口</li>
<li>spring.security.user.name=”wang” s</li>
<li>spring.security.user.password=”123456”</li>
</ol>
<h3 id="Lombok"><a href="#Lombok" class="headerlink" title="Lombok"></a>Lombok</h3><ol>
<li>@Data相当于@Getter @Setter @RequiredArgsConstructor @ToString @EqualsAndHashCode这5个注解的合集。</li>
<li>@EqualsAndHashCode(callSuper = true)  验证子类也为equal true</li>
</ol>
<h3 id="issue"><a href="#issue" class="headerlink" title="issue"></a>issue</h3><ol>
<li></li>
</ol>
]]></content>
      <categories>
        <category>组件</category>
      </categories>
  </entry>
  <entry>
    <title>web图片上传与获取</title>
    <url>/2021/11/06/%E7%BB%84%E4%BB%B6/%E5%9B%BE%E7%89%87%E9%97%AE%E9%A2%98/</url>
    <content><![CDATA[<p>[toc]</p>
<h3 id="配置资源路径"><a href="#配置资源路径" class="headerlink" title="配置资源路径"></a>配置资源路径</h3><ol>
<li><p>配置类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebResourceConfig</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> </span>&#123;</span><br><span class="line">        registry.addResourceHandler(<span class="string">&quot;/img/**&quot;</span>).addResourceLocations(<span class="string">&quot;file:D:/data/java/img/&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>上传mutifile到指定路径</p>
</li>
<li><p>html访问/img/</p>
</li>
</ol>
<h3 id="properties配置文件"><a href="#properties配置文件" class="headerlink" title="properties配置文件"></a>properties配置文件</h3><ol>
<li></li>
</ol>
<h3 id="nginx"><a href="#nginx" class="headerlink" title="nginx"></a>nginx</h3><ol>
<li></li>
</ol>
<h3 id="阿里云OSS"><a href="#阿里云OSS" class="headerlink" title="阿里云OSS"></a>阿里云OSS</h3><ol>
<li><p>依赖</p>
</li>
<li><p>配置</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliyun.oss<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aliyun-sdk-oss<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>代码</p>
<ol>
<li><p>配置类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConstantPropertiesUtils</span> <span class="keyword">implements</span> <span class="title">InitializingBean</span> </span>&#123; <span class="meta">@Value(&quot;$&#123;aliyun.oss.file.endpoint&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String endpoint; <span class="meta">@Value(&quot;$&#123;aliyun.oss.file.keyid&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String keyId; <span class="meta">@Value(&quot;$&#123;aliyun.oss.file.keysecret&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String keySecret; <span class="meta">@Value(&quot;$&#123;aliyun.oss.file.bucketname&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String bucketName;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String END_POIND;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String ACCESS_KEY_ID;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String ACCESS_KEY_SECRET;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String BUCKET_NAME;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterPropertiesSet</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        END_POIND = endpoint;</span><br><span class="line">        ACCESS_KEY_ID = keyId;</span><br><span class="line">        ACCESS_KEY_SECRET = keySecret;</span><br><span class="line">        BUCKET_NAME = bucketName;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>上传</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">uploadFileAvatar</span><span class="params">(MultipartFile file)</span> </span>&#123;</span><br><span class="line">       <span class="comment">// 工具类获取值</span></span><br><span class="line">       String endpoint = OssConfig.END_POIND;</span><br><span class="line">       String bucketName = OssConfig.BUCKET_NAME;</span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           <span class="comment">// 创建OSS实例。</span></span><br><span class="line">           OSS ossClient = <span class="keyword">new</span> OSSClientBuilder().build(endpoint,</span><br><span class="line">                   OssConfig.ACCESS_KEY_ID, OssConfig.ACCESS_KEY_SECRET);</span><br><span class="line">           <span class="comment">//获取文件名称</span></span><br><span class="line">           String fileName =getFileName(file.getOriginalFilename());</span><br><span class="line">           fileName=<span class="string">&quot;test.jpg&quot;</span>;</span><br><span class="line">           <span class="comment">//第一个参数  Bucket名称 文件路径  文件流</span></span><br><span class="line">           ossClient.putObject(bucketName, fileName, file.getInputStream());</span><br><span class="line">           ossClient.shutdown();  <span class="comment">// 关闭OSSClient。</span></span><br><span class="line">           <span class="comment">//把上传之后文件路径返回</span></span><br><span class="line">           <span class="comment">//需要把上传到阿里云oss路径手动拼接出来</span></span><br><span class="line">           String url = <span class="string">&quot;https://&quot;</span> + bucketName + <span class="string">&quot;.&quot;</span> + endpoint + <span class="string">&quot;/&quot;</span> + fileName;</span><br><span class="line">           System.out.println(url);<span class="comment">//https://job-wyg.oss-cn-beijing.aliyuncs.com/test.jpg</span></span><br><span class="line">           <span class="keyword">return</span> url;</span><br><span class="line">       &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">           e.printStackTrace();</span><br><span class="line">           <span class="keyword">return</span> <span class="keyword">null</span>;&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ol>
]]></content>
      <categories>
        <category>组件</category>
      </categories>
  </entry>
  <entry>
    <title>内存</title>
    <url>/2022/05/07/408/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E5%86%85%E5%AD%98/</url>
    <content><![CDATA[<h2 id="一、内存"><a href="#一、内存" class="headerlink" title="一、内存"></a>一、内存</h2><h3 id="1-1-虚拟内存"><a href="#1-1-虚拟内存" class="headerlink" title="1.1 虚拟内存"></a>1.1 虚拟内存</h3><blockquote>
<p>虚拟网络的概念就是看着互联的网络其实并不直接<strong>物理互联</strong>，而是通过ip协议和路由器来<strong>逻辑互联</strong></p>
<p>虚拟内存的概念类似。</p>
<ol>
<li>将<code>内存碎片</code>和部分<code>磁盘</code>逻辑组合，看着就像是连续的内存。也就是说实际的内存地址不是真正的物理内存地址，而可以通过映射来找到对应物理地址</li>
<li>每个进程创建的时候都会被分配一个1G大小的虚拟内存，这个虚拟就是虚的意思。</li>
<li></li>
</ol>
</blockquote>
<h4 id="1-1-1-解决的问题"><a href="#1-1-1-解决的问题" class="headerlink" title="1.1.1 解决的问题"></a>1.1.1 解决的问题</h4><ol>
<li>内存碎片问题：内存分段+内存分页+内存映射</li>
<li>内存读写效率问题</li>
<li>内存权限问题：界限寄存器</li>
<li>内存空闲问题：内存读写也有二八定律，八成的内存都处于空闲，可以放进磁盘</li>
</ol>
<h4 id="1-1-2-内存管理"><a href="#1-1-2-内存管理" class="headerlink" title="1.1.2 内存管理"></a>1.1.2 内存管理</h4><blockquote>
<p>物理地址 = 虚拟地址 + 基址（基址寄存器）</p>
</blockquote>
<ol>
<li><p><strong>寻址</strong></p>
<p>该功能由<strong>内存管理单元MMU</strong>完成，对用户透明。</p>
</li>
<li><p>权限</p>
<p>该功能由<strong>界限寄存器</strong>完成，限制进程内存上限，一个进程最大内存为1G </p>
</li>
<li></li>
</ol>
<h3 id="1-2-内存分页"><a href="#1-2-内存分页" class="headerlink" title="1.2 内存分页"></a>1.2 内存分页</h3><p>虚拟地址=<strong>虚拟页号</strong> + <strong>页内偏移量</strong></p>
<h4 id="1-2-1-页表"><a href="#1-2-1-页表" class="headerlink" title="1.2.1 页表"></a>1.2.1 页表</h4><blockquote>
<p>20位页表项+12位页内地址=32位</p>
</blockquote>
<h5 id="1-2-1-1-大小计算"><a href="#1-2-1-1-大小计算" class="headerlink" title="1.2.1.1 大小计算"></a>1.2.1.1 大小计算</h5><ol>
<li>页大小一般为4KB，4GB内存计算机需要记录1M个页</li>
<li>页映射关系存储在<strong>页表</strong></li>
<li>页表的每个映射关系叫<strong>页表项</strong></li>
<li>页表项大小为4B，一个页表大小为1M*4B=4MB，</li>
</ol>
<h5 id="1-2-1-2-问题"><a href="#1-2-1-2-问题" class="headerlink" title="1.2.1.2 问题"></a>1.2.1.2 问题</h5><p>对进程而言</p>
<ol>
<li>每个进程都有自己的页表，所以100个进程就需要400MB的页表内存，造成了极大的浪费</li>
<li>这也是切换进程效率低于线程的原因</li>
</ol>
<h4 id="1-2-2-多级页表"><a href="#1-2-2-多级页表" class="headerlink" title="1.2.2 多级页表"></a>1.2.2 多级页表</h4><blockquote>
<p>10位页目录+10位页表项+12位页内地址=32位</p>
</blockquote>
<ol>
<li>1K个页表目录，每个页表目录有1K个页表项，总共还是<strong>1M</strong>个页表项</li>
<li>页目录大小：1K*4B=4KB，页表项大小还是4MB</li>
<li>优势：只有当前进程使用到了对应的内存才创建该页目录的页表项，所以极限情况下只占4KB，也就是著有页表目录需要创建。</li>
</ol>
<h3 id="1-3-缺页"><a href="#1-3-缺页" class="headerlink" title="1.3 缺页"></a>1.3 缺页</h3><p>当数据存在虚拟内存存于磁盘的时候，就会发生缺页。有待商榷</p>
]]></content>
      <categories>
        <category>操作系统</category>
      </categories>
  </entry>
  <entry>
    <title>进程</title>
    <url>/2022/03/30/408/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E8%BF%9B%E7%A8%8B/</url>
    <content><![CDATA[<p>`</p>
<h2 id="一、同步、异步与阻塞、非阻塞"><a href="#一、同步、异步与阻塞、非阻塞" class="headerlink" title="一、同步、异步与阻塞、非阻塞"></a>一、同步、异步与阻塞、非阻塞</h2><p><a href="https://www.zhihu.com/question/19732473">参考</a></p>
<h3 id="同步、异步"><a href="#同步、异步" class="headerlink" title="同步、异步"></a>同步、异步</h3><ul>
<li><p>所谓同步，就是在发出一个<em>调用</em>时，在没有得到结果之前，该<em>调用</em>就不返回。但是一旦调用返回，就得到返回值，<br>换句话说，就是由调用者主动等待这个<em>调用</em>的结果。</p>
</li>
<li><p>而异步则是相反，调用在发出之后，这个调用就直接返回了，所以没有返回结果。换句话说，当一个异步过程调用发出后，调用者不会立刻得到结果。而是在<em>调用</em>发出后，<em>被调用者</em>通过状态、通知来通知调用者，或通过回调函数处理这个调用。</p>
</li>
<li><p>同步</p>
</li>
<li><p>异步: 雇一个新的线程callBack</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Response res;</span><br><span class="line"><span class="keyword">new</span> Thread(()-&gt;&#123;</span><br><span class="line">    res=requset();</span><br><span class="line">	callBack();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="阻塞、非阻塞"><a href="#阻塞、非阻塞" class="headerlink" title="阻塞、非阻塞"></a>阻塞、非阻塞</h3><ul>
<li><p>阻塞就是</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Object result=doAndwaitResult();</span><br><span class="line"><span class="function">Object <span class="title">doAndwaitResult</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.wait();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>非阻塞就是</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">    Object result=<span class="keyword">new</span> Object();</span><br><span class="line">    getResource(result);</span><br><span class="line">    <span class="keyword">while</span>((result=testResult())!=<span class="keyword">null</span>)&#123;</span><br><span class="line">        doOther();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="二、进程"><a href="#二、进程" class="headerlink" title="二、进程"></a>二、进程</h2><h3 id="2-1-进程状态"><a href="#2-1-进程状态" class="headerlink" title="2.1 进程状态"></a>2.1 进程状态</h3><h4 id="2-1-1-五状态"><a href="#2-1-1-五状态" class="headerlink" title="2.1.1 五状态"></a>2.1.1 五状态</h4><p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20220325232538100.png" alt="image-20220325232538100"></p>
<h4 id="2-1-2-挂起状态"><a href="#2-1-2-挂起状态" class="headerlink" title="2.1.2 挂起状态"></a>2.1.2 挂起状态</h4><blockquote>
<p>​    被阻塞状态的进程占用着物理内存就一种浪费物理内存的行为，在虚拟内存管理的操作系统中，通常会把阻塞状态的进程的物理内存空间换出到硬盘，等需要再次运行的时候，再从硬盘换入到物理内存</p>
</blockquote>
<p><strong>描述进程没有占用实际的物理内存空间的情况，这个状态就是挂起状态</strong></p>
<ul>
<li>阻塞挂起状态：进程在外存（硬盘）并等待某个事件的出现；</li>
<li>就绪挂起状态：进程在外存（硬盘），但只要进入内存，即刻立刻运行；</li>
<li>通过 sleep 让进程间歇性挂起，其工作原理是设置一个定时器，到期后唤醒进程</li>
<li>处于挂起的进程进入<strong>等待队列</strong>，等待某个事件发生</li>
</ul>
<h4 id="2-1-3-七状态"><a href="#2-1-3-七状态" class="headerlink" title="2.1.3 七状态"></a>2.1.3 七状态</h4><p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20220325232849106.png" alt="image-20220325232849106"></p>
<h3 id="2-2-进程控制"><a href="#2-2-进程控制" class="headerlink" title="2.2 进程控制"></a>2.2 进程控制</h3><blockquote>
<p>用进程控制块（process control block，PCB）数据结构来描述进程，是进程存在的唯一标识</p>
</blockquote>
<h4 id="2-2-1-PCB-信息"><a href="#2-2-1-PCB-信息" class="headerlink" title="2.2.1 PCB 信息"></a>2.2.1 PCB 信息</h4><ul>
<li>进程标识符：标识各个进程，每个进程都有一个并且唯一的标识符；</li>
<li>用户标识符：进程归属的用户，用户标识符主要为共享和保护服务；</li>
<li>进程当前状态，如 new、ready、running、waiting 或 blocked 等；</li>
<li>有关内存地址空间或虚拟地址空间的信息，所打开文件的列表和所使用的 I/O 设备信息。</li>
<li>CPU 中各个寄存器的值，当进程被切换时，CPU 的状态信息都会被保存在相应的 PCB 中，以便进程<br>重新执行时，能从断点处继续执行</li>
</ul>
<h4 id="2-2-2-PCB-连接"><a href="#2-2-2-PCB-连接" class="headerlink" title="2.2.2 PCB 连接"></a>2.2.2 PCB 连接</h4><blockquote>
<p>通常是通过链表的方式进行组织，把具有相同状态的进程链在一起，组成各种队列。</p>
</blockquote>
<ul>
<li>将所有处于就绪状态的进程链在一起，称为就绪队列</li>
<li>把所有因等待某事件而处于等待状态的进程链在一起就组成各种阻塞队列</li>
</ul>
<h4 id="2-2-3-进程阻塞"><a href="#2-2-3-进程阻塞" class="headerlink" title="2.2.3 进程阻塞"></a>2.2.3 进程阻塞</h4><p>阻塞状态的进程是绝对不可能叫醒自己的</p>
<h4 id="2-2-4-进程唤醒"><a href="#2-2-4-进程唤醒" class="headerlink" title="2.2.4 进程唤醒"></a>2.2.4 进程唤醒</h4><blockquote>
<p>​    如某进程正在等待 I/O 事件，需由别的进程发消息给它，则只有当该进程所期待的事件出现时，才由发<br>现者进程用唤醒语句叫醒它</p>
</blockquote>
<h4 id="2-2-5-进程终止"><a href="#2-2-5-进程终止" class="headerlink" title="2.2.5 进程终止"></a>2.2.5 进程终止</h4><p>进程可以有 3 种终止方式：正常结束、异常结束以及外界干预（信号 kill 掉）。</p>
<h2 id="三、线程"><a href="#三、线程" class="headerlink" title="三、线程"></a>三、线程</h2><h4 id="3-1-原因"><a href="#3-1-原因" class="headerlink" title="3.1 原因"></a>3.1 原因</h4><ol>
<li>开销问题</li>
<li>内存共享问题(进程间通信，线程间通信)</li>
</ol>
<h4 id="3-2-三种线程"><a href="#3-2-三种线程" class="headerlink" title="3.2 三种线程"></a>3.2 三种线程</h4><ol>
<li>用户线程</li>
<li>内核线程</li>
<li>轻量级</li>
</ol>
<h4 id="3-3-线程切换"><a href="#3-3-线程切换" class="headerlink" title="3.3 线程切换"></a>3.3 线程切换</h4><p>线程切换时，虚拟内存这些共享的资源就保持不变，只需要切换线程的私有数据、寄存器等不共享的数据；</p>
<h4 id="3-4-线程与进程对比"><a href="#3-4-线程与进程对比" class="headerlink" title="3.4 线程与进程对比"></a>3.4 线程与进程对比</h4><p>线程相比进程能减少开销，体现在：</p>
<ul>
<li>线程的<code>创建快</code>，因为进程在创建的过程中，还需要资源管理信息，比如内存管理信息、文<br>件管理信息，而线程在创建的过程中，不会涉及这些资源管理信息，而是共享它们；</li>
<li>线程的<code>终止快</code>，因为线程释放的资源相比进程少很多；</li>
<li>同一个进程内的线程切换比进程<code>切换快</code>，因为线程具有相同的地址空间（虚拟内存共享），这意味着<br>同一个进程的线程都具有同一个⻚表，那么在切换的时候不需要切换⻚表。而对于进程之间的切换，<br>切换的时候要把⻚表给切换掉，而⻚表的切换过程开销是比较大的；</li>
<li>由于同一进程的各线程间<code>共享内存</code>和文件资源，那么在线程之间数据传递的时候，就不需要经过内核<br>了，这就使得线程之间的数据交互效率更高了；</li>
</ul>
<h3 id=""><a href="#" class="headerlink" title=""></a></h3>]]></content>
      <categories>
        <category>操作系统</category>
      </categories>
  </entry>
  <entry>
    <title>TCP/IP</title>
    <url>/2022/04/03/408/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/tcpip/</url>
    <content><![CDATA[<h2 id="三次握手、四次挥手"><a href="#三次握手、四次挥手" class="headerlink" title="三次握手、四次挥手"></a>三次握手、四次挥手</h2><h4 id="为什么是三次握手"><a href="#为什么是三次握手" class="headerlink" title="为什么是三次握手"></a>为什么是三次握手</h4><p>“三次握手”的目的是</p>
<ul>
<li>为了防止已失效的连接请求报文段突然又传送到了服务端，因而产生错误</li>
<li>网络中存在延迟的重复分组</li>
</ul>
<p>​    已失效的连接请求报文段”的产生在这样一种情况下：client发出的第一个连接请求报文段并没有丢失，而是在某个网络结点长时间的<strong>滞留</strong>了，以致延误到连接释放以后的某个时间才到达server。本来这是一个早已失效的报文段。但server收到此失效的连接请求报文段后，就<strong>误认为是client再次发出的一个新的连接请求</strong>。于是就向client发出确认报文段，同意建立连接。假设不采用“三次握手”，那么只要server发出确认，新的连接就建立了。由于现在client并没有发出建立连接的请求，因此不会理睬server的确认，也不会向server发送数据。<strong>但server却以为新的运输连接已经建立</strong>，并一直等待client发来数据。这样，server的很多资源就白白浪费掉了</p>
<h4 id="为什么是四次挥手"><a href="#为什么是四次挥手" class="headerlink" title="为什么是四次挥手"></a>为什么是四次挥手</h4><p>A：我说完了<br>B：我知道了，等一下，我可能还没说完</p>
<blockquote>
<p>被动方此时有可能还有相应的数据报文需要发送，因此需要先发送ACK报文，告知主动方“我知道你想断开连接的请求了”。这样主动方便不会因为没有收到应答而继续发送断开连接的请求（即FIN报文）。</p>
</blockquote>
<p>B：我也说完了<br>A：我知道了，结束吧</p>
<h4 id="SYN和ACK"><a href="#SYN和ACK" class="headerlink" title="SYN和ACK"></a>SYN和ACK</h4><p>ACK 英文缩写: ACK (ACKnowledge Character） 中文译名: 确认字符  </p>
<p>SYN 包(synchronize 使同步)  SYN=1 表示 SYN 报文</p>
<p>序列号：    </p>
<p>确认应答号：</p>
<p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20220403122738600.png" alt="image-20220403122738600"></p>
<p>第一次握手：主机A发送位码为SYN=1，随机产生seq number=1234567的数据包到服务器，主机B由SYN=1知道，A要求建立联机；</p>
<p>第二次握手，主机B收到请求后要确认联机信息，向A发送ack number=(主机A的seq+1)，SYN=1,ACK=1，随机产生seq number=7654321的包；</p>
<p>第三次握手：主机A收到后检查ack number是否正确，即第一次发送的seq number+1，以及位码ACK是否为1，若正确，主机A会再发送ack number=（主机B的seq+1）,ACK=1，主机B收到后确认seq值与ACK=1则连接建立成功。</p>
]]></content>
  </entry>
  <entry>
    <title>前后端分离解决跨域</title>
    <url>/2022/04/27/javaWeb/cookie-session/%E8%B7%A8%E5%9F%9Fcookie/</url>
    <content><![CDATA[<h2 id="一、跨域"><a href="#一、跨域" class="headerlink" title="一、跨域"></a>一、跨域</h2><h3 id="1-1-跨域原因"><a href="#1-1-跨域原因" class="headerlink" title="1.1 跨域原因"></a>1.1 跨域原因</h3><ul>
<li><strong>浏览器</strong>的同源策略限制：浏览器核心、基本的安全功能，如果缺少了同源策略，则浏览器的正常功能可能都会受到影响。</li>
<li>同源策略：会阻止一个域的js和另外一个域的内容进行交互。http-host-port。</li>
<li>前后端分离：前后端的域不一致。</li>
</ul>
<h3 id="1-2-没有同源策略会引发的问题"><a href="#1-2-没有同源策略会引发的问题" class="headerlink" title="1.2 没有同源策略会引发的问题"></a>1.2 没有同源策略会引发的问题</h3><p>​    一个网站用户Bob可能正在浏览聊天论坛，而同时另一个用户Alice也在此论坛中，并且后者刚刚发布了一个具有Bob银行链接的图片消息。设想一下，Alice编写了一个在Bob的银行站点上进行取款的form提交的链接，并将此链接作为图片src。如果Bob的银行在cookie中保存他的授权信息，并且此cookie没有过期，那么当Bob的浏览器尝试装载图片时将提交这个取款form和他的cookie，这样在没经Bob同意的情况下便授权了这次事务。</p>
<ol>
<li>病毒网站对cookie、session的<a href="https://blog.csdn.net/qq_37493556/article/details/106734689?utm_medium=distribute.pc_aggpage_search_result.none-task-blog-2~aggregatepage~first_rank_ecpm_v1~rank_v31_ecpm-1-106734689.pc_agg_new_rank&utm_term=%E8%B7%A8%E5%9F%9F%E7%9A%84%E6%9C%AC%E8%B4%A8%E6%98%AF%E4%BB%80%E4%B9%88&spm=1000.2123.3001.4430">盗用</a></li>
<li>盗版网站对后台资源的复用</li>
</ol>
<h3 id="1-3-问题"><a href="#1-3-问题" class="headerlink" title="1.3 问题"></a>1.3 问题</h3><ol>
<li>前端后端的代码需要部署到同一台服务器问题的跨域</li>
<li>[前后端不同服务器]</li>
</ol>
<h2 id="二、解决"><a href="#二、解决" class="headerlink" title="二、解决"></a>二、解决</h2><h3 id="2-1-后端处理"><a href="#2-1-后端处理" class="headerlink" title="2.1 后端处理"></a>2.1 后端处理</h3><h4 id="前端请求"><a href="#前端请求" class="headerlink" title="前端请求"></a>前端请求</h4><blockquote>
<p> withCredentials: true</p>
</blockquote>
<ol>
<li><p>ajax</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">$.ajax(&#123;</span><br><span class="line">    <span class="attr">url</span>:bp+<span class="string">&quot;/user/test&quot;</span>,</span><br><span class="line"> <span class="attr">xhrFields</span>: &#123;</span><br><span class="line">        <span class="attr">withCredentials</span>: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">success</span>:<span class="function"><span class="keyword">function</span>(<span class="params">result</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(result);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">error</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li>
<li><p>axios</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> ax=axios.create(&#123;</span><br><span class="line">    <span class="attr">withCredentials</span>:<span class="literal">true</span>,</span><br><span class="line">&#125;)</span><br><span class="line">ax.get(bp+<span class="string">&quot;/user/test&quot;</span>).then(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="2-1-1-CrossOrigin注解"><a href="#2-1-1-CrossOrigin注解" class="headerlink" title="2.1.1 CrossOrigin注解"></a>2.1.1 CrossOrigin注解</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@CrossOrigin(origins = &quot;http://localhost&quot;,allowCredentials = &quot;true&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line"><span class="comment">//origins 是保证能跨域访问</span></span><br><span class="line">    <span class="comment">//allowCredentials 是保证sessionId 唯一</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-1-2-Filter配置"><a href="#2-1-2-Filter配置" class="headerlink" title="2.1.2 Filter配置"></a>2.1.2 Filter配置</h4><p>response的属性</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginFilter</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        response.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        response.setContentType(<span class="string">&quot;application/json; charset=utf-8&quot;</span>);</span><br><span class="line">        response.setHeader(<span class="string">&quot;Access-Control-Allow-Credentials&quot;</span>,<span class="string">&quot;true&quot;</span>);</span><br><span class="line">        response.setHeader(<span class="string">&quot;Access-Control-Allow-Origin&quot;</span>, <span class="string">&quot;http://127.0.0.1:*&quot;</span>);<span class="comment">//允许同机器下的q</span></span><br><span class="line">        response.setHeader(<span class="string">&quot;Access-Control-Allow-Headers&quot;</span>, <span class="string">&quot;Origin, X-Requested-With, Content-Type, Accept&quot;</span>);</span><br><span class="line">        response.setHeader(<span class="string">&quot;Access-Control-Allow-Methods&quot;</span>, <span class="string">&quot;GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-1-3-webmvcConfig"><a href="#2-1-3-webmvcConfig" class="headerlink" title="2.1.3 webmvcConfig"></a>2.1.3 webmvcConfig</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addCorsMappings</span><span class="params">(CorsRegistry registry)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//添加映射路径</span></span><br><span class="line">        registry.addMapping(<span class="string">&quot;/**&quot;</span>)</span><br><span class="line">                <span class="comment">//是否发送Cookie</span></span><br><span class="line">                .allowCredentials(<span class="keyword">true</span>)</span><br><span class="line"><span class="comment">//                //设置放行哪些原始域   SpringBoot2.4.4下低版本使用.allowedOrigins(&quot;*&quot;)</span></span><br><span class="line">               <span class="comment">// .allowedOrigins(&quot;http://localhost&quot;);  发现直接注释掉能生效</span></span><br><span class="line"><span class="comment">//                .allowedMethods(&quot;*&quot;) //或者放行全部</span></span><br><span class="line">                <span class="comment">//放行哪些原始请求头部信息</span></span><br><span class="line"><span class="comment">//                .allowedHeaders(&quot;*&quot;)</span></span><br><span class="line">                <span class="comment">//暴露哪些原始请求头部信息</span></span><br><span class="line"><span class="comment">//                .exposedHeaders(&quot;*&quot;);</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-1-4-CrosFilter-Bean"><a href="#2-1-4-CrosFilter-Bean" class="headerlink" title="2.1.4 CrosFilter Bean"></a>2.1.4 CrosFilter Bean</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GlobalCorsConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CorsFilter <span class="title">corsFilter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//1. 添加 CORS配置信息</span></span><br><span class="line">        CorsConfiguration config = <span class="keyword">new</span> CorsConfiguration();</span><br><span class="line">        <span class="comment">//放行哪些原始域</span></span><br><span class="line">        config.addAllowedOrigin(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">        <span class="comment">//是否发送 Cookie</span></span><br><span class="line">        config.setAllowCredentials(<span class="keyword">true</span>);</span><br><span class="line">        <span class="comment">//放行哪些请求方式</span></span><br><span class="line">        config.addAllowedMethod(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">        <span class="comment">//放行哪些原始请求头部信息</span></span><br><span class="line">        config.addAllowedHeader(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">        <span class="comment">//暴露哪些头部信息</span></span><br><span class="line">        config.addExposedHeader(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">        <span class="comment">//2. 添加映射路径</span></span><br><span class="line">        UrlBasedCorsConfigurationSource corsConfigurationSource = <span class="keyword">new</span> UrlBasedCorsConfigurationSource();</span><br><span class="line">        corsConfigurationSource.registerCorsConfiguration(<span class="string">&quot;/**&quot;</span>,config);</span><br><span class="line">        <span class="comment">//3. 返回新的CorsFilter</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> CorsFilter(corsConfigurationSource);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="nginx代理"><a href="#nginx代理" class="headerlink" title="nginx代理"></a>nginx代理</h3><h3 id="token"><a href="#token" class="headerlink" title="token"></a>token</h3>]]></content>
      <categories>
        <category>javaWeb</category>
      </categories>
  </entry>
  <entry>
    <title>request</title>
    <url>/2021/11/12/javaWeb/web%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6/response/</url>
    <content><![CDATA[<p>[toc]</p>
<h3 id="一、Response响应"><a href="#一、Response响应" class="headerlink" title="一、Response响应"></a>一、Response响应</h3><h4 id="1-设置响应消息"><a href="#1-设置响应消息" class="headerlink" title="1. 设置响应消息"></a>1. 设置响应消息</h4><ol>
<li><p>响应行</p>
<ol>
<li>setStatus(200)</li>
</ol>
</li>
<li><p>响应头</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">set<span class="constructor">Header(<span class="params">string</span> <span class="params">name</span>,<span class="params">string</span> <span class="params">value</span>)</span></span><br></pre></td></tr></table></figure></li>
<li><p>响应体(stream)</p>
<ol>
<li>获取输出流 PrintWriter</li>
<li>调用outStream输出到浏览器</li>
</ol>
</li>
</ol>
<span id="more"></span>

<h4 id="2-重定向步骤"><a href="#2-重定向步骤" class="headerlink" title="2. 重定向步骤"></a>2. 重定向步骤</h4><ol>
<li><p>A没干–&gt;302+url of B–&gt;但是告诉浏览器B能干</p>
</li>
<li><p>```java<br>resp.sendRedirect(“/d6”);</p>
<figure class="highlight clean"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="number">3.</span> 异步编程：get1--&gt;post1--&gt;重定向--&gt;post1--&gt;get1;post2....</span><br><span class="line"></span><br><span class="line"><span class="number">4.</span> 重定向是两次请求，所以重定向地址不是request域，也因为没传入req,resp.</span><br><span class="line"></span><br><span class="line"><span class="number">5.</span> d5-&gt;d6-&gt;d5不会让服务器崩溃，会让他一直工作</span><br><span class="line"></span><br><span class="line">### 二、响应数据到浏览器</span><br><span class="line"></span><br><span class="line">#### <span class="number">1.</span> 响应格式</span><br><span class="line"></span><br><span class="line"><span class="number">1.</span> String/txt/html</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>PrintWriter printWriter=resp.getWriter();<br>printWriter.write(“<h>hello-write</h>“);</p>
<figure class="highlight autohotkey"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="number">2</span>. 乱码：编码和解码的标准不一样。</span><br><span class="line"></span><br><span class="line">   <span class="number">1</span>. 设置resp的编码格式</span><br><span class="line"></span><br><span class="line">   <span class="number">2</span>. 告诉浏览器解码方式(建议)</span><br><span class="line"></span><br><span class="line">      ```java</span><br><span class="line">      resp.setHeader(<span class="string">&quot;content-type&quot;</span>,<span class="string">&quot;text/html;charaset=utf-8&quot;</span>)<span class="comment">;</span></span><br></pre></td></tr></table></figure></li>
<li><p>字节流</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ServletOutputStream outputStream=resp.getOutputStream();</span><br><span class="line">outputStream.write(<span class="string">&quot;你不好&quot;</span>.getBytes(StandardCharsets.UTF_8));</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="2-制作验证码"><a href="#2-制作验证码" class="headerlink" title="2. 制作验证码"></a>2. 制作验证码</h4><ol>
<li><p>简单图片</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">BufferedImage image=<span class="keyword">new</span> BufferedImage(w,h,BufferedImage.TYPE_INT_RGB);<span class="comment">//创建图片对象</span></span><br><span class="line"><span class="keyword">int</span> n=<span class="number">4</span>;<span class="comment">//画布加入4个字母</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">	Random ran=<span class="keyword">new</span> Random();</span><br><span class="line">	<span class="keyword">int</span> index=ran.nextInt(<span class="number">26</span>);</span><br><span class="line">	<span class="keyword">char</span> c= (<span class="keyword">char</span>) (index+<span class="string">&#x27;A&#x27;</span>);</span><br><span class="line">	g.drawString(c+<span class="string">&quot;&quot;</span>,<span class="number">20</span>+w/<span class="number">5</span>*i,h/<span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line">ImageIO.write(image,<span class="string">&quot;jpg&quot;</span>,resp.getOutputStream());<span class="comment">//传入到流</span></span><br></pre></td></tr></table></figure></li>
<li><p>点击图片刷新–&gt;前端调用刷新函数</p>
</li>
</ol>
<h4 id="3-下载资源步骤-content-disposition-附件-attachment"><a href="#3-下载资源步骤-content-disposition-附件-attachment" class="headerlink" title="3. 下载资源步骤(content-disposition: 附件-attachment;)"></a>3. 下载资源步骤(content-disposition: 附件-attachment;)</h4><ol>
<li>href—&gt;servlet, 超链接指向servlet</li>
<li>设置响应头：文件类型+打开方式</li>
<li>servlet.context.getRealName，通过context获取真实路径</li>
<li>OutStream(InputStream(RealName)) 传到response的输出流</li>
<li>资源需要放在web下，而不是WEB-INF下</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String filename = req.getParameter(<span class="string">&quot;filename&quot;</span>);</span><br><span class="line">String mimeType = context.getMimeType(filename);</span><br><span class="line">resp.setHeader(<span class="string">&quot;content-type&quot;</span>,mimeType);</span><br><span class="line">resp.setHeader(<span class="string">&quot;content-disposition&quot;</span>,<span class="string">&quot;attachment;filename=&quot;</span>+filename);</span><br><span class="line">String realPath1 = context.getRealPath(filename);</span><br><span class="line">FileInputStream inputStream = <span class="keyword">new</span> FileInputStream(realPath1);</span><br><span class="line">ServletOutputStream outputStream = resp.getOutputStream();</span><br><span class="line"><span class="keyword">byte</span>[] buffers = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span> * <span class="number">8</span>];</span><br><span class="line"><span class="keyword">int</span> len = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> ((len = inputStream.read(buffers)) != -<span class="number">1</span>) &#123;outputStream.write(buffers,<span class="number">0</span>,len);</span><br><span class="line">                                                &#125;<span class="comment">//访问/d8?filename=a.jpg</span></span><br></pre></td></tr></table></figure>



]]></content>
      <categories>
        <category>javaWeb</category>
      </categories>
  </entry>
  <entry>
    <title>request</title>
    <url>/2022/01/21/javaWeb/web%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6/request/</url>
    <content><![CDATA[<p>[toc]</p>
<h2 id="一、request请求"><a href="#一、request请求" class="headerlink" title="一、request请求"></a>一、request请求</h2><h5 id="1-一次请求响应步骤"><a href="#1-一次请求响应步骤" class="headerlink" title="1. 一次请求响应步骤"></a>1. 一次请求响应步骤</h5><ol>
<li><p>tomcat会根据请求url的路径创建servlet对象</p>
</li>
<li><p>tomcat创建Request和Response对象，并且request封装请求消息数据</p>
</li>
<li><p>tomcat将request和response两个对象传给service，并调用service方法</p>
</li>
<li><p>service根据request获取请求消息，使用response设置响应消息</p>
</li>
<li><p>服务器再给浏览器响应之前，会从response获取响应消息</p>
</li>
<li><p>其中resp.getWriter.write(“html”)会返回一个页面</p>
<span id="more"></span></li>
</ol>
<h2 id="二、API-HttpServletRequest"><a href="#二、API-HttpServletRequest" class="headerlink" title="二、API  (HttpServletRequest )"></a>二、API  (HttpServletRequest )</h2><p><a href="https://www.cnblogs.com/youngchaolin/p/11526858.html">参考</a></p>
<h3 id="2-1-获取客户端信息"><a href="#2-1-获取客户端信息" class="headerlink" title="2.1 获取客户端信息"></a>2.1 获取客户端信息</h3><ol>
<li>request.getRequestURL   //返回客户端发出请求完整URL</li>
<li>request.getRequestURI   //返回请求行中的资源名部分</li>
<li>request.getQueryString   //返回请求行中的参数部分</li>
<li>request.getRemoteAddr   // 返回发出请求的客户机的IP地址</li>
<li>request.getMethod – 得到客户机请求方式</li>
<li>getContextPath – 获得当前web应用虚拟目录名称 – 在写路径时不要将web应用的虚拟路径的名称写死, 应该在需要写web应用的名称的地方通过getContextPath方法动态获取</li>
<li>request.getRemotePort();//远程端口，即客户端端口</li>
<li>request.getRemoteUser();//远程用户</li>
<li>request.getRequestedSessionId();//客户端的Session的ID</li>
</ol>
<h3 id="2-2-获取请求头信息"><a href="#2-2-获取请求头信息" class="headerlink" title="2.2 获取请求头信息"></a>2.2 获取请求头信息</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">getHeader(name) <span class="function">String</span></span><br><span class="line"><span class="function"><span class="title">getHeaders</span><span class="params">(name)</span> Enumeration&lt;String&gt;</span></span><br><span class="line"><span class="function">getHeaderNames Enumeration&lt;String&gt;</span></span><br><span class="line"><span class="function"><span class="title">getIntHeader</span><span class="params">(name)</span> <span class="keyword">int</span></span></span><br><span class="line"><span class="function"><span class="title">getDateHeader</span><span class="params">(name)</span> <span class="title">long</span><span class="params">(日期对应毫秒)</span></span></span><br></pre></td></tr></table></figure>

<h3 id="2-3-获取请求参数"><a href="#2-3-获取请求参数" class="headerlink" title="2.3 获取请求参数"></a>2.3 获取请求参数</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">getParameter(String name) --- String 通过name获得值</span><br><span class="line">getParameterValues(String name) --- String[ ] 通过name获得多值 <span class="function">checkbox</span></span><br><span class="line"><span class="function"><span class="title">getParameterMap</span><span class="params">()</span> --- Map&lt;String,String[ ]&gt; key :name value: 多值 将查询的参数保存在一个Map中</span></span><br><span class="line"><span class="function"><span class="title">getParameterNames</span><span class="params">()</span> --- Enumeration&lt;String&gt; 获得所有name</span></span><br></pre></td></tr></table></figure>



<h3 id="2-4-请求转发"><a href="#2-4-请求转发" class="headerlink" title="2.4 请求转发"></a>2.4 请求转发</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span> <span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span>&#123;</span><br><span class="line">    RequestDispatcher dispatcher = request.getRequestDispatcher(<span class="string">&quot;/RequestDemo5&quot;</span>);</span><br><span class="line">    dispatcher.forward(request, response);<span class="comment">//request,responese的请求转发会清空write</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">request.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);<span class="comment">//设置request编码方式</span></span><br><span class="line">request.getLocalAddr();<span class="comment">//获取本地IP，即服务器IP</span></span><br><span class="line">request.getLocalName();<span class="comment">//获取本地名称，即服务器名称</span></span><br><span class="line">request.getLocalPort();<span class="comment">//获取本地端口号，即Tomcat端口号</span></span><br><span class="line">request.getLocale();<span class="comment">//用户的语言环境</span></span><br><span class="line">request.getContextPath();<span class="comment">//context路径</span></span><br><span class="line">request.getMethod();<span class="comment">//GET还是POST</span></span><br><span class="line">request.getProtocol();<span class="comment">//协议，http协议</span></span><br><span class="line">request.getQueryString();<span class="comment">//查询字符串</span></span><br><span class="line">request.getRemoteAddr();<span class="comment">//远程IP，即客户端IP</span></span><br><span class="line">request.getRemotePort();<span class="comment">//远程端口，即客户端端口</span></span><br><span class="line">request.getRemoteUser();<span class="comment">//远程用户</span></span><br><span class="line">request.getRequestedSessionId();<span class="comment">//客户端的Session的ID</span></span><br><span class="line">request.getRequestURI();<span class="comment">//用户请求的URL</span></span><br><span class="line">request.getScheme();<span class="comment">//协议头，例如http</span></span><br><span class="line">request.getServerName();<span class="comment">//服务器名称</span></span><br><span class="line">request.getServerPort();<span class="comment">//服务器端口</span></span><br><span class="line">request.getServletPath();<span class="comment">//Servlet路径</span></span><br></pre></td></tr></table></figure>

<h2 id="三、Request功能-获取请求消息"><a href="#三、Request功能-获取请求消息" class="headerlink" title="三、Request功能-获取请求消息"></a>三、Request功能-获取请求消息</h2><h4 id="1-获取请求行"><a href="#1-获取请求行" class="headerlink" title="(1)获取请求行"></a>(1)获取请求行</h4><p>GET /login.html HTTP/1.1</p>
<ol>
<li><p>获取虚拟目录</p>
<p>String getContextPath</p>
</li>
<li><p>获取请求URL</p>
<p>getRequestURL </p>
<p><a href="http://localhost:8080/d2">http://localhost:8080/d2</a></p>
</li>
<li><p>获取请求URI</p>
<p>getRequestURI</p>
<p>d2</p>
</li>
<li><p>获取请求方式：</p>
<p>String getMethod</p>
<p>GET</p>
</li>
<li><p>获取请求参数</p>
<p>String getQueryString</p>
<p>username=aaa</p>
</li>
<li><p>获取Servlet路径</p>
<p>getServletPath</p>
<p>/d2</p>
</li>
<li><p>获取Ip地址</p>
<p>getRemoteAddr</p>
<p>0:0:0:0:0:0:0:1</p>
</li>
</ol>
<h4 id="2-获取请求头数据"><a href="#2-获取请求头数据" class="headerlink" title="(2)获取请求头数据"></a>(2)获取请求头数据</h4><ol>
<li><p>通过请求头获取请求头值</p>
<p>getHeader(string name)</p>
</li>
<li><p>获取所有请求头名称</p>
<p>Enumeration getHeaderNames</p>
<p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20211003223205963.png" alt="image-20211003223205963"></p>
</li>
</ol>
<h4 id="3-获取请求体信息-只有Post才有"><a href="#3-获取请求体信息-只有Post才有" class="headerlink" title="(3)获取请求体信息(只有Post才有)"></a>(3)获取请求体信息(只有Post才有)</h4><ol>
<li><p>获取字符流/字节流</p>
<p>getReader/getInputStream</p>
</li>
<li><p>从流中解析得数据</p>
</li>
</ol>
<h4 id="4-其他功能"><a href="#4-其他功能" class="headerlink" title="(4)其他功能"></a>(4)其他功能</h4><h5 id="4-1-获取请求参数通用方式-无论get-post，优点：方法统一"><a href="#4-1-获取请求参数通用方式-无论get-post，优点：方法统一" class="headerlink" title="4.1 获取请求参数通用方式(无论get/post，优点：方法统一)"></a>4.1 获取请求参数通用方式(无论get/post，优点：方法统一)</h5><ol>
<li><p>根据参数名称获取参数值</p>
<p>getParameter(string name)</p>
</li>
<li><p>根据参数名称获取数组getParameterValues(string name)</p>
</li>
<li><p>获取所有参数名称</p>
<p>getParamaterNames</p>
</li>
<li><p>获取参数map集合</p>
<p>getParameterMap</p>
</li>
</ol>
<h5 id="4-2请求转发"><a href="#4-2请求转发" class="headerlink" title="4.2请求转发"></a>4.2请求转发</h5><p>服务器资源跳转方式</p>
<ol>
<li>获取转发对象RequestDispatcher getRequestDispatcher(string path)</li>
<li>调用对象方法<ol>
<li>forword(req,resp): 请求抓发,第一个servlet只Writer了resp的头,</li>
<li>include( req , resp): 请求包含—两个请求都Writer了resp体</li>
</ol>
</li>
<li>特点<ol>
<li>浏览器只有一次请求，其他请求在服务器进行</li>
<li>浏览器地址不变</li>
<li>只能转发得到当前服务器内部资源</li>
</ol>
</li>
</ol>
<h5 id="4-3-共享数据"><a href="#4-3-共享数据" class="headerlink" title="4.3 共享数据"></a>4.3 共享数据</h5><ol>
<li>域对象：一个有作用范围的对象，在这个范围能够共享数据</li>
<li>request对象：代表一次请求的范围，一般用于请求转发多个资源中共享数据。</li>
<li>共享方法：<ol>
<li>setAttribute(“age”,obj)</li>
<li></li>
</ol>
</li>
</ol>
<h5 id="4-4-获取ServletContext-getServletContext"><a href="#4-4-获取ServletContext-getServletContext" class="headerlink" title="4.4 获取ServletContext getServletContext"></a>4.4 获取ServletContext getServletContext</h5><h2 id="四、方法"><a href="#四、方法" class="headerlink" title="四、方法"></a>四、方法</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">request.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);<span class="comment">//设置request编码方式</span></span><br><span class="line">request.getMethod();<span class="comment">//GET还是POST</span></span><br><span class="line">request.getQueryString();<span class="comment">//url请求参数 name=wang&amp;age=20</span></span><br><span class="line">request.getProtocol();<span class="comment">//协议，http协议</span></span><br><span class="line">request.getScheme();<span class="comment">//协议头，例如http</span></span><br><span class="line">request.getRequestURL();<span class="comment">//请求的绝对路径</span></span><br><span class="line">request.getRequestURI()<span class="comment">//相对资源路径/uri</span></span><br><span class="line">request.getContextPath();<span class="comment">//context路径</span></span><br><span class="line"></span><br><span class="line">request.getLocalAddr();<span class="comment">//获取本地IP，即服务器IP</span></span><br><span class="line">request.getLocalName();<span class="comment">//获取本地名称，即服务器名称</span></span><br><span class="line">request.getLocalPort();<span class="comment">//获取本地端口号，即Tomcat端口号</span></span><br><span class="line">request.getLocale();<span class="comment">//用户的语言环境</span></span><br><span class="line"></span><br><span class="line">request.getRemoteAddr();<span class="comment">//远程IP</span></span><br><span class="line">request.getRemoteHost();<span class="comment">//远程主机名</span></span><br><span class="line">request.getRemotePort();<span class="comment">//远程端口</span></span><br><span class="line">request.getRemoteUser();<span class="comment">//远程用户,null</span></span><br><span class="line"></span><br><span class="line">request.getRequestedSessionId();<span class="comment">//客户端的Session的ID</span></span><br><span class="line"></span><br><span class="line">request.getServerName();<span class="comment">//服务器名称</span></span><br><span class="line">request.getServerPort();<span class="comment">//服务器端口</span></span><br><span class="line">request.getServletPath();<span class="comment">//Servlet路径</span></span><br></pre></td></tr></table></figure>

<h3 id="请求参数"><a href="#请求参数" class="headerlink" title="请求参数"></a>请求参数</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">getParameter(String)方法(常用)  </span><br><span class="line">getParameterValues(String name)方法(常用)   </span><br><span class="line">getParameterNames()方法(不常用)</span><br><span class="line">Map&lt;String,String[]&gt; getParameterMap()方法(编写框架时常用)  </span><br></pre></td></tr></table></figure>

<h3 id="作为域对象"><a href="#作为域对象" class="headerlink" title="作为域对象"></a>作为域对象</h3><ul>
<li>setAttribute(String name,Object o)方法，将数据作为request对象的一个属性存放到request对象中，例如：request.setAttribute(“data”, data);</li>
<li>getAttribute(String name)方法，获取request对象的name属性的属性值，例如：request.getAttribute(“data”)</li>
<li>removeAttribute(String name)方法，移除request对象的name属性，例如：request.removeAttribute(“data”)</li>
<li>getAttributeNames方法，获取request对象的所有属性名，返回的是一个，例如：Enumeration<String> attrNames = request.getAttributeNames();</li>
</ul>
<h3 id="作为请求中间件"><a href="#作为请求中间件" class="headerlink" title="作为请求中间件"></a>作为请求中间件</h3><p>一个web资源收到客户端请求后，<strong>通知服务器去调用另外一个web资源</strong>进行处理，称之为请求转发/307。<br>　一个web资源收到客户端请求后，<strong>通知浏览器去访问另外一个web资源</strong>进行处理，称之为请求重定向/302。</p>
<h2 id="五、特"><a href="#五、特" class="headerlink" title="五、特"></a>五、特</h2><ol>
<li><p>request,responese的请求转发会清空write—&gt;2.4</p>
<p><strong>说明在转发前往response缓存中写入的数据，在转发后会被清空</strong>。</p>
</li>
</ol>
]]></content>
      <categories>
        <category>javaWeb</category>
      </categories>
  </entry>
  <entry>
    <title>servlet</title>
    <url>/2021/11/12/javaWeb/web%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6/servlet/</url>
    <content><![CDATA[<p>[toc]</p>
<h2 id="一、Servlet概述"><a href="#一、Servlet概述" class="headerlink" title="一、Servlet概述"></a>一、Servlet概述</h2><ol>
<li><p>server applet——&gt;运行在服务器的小程序</p>
</li>
<li><p>动态资源：java类若要一直运行在tomcat，那么它就得实现servlet规范(接口)，这样才能被tomcat识别。</p>
</li>
<li><p>servlet接口方法</p>
<ol>
<li><p>init: serlvet创建的时候运行，只运行一次,不是启动的时候，而是第一次访问的时候。</p>
</li>
<li><p>service:提供服务的方法，运行多次</p>
<figure class="highlight coq"><table><tr><td class="code"><pre><span class="line">访问mapping的</span><br><span class="line"><span class="number">8080</span>+虚拟目录+url-<span class="built_in">pattern</span></span><br><span class="line">就会运行该函数</span><br></pre></td></tr></table></figure>

<span id="more"></span></li>
<li><p>getServletInfo：获取serlvet版本信息</p>
</li>
<li><p>getServletConfig</p>
</li>
<li><p>destroy:正常关闭时运行一次</p>
</li>
</ol>
</li>
</ol>
<h2 id="二、Servlet配置"><a href="#二、Servlet配置" class="headerlink" title="二、Servlet配置"></a>二、Servlet配置</h2><ol>
<li><p>servlet.class.service(req,resp)</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(ServletRequest req ,ServletResponse resp)</span></span></span><br><span class="line"><span class="function"></span>&#123;System.out.println(<span class="string">&quot;servlet启动&quot;</span>);&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>注册servlet </p>
<ul>
<li><p>web.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>serveletName<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span><span class="comment">&lt;!--名字--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.wyg.web.servlet.ServletDemo<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span><span class="comment">&lt;!--servlet类--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span><span class="comment">&lt;!--映射--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>serveletName<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/demox1<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span><span class="comment">&lt;!--路径--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>注解配置</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@WebServlet( &quot;/s1&quot;)</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>可以加入映射数组</p>
<figure class="highlight ada"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;user/demo&quot;</span></span><br><span class="line"><span class="string">&quot;user/*&quot;</span> 通配符任意</span><br><span class="line"><span class="string">&quot;/*&quot;</span> 任意，优先级最低</span><br><span class="line"><span class="string">&quot;*.do&quot;</span>任意.<span class="keyword">do</span>结尾 </span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="三、原理步骤"><a href="#三、原理步骤" class="headerlink" title="三、原理步骤"></a>三、原理步骤</h2><ol>
<li>访问url</li>
<li>扫描mapping找到对应servlet.name进而找到servlet.class的全限定类名</li>
<li>反射class.forname(servlet.class).newInstance创建出对象servlet</li>
<li>调用servlet.service</li>
</ol>
<h2 id="四、servlet生命周期"><a href="#四、servlet生命周期" class="headerlink" title="四、servlet生命周期"></a>四、servlet生命周期</h2><ol>
<li><p>被创建加载：init 加载资源</p>
<p>默认第一次访问url</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">web.xml-&gt;指定启动时加载并赋予优先级，值为2表示可能是依赖其他servlet启动才能启动。</span><br><span class="line"><span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>2<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>被调用–&gt;service</p>
</li>
<li><p>被销毁–&gt;destory 释放资源</p>
</li>
</ol>
<h2 id="五、servlet体系结构"><a href="#五、servlet体系结构" class="headerlink" title="五、servlet体系结构"></a>五、servlet体系结构</h2><p>父子关系：接口Servlet–&gt;抽象GenericServlet–&gt;抽象HttpServlet</p>
<h4 id="genericServlet"><a href="#genericServlet" class="headerlink" title="genericServlet"></a>genericServlet</h4><ol>
<li>其他方法默认空实现</li>
<li>只需实现service方法</li>
</ol>
<h4 id="httpServlet"><a href="#httpServlet" class="headerlink" title="httpServlet:"></a>httpServlet:</h4><ol>
<li><p>url请求</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String method=req.<span class="function">getMethod</span></span><br><span class="line"><span class="function"><span class="title">if</span><span class="params">(method.eq(<span class="string">&quot;get&quot;</span>)</span>)...</span></span><br><span class="line"><span class="function"><span class="keyword">else</span>...</span></span><br></pre></td></tr></table></figure></li>
<li><p>这样每次都判断很麻烦，所以httpServlet对它进行了一个封装，这个封装就是重写service方法判断是get还是post,然后调用对应方法，只需重写doGet/doPost方法</p>
</li>
<li><p>默认deGet方法</p>
</li>
</ol>
<h2 id="六、注意"><a href="#六、注意" class="headerlink" title="六、注意"></a>六、注意</h2><ol>
<li>servlet是容易并发的对象(单例)，所以尽量不要定义成员变量，确保线程安全。</li>
<li>尽量不要再servlet定义成员变量，定义了也只用于读取。</li>
<li>url-pattern必须前缀”/“</li>
<li>servlet配置项地址：CATALINA_BASE(tomcat启动的时候输出)</li>
</ol>
]]></content>
  </entry>
  <entry>
    <title>过滤器</title>
    <url>/2022/04/26/javaWeb/web%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6/%E8%BF%87%E6%BB%A4%E5%99%A8/</url>
    <content><![CDATA[<p>[toc]</p>
<p><a href="https://mrbird.cc/Servlet-Jsp-note.html">参考</a></p>
<p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20220506211318674.png" alt="image-20220506211318674"></p>
<h3 id="创建过滤器"><a href="#创建过滤器" class="headerlink" title="创建过滤器"></a>创建过滤器</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String[] paths;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest request, ServletResponse response,</span></span></span><br><span class="line"><span class="params"><span class="function">                         FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">        HttpServletRequest req = (HttpServletRequest) request;</span><br><span class="line">        HttpServletResponse res = (HttpServletResponse) response;</span><br><span class="line">        String uri = req.getRequestURI();</span><br><span class="line">        <span class="keyword">for</span> (String path : paths) &#123;</span><br><span class="line">            <span class="keyword">if</span> (uri.contains(path)) &#123;</span><br><span class="line">                chain.doFilter(req, res);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//判断session中是否存在登录数据</span></span><br><span class="line">        HttpSession session = req.getSession();</span><br><span class="line">        <span class="comment">//模拟一个叫admin的账号</span></span><br><span class="line">        String admin = (String) session.getAttribute(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (admin == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">//没有登录，强制跳转到登录页</span></span><br><span class="line">            res.sendRedirect(req.getContextPath() + <span class="string">&quot;/login/toLogin.do&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//已登录，继续执行</span></span><br><span class="line">            chain.doFilter(req, res);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">        String excludePath = filterConfig.getInitParameter(<span class="string">&quot;excludePath&quot;</span>);</span><br><span class="line">        paths = excludePath.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="注册过滤器"><a href="#注册过滤器" class="headerlink" title="注册过滤器"></a>注册过滤器</h3><p>web.xml中配置Filter：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>loginFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>com.postar.servlet.LoginFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 设置要排除过滤的路径 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>excludePath<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>login/toLogin,login/login,login/createImage<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>loginFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>*.do<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id=""><a href="#" class="headerlink" title=""></a></h3>]]></content>
      <categories>
        <category>javaWeb</category>
      </categories>
  </entry>
  <entry>
    <title>java8新特性</title>
    <url>/2021/11/12/java/java8/java8%E6%96%B0%E7%89%B9%E6%80%A7/</url>
    <content><![CDATA[<h1 id="java8新特性"><a href="#java8新特性" class="headerlink" title="java8新特性"></a>java8新特性</h1><h3 id="一、lambda-参数式函数-代码更少"><a href="#一、lambda-参数式函数-代码更少" class="headerlink" title="一、lambda(参数式函数) 代码更少"></a>一、lambda(参数式函数) 代码更少</h3><blockquote>
<p>lambda含义：Runnable runnable=()-&gt; System.out.println(“”);</p>
<p>创建一个类，并new出来，看成一个方法对象</p>
</blockquote>
<p>fun1(fun2())</p>
<ol>
<li><p>参数式函数，参数式lambda。</p>
</li>
<li><p>java中 lambda是实现了函数的对象，而不像其他语言一样是一个函数。一般用于接口，这个接口只有一个函数需要重写。这个接口的实例就是lambda。</p>
</li>
<li><p>但是用到的lambda还是写的那个重写的函数，也就是说我们需要某个功能的时候，我们可以根据四大函数式接口写出自己的函数，将这个接口传入，就完成了一个功能器。</p>
<span id="more"></span></li>
<li><p>为了完成多功能，所以lambda对象应该是以参数的身份传入到指定函数，以为创建Lambda很简单，代码很少，这样在不改变原函数的情况下就能根据传入的lambda不同而拥有不同的功能，目的就是多态。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">public</span> List <span class="title">filter</span><span class="params">(<span class="keyword">int</span> []nums,Predicate&lt;Integer&gt;predicate)</span></span>&#123;</span><br><span class="line">filter(nums,o-&gt;o&gt;<span class="number">6</span>);</span><br><span class="line">filter(nums,o-&gt;<span class="number">2</span>*o&gt;<span class="number">6</span>);</span><br><span class="line">filter(nums,o-&gt;o*o&gt;<span class="number">6</span>);</span><br><span class="line">filter(nums,o-&gt;<span class="number">1</span>&gt;<span class="number">6</span>);</span><br></pre></td></tr></table></figure></li>
<li><p>创建比较器</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//lambda</span></span><br><span class="line">Comparator&lt;Integer&gt;comparator2=(o1,o2)-&gt;o1.compareTo(o2);</span><br><span class="line"><span class="comment">//方法引用  lambda 传fun</span></span><br><span class="line">        Comparator&lt;Integer&gt;comparator3= Integer::compareTo;</span><br><span class="line">Arrays.sort(nums,comparator3);</span><br></pre></td></tr></table></figure></li>
<li><p>创建进程</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Runnable runnable2=()-&gt; System.out.println(<span class="string">&quot;rrrr2&quot;</span>);</span><br></pre></td></tr></table></figure></li>
<li><p>lambda优化</p>
<ol>
<li><p>去掉形参类型(类型推断)</p>
<ol>
<li><p>直接传入o1,而不用在前面加integer</p>
</li>
<li><p>int[]nums=new int[]{1,2,3}–&gt;</p>
<p>int[]nums={1,2,3}</p>
</li>
</ol>
</li>
<li><p>去掉return和{} 只有一句的情况</p>
</li>
<li><p>只有一个参数，可以去掉小括号</p>
</li>
</ol>
</li>
<li><p>格式</p>
<ol>
<li>一个参数没返回:obj=x-&gt;fun(x)</li>
<li>无参无返回: obj=()-&gt;fun()</li>
<li>两个参数: obj=(x,y)-&gt;fun(x,y)</li>
<li>有返回: obj=(x,y)-&gt;{fun(x,y) return}</li>
</ol>
</li>
</ol>
<h3 id="二、函数式接口"><a href="#二、函数式接口" class="headerlink" title="二、函数式接口"></a>二、函数式接口</h3><ol>
<li><p>对于静态方法，是fun(E)，对于类::方法，用的是E.fun()</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Arrays.stream(nums).mapToInt(Integer::intValue);<span class="comment">//类::方法</span></span><br><span class="line">Arrays.stream(nums).mapToInt(Integer::valueOf);<span class="comment">//类::静态方法</span></span><br></pre></td></tr></table></figure></li>
<li></li>
</ol>
<h3 id="三、方法引用-构造器引用"><a href="#三、方法引用-构造器引用" class="headerlink" title="三、方法引用 构造器引用"></a>三、方法引用 构造器引用</h3><ol>
<li><p>当要传递给lambda操作，已经有实现方法，就可以使用方法引用。</p>
</li>
<li><p>基于lambda</p>
</li>
<li><p>关键：传入的方法的返回类型和参数相同</p>
</li>
<li><p>就好像现在不用自己写函数传入Lambda体了，而是有现成的函数，那么直接传入</p>
<p>类::方法名就ok了。</p>
</li>
<li><p>三种情况+一种构造器</p>
<ol>
<li>类::非静态方法</li>
<li>对象::静态方法</li>
<li>类::非静态方法</li>
<li>构造器引用<ol>
<li>类::new</li>
</ol>
</li>
</ol>
</li>
<li><p>要求：两个函数除了名字不一样，其他都一样</p>
</li>
<li><p>细节</p>
<ol>
<li>不用写入形参，因为类型与参数推断，且要求两函数是一样的，所以没必要写形参。</li>
</ol>
</li>
</ol>
<h3 id="四、stream-api-并行计算"><a href="#四、stream-api-并行计算" class="headerlink" title="四、stream api 并行计算"></a>四、stream api 并行计算</h3><ol>
<li><p>stream:运算 cpu打交道</p>
<p>Collection:集合  内存打交道</p>
</li>
<li><p>类似于SQL语句</p>
</li>
<li><p>作用：</p>
<ol>
<li>查询数据不能用sql的情况,如nosql需要把查询到的数据在java里面进行处理</li>
</ol>
</li>
<li><p>特点：</p>
<ol>
<li>自己不储存(视图)</li>
<li>不会改变原对象，也就是inplace=False</li>
<li>操作延迟，直到终止操作才会执行</li>
</ol>
</li>
<li><p>步骤</p>
<ol>
<li><p>创建</p>
<ol>
<li><p>可迭代对象(即实现迭代接口).stream()</p>
</li>
<li><p>并行：parallelstream()</p>
</li>
<li><p>Arrays.stream(T[]arr)</p>
</li>
<li><p>Stream.of(T..)</p>
</li>
<li><p>生成器</p>
<ol>
<li><p>生成偶数流</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span>&lt;T&gt; <span class="title">iterate</span><span class="params">(T t,计算器)</span></span></span><br><span class="line"><span class="function">Stream.<span class="title">iterate</span><span class="params">(<span class="number">0</span>,t-&gt;t+<span class="number">2</span>)</span></span></span><br></pre></td></tr></table></figure></li>
<li><p>生成随机数流</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Stream.generate(Math::random)</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ol>
</li>
<li><p>中间操作{数据处理：}</p>
<ol>
<li><p>筛选与切片</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//筛选</span></span><br><span class="line">stream.filter(a-&gt;a&gt;<span class="number">2</span>)</span><br><span class="line"><span class="comment">//跳过 跳过前三个</span></span><br><span class="line">stream.skip(<span class="number">3</span>)</span><br><span class="line"><span class="comment">//截断 前三个</span></span><br><span class="line">stream.limit(<span class="number">3</span>)</span><br><span class="line"><span class="comment">//去重</span></span><br><span class="line">stream.distinct()</span><br></pre></td></tr></table></figure></li>
<li><p>映射map  (数据转换)</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//转换成大写</span></span><br><span class="line">   stream.map(s&gt;s.toUpperCase())</span><br><span class="line">   <span class="comment">//选出名字长度大于三的数据</span></span><br><span class="line">   stream.map(User::getname).filter(name-&gt;name.leangth&gt;<span class="number">3</span>)</span><br><span class="line">   <span class="comment">//摊平</span></span><br><span class="line">   stream.flatMap(mapToStream)</span><br><span class="line">   <span class="comment">//其中mapToStream能够把stream里面的单个对象转换成stream的函数</span></span><br></pre></td></tr></table></figure></li>
<li><p>排序</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">stream.sorted((o1,o2)-&gt;o1.value-o2.value)</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p>终止操作</p>
<ol>
<li><p>匹配查找</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//所有匹配-&gt;bool</span></span><br><span class="line">stream.addMatch(o-&gt;o.age&gt;<span class="number">18</span>)    </span><br><span class="line"><span class="comment">//任意匹配-&gt;bool</span></span><br><span class="line">stream.anyMatch(o-&gt;o.age&gt;<span class="number">18</span>)</span><br><span class="line"><span class="comment">//第一个元素-&gt;Optional&lt;T&gt;</span></span><br><span class="line">stream.fidFirst()</span><br></pre></td></tr></table></figure></li>
<li><p>其他</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//数量-&gt;long</span></span><br><span class="line">stream.count()</span><br><span class="line"><span class="comment">//最大值-&gt;Optional&lt;T&gt;</span></span><br><span class="line">stream.max((o1,o2)-&gt;o1.value-o2.value)</span><br><span class="line"><span class="comment">//内部迭代</span></span><br><span class="line">stream.foreach(System.out:println)</span><br></pre></td></tr></table></figure></li>
<li><p>规约 reduce</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">stream.reduce(<span class="number">0</span>,(o1,o2)-&gt;o1+o2)</span><br></pre></td></tr></table></figure></li>
<li><p>收集collect(Collector c)</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//list</span></span><br><span class="line">stream.collect(Collectors.toList())</span><br><span class="line"><span class="comment">//set</span></span><br><span class="line">stream.collect(Collectors.toSet())    </span><br><span class="line"><span class="comment">//不确定性collection</span></span><br><span class="line">stream.collect(Collectors.toCollection())</span><br></pre></td></tr></table></figure></li>
<li><p>分组</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Map&lt;String, Map&lt;String, Paper&gt;&gt; collect = records.parallelStream().collect(</span><br><span class="line">                Collectors.groupingBy(Paper::getExamId,</span><br><span class="line">                        Collectors.toMap(Paper::getUserId, Function.identity(), (o1, o2) -&gt; (o1.getUserScore() &gt; o2.getUserScore() ? o1 : o2))));</span><br></pre></td></tr></table></figure></li>
<li><p>平均值</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> avg = exams.stream().mapToInt(UserExam::getMaxScore).sum() / exams.size();</span><br></pre></td></tr></table></figure></li>
<li><p>某一属性</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">dictEntityList.stream().map(DictEntity::getName).collect(Collectors.toList());</span><br></pre></td></tr></table></figure></li>
<li><p><a href="https://blog.csdn.net/yihuaiyan/article/details/101050144?utm_term=javastream%E6%B1%82%E5%B9%B3%E5%9D%87%E5%80%BC&utm_medium=distribute.pc_aggpage_search_result.none-task-blog-2~all~sobaiduweb~default-0-101050144&spm=3001.4430">参考</a></p>
</li>
</ol>
</li>
</ol>
</li>
</ol>
<h3 id="五、optional类-最大减少空指针异常"><a href="#五、optional类-最大减少空指针异常" class="headerlink" title="五、optional类 最大减少空指针异常"></a>五、optional类 最大减少空指针异常</h3><ol>
<li><p>of</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Optional&lt;Student&gt;optionalStudent=Optional.of(student);<span class="comment">//of必须非空</span></span><br><span class="line"><span class="comment">//ofNullable 可空，为empty  </span></span><br><span class="line">Optional&lt;Student&gt;optionalStudent2=Optional.ofNullable(student);</span><br></pre></td></tr></table></figure></li>
<li><p>orElse</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">value != <span class="keyword">null</span> ? value : other</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><ol>
<li>接口默认方法</li>
<li>DateTime api</li>
<li>@Repeatable元注解</li>
<li>线程池</li>
</ol>
<h3 id="函数式接口"><a href="#函数式接口" class="headerlink" title="函数式接口"></a><a href="https://www.runoob.com/java/java8-functional-interfaces.html">函数式接口</a></h3><ol>
<li><p>Function</p>
</li>
<li><p>&lt;T&gt; Function&lt;T, T&gt;  Function.identity()   传</p>
</li>
<li><p>BinaryOperator</p>
<figure class="highlight gcode"><table><tr><td class="code"><pre><span class="line">T apply<span class="comment">(T t, T u)</span>;</span><br><span class="line"><span class="comment">(o1,o2)</span>-&gt;<span class="meta">o1</span>.age&gt;<span class="meta">o2</span>.a? <span class="meta">o1</span> : <span class="meta">o2</span></span><br></pre></td></tr></table></figure></li>
<li><p>BiFunction&lt;T, U, R&gt;</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function">R <span class="title">apply</span><span class="params">(T t, U u)</span></span>;</span><br></pre></td></tr></table></figure></li>
<li><p>ToIntFunction<T> </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">applyAsInt</span><span class="params">(T value)</span></span>;</span><br><span class="line">Student::getAge</span><br><span class="line">o-&gt;o.getAge()    </span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="我对Lambda的运用"><a href="#我对Lambda的运用" class="headerlink" title="我对Lambda的运用"></a>我对Lambda的运用</h3><ol>
<li><p>类–&gt;映射string–&gt;加到listString</p>
<pre><code><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">result.getAllErrors().stream().map(DefaultMessageSourceResolvable::getDefaultMessage).forEach(list::add);</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
<li><p>取出每组最大值</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//并行流 聚集分组 得最大值</span></span><br><span class="line">Map&lt;String, ConcurrentMap&lt;String, Paper&gt;&gt; map = records.stream().collect(</span><br><span class="line">    Collectors.groupingBy(Paper::getExamId,</span><br><span class="line">                          Collectors.toConcurrentMap(Paper::getUserId, Function.identity(), (o1, o2) -&gt; (o1.getUserScore() &gt; o2.getUserScore() ? o1 : o2))));</span><br></pre></td></tr></table></figure></li>
<li></li>
</ol>
]]></content>
      <categories>
        <category>java高阶</category>
      </categories>
  </entry>
  <entry>
    <title>java知识</title>
    <url>/2021/12/14/java/javaSE/java%E7%9F%A5%E8%AF%86/</url>
    <content><![CDATA[<p>[toc]</p>
<h2 id="一、java分析"><a href="#一、java分析" class="headerlink" title="一、java分析"></a>一、java分析</h2><ol>
<li><p>基本代码分析</p>
<ol>
<li>调试–栈</li>
<li>语法糖、注解等：javac编译+javap反编译</li>
</ol>
</li>
<li><p>判断两个obj是否同类  print obj.getClass</p>
</li>
<li><p>判断两个obj是否一样  print   obj.hashcode  但是可能hash碰撞</p>
</li>
<li><p>web功能分析：</p>
<ol>
<li><p>F12</p>
</li>
<li><p>Postman Swagger RestfulTools</p>
<span id="more"></span></li>
</ol>
<h3 id="1-1-基本类型"><a href="#1-1-基本类型" class="headerlink" title="1.1 基本类型"></a>1.1 基本类型</h3><h4 id="1-1-1-范围-–EEE754标准"><a href="#1-1-1-范围-–EEE754标准" class="headerlink" title="1.1.1 范围  –EEE754标准"></a>1.1.1 范围  –EEE754标准</h4><blockquote>
<p>　精度是由尾数决定的，为什么？由浮点数的值计算公式可知：当指数的最终值为负，虽然这个时候浮点数的值能表示更小，但这个时候仅仅能表示0<del>1（或-1</del>0）这个数段的小数，没有实际意义。所以精度主要是看尾数的值。<strong>精度和尾数有关</strong>，<strong>范围和指数有关</strong></p>
</blockquote>
<ol>
<li><p>double</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">[-<span class="number">1.79769313486231570e+308</span>,-<span class="number">4.94065645841246544e-324</span>] ∪  [<span class="number">4.94065645841246544e-324</span>,<span class="number">1.79769313486231570e+308</span>]</span><br></pre></td></tr></table></figure></li>
<li><p>fload</p>
<table>
<thead>
<tr>
<th></th>
<th>符号位（S）：1bit</th>
<th>指数位（E）：8bit</th>
<th>尾数位（M）：23bit</th>
<th>精度</th>
</tr>
</thead>
<tbody><tr>
<td>Fload</td>
<td>1</td>
<td>8</td>
<td>23</td>
<td>6~7位，能保证6位绝对精确</td>
</tr>
<tr>
<td></td>
<td></td>
<td>-127~128次方</td>
<td>0000……0001(22个0)</td>
<td>java toString 7位小数</td>
</tr>
<tr>
<td></td>
<td></td>
<td>3.4028234e+38</td>
<td>1.1920929e-7</td>
<td></td>
</tr>
<tr>
<td>Double</td>
<td>1</td>
<td>11</td>
<td>52</td>
<td>15~16，能保证15</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>2.2204E-16</td>
<td>java toString 16位小数，使用E表示位x.123131135151E33小数点后面一共17位</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">[-<span class="number">3.40282346638528860e+38</span> , -<span class="number">1.40129846432481707e-45</span>] ∪ [<span class="number">1.40129846432481707e-45</span> ~ <span class="number">3.40282346638528860e+38</span>]</span><br></pre></td></tr></table></figure>

<h4 id="特殊"><a href="#特殊" class="headerlink" title="特殊"></a>特殊</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="number">0.0</span>/<span class="number">0.0</span>=NAN</span><br><span class="line">NAN != NAN</span><br><span class="line">Math.pow(Float.NaN,<span class="number">0</span>)=<span class="number">1</span></span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ol>
<h2 id="二、类"><a href="#二、类" class="headerlink" title="二、类"></a>二、类</h2><h3 id="2-1-私有构造"><a href="#2-1-私有构造" class="headerlink" title="2.1 私有构造"></a>2.1 私有构造</h3><ol>
<li><p>特点：不能实例化，不能被继承，常用于被实例化一次的类(单例模式)</p>
</li>
<li><p>两种方式拿到单例</p>
<ol>
<li><p>puvlic static成员变量</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Elvis</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Elvis INSTANCE = <span class="keyword">new</span> Elvis();</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Elvis</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>private static成员变量，使用static方法返回</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Elvis</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Elvis INSTANCE = <span class="keyword">new</span> Elvis();</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Elvis</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Elvis <span class="title">getInstance</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> INSTANCE;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>作用：防止实例化和子类化，常用在util类,常量类，我们一般用这些类static方法而非他的实例，</p>
</li>
</ol>
</li>
</ol>
<h3 id="2-2-继承"><a href="#2-2-继承" class="headerlink" title="2.2 继承"></a>2.2 继承</h3><ol>
<li><p>强制转换本着宁多勿少的原则，java.lang.ClassCastException运行时异常</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Users obj= (Users) <span class="keyword">new</span> Object();</span><br></pre></td></tr></table></figure></li>
</ol>
<!--more-->

<h2 id="三、java9大隐式对象"><a href="#三、java9大隐式对象" class="headerlink" title="三、java9大隐式对象"></a>三、java9大隐式对象</h2><ol>
<li><p>Session: 主要用于来分别保存每个用户信息，与请求关联的对话;</p>
</li>
<li><p>Request: 代表请求对象，主要用于接受客户端通过HTTP协议连接传输到服务器端的数据;</p>
</li>
<li><p>Response: 代表响应对象，主要用于向客户端发送数据;</p>
</li>
<li><p>out: 主要用于向客户端输出数据；</p>
</li>
<li><p>application: 主要用于保存用户信息，代码片段的运行环境;</p>
</li>
<li><p>pageContext: 管理网页属性;</p>
<ol>
<li>可以作为入口对象获取其他八大隐式对象的引用</li>
</ol>
</li>
<li><p>config: 代码片段配置对象，表示Servlet的配置;</p>
</li>
<li><p>page:处理jsp网页;</p>
</li>
<li><p>Exception:处理jsp文件执行时发生的错误和异常</p>
</li>
</ol>
<h4 id="native关键字"><a href="#native关键字" class="headerlink" title="native关键字"></a>native关键字</h4><ol>
<li><a href="https://www.cnblogs.com/szlbm/p/5504603.html**">手写一个native</a></li>
<li>native方法主要用于加载文件和动态链接库，由于Java语言无法访问操作系统底层信息（比如：底层硬件设备等），这时候就需要借助C语言来完成了。被native修饰的方法可以被C语言重写。</li>
<li>被native关键字修饰的方法叫做本地方法，本地方法和其它方法不一样，本地方法意味着和平台有关</li>
<li>Java程序中声明native修饰的方法，类似于abstract修饰的方法，只有方法签名，没有方法实现。编译该java文件，会产生一个.class文件。</li>
</ol>
]]></content>
      <categories>
        <category>java</category>
      </categories>
  </entry>
  <entry>
    <title>动态代理</title>
    <url>/2021/11/25/java/javaSE/java%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/</url>
    <content><![CDATA[<h3 id="动态代理"><a href="#动态代理" class="headerlink" title="动态代理"></a>动态代理</h3><blockquote>
<p>对每个接口方法的增强，而不是对所有类方法的增强</p>
</blockquote>
<h2 id="一、jdk-InvocationHandler"><a href="#一、jdk-InvocationHandler" class="headerlink" title="一、jdk.InvocationHandler"></a>一、jdk.InvocationHandler</h2><blockquote>
<p>基于接口实现</p>
</blockquote>
<h3 id="1-1-步骤"><a href="#1-1-步骤" class="headerlink" title="1.1 步骤"></a>1.1 步骤</h3><ol>
<li><p>被代理对象A1  实现接口A的两个方法(m1,m2)</p>
</li>
<li><p>创建一个handler实现InvocationHandler接口</p>
</li>
<li><p>重写handler的invoke方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">doDate()</span><br><span class="line">invoke(tar,args)==doSime()</span><br><span class="line">doLog()</span><br></pre></td></tr></table></figure></li>
<li><p>实现代理jdk.Proxy</p>
</li>
</ol>
<span id="more"></span>

<h3 id="1-2-代码"><a href="#1-2-代码" class="headerlink" title="1.2 代码"></a>1.2 代码</h3><ol>
<li><p>接口和类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">PublicI</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">speak</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> <span class="keyword">implements</span> <span class="title">PublicI</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">speak</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;AAAAAAAAAAAAAAAAAAAAAAA&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>方法调用类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyProxyHandler</span> <span class="keyword">implements</span> <span class="title">InvocationHandler</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Object object;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyProxyHandler</span><span class="params">(Object object)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.object = object;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;before&quot;</span>);</span><br><span class="line">        <span class="comment">//方法调用</span></span><br><span class="line">        method.invoke(object,args);</span><br><span class="line">        System.out.println(<span class="string">&quot;after&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>创建代理类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">A a=<span class="keyword">new</span> A();<span class="comment">//创建被代理对象</span></span><br><span class="line">InvocationHandler handler=<span class="keyword">new</span> MyProxyHandler(a);<span class="comment">//创建中间产物</span></span><br><span class="line">PublicI proxy= (PublicI) Proxy.newProxyInstance(a.getClass().getClassLoader(),a.getClass().getInterfaces(),handler);<span class="comment">//代理类</span></span><br><span class="line">proxy.speak();</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="1-3-核心代码分析"><a href="#1-3-核心代码分析" class="headerlink" title="1.3 核心代码分析"></a>1.3 核心代码分析</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Class&lt;?&gt;[] constructorParams =&#123; InvocationHandler.class &#125;; 		</span><br><span class="line"><span class="keyword">final</span> Class&lt;?&gt;[] intfs = interfaces.clone();</span><br><span class="line"><span class="comment">//根据提供的接口（在我们的例子中，即Subject接口），生成代理类</span></span><br><span class="line">Class&lt;?&gt; cl = getProxyClass0(loader, intfs);</span><br><span class="line"><span class="keyword">final</span> Constructor&lt;?&gt; cons = cl.getConstructor(constructorParams);</span><br><span class="line"><span class="comment">//调用代理类的构造器，构造器参数为InvocationHandler的接口实现类（在我们的例子中，即JdkProxySubject）</span></span><br><span class="line"><span class="keyword">return</span> cons.newInstance(<span class="keyword">new</span> Object[]&#123;h&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="1-4-原理"><a href="#1-4-原理" class="headerlink" title="1.4 原理"></a>1.4 原理</h3><h3 id="1-5-InvocationHandler"><a href="#1-5-InvocationHandler" class="headerlink" title="1.5 InvocationHandler"></a>1.5 InvocationHandler</h3><h4 id="代理规则"><a href="#代理规则" class="headerlink" title="代理规则"></a>代理规则</h4><ol>
<li>object</li>
<li>default方法能被重写</li>
</ol>
<h4 id="native方法会被代理-hashcode"><a href="#native方法会被代理-hashcode" class="headerlink" title="native方法会被代理: hashcode"></a>native方法会被代理: hashcode</h4><h2 id="二、CGLIB"><a href="#二、CGLIB" class="headerlink" title="二、CGLIB"></a>二、CGLIB</h2><ol>
<li><p>要求：继承，不能final</p>
</li>
<li><p>作用：</p>
<ol>
<li>减少代码重复</li>
<li>无痛功能增强</li>
<li>专注业务逻辑</li>
<li>解耦合</li>
</ol>
</li>
<li><p>AOP 面向切面编程</p>
<ol>
<li> 规范化（约定好）的动态代理</li>
</ol>
</li>
<li></li>
</ol>
]]></content>
      <categories>
        <category>java高级</category>
      </categories>
  </entry>
  <entry>
    <title>内部类</title>
    <url>/2022/03/22/java/javaSE/%E5%86%85%E9%83%A8%E7%B1%BB/</url>
    <content><![CDATA[<h4 id="1-作用"><a href="#1-作用" class="headerlink" title="1 作用"></a>1 作用</h4><ol>
<li>可以实现多重继承：定义一个半成品类继承类1，</li>
<li>可以直接访问外部类的成员，包括私有</li>
</ol>
<h4 id="2-内部类的分类"><a href="#2-内部类的分类" class="headerlink" title="2  内部类的分类"></a>2  内部类的分类</h4><ul>
<li><p>成员内部类 –&gt; 类里的类</p>
<blockquote>
<p>不能定义静态变量，除了final修饰的</p>
</blockquote>
</li>
<li><p>局部内部类 –&gt; 函数里面的类</p>
</li>
<li><p>静态内部类 –&gt; 类里面static类</p>
<blockquote>
<p>和普通的类差不多,引用方式  Out.Inner inner =  new Out.Inner();  inner.do();</p>
</blockquote>
</li>
<li><p>匿名内部类 –&gt;  lambda</p>
</li>
</ul>
<h4 id="3-注意点"><a href="#3-注意点" class="headerlink" title="3 注意点"></a>3 注意点</h4><ol>
<li><p>各个类也有访问权限</p>
<ol>
<li>默认defalut</li>
<li>只有public的能在别的包创建这个内部类</li>
</ol>
</li>
<li><p>非static的成员内部类不能有static方法,也即不能有main函数</p>
</li>
<li><p>创建一个成员内类就相当于创建了两个类: 外部+内部</p>
<p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20211203232620875.png" alt="image-20211203232620875"></p>
</li>
<li><p>函数里面不能有权限符号 private等,所有局部内部类都是只有这个方法能访问的</p>
</li>
<li><p>为什么局部内部类访问局部变量必须加final修饰呢</p>
<blockquote>
<p>​    因为<strong>局部变量是随着方法的调用而调用</strong>，<strong>使用完毕就消失</strong>，<strong>而堆内存的数据并不会立即消失</strong>。</p>
<p>所以，堆内存还是用该变量，而该变量已经没有了。<strong>为了让该值还存在，就加final修饰。</strong></p>
<p>原因是，当我们使用final修饰变量后，堆内存直接存储的<strong>是值</strong>，而<strong>不是变量名</strong>。</p>
</blockquote>
</li>
</ol>
<h3 id="2-成员内部类"><a href="#2-成员内部类" class="headerlink" title="2. 成员内部类"></a>2. 成员内部类</h3><blockquote>
<p>成员内部类不能定义静态变量。类初始化的时候先初始化静态成员，如果允许成员内。部类定义静态变量，那么成员内部类的静态变量初始化顺序是有歧义的</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SSS</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">	</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Inner</span> </span>&#123;  	<span class="comment">//成员内部类</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            System.out.println(age);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Inner2</span> </span>&#123;  <span class="comment">//静态内部类/嵌套内部类</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            System.out.println(<span class="number">111</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">SSS.Inner a=<span class="keyword">new</span> SSS().<span class="function">new <span class="title">Inner</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>

<h3 id="3-局部内部类"><a href="#3-局部内部类" class="headerlink" title="3. 局部内部类"></a>3. 局部内部类</h3><h3 id="4-HashMap内部类"><a href="#4-HashMap内部类" class="headerlink" title="4.  HashMap内部类"></a>4.  HashMap内部类</h3><ol>
<li><p>keySet,Values</p>
<blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">KeySet</span> <span class="keyword">extends</span> <span class="title">AbstractSet</span>&lt;<span class="title">K</span>&gt; </span></span><br></pre></td></tr></table></figure>



<p>用于懒加载</p>
</blockquote>
</li>
<li><p>EntrySet</p>
<blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">EntrySet</span> <span class="keyword">extends</span> <span class="title">AbstractSet</span>&lt;<span class="title">Map</span>.<span class="title">Entry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt;&gt;</span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>懒加载类，</p>
</blockquote>
</li>
<li><p>EntryIterator</p>
<blockquote>
<p>基于HashMap自身的next方法的迭代器</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">EntryIterator</span> <span class="keyword">extends</span> <span class="title">HashIterator</span> <span class="keyword">implements</span> <span class="title">Iterator</span>&lt;<span class="title">Map</span>.<span class="title">Entry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt;&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> Map.<span class="function">Entry&lt;K,V&gt; <span class="title">next</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> nextNode(); &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">final</span> Node&lt;K,V&gt; <span class="title">nextNode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Node&lt;K,V&gt;[] t;</span><br><span class="line">    Node&lt;K,V&gt; e = next;</span><br><span class="line">    <span class="keyword">if</span> (modCount != expectedModCount)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> ConcurrentModificationException();</span><br><span class="line">    <span class="keyword">if</span> (e == <span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NoSuchElementException();</span><br><span class="line">    <span class="keyword">if</span> ((next = (current = e).next) == <span class="keyword">null</span> &amp;&amp; (t = table) != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">do</span> &#123;&#125; <span class="keyword">while</span> (index &lt; t.length &amp;&amp; (next = t[index++]) == <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> e;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="静态内部类"><a href="#静态内部类" class="headerlink" title="静态内部类"></a>静态内部类</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">implements</span> <span class="title">Map</span>.<span class="title">Entry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt;</span>&#123;</span><br><span class="line">    Node(<span class="keyword">int</span> hash, K key, V value, Node&lt;K,V&gt; next) &#123;</span><br><span class="line">           <span class="keyword">this</span>.hash = hash;</span><br><span class="line">           <span class="keyword">this</span>.key = key;</span><br><span class="line">           <span class="keyword">this</span>.value = value;</span><br><span class="line">           <span class="keyword">this</span>.next = next;</span><br><span class="line">       &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="foreach实现"><a href="#foreach实现" class="headerlink" title="foreach实现"></a>foreach实现</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (Map.Entry&lt;K, V&gt; entry : entrySet()) &#123;</span><br><span class="line">    action.accept(k, v);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//  --&gt;  entrySet()=new EntrySet(); </span></span><br><span class="line"><span class="comment">//  --&gt;  EntrySet 实现了iterable接口 具体方法为</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> Iterator&lt;Map.Entry&lt;K,V&gt;&gt; iterator() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> EntryIterator();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//  --&gt; 迭代器next方法的本质为</span></span><br><span class="line"><span class="comment">// 1. .next遍历链表或者红黑树，直到为null</span></span><br><span class="line"><span class="comment">// 2. 遍历数组，找到新的元素再.next遍历</span></span><br><span class="line"><span class="function"><span class="keyword">final</span> Node&lt;K,V&gt; <span class="title">nextNode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Node&lt;K,V&gt;[] t;</span><br><span class="line">    Node&lt;K,V&gt; e = next;</span><br><span class="line">    <span class="keyword">if</span> (modCount != expectedModCount)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> ConcurrentModificationException();</span><br><span class="line">    <span class="keyword">if</span> ((next = (current = e).next) == <span class="keyword">null</span> &amp;&amp; (t = table) != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">do</span> &#123;&#125; <span class="keyword">while</span> (index &lt; t.length &amp;&amp; (next = t[index++]) == <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> e;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//  --&gt; </span></span><br><span class="line"><span class="comment">//  --&gt; </span></span><br></pre></td></tr></table></figure></li>
</ol>
]]></content>
  </entry>
  <entry>
    <title>反射</title>
    <url>/2021/11/24/java/javaSE/%E5%8F%8D%E5%B0%84%E5%92%8C%E6%B3%A8%E8%A7%A3/</url>
    <content><![CDATA[<p>[toc]</p>
<p>参考<a href="https://www.cnblogs.com/tech-bird/p/3525336.html">狂神</a></p>
<h2 id="一、Class"><a href="#一、Class" class="headerlink" title="一、Class"></a>一、Class</h2><h3 id="1-创建类方式"><a href="#1-创建类方式" class="headerlink" title="1. 创建类方式"></a>1. 创建类方式</h3><ol>
<li>new</li>
<li>clone</li>
<li>反射<ol>
<li>newInstance</li>
<li>Constructor.newInstance</li>
</ol>
</li>
<li>反序列化</li>
</ol>
<h3 id="2-谁拥有class"><a href="#2-谁拥有class" class="headerlink" title="2. 谁拥有class"></a>2. 谁拥有class</h3><ol>
<li><p>class</p>
</li>
<li><p>interface</p>
<span id="more"></span></li>
<li><p>enum</p>
</li>
<li><p>annotation</p>
</li>
<li><p>primitive type 基本数据类型</p>
</li>
<li><p>void</p>
</li>
</ol>
<h3 id="获得class"><a href="#获得class" class="headerlink" title="获得class"></a>获得class</h3><p>特别的</p>
<ol>
<li><p>基本类可以通过其封装类.type获得class</p>
<figure class="highlight fortran"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Integer</span>.<span class="keyword">TYPE</span>==<span class="built_in">int</span></span><br><span class="line"><span class="keyword">Integer</span>.<span class="keyword">class</span>==<span class="keyword">class</span> java.lang.<span class="keyword">Integer</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="3-java-lang-Class-lt-T-gt"><a href="#3-java-lang-Class-lt-T-gt" class="headerlink" title="3. java.lang.Class&lt;T&gt;"></a>3. java.lang.Class&lt;T&gt;</h3><ol>
<li><p>Class类是一个对象照镜子的结果，对象可以看到自己有哪些属性，方法，构造器，实现了哪些接口等等</p>
</li>
<li><p>Class类和Object关系不大，Class就是一个方便反射的类。interface也有Class,这个.但这不意味着interface和Object有任何关系。</p>
<ol>
<li>inteface作为注解的时候有一个类似Object的公共父接口Annotation.</li>
</ol>
</li>
<li><p>Class 是一个类,一个描述类的类.封装了描述方法的 Method,</p>
<p>​       描述字段的 File</p>
<p>​       描述构造器的 Constructor 等属性.</p>
</li>
</ol>
<h2 id="二、反射"><a href="#二、反射" class="headerlink" title="二、反射"></a>二、反射</h2><h3 id="1-反射Api"><a href="#1-反射Api" class="headerlink" title="1. 反射Api"></a>1. 反射Api</h3><ol>
<li><p>关于方法的</p>
<table>
<thead>
<tr>
<th>方法名</th>
<th>功能说明</th>
</tr>
</thead>
<tbody><tr>
<td>static Class forName(String name)</td>
<td>返回指定类名 name 的 Class 对象</td>
</tr>
<tr>
<td>Object newInstance()</td>
<td>调用缺省构造函数，返回该Class对象的一个实例</td>
</tr>
<tr>
<td>Object newInstance(Object []args)</td>
<td>调用当前格式构造函数，返回该Class对象的一个实例</td>
</tr>
<tr>
<td>getName()</td>
<td>返回此Class对象所表示的实体（类、接口、数组类、基本类型或void）名称</td>
</tr>
<tr>
<td>Class getSuperClass()</td>
<td>返回当前Class对象的父类的Class对象</td>
</tr>
<tr>
<td>Class [] getInterfaces()</td>
<td>获取当前Class对象的接口</td>
</tr>
<tr>
<td>ClassLoader getClassLoader()</td>
<td>返回该类的类加载器</td>
</tr>
<tr>
<td>Class getSuperclass()</td>
<td>返回表示此Class所表示的实体的超类的Class</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody></table>
</li>
<li><p>获得非超类属性</p>
<blockquote>
<p>getDeclatedFields、getDeclatedMethods和getDeclaredConstructors方法可以获得<br>本类的所<strong>有(包括private)</strong></p>
</blockquote>
</li>
<li><p>获得所有属性</p>
<blockquote>
<p>getFields、getMethods和getCostructors方法可以获得类提供的<strong>public域</strong>、方法和构造器数组，其中包括超类的共有成员</p>
</blockquote>
</li>
<li><p>获得特定属性</p>
</li>
</ol>
<blockquote>
<p>getField、getMethod和getCostructor方法可以获得指定名字的域、方法和构造器</p>
</blockquote>
<ol start="5">
<li><p>获得GenericType</p>
<blockquote>
<p>泛型、基本类型、Object类型三种</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Type genericType = c.getClass().getFields()[<span class="number">0</span>].getGenericType();<span class="comment">// T int Student</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">    Field[] fields = Student.class.getDeclaredFields();</span><br><span class="line">    System.out.println(fields[<span class="number">0</span>].getType()); <span class="comment">// 输出 class java.lang.Object</span></span><br><span class="line">    System.out.println(fields[<span class="number">0</span>].getGenericType()); <span class="comment">//输出 T</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span>&lt;<span class="title">T</span>&gt;</span>&#123;</span><br><span class="line">    T age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></blockquote>
</li>
</ol>
<h4 id="类加载过程"><a href="#类加载过程" class="headerlink" title="类加载过程"></a>类加载过程</h4><ol>
<li>load:classLoader将class文件读入内存，并创建一个Class&lt;this&gt;的Class实例</li>
<li>link:将类的二进制数据合并到Jre<ol>
<li>检验类信息是否符合规范，代码是否正确</li>
<li>分配static成员的内存</li>
</ol>
</li>
<li>initialize:JVM初始化类，执行静态代码块</li>
</ol>
<h4 id="类的初始化"><a href="#类的初始化" class="headerlink" title="类的初始化"></a>类的初始化</h4><ol>
<li><p>初始化是一种懒加载，只有被用到了才会初始化</p>
</li>
<li><p>主动引用(从父类到子类都会初始化)</p>
<ol>
<li>new</li>
<li>反射</li>
</ol>
</li>
<li><p>被动引用(不会初始化)</p>
<ol>
<li>直接调用静态变量 、常量类A.a，(因为在这些东西在link的时候就加载出来了)</li>
<li>new 出来的是对象数组</li>
</ol>
</li>
<li><p>类加载器</p>
<p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20211011004255272.png" alt="image-20211011004255272"></p>
</li>
</ol>
<h3 id="反射"><a href="#反射" class="headerlink" title="反射"></a>反射</h3><ol>
<li><p><a href="https://www.cnblogs.com/adamjwh/p/9683705.html">反射功能</a></p>
<ol>
<li>在运行时判断任意一个对象所属的类。</li>
<li>在运行时构造任意一个类的对象。</li>
<li>在运行时判断任意一个类所具有的成员变量和方法。</li>
<li>在运行时调用任意一个对象的方法。</li>
<li>生成动态代理。</li>
</ol>
</li>
<li><p>Method</p>
<ol>
<li><p>获得所有方法(不包括私有)</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Method[] methods = clazz.getMethods();</span><br></pre></td></tr></table></figure></li>
<li><p>获取本类方法(包括私有)</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">methods = clazz.getDeclaredMethods();</span><br></pre></td></tr></table></figure></li>
<li><p>通过方法名+参数类型获取方法(包括私有)</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Method method = clazz.getDeclaredMethod(<span class="string">&quot;setName&quot;</span>, String.class);</span><br></pre></td></tr></table></figure></li>
<li><p>反向调用方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">method.invoke(obje,<span class="number">2</span>);<span class="comment">//如果一个方法是私有方法，第三步是可以获取到的，但是这一步却不能执行　　　　//私有方法的执行，必须在调用invoke之前加上一句method.setAccessible（true）;</span></span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ol>
]]></content>
      <categories>
        <category>java</category>
      </categories>
  </entry>
  <entry>
    <title>泛型</title>
    <url>/2021/12/09/java/javaSE/%E6%B3%9B%E5%9E%8B/</url>
    <content><![CDATA[<blockquote>
<p>菱形运算符&lt;&gt;，菱形运算符就是为了规范返回与传入，全部Object一堆乱+强制类型转换</p>
</blockquote>
<blockquote>
<p>泛型就是检错，泛型的擦除就是检错完成后让代码和不使用泛型的代码完全相同</p>
</blockquote>
<h3 id="1-通配符"><a href="#1-通配符" class="headerlink" title="1.通配符"></a>1.通配符</h3><ol>
<li>无限通配符 List&lt;?&gt;<ol>
<li> 不能添加，只能add null，用作迭代</li>
<li> List&lt;?&gt; 在 逻 辑 上 是List&lt;String&gt;,List&lt;Integer&gt; 的父类</li>
</ol>
</li>
<li>原类型List<ol>
<li> <code>类型</code>不安全,可以将任何类型元素加入</li>
<li> 这个类型是为了兼容jdk1.5之前的代码，不然java会禁用这种写法</li>
</ol>
</li>
<li> 通配符List&lt;T&gt;</li>
</ol>
<h3 id="2-泛型方法"><a href="#2-泛型方法" class="headerlink" title="2. 泛型方法"></a>2. 泛型方法</h3><h5 id="2-1-E：：较为常用"><a href="#2-1-E：：较为常用" class="headerlink" title="2.1 E：：较为常用"></a>2.1 E：：<strong>较为常用</strong></h5><blockquote>
<p>这里的参数为? extend Object </p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> &lt;X&gt; <span class="function">List&lt;X&gt; <span class="title">test1</span><span class="params">(String name,X)</span></span>&#123;  <span class="comment">//这里的E 默认为Class&lt;Obeject&gt;</span></span><br><span class="line">    List&lt;X&gt;list=process(name,e.getClass());</span><br><span class="line">    <span class="keyword">return</span> list;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//使用</span></span><br><span class="line">List&lt;Student&gt; a = test2(<span class="string">&quot;a&quot;</span>, <span class="keyword">new</span> Student());</span><br></pre></td></tr></table></figure>

<h4 id="2-2-Class-lt-E-gt"><a href="#2-2-Class-lt-E-gt" class="headerlink" title="2.2 Class&lt;E&gt;"></a>2.2 Class&lt;E&gt;</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> &lt;X&gt; <span class="function">List&lt;X&gt; <span class="title">test2</span><span class="params">(String name,Class&lt;X&gt;xClass)</span></span>&#123;  <span class="comment">//第一个X 就是参数化类型，参数里面的X就是指定</span></span><br><span class="line">    List&lt;X&gt;list=process(name,xClass);</span><br><span class="line">    <span class="keyword">return</span> list;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//使用</span></span><br><span class="line">List&lt;Student&gt; a = test1(<span class="string">&quot;a&quot;</span>, Student.class);</span><br></pre></td></tr></table></figure>

<h3 id="2-3-Objects方法"><a href="#2-3-Objects方法" class="headerlink" title="2.3 Objects方法"></a>2.3 Objects方法</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function"><span class="keyword">int</span> <span class="title">compare</span><span class="params">(T a, T b, Comparator&lt;? <span class="keyword">super</span> T&gt; c)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> (a == b) ? <span class="number">0</span> :  c.compare(a, b);</span><br><span class="line">   &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">T <span class="title">requireNonNull</span><span class="params">(T obj)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">if</span> (obj == <span class="keyword">null</span>)</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">       <span class="keyword">return</span> obj;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h4 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h4><ol>
<li><p>泛型无效性—&gt; 编译过后 泛型信息消失</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">(List&lt;Integer&gt;list)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">(List&lt;String&gt;list)</span></span>&#123;  <span class="comment">//报错 </span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="逆变"><a href="#逆变" class="headerlink" title="逆变"></a>逆变</h4><ol>
<li><p>数组具有协变</p>
<blockquote>
<p>可以把数组理解成一个简单的Class，而不是集合</p>
<p>? extend E </p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//协变就是协助多态的意思，</span></span><br><span class="line">Object[]o=<span class="keyword">new</span> String[<span class="number">2</span>];</span><br><span class="line"><span class="comment">//但是协变也造成了另一个困难，类型未知</span></span><br><span class="line">o[<span class="number">0</span>]=<span class="keyword">new</span> Integer(<span class="number">2</span>);</span><br></pre></td></tr></table></figure></li>
<li><p>集合不能协变</p>
<blockquote>
<p>意思就是E 就是E</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;Object&gt;list=<span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">List&lt;String&gt;list2=<span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">list=list2;<span class="comment">//报错</span></span><br><span class="line"><span class="comment">//解决办法 手动extend</span></span><br><span class="line">List&lt;? extends Object&gt;list=<span class="keyword">new</span> ArrayList&lt;&gt;();</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="协变"><a href="#协变" class="headerlink" title="协变"></a>协变</h4>]]></content>
  </entry>
  <entry>
    <title>java注解</title>
    <url>/2021/12/12/java/javaSE/%E6%B3%A8%E8%A7%A3/</url>
    <content><![CDATA[<h3 id="1-内置注解"><a href="#1-内置注解" class="headerlink" title="1. 内置注解"></a>1. 内置注解</h3><ol>
<li><p>@Override </p>
</li>
<li><p>@Supersswarnings 类/方法</p>
</li>
<li><p>@Deprecated 类/方法</p>
</li>
<li><p>元注解 </p>
<ol>
<li><p>@Target 作用范围</p>
<p>ElementType 枚举值</p>
<ol>
<li>Type 类上</li>
<li>Method 方法上</li>
<li>Field 属性上</li>
</ol>
</li>
<li><p>@Retetion 什么时候有效  默认runtime</p>
</li>
<li><p>@Inherited 继承</p>
</li>
<li><p>@Documented 生成文档</p>
</li>
</ol>
</li>
<li><p>次元注解(注解的注解)</p>
<ol>
<li><p>@Repeatable(Persons.class)</p>
<p>可重复的</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 不能重复使用</span></span><br><span class="line"><span class="meta">@Identity(&quot;父亲&quot;)</span></span><br><span class="line"><span class="meta">@Identity(&quot;教师&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RepeatableTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p>本质：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">myAnno</span>.<span class="title">An1</span> <span class="keyword">extends</span> <span class="title">java</span>.<span class="title">lang</span>.<span class="title">annotation</span>.<span class="title">Annotation</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>三大主干类</p>
<ol>
<li><p>祖先</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> java.lang.annotation;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Annotation</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object obj)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">String <span class="title">toString</span><span class="params">()</span></span>;</span><br><span class="line">    Class&lt;? extends Annotation&gt; annotationType();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>作用域</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">ElementType</span> </span>&#123;</span><br><span class="line">    TYPE,               <span class="comment">/* 类、接口（包括注释类型）或枚举声明  */</span></span><br><span class="line">    FIELD,              <span class="comment">/* 字段声明（包括枚举常量）  */</span></span><br><span class="line">    METHOD,             <span class="comment">/* 方法声明  */</span></span><br><span class="line">    PARAMETER,          <span class="comment">/* 参数声明  */</span></span><br><span class="line">    CONSTRUCTOR,        <span class="comment">/* 构造方法声明  */</span></span><br><span class="line">    LOCAL_VARIABLE,     <span class="comment">/* 局部变量声明  */</span></span><br><span class="line">    ANNOTATION_TYPE,    <span class="comment">/* 注释类型声明  */</span></span><br><span class="line">    PACKAGE             <span class="comment">/* 包声明  */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>作用时间</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> java.lang.annotation;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">RetentionPolicy</span> </span>&#123;</span><br><span class="line">    SOURCE,            <span class="comment">/* Annotation信息仅存在于编译器处理期间，编译器处理完之后就没有该Annotation信息了  */</span></span><br><span class="line">    CLASS,             <span class="comment">/* 编译器将Annotation存储于类对应的.class文件中。默认行为  */</span></span><br><span class="line">    RUNTIME            <span class="comment">/* 编译器将Annotation存储于class文件中，并且可由JVM读入 */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p>属性—抽象方法</p>
<ol>
<li><p>这是一种java特定规约方法,无参+返回</p>
<p>object method();</p>
<p>类似的还有@Test的</p>
<p>void method();</p>
</li>
<li><p>返回值类型</p>
<ol>
<li>注解(不能是自己，循环注解)</li>
<li>string</li>
<li>枚举</li>
<li>数组</li>
<li>基本类型(不是integer)</li>
</ol>
</li>
<li><p>可以default</p>
</li>
<li><p>在注解被使用的时候属性必须有值</p>
</li>
<li><p>每个属性—抽象方法都能根据反射获得值</p>
</li>
</ol>
</li>
<li><p>作用</p>
<ol>
<li>编译检查<ol>
<li>override检查父类是否有该方法<ol>
<li>其实override加不加都能覆盖,但是加了能起到检查的作用</li>
</ol>
</li>
<li>supersswarnings 检查警告</li>
<li></li>
</ol>
</li>
</ol>
</li>
<li><p>4. </p>
</li>
</ol>
]]></content>
      <categories>
        <category>java</category>
      </categories>
  </entry>
  <entry>
    <title>java重写、重载</title>
    <url>/2021/12/07/java/javaSE/%E9%87%8D%E5%86%99%E3%80%81%E9%87%8D%E8%BD%BD/</url>
    <content><![CDATA[<table>
<thead>
<tr>
<th>规则</th>
<th>重写override</th>
<th>重载</th>
</tr>
</thead>
<tbody><tr>
<td>参数</td>
<td>必须一样</td>
<td>必须不一样</td>
</tr>
<tr>
<td>异常</td>
<td>受检异常：子类方法不能抛出父类<strong>没抛出的异常</strong>，也能不抛出。<strong>非受检异常：无规则</strong></td>
<td></td>
</tr>
<tr>
<td>返回值类型</td>
<td>同上（可以理解为返回的范围更小）</td>
<td></td>
</tr>
<tr>
<td>权限</td>
<td>只有父类和子类在同一个包中，才能重写default方法，否则被重写的<strong>最低权限是protected</strong>、并且<strong>访问权限&gt;父亲</strong></td>
<td></td>
</tr>
<tr>
<td>其他</td>
<td>final static 不能被重写</td>
<td><strong>被重载的方法已经不再是父类方法，不受override规则约束</strong></td>
</tr>
</tbody></table>
<h3 id="一、重写-override"><a href="#一、重写-override" class="headerlink" title="一、重写 override"></a>一、重写 override</h3><blockquote>
<p>继承，外壳不变，内容改变</p>
</blockquote>
<h4 id="1-1-参数规则"><a href="#1-1-参数规则" class="headerlink" title="1.1 参数规则"></a>1.1 参数规则</h4><p>​    参数列表必须相同</p>
<h4 id="1-2-异常规则"><a href="#1-2-异常规则" class="headerlink" title="1.2 异常规则"></a>1.2 异常规则</h4><ol>
<li><p>可抛出任意的RuntimeException</p>
</li>
<li><p>对于强制性异常，儿子抛出的异常小于父亲的异常、(儿子抛出子异常)。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">a</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">t</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">b</span> <span class="keyword">extends</span> <span class="title">a</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">t</span><span class="params">()</span> <span class="keyword">throws</span> SQLClientInfoException</span>&#123;</span><br><span class="line">        System.out.println();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="1-3返回值规则"><a href="#1-3返回值规则" class="headerlink" title="1.3返回值规则"></a>1.3返回值规则</h4><p>​    返回值必须返回 ? &gt; Object (规则同异常)</p>
<h4 id="1-4-权限规则"><a href="#1-4-权限规则" class="headerlink" title="1.4 权限规则"></a>1.4 权限规则</h4><p>​    只有父类和子类在同一个包中，才能重写default方法，否则被重写的最低权限是protected、并且访问权限&gt;父亲</p>
<h4 id="1-5-其他规则"><a href="#1-5-其他规则" class="headerlink" title="1.5 其他规则"></a>1.5 其他规则</h4><ol>
<li>final、static、构造方法不能被重写</li>
<li>写@override注解的优点<ol>
<li>可以当注释用,方便阅读</li>
<li>编译器可以验证@Override下面的方法名是否是你父类中所有的，如果没有则报错</li>
</ol>
</li>
</ol>
<h3 id="二、重载"><a href="#二、重载" class="headerlink" title="二、重载"></a>二、重载</h3><blockquote>
<p>原则：本质上是两个方法，基于参数列表区分</p>
</blockquote>
<h4 id="2-1-参数规则"><a href="#2-1-参数规则" class="headerlink" title="2.1 参数规则"></a>2.1 参数规则</h4><p><strong>必须</strong>改变参数列表(参数个数或类型不一样)</p>
]]></content>
  </entry>
  <entry>
    <title>java多线程关键字理解</title>
    <url>/2021/12/23/java/java%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB/Java%E5%85%B3%E9%94%AE%E5%AD%97/</url>
    <content><![CDATA[<p>[toc]</p>
<h2 id="一、synchronized"><a href="#一、synchronized" class="headerlink" title="一、synchronized"></a>一、synchronized</h2><p><a href="(http://hollischuang.gitee.io/tobetopjavaer/#/basics/concurrent-coding/synchronized?id=synchronized%E7%9A%84%E7%94%A8%E6%B3%95)">参考</a></p>
<blockquote>
<p> 当我们想要保证一个共享资源在同一时间只会被一个线程访问到时，我们可以在代码中使用<code>synchronized</code>关键字对类或者对象加锁/同步。</p>
</blockquote>
<blockquote>
<p><code>synchronized</code>关键字在需要原子性、可见性和有序性这三种特性的时候都可以作为其中一种解决方案，看起来是“万能”的。的确，大部分并发控制操作都能使用synchronized来完成。</p>
</blockquote>
<h3 id="1-1-用法"><a href="#1-1-用法" class="headerlink" title="1.1 用法"></a>1.1 用法</h3><h3 id="1-2-原理"><a href="#1-2-原理" class="headerlink" title="1.2 原理"></a>1.2 原理</h3><h3 id="1-3-CSA"><a href="#1-3-CSA" class="headerlink" title="1.3 CSA"></a>1.3 CSA</h3><h3 id="可见性"><a href="#可见性" class="headerlink" title="可见性"></a>可见性</h3><blockquote>
<p>可见性是指当多个线程访问同一个变量时，一个线程修改了这个变量的值，其他线程能够立即看得到修改的值。</p>
</blockquote>
<h2 id="二、volatile"><a href="#二、volatile" class="headerlink" title="二、volatile"></a>二、volatile</h2><h3 id="锁机制缺点"><a href="#锁机制缺点" class="headerlink" title="锁机制缺点"></a>锁机制缺点</h3><p>（1）在多线程竞争下，加锁、释放锁会导致比较多的上下文切换和调度延时，引起性能问题。</p>
<p>（2）一个线程持有锁会导致其它所有需要此锁的线程挂起。</p>
<p>（3）如果一个优先级高的线程等待一个优先级低的线程释放锁会导致优先级倒置，引起性能风险。</p>
<p>volatile是不错的机制，但是volatile不能保证原子性。因此对于同步最终还是要回到锁机制上来。</p>
<p>独占锁是一种悲观锁，synchronized就是一种独占锁，会导致其它所有需要锁的线程挂起，等待持有锁的线程释放锁。而另一个更加有效的锁就是乐观锁。所谓乐观锁就是，每次不加锁而是假设没有冲突而去完成某项操作，如果因为冲突失败就重试，直到成功为止。乐观锁用到的机制就是CAS，Compare and Swap。</p>
<h3 id="三、"><a href="#三、" class="headerlink" title="三、= ="></a>三、= =</h3><blockquote>
<p>双等号</p>
</blockquote>
<p>java中的数据类型，可分为两类：</p>
<ol>
<li>基本数据类型：比较的是他们的值。</li>
<li>引用类型<br>比较的是他们在内存中的存放地址，所以，除非是同一个new出来的对象，他们的比较后的结果为true，否则比较后结果为false。 JAVA当中所有的类都是继承于Object这个基类的，在Object中的基类中定义了一个equals的方法，这个方法的初始行为是比较对象的内存地 址，但在一些类库当中这个方法被覆盖掉了，如String,Integer,Date在这些类当中equals有其自身的实现，而不再是比较类在堆内存中的存放地址了。<br> 对于复合数据类型之间进行equals比较，在没有覆写equals方法的情况下，他们之间的比较还是基于他们在内存中的存放位置的地址值的，因为Object的equals方法也是用双等号（==）进行比较的，所以比较后的结果跟双等号（==）的结果相同。</li>
</ol>
<h2 id="三、transient"><a href="#三、transient" class="headerlink" title="三、transient"></a>三、<a href="http://hollischuang.gitee.io/tobetopjavaer/#/basics/java-basic/transient-in-java?id=transient">transient</a></h2><blockquote>
<p>​    transient修饰的成员变量，在序列化的时候其值会被忽略，在被反序列化后， transient 变量的值被设为初始值， 如 int 型的是 0，对象型的是 null。</p>
</blockquote>
]]></content>
      <categories>
        <category>java</category>
        <category>JUC</category>
      </categories>
  </entry>
  <entry>
    <title>java常用工具类源码</title>
    <url>/2022/03/13/java/java%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB/java%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB/</url>
    <content><![CDATA[<h3 id="比较器Comparator"><a href="#比较器Comparator" class="headerlink" title="比较器Comparator"></a>比较器Comparator</h3><h3 id="一、比较器Comparator"><a href="#一、比较器Comparator" class="headerlink" title="一、比较器Comparator"></a>一、比较器Comparator</h3><ol>
<li><p>Arrays.sort(users,new Comparator)</p>
<p>-&gt;TimSort.sort(user,0,length,comparator)</p>
<p>-&gt;if(len&lt;32)</p>
<p>​    –&gt;i++找到合适开始index</p>
<p>​    –&gt;2进制插入排序binarySort(a,index,length,c)</p>
<p>​    –&gt;这是对少量元素进行排序的最佳方法，它需</p>
</li>
</ol>
<span id="more"></span>

<ol start="2">
<li><p>要O（n logn）比较，但需要O（n^2）数据移动（最坏情况</p>
<p>-&gt;else -&gt;Timsort</p>
</li>
<li><p>Arrays.sort(int[])–&gt;优化的快排</p>
</li>
</ol>
<h3 id="二、org-apache-logging-log4j-util-Strings-final"><a href="#二、org-apache-logging-log4j-util-Strings-final" class="headerlink" title="二、org.apache.logging.log4j.util.Strings(final)"></a>二、org.apache.logging.log4j.util.Strings(final)</h3><ol>
<li><p>isEmpty</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">return</span> cs == <span class="keyword">null</span> || cs.length() == <span class="number">0</span>;</span><br></pre></td></tr></table></figure></li>
<li><p>isBlank 是否是空白</p>
</li>
</ol>
<h3 id="三、java-lang"><a href="#三、java-lang" class="headerlink" title="三、java.lang"></a>三、java.lang</h3><ol>
<li><p>final class</p>
<ol>
<li><p>String</p>
<ol>
<li><p>charAt,indexOf,compareTo,concat(str),contain,equals,endsWith,ifEmpty</p>
<p>replace,split</p>
</li>
<li><p>copyValueOf(),valueOf(char[],begin,length),valueOf(基本类型)</p>
</li>
<li><p>subString(begin,end),toLowerCase,trim</p>
</li>
</ol>
</li>
<li><p>Character</p>
<ol>
<li>equals,isLetter是否是一个字母,isLowLetter是否小写字母，toLowCase,compareTo</li>
<li>digit</li>
</ol>
</li>
<li><p>Object</p>
<ol>
<li><p>final native getClass 获得运行时Class而非String/类 com.wyg.entity.user,也可能是他的子类。</p>
</li>
<li><p>native clone</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">x.clone()!=x</span><br><span class="line">x.clone().getClass()==x</span><br><span class="line">x.clone().equal(<span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure></li>
<li><p>native hashcode</p>
</li>
<li><p>可重写：toString,equals</p>
</li>
</ol>
</li>
<li><p>java.util.Objects  //对Object对象处理的方法类</p>
<ol>
<li><p>深度判等</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">deepEquals(Object a, Object b)</span><br><span class="line">   <span class="keyword">if</span> (a == b)</span><br><span class="line">   	<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">   <span class="keyword">else</span> <span class="keyword">if</span> (a == <span class="keyword">null</span> || b == <span class="keyword">null</span>)</span><br><span class="line">   	<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">   <span class="keyword">else</span></span><br><span class="line">   	<span class="keyword">return</span> Arrays.deepEquals0(a, b);</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p>System</p>
<ol>
<li><p>获取系统信息，修改系统信息，标准输入输出流，加载文件、库。</p>
</li>
<li><p>native void arraycopy(src[],begin1,dest[],begin2,length)</p>
</li>
<li><p>exit退出</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">exit</span><span class="params">(<span class="keyword">int</span> status)</span> </span>&#123;</span><br><span class="line">       Runtime.getRuntime().exit(status);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p>Math</p>
</li>
<li><p>Thread</p>
</li>
</ol>
</li>
<li><p>class</p>
<ol>
<li>interface Runable</li>
<li>Thread implements Runnable<ol>
<li>static sleep 当前线程休息</li>
<li>start,调用run</li>
<li>getId,getName</li>
<li>static currentThread,返回当前线程</li>
<li></li>
</ol>
</li>
<li>class Package implements java.lang.reflect.AnnotatedElemen–单例</li>
</ol>
</li>
<li><p>特殊类：</p>
<ol>
<li><p>异常类class Throwable implements Serializable</p>
<ol>
<li>getMassage</li>
<li>printStackTrace</li>
</ol>
</li>
<li><p>final Void</p>
<ol>
<li><p>结合native方法构成关键字</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">native</span> Class&lt;?&gt; getPrimitiveClass(String name);</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p>final Class&lt;T&gt;</p>
<ol>
<li><p>结合native方法构成关键字</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">native</span> Class&lt;?&gt; getPrimitiveClass(String name);</span><br></pre></td></tr></table></figure></li>
<li><p>T newInstance 创造实例</p>
</li>
</ol>
</li>
</ol>
</li>
</ol>
]]></content>
      <categories>
        <category>javay</category>
      </categories>
  </entry>
  <entry>
    <title>NIO</title>
    <url>/2021/11/29/java/java%E7%BB%84%E4%BB%B6/NIO/</url>
    <content><![CDATA[<p>[toc]</p>
<h2 id="一、IO概述"><a href="#一、IO概述" class="headerlink" title="一、IO概述"></a>一、IO概述</h2><ol>
<li>同步阻塞IO-面向流-BIO<ol>
<li>一个请求连接一个线程，</li>
<li>问题：需要创建很多的线程，所有的线程还是同步的</li>
<li>解决：线程池，但是线程池数量有上限</li>
<li>适合请求少的场景，程序简单</li>
</ol>
</li>
<li>同步非阻塞IO-多路复用器-NIO<ol>
<li>一个线程可以处理多个请求</li>
<li>selector 选择器(复用器)</li>
<li>适合请求多，请求时间短：聊天，弹幕</li>
</ol>
</li>
<li>异步非阻塞IO–AIO(NIO2.0)<ol>
<li>一个请求一个线程</li>
<li>适合请求较多，且请求时间长场景</li>
</ol>
</li>
</ol>
<h2 id="二、BIO"><a href="#二、BIO" class="headerlink" title="二、BIO"></a>二、BIO</h2><ol>
<li>java.io</li>
</ol>
<h3 id="2-1-一对一"><a href="#2-1-一对一" class="headerlink" title="2.1 一对一"></a>2.1 一对一</h3><blockquote>
<p>服务端只有一个线程，只能处理唯一一个请求</p>
</blockquote>
<h4 id="2-1-1-服务端"><a href="#2-1-1-服务端" class="headerlink" title="2.1.1 服务端"></a>2.1.1 服务端</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ServerSocket serverSocket=<span class="keyword">new</span> ServerSocket(<span class="number">8888</span>);</span><br><span class="line"><span class="comment">//开启监听</span></span><br><span class="line">Socket accept = serverSocket.accept();</span><br><span class="line"><span class="comment">//从socket获得流</span></span><br><span class="line">InputStream inputStream = accept.getInputStream();</span><br><span class="line"><span class="comment">//包装缓冲区</span></span><br><span class="line">String msg= FileUtil.readFile(inputStream);</span><br><span class="line">System.out.println(msg);</span><br></pre></td></tr></table></figure>

<h4 id="2-1-2-客户端"><a href="#2-1-2-客户端" class="headerlink" title="2.1.2 客户端"></a>2.1.2 客户端</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Socket socket=<span class="keyword">new</span> Socket(<span class="string">&quot;127.0.0.1&quot;</span>,<span class="number">8888</span>);</span><br><span class="line"><span class="comment">//获得输出流</span></span><br><span class="line">OutputStream outputStream = socket.getOutputStream();</span><br><span class="line">PrintWriter printWriter=<span class="keyword">new</span> PrintWriter(outputStream);</span><br><span class="line">Scanner scanner=<span class="keyword">new</span> Scanner(System.in);</span><br><span class="line"><span class="keyword">while</span> (<span class="keyword">true</span>)&#123;</span><br><span class="line">    System.out.print(<span class="string">&quot;发送:&quot;</span>);</span><br><span class="line">    String s = scanner.nextLine();</span><br><span class="line">    <span class="keyword">if</span>(s.equals(<span class="string">&quot;-1&quot;</span>))</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    printWriter.println(s);</span><br><span class="line">    printWriter.flush();</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-2-多对多"><a href="#2-2-多对多" class="headerlink" title="2.2 多对多"></a>2.2 多对多</h3><blockquote>
<p>每个请求创建一个线程去处理请求</p>
</blockquote>
<h4 id="2-2-1-服务端"><a href="#2-2-1-服务端" class="headerlink" title="2.2.1 服务端"></a>2.2.1 服务端</h4><h4 id="2-2-2-客户端"><a href="#2-2-2-客户端" class="headerlink" title="2.2.2 客户端"></a>2.2.2 客户端</h4><h4 id="2-2-3-缺陷"><a href="#2-2-3-缺陷" class="headerlink" title="2.2.3 缺陷"></a>2.2.3 缺陷</h4><ol>
<li>每个请求都创建线程，线程的切换、竞争会浪费资源</li>
<li>线程本身也占用cpu资源</li>
<li>并不是每个请求线程</li>
</ol>
<h3 id="2-3-伪异步"><a href="#2-3-伪异步" class="headerlink" title="2.3 伪异步"></a>2.3 伪异步</h3><ul>
<li>优：创建线程池，能避免创建线程的资源消耗问题</li>
<li>缺：底层还是阻塞的，如果请求处理较慢，那么新的请求就会长时间的再请求队列中，产生大量超时</li>
<li>适应：小批量，请求处理快速的场景</li>
</ul>
<h3 id="BIO总结"><a href="#BIO总结" class="headerlink" title="BIO总结"></a>BIO总结</h3><ol>
<li><p>发送</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">dataOutputStream.flush();</span><br></pre></td></tr></table></figure></li>
<li><p>发送结束声明</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">socket.shutdownOutput();</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="三、NIO"><a href="#三、NIO" class="headerlink" title="三、NIO"></a>三、NIO</h2><h3 id="3-1-NIO概述"><a href="#3-1-NIO概述" class="headerlink" title="3.1 NIO概述"></a>3.1 NIO概述</h3><h4 id="3-1-1-基本概念"><a href="#3-1-1-基本概念" class="headerlink" title="3.1.1 基本概念"></a>3.1.1 基本概念</h4><ol>
<li>since JDK1.4</li>
<li>基于通道的非阻塞IO，IO复用</li>
<li>支持面向缓冲区</li>
</ol>
<h4 id="3-1-2-三大核心组件"><a href="#3-1-2-三大核心组件" class="headerlink" title="3.1.2 三大核心组件"></a>3.1.2 三大核心组件</h4><ol>
<li>Channel 通道</li>
<li>Buffer 缓冲区</li>
<li>Selector 选择器(多路复用器)<ol>
<li>轮询每个通道</li>
</ol>
</li>
</ol>
<h4 id="3-1-3-非阻塞模式"><a href="#3-1-3-非阻塞模式" class="headerlink" title="3.1.3 非阻塞模式"></a>3.1.3 非阻塞模式</h4><p>一个线程可以同时处理很多请求，基于监听器</p>
<h4 id="3-1-4-NIO模型图"><a href="#3-1-4-NIO模型图" class="headerlink" title="3.1.4 NIO模型图"></a>3.1.4 NIO模型图</h4><p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20211207225509511.png" alt="image-20211207225509511"></p>
<h4 id="3-1-5-NIO-vs-BIO"><a href="#3-1-5-NIO-vs-BIO" class="headerlink" title="3.1.5 NIO  vs  BIO"></a>3.1.5 NIO  vs  BIO</h4><table>
<thead>
<tr>
<th>BIO</th>
<th>NIO</th>
</tr>
</thead>
<tbody><tr>
<td>数据流(字节，字符)</td>
<td>数据块(缓冲区，通道)</td>
</tr>
<tr>
<td>流：单向</td>
<td>通道：双向</td>
</tr>
<tr>
<td>阻塞</td>
<td>非阻塞</td>
</tr>
<tr>
<td>一个请求需要一个线程</td>
<td>一个线程处理处理多个请求(选择器监听)</td>
</tr>
</tbody></table>
<h3 id="3-2-Buffer"><a href="#3-2-Buffer" class="headerlink" title="3.2 Buffer"></a>3.2 Buffer</h3><h4 id="3-2-2-Buffer属性"><a href="#3-2-2-Buffer属性" class="headerlink" title="3.2.2 Buffer属性"></a>3.2.2 Buffer属性</h4><ol>
<li>容量：数组大小,不可更改<ol>
<li>通过allocate分配</li>
</ol>
</li>
<li>限制：可操作的最后位置<ol>
<li>读：表示有数据的最后位置</li>
<li>写：表示容量</li>
</ol>
</li>
<li>位置：写入、读取的当前位置索引<ol>
<li>标记：mark该位置</li>
<li>重置：重置到mark位置</li>
</ol>
</li>
</ol>
<h4 id="3-2-3-Buffer-Api"><a href="#3-2-3-Buffer-Api" class="headerlink" title="3.2.3 Buffer Api"></a>3.2.3 Buffer Api</h4><ol>
<li>clear 清空缓存区</li>
<li>flip：转换成可读模式</li>
<li>Remaining：获得缓冲区长度</li>
<li>hasRemaining：是否有数据</li>
<li>rewind：将位置置0清除mark</li>
</ol>
<h4 id="3-2-4-缓冲区分类"><a href="#3-2-4-缓冲区分类" class="headerlink" title="3.2.4 缓冲区分类"></a>3.2.4 缓冲区分类</h4><h5 id="3-2-4-1-直接缓冲区"><a href="#3-2-4-1-直接缓冲区" class="headerlink" title="3.2.4.1 直接缓冲区"></a>3.2.4.1 直接缓冲区</h5><blockquote>
<p>写入到直接内存，高并发场景</p>
</blockquote>
<h5 id="3-2-4-2-非直接缓冲区"><a href="#3-2-4-2-非直接缓冲区" class="headerlink" title="3.2.4.2 非直接缓冲区"></a>3.2.4.2 非直接缓冲区</h5><blockquote>
<p>写入堆内存</p>
</blockquote>
<h3 id="3-3-Channel"><a href="#3-3-Channel" class="headerlink" title="3.3 Channel"></a>3.3 Channel</h3><blockquote>
<p>Channel代表这一个网络连接通道，当Channel注册到Selector后会返回一个SelectionKey对象，该SelectionKey对象则代表这这个Channel和它注册的Selector间的关系。并且SelectionKey中维护着两个很重要的属性：interestOps、readyOps。</p>
<p>interestOps是我们希望Selector监听Channel的哪些事件。我们将我们感兴趣的事件设置到该字段，这样在selection操作时，当发现该Channel有我们所<strong>感兴趣的事件</strong>发生时，就会将我们感兴趣的事件再设置到readyOps中，这样我们就能得知是哪些事件发生了以做相应处理。 </p>
</blockquote>
<h4 id="3-3-1-特点"><a href="#3-3-1-特点" class="headerlink" title="3.3.1 特点"></a>3.3.1 特点</h4><ol>
<li>双向的</li>
<li>不能直接数据交互，需借助buffer</li>
<li>异步读写</li>
</ol>
<h4 id="3-3-2-Channel实现"><a href="#3-3-2-Channel实现" class="headerlink" title="3.3.2 Channel实现"></a>3.3.2 Channel实现</h4><ol>
<li>FileChannel 文件</li>
<li>DatagramChannel  UDP</li>
<li>SocketChannel  TCP</li>
<li>ServerSockeChannel  监听Web的TCP连接，每一个连接创建一个Channel</li>
</ol>
<h3 id="3-4-Selector"><a href="#3-4-Selector" class="headerlink" title="3.4 Selector"></a>3.4 Selector</h3><blockquote>
<p>选择器，Selector是NIO中实现I/O多路复用的关键类。Selector实现了通过一个线程管理多个Channel，从而管理多个网络连接的目的，</p>
</blockquote>
<h4 id="3-4-1-工作方式"><a href="#3-4-1-工作方式" class="headerlink" title="3.4.1 工作方式"></a>3.4.1 工作方式</h4><blockquote>
<p>多个 Channel 以事件的方式可以注册到同一个Selector，如果有事件发生，便获取事件然后针对每个事件进行相应的处理。这样就可以只用<strong>一个单线程</strong>去管理<strong>多个通道</strong>，也就是管理多个连接和请求。避免了多线程之间的上下文切换导致的开销</p>
</blockquote>
<h4 id="3-4-2-选择器作用"><a href="#3-4-2-选择器作用" class="headerlink" title="3.4.2 选择器作用"></a>3.4.2 选择器作用</h4><ol>
<li>轮询Channel选出可用的Channel</li>
</ol>
<h3 id="3-5-Reactor模式"><a href="#3-5-Reactor模式" class="headerlink" title="3.5 Reactor模式"></a>3.5 Reactor模式</h3><ol>
<li><a href="https://zhuanlan.zhihu.com/p/93612337">参考</a></li>
</ol>
]]></content>
      <categories>
        <category>java高级</category>
      </categories>
  </entry>
  <entry>
    <title>contentType</title>
    <url>/2021/11/10/java/java%E7%BB%84%E4%BB%B6/file-content-type/</url>
    <content><![CDATA[<p>[toc]</p>
<h3 id="一、比较全面的contentType的类型值"><a href="#一、比较全面的contentType的类型值" class="headerlink" title="一、比较全面的contentType的类型值"></a>一、比较全面的contentType的类型值</h3><p><a href="https://blog.csdn.net/qq_37651267/article/details/91380351">参考</a></p>
<p>文件扩展名    Content-Type(Mime-Type)    文件扩展名    Content-Type(Mime-Type)</p>
<span id="more"></span>

<p>.<em>（ 二进制流，不知道下载文件类型）    application/octet-stream    .tif    image/tiff<br>.asp    text/asp    .asx    video/x-ms-asf<br>.au    audio/basic    .avi    video/avi<br>.awf    application/vnd.adobe.workflow    .biz    text/xml<br>.bmp    application/x-bmp    .bot    application/x-bot<br>.cit    application/x-cit    .class    java/</em><br>.csi    application/x-csi    .css    text/css<br>.dcd    text/xml    .dcx    application/x-dcx<br>.dib    application/x-dib    .dll    application/x-msdownload<br>.doc    application/msword    .dot    application/msword<br>.drw    application/x-drw    .dtd    text/xml<br>.dwf    Model/vnd.dwf    .dwf    application/x-dwf<br>.etd    application/x-ebx    .exe    application/x-msdownload<br>.gif    image/gif    .gl2    application/x-gl2<br>.hrf    application/x-hrf    .hta    application/hta<br>.htc    text/x-component    .htm    text/html<br>.html    text/html    .htt    text/webviewhtml<br>.htx    text/html    .icb    application/x-icb<br>.ico    image/x-icon    .ico    application/x-ico<br>.iff    application/x-iff    .ig4    application/x-g4<br>.igs    application/x-igs    .iii    application/x-iphone<br>.img    application/x-img    .ins    application/x-internet-signup<br>.java    java/*    .jfif    image/jpeg<br>.jpe    image/jpeg    .jpe    application/x-jpe<br>.jpeg    image/jpeg    .jpg    image/jpeg<br>.jpg    application/x-jpg    .js    application/x-javascript<br>.jsp    text/html    .la1    audio/x-liquid-file<br>.mdb    application/msaccess    .mdb    application/x-mdb<br>.mfp    application/x-shockwave-flash    .mht    message/rfc822<br>.mhtml    message/rfc822    .mi    application/x-mi<br>.mid    audio/mid    .midi    audio/mid<br>.mil    application/x-mil    .mml    text/xml<br>.mnd    audio/x-musicnet-download    .mns    audio/x-musicnet-stream<br>.mocha    application/x-javascript    .movie    video/x-sgi-movie<br>.mp1    audio/mp1    .mp2    audio/mp2<br>.mp2v    video/mpeg    .mp3    audio/mp3<br>.mp4    video/mpeg4    .mpa    video/x-mpg<br>.mpd    application/vnd.ms-project    .mpe    video/x-mpeg<br>.mpeg    video/mpg    .mpg    video/mpg<br>.mpga    audio/rn-mpeg    .mpp    application/vnd.ms-project<br>.mps    video/x-mpeg    .mpt    application/vnd.ms-project<br>.mpv    video/mpg    .mpv2    video/mpeg<br>.mpw    application/vnd.ms-project    .mpx    application/vnd.ms-project<br>.mtx    text/xml    .mxp    application/x-mmxp<br>.net    image/pnetvue    .nrf    application/x-nrf<br>.nws    message/rfc822    .odc    text/x-ms-odc<br>.out    application/x-out    .p10    application/pkcs10<br>.p12    application/x-pkcs12    .p7b    application/x-pkcs7-certificates<br>.p7c    application/pkcs7-mime    .p7m    application/pkcs7-mime<br>.p7r    application/x-pkcs7-certreqresp    .p7s    application/pkcs7-signature<br>.pc5    application/x-pc5    .pci    application/x-pci<br>.pcl    application/x-pcl    .pcx    application/x-pcx<br>.pdf    application/pdf    .pdf    application/pdf<br>.pdx    application/vnd.adobe.pdx    .pfx    application/x-pkcs12<br>.pgl    application/x-pgl    .pic    application/x-pic<br>.pko    application/vnd.ms-pki.pko    .pl    application/x-perl<br>.plg    text/html    .pls    audio/scpls<br>.plt    application/x-plt    .png    image/png<br>.png    application/x-png    .pot    application/vnd.ms-powerpoint<br>.ppa    application/vnd.ms-powerpoint    .ppm    application/x-ppm<br>.pps    application/vnd.ms-powerpoint    .ppt    application/vnd.ms-powerpoint<br>.ppt    application/x-ppt    .pr    application/x-pr<br>.prf    application/pics-rules    .prn    application/x-prn<br>.prt    application/x-prt    .ps    application/x-ps<br>.ps    application/postscript    .ptn    application/x-ptn<br>.pwz    application/vnd.ms-powerpoint    .r3t    text/vnd.rn-realtext3d<br>.ra    audio/vnd.rn-realaudio    .ram    audio/x-pn-realaudio<br>.ras    application/x-ras    .rat    application/rat-file<br>.rdf    text/xml    .rec    application/vnd.rn-recording<br>.red    application/x-red    .rgb    application/x-rgb<br>.rjs    application/vnd.rn-realsystem-rjs    .rjt    application/vnd.rn-realsystem-rjt<br>.rlc    application/x-rlc    .rle    application/x-rle<br>.rm    application/vnd.rn-realmedia    .rmf    application/vnd.adobe.rmf<br>.rmi    audio/mid    .rmj    application/vnd.rn-realsystem-rmj<br>.rmm    audio/x-pn-realaudio    .rmp    application/vnd.rn-rn_music_package<br>.rms    application/vnd.rn-realmedia-secure    .rmvb    application/vnd.rn-realmedia-vbr<br>.rmx    application/vnd.rn-realsystem-rmx    .rnx    application/vnd.rn-realplayer<br>.rp    image/vnd.rn-realpix    .rpm    audio/x-pn-realaudio-plugin<br>.rsml    application/vnd.rn-rsml    .rt    text/vnd.rn-realtext<br>.rtf    application/msword    .rtf    application/x-rtf<br>.rv    video/vnd.rn-realvideo    .sam    application/x-sam<br>.sat    application/x-sat    .sdp    application/sdp<br>.sdw    application/x-sdw    .sit    application/x-stuffit<br>.slb    application/x-slb    .sld    application/x-sld<br>.slk    drawing/x-slk    .smi    application/smil<br>.smil    application/smil    .smk    application/x-smk<br>.snd    audio/basic    .sol    text/plain<br>.sor    text/plain    .spc    application/x-pkcs7-certificates<br>.spl    application/futuresplash    .spp    text/xml<br>.ssm    application/streamingmedia    .sst    application/vnd.ms-pki.certstore<br>.stl    application/vnd.ms-pki.stl    .stm    text/html<br>.sty    application/x-sty    .svg    text/xml<br>.swf    application/x-shockwave-flash    .tdf    application/x-tdf<br>.tg4    application/x-tg4    .tga    application/x-tga<br>.tif    image/tiff    .tif    application/x-tif<br>.tiff    image/tiff    .tld    text/xml<br>.top    drawing/x-top    .torrent    application/x-bittorrent<br>.tsd    text/xml    .txt    text/plain<br>.uin    application/x-icq    .uls    text/iuls<br>.vcf    text/x-vcard    .vda    application/x-vda<br>.vdx    application/vnd.visio    .vml    text/xml<br>.vpg    application/x-vpeg005    .vsd    application/vnd.visio<br>.vsd    application/x-vsd    .vss    application/vnd.visio<br>.vst    application/vnd.visio    .vst    application/x-vst<br>.vsw    application/vnd.visio    .vsx    application/vnd.visio<br>.vtx    application/vnd.visio    .vxml    text/xml<br>.wav    audio/wav    .wax    audio/x-ms-wax<br>.wb1    application/x-wb1    .wb2    application/x-wb2<br>.wb3    application/x-wb3    .wbmp    image/vnd.wap.wbmp<br>.wiz    application/msword    .wk3    application/x-wk3<br>.wk4    application/x-wk4    .wkq    application/x-wkq<br>.wks    application/x-wks    .wm    video/x-ms-wm<br>.wma    audio/x-ms-wma    .wmd    application/x-ms-wmd<br>.wmf    application/x-wmf    .wml    text/vnd.wap.wml<br>.wmv    video/x-ms-wmv    .wmx    video/x-ms-wmx<br>.wmz    application/x-ms-wmz    .wp6    application/x-wp6<br>.wpd    application/x-wpd    .wpg    application/x-wpg<br>.wpl    application/vnd.ms-wpl    .wq1    application/x-wq1<br>.wr1    application/x-wr1    .wri    application/x-wri<br>.wrk    application/x-wrk    .ws    application/x-ws<br>.ws2    application/x-ws    .wsc    text/scriptlet<br>.wsdl    text/xml    .wvx    video/x-ms-wvx<br>.xdp    application/vnd.adobe.xdp    .xdr    text/xml<br>.xfd    application/vnd.adobe.xfd    .xfdf    application/vnd.adobe.xfdf<br>.xhtml    text/html    .xls    application/vnd.ms-excel<br>.xls    application/x-xls    .xlw    application/x-xlw<br>.xml    text/xml    .xpl    audio/scpls<br>.xq    text/xml    .xql    text/xml<br>.xquery    text/xml    .xsd    text/xml<br>.xsl    text/xml    .xslt    text/xml<br>.xwd    application/x-xwd    .x_b    application/x-x_b<br>.sis    application/vnd.symbian.install    .sisx    application/vnd.symbian.install<br>.x_t    application/x-x_t    .ipa    application/vnd.iphone<br>.apk    application/vnd.android.package-archive    .xap    application/x-silverlight-app</p>
<h3 id="二、Requests"><a href="#二、Requests" class="headerlink" title="二、Requests"></a>二、Requests</h3><p>Heade r    解释    示例<br>Accept    指定客户端能够接收的内容类型    Accept: text/plain, text/html<br>Accept-Charset    浏览器可以接受的字符编码集。    Accept-Charset: iso-8859-5<br>Accept-Encoding    指定浏览器可以支持的web服务器返回内容压缩编码类型。    Accept-Encoding: compress, gzip<br>Accept-Language    浏览器可接受的语言    Accept-Language: en,zh<br>Accept-Ranges    可以请求网页实体的一个或者多个子范围字段    Accept-Ranges: bytes<br>Authorization    HTTP授权的授权证书    Authorization: Basic QWxhZGRpbjpvcGVuIHNlc2FtZQ==<br>Cache-Control    指定请求和响应遵循的缓存机制    Cache-Control: no-cache<br>Connection    表示是否需要持久连接。    （HTTP 1.1默认进行持久连接）<br>Cookie    HTTP请求发送时，会把保存在该请求域名下的所有cookie值一起发送给web服务器。    Cookie: $Version=1; Skin=new;<br>Content-Length    请求的内容长度    Content-Length: 348<br>Content-Type    请求的与实体对应的MIME信息    Content-Type: application/x-www-form-urlencoded<br>Date    请求发送的日期和时间    Date: Tue, 15 Nov 2010 08:12:31 GMT<br>Expect    请求的特定的服务器行为    Expect: 100-continue<br>From    发出请求的用户的Email    From: <a href="mailto:&#117;&#115;&#x65;&#x72;&#64;&#101;&#x6d;&#x61;&#x69;&#x6c;&#x2e;&#x63;&#x6f;&#109;">&#117;&#115;&#x65;&#x72;&#64;&#101;&#x6d;&#x61;&#x69;&#x6c;&#x2e;&#x63;&#x6f;&#109;</a><br>Host    指定请求的服务器的域名和端口号    Host: <a href="http://www.zcmhi.com/">www.zcmhi.com</a><br>If-Match    只有请求内容与实体相匹配才有效    If-Match: “737060cd8c284d8af7ad3082f209582d”<br>If-Modified-Since    如果请求的部分在指定时间之后被修改则请求成功，未被修改则返回304代码    If-Modified-Since: Sat, 29 Oct 2010 19:43:31 GMT<br>If-None-Match    如果内容未改变返回304代码，参数为服务器先前发送的Etag，与服务器回应的Etag比较判断是否改变    If-None-Match: “737060cd8c284d8af7ad3082f209582d”<br>If-Range    如果实体未改变，服务器发送客户端丢失的部分，否则发送整个实体。参数也为Etag    If-Range: “737060cd8c284d8af7ad3082f209582d”<br>If-Unmodified-Since    只在实体在指定时间之后未被修改才请求成功    If-Unmodified-Since: Sat, 29 Oct 2010 19:43:31 GMT<br>Max-Forwards    限制信息通过代理和网关传送的时间    Max-Forwards: 10<br>Pragma    用来包含实现特定的指令    Pragma: no-cache<br>Proxy-Authorization    连接到代理的授权证书    Proxy-Authorization: Basic QWxhZGRpbjpvcGVuIHNlc2FtZQ==<br>Range    只请求实体的一部分，指定范围    Range: bytes=500-999<br>Referer    先前网页的地址，当前请求网页紧随其后,即来路    Referer: <a href="http://www.zcmhi.com/archives/71.html">http://www.zcmhi.com/archives/71.html</a><br>TE    客户端愿意接受的传输编码，并通知服务器接受接受尾加头信息    TE: trailers,deflate;q=0.5<br>Upgrade    向服务器指定某种传输协议以便服务器进行转换（如果支持）    Upgrade: HTTP/2.0, SHTTP/1.3, IRC/6.9, RTA/x11<br>User-Agent    User-Agent的内容包含发出请求的用户信息    User-Agent: Mozilla/5.0 (Linux; X11)<br>Via    通知中间网关或代理服务器地址，通信协议    Via: 1.0 fred, 1.1 nowhere.com (Apache/1.1)<br>Warning    关于消息实体的警告信息    Warn: 199 Miscellaneous warning</p>
<h3 id="三、Responses"><a href="#三、Responses" class="headerlink" title="三、Responses"></a>三、Responses</h3><p>Heade r    解释    示例<br>Accept-Ranges    表明服务器是否支持指定范围请求及哪种类型的分段请求    Accept-Ranges: bytes<br>Age    从原始服务器到代理缓存形成的估算时间（以秒计，非负）    Age: 12<br>Allow    对某网络资源的有效的请求行为，不允许则返回405    Allow: GET, HEAD<br>Cache-Control    告诉所有的缓存机制是否可以缓存及哪种类型    Cache-Control: no-cache<br>Content-Encoding    web服务器支持的返回内容压缩编码类型。    Content-Encoding: gzip<br>Content-Language    响应体的语言    Content-Language: en,zh<br>Content-Length    响应体的长度    Content-Length: 348<br>Content-Location    请求资源可替代的备用的另一地址    Content-Location: /index.htm<br>Content-MD5    返回资源的MD5校验值    Content-MD5: Q2hlY2sgSW50ZWdyaXR5IQ==<br>Content-Range    在整个返回体中本部分的字节位置    Content-Range: bytes 21010-47021/47022<br>Content-Type    返回内容的MIME类型    Content-Type: text/html; charset=utf-8<br>Date    原始服务器消息发出的时间    Date: Tue, 15 Nov 2010 08:12:31 GMT<br>ETag    请求变量的实体标签的当前值    ETag: “737060cd8c284d8af7ad3082f209582d”<br>Expires    响应过期的日期和时间    Expires: Thu, 01 Dec 2010 16:00:00 GMT<br>Last-Modified    请求资源的最后修改时间    Last-Modified: Tue, 15 Nov 2010 12:45:26 GMT<br>Location    用来重定向接收方到非请求URL的位置来完成请求或标识新的资源    Location: <a href="http://www.zcmhi.com/archives/94.html">http://www.zcmhi.com/archives/94.html</a><br>Pragma    包括实现特定的指令，它可应用到响应链上的任何接收方    Pragma: no-cache<br>Proxy-Authenticate    它指出认证方案和可应用到代理的该URL上的参数    Proxy-Authenticate: Basic<br>refresh    应用于重定向或一个新的资源被创造，在5秒之后重定向（由网景提出，被大部分浏览器支持）    Refresh: 5; url=<a href="http://www.zcmhi.com/archives/94.html">http://www.zcmhi.com/archives/94.html</a><br>Retry-After    如果实体暂时不可取，通知客户端在指定时间之后再次尝试    Retry-After: 120<br>Server    web服务器软件名称    Server: Apache/1.3.27 (Unix) (Red-Hat/Linux)<br>Set-Cookie    设置Http Cookie    Set-Cookie: UserID=JohnDoe; Max-Age=3600; Version=1<br>Trailer    指出头域在分块传输编码的尾部存在    Trailer: Max-Forwards<br>Transfer-Encoding    文件传输编码    Transfer-Encoding:chunked<br>Vary    告诉下游代理是使用缓存响应还是从原始服务器请求    Vary: *<br>Via    告知代理客户端响应是通过哪里发送的    Via: 1.0 fred, 1.1 nowhere.com (Apache/1.1)<br>Warning    警告实体可能存在的问题    Warning: 199 Miscellaneous warning<br>WWW-Authenticate    表明客户端请求实体应该使用的授权方案    WWW-Authenticate: Basic</p>
]]></content>
  </entry>
  <entry>
    <title>vuepress</title>
    <url>/2021/11/22/java/java%E7%BB%84%E4%BB%B6/%E6%96%87%E4%BB%B6/</url>
    <content><![CDATA[<h2 id="一、基本使用"><a href="#一、基本使用" class="headerlink" title="一、基本使用"></a>一、基本使用</h2><ol>
<li><p>.vuepress文件夹，所有 VuePress 相关的文件都将会被放在这里</p>
<ol>
<li><p>一个 VuePress 网站必要的配置文件是 <code>.vuepress/config.js</code>，它应该导出一个 JavaScript 对象：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="attr">title</span>: <span class="string">&#x27;Hello VuePress&#x27;</span>,</span><br><span class="line">  <span class="attr">description</span>: <span class="string">&#x27;Just playing around&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p>官网 <a href="https://vuepress.vuejs.org/zh/guide/getting-started.html">https://vuepress.vuejs.org/zh/guide/getting-started.html</a></p>
</li>
<li><p>启动 npm run  docs:dev</p>
</li>
<li></li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">默认主题提供了一些选项，让你可以去自定义导航栏（navbar）、 侧边栏（sidebar）和 首页（homepage） </span><br><span class="line"></span><br><span class="line">### 2.1 Header</span><br><span class="line"></span><br><span class="line">```yaml</span><br><span class="line">---</span><br><span class="line">home: true</span><br><span class="line">heroImage: /hero.png</span><br><span class="line">heroText: Hero 标题</span><br><span class="line">tagline: Hero 副标题</span><br><span class="line"># navbar: false 禁用导航栏</span><br><span class="line">actionText: 快速上手 →</span><br><span class="line">actionLink: /zh/guide/</span><br><span class="line">features:</span><br><span class="line">- title: 简洁至上</span><br><span class="line">  details: 以 Markdown 为中心的项目结构，以最少的配置帮助你专注于写作。</span><br><span class="line">- title: Vue驱动</span><br><span class="line">  details: 享受 Vue + webpack 的开发体验，在 Markdown 中使用 Vue 组件，同时可以使用 Vue 来开发自定义主题。</span><br><span class="line">- title: 高性能</span><br><span class="line">  details: VuePress 为每个页面预渲染生成静态的 HTML，同时在页面被加载的时候，将作为 SPA 运行。</span><br><span class="line">footer: MIT Licensed | Copyright © 2018-present Evan You</span><br><span class="line">---</span><br></pre></td></tr></table></figure>

<h3 id="2-2-Frontmatter"><a href="#2-2-Frontmatter" class="headerlink" title="2.2 Frontmatter"></a>2.2 Frontmatter</h3><h3 id="2-2-1-首页"><a href="#2-2-1-首页" class="headerlink" title="2.2.1 首页"></a>2.2.1 首页</h3><table>
<thead>
<tr>
<th>关键字</th>
<th>功能</th>
<th>用例</th>
</tr>
</thead>
<tbody><tr>
<td>home</td>
<td>是否首页</td>
<td>home: true</td>
</tr>
<tr>
<td>heroImage</td>
<td>首页图片的 URL</td>
<td># Public 文件路径 heroImage: /images/hero.png</td>
</tr>
<tr>
<td>heroText</td>
<td>首页标题</td>
<td></td>
</tr>
<tr>
<td>tagline</td>
<td>首页标语,则默认使用站点 <a href="https://v2.vuepress.vuejs.org/zh/reference/config.html#description">description</a></td>
<td></td>
</tr>
<tr>
<td>actions</td>
<td>首页按钮</td>
<td>actions:   - text: 快速上手     link: /zh/guide/getting-started.html     type: primary</td>
</tr>
<tr>
<td>features</td>
<td>首页下三件简述</td>
<td></td>
</tr>
<tr>
<td>footer</td>
<td>首页页脚</td>
<td></td>
</tr>
<tr>
<td>footerHtml</td>
<td>是否允许页脚中使用 HTML</td>
<td></td>
</tr>
</tbody></table>
<figure class="highlight plaintext"><figcaption><span>普通页面</span></figcaption><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">| 关键字          | 功能                               | 用例                                                         |</span><br><span class="line">| --------------- | ---------------------------------- | ------------------------------------------------------------ |</span><br><span class="line">| editLink        | 编辑此页                           |                                                              |</span><br><span class="line">| editLinkPattern | 本页面中 *编辑此页* 链接的 Pattern | [三项](https://v2.vuepress.vuejs.org/zh/reference/default-theme/config.html#editlinkpattern) |</span><br><span class="line">| sidebar         | 配置侧边栏                         |                                                              |</span><br><span class="line">| navbar          | 导航栏配置                         |                                                              |</span><br><span class="line">| contributors    | 贡献者列表                         |                                                              |</span><br><span class="line"></span><br><span class="line">2.3 搜索框. </span><br><span class="line"></span><br><span class="line">#### 1. 内置搜索</span><br><span class="line"></span><br><span class="line">```js</span><br><span class="line">// .vuepress/config.js</span><br><span class="line">module.exports = &#123;</span><br><span class="line">  themeConfig: &#123;</span><br><span class="line">    search: false,</span><br><span class="line">    searchMaxSuggestions: 10</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="页面滚动"><a href="#页面滚动" class="headerlink" title="页面滚动"></a>页面滚动</h3><h3 id="自定义页面类"><a href="#自定义页面类" class="headerlink" title="自定义页面类"></a>自定义页面类</h3><h3 id="特定页面的自定义布局"><a href="#特定页面的自定义布局" class="headerlink" title="特定页面的自定义布局"></a>特定页面的自定义布局</h3><h2 id="三、配置"><a href="#三、配置" class="headerlink" title="三、配置"></a>三、配置</h2><h3 id="3-1-基本项"><a href="#3-1-基本项" class="headerlink" title="3.1 基本项"></a>3.1 基本项</h3><table>
<thead>
<tr>
<th>关键字</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>lang</td>
<td>语言</td>
</tr>
<tr>
<td>title</td>
<td>标题</td>
</tr>
<tr>
<td>description</td>
<td>描述</td>
</tr>
<tr>
<td>base</td>
<td>git-page相对地址</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h3 id="3-2主题配置"><a href="#3-2主题配置" class="headerlink" title="3.2主题配置"></a>3.2主题配置</h3><ol>
<li>logo logo地址</li>
<li>navbar 导航栏</li>
<li>sidebar 侧边栏</li>
</ol>
<h4 id="3-2-1-导航栏"><a href="#3-2-1-导航栏" class="headerlink" title="3.2.1 导航栏"></a>3.2.1 导航栏</h4><ol>
<li><p>logo</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">   </span><br></pre></td></tr></table></figure></li>
<li><p>导航栏连接</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// .vuepress/config.js</span></span><br><span class="line"><span class="keyword">module</span>.<span class="keyword">exports</span> = &#123;</span><br><span class="line">  themeConfig: &#123;</span><br><span class="line">    nav: [</span><br><span class="line">      &#123; text: <span class="string">&#x27;Home&#x27;</span>, link: <span class="string">&#x27;/&#x27;</span> &#125;,</span><br><span class="line">      &#123; text: <span class="string">&#x27;Guide&#x27;</span>, link: <span class="string">&#x27;/guide/&#x27;</span> &#125;,</span><br><span class="line">      &#123; text: <span class="string">&#x27;External&#x27;</span>, link: <span class="string">&#x27;https://google.com&#x27;</span> &#125;,</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>当你提供了一个 <code>items</code> 数组而不是一个单一的 <code>link</code> 时，它将显示为一个 <code>下拉列表</code> </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// .vuepress/config.js</span></span><br><span class="line"><span class="keyword">module</span>.<span class="keyword">exports</span> = &#123;</span><br><span class="line">  themeConfig: &#123;</span><br><span class="line">    nav: [</span><br><span class="line">      &#123;</span><br><span class="line">        text: <span class="string">&#x27;Languages&#x27;</span>,</span><br><span class="line">        ariaLabel: <span class="string">&#x27;Language Menu&#x27;</span>,</span><br><span class="line">        items: [</span><br><span class="line">          &#123; text: <span class="string">&#x27;Chinese&#x27;</span>, link: <span class="string">&#x27;/language/chinese/&#x27;</span> &#125;,</span><br><span class="line">          &#123; text: <span class="string">&#x27;Japanese&#x27;</span>, link: <span class="string">&#x27;/language/japanese/&#x27;</span> &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>此外，你还可以通过嵌套的 <code>items</code> 来在 <code>下拉列表</code> 中设置分组：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// .vuepress/config.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="attr">themeConfig</span>: &#123;</span><br><span class="line">    <span class="attr">nav</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">text</span>: <span class="string">&#x27;Languages&#x27;</span>,</span><br><span class="line">        <span class="attr">items</span>: [</span><br><span class="line">          &#123; <span class="attr">text</span>: <span class="string">&#x27;Group1&#x27;</span>, <span class="attr">items</span>: [<span class="comment">/*  */</span>] &#125;,</span><br><span class="line">          &#123; <span class="attr">text</span>: <span class="string">&#x27;Group2&#x27;</span>, <span class="attr">items</span>: [<span class="comment">/*  */</span>] &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>禁用</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">themeConfig: &#123;</span><br><span class="line">  navbar: <span class="keyword">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="3-2-2-侧边栏"><a href="#3-2-2-侧边栏" class="headerlink" title="3.2.2 侧边栏"></a>3.2.2 侧边栏</h4><h5 id="3-2-2-1-基本配置"><a href="#3-2-2-1-基本配置" class="headerlink" title="3.2.2.1 基本配置"></a>3.2.2.1 基本配置</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">sidebar: [</span><br><span class="line">     &#123;</span><br><span class="line">       text: <span class="string">&#x27;Guide&#x27;</span>,</span><br><span class="line">       link: <span class="string">&#x27;/guide/&#x27;</span>,</span><br><span class="line">       children: [</span><br><span class="line">         &#123;</span><br><span class="line">           text: <span class="string">&#x27;github&#x27;</span>,</span><br><span class="line">           link: <span class="string">&#x27;https://github.com&#x27;</span>,</span><br><span class="line">           children: [],</span><br><span class="line">         &#125;,</span><br><span class="line">         <span class="string">&#x27;/guide/a.md&#x27;</span>,</span><br><span class="line">         <span class="string">&#x27;/guide/b.md&#x27;</span>,</span><br><span class="line">         <span class="string">&#x27;/guide/c.md&#x27;</span></span><br><span class="line">       ],</span><br><span class="line">     &#125;,</span><br><span class="line">     <span class="string">&#x27;/bar/README.md&#x27;</span>,</span><br><span class="line">   ],</span><br></pre></td></tr></table></figure>

<h5 id="3-2-2-2-注意"><a href="#3-2-2-2-注意" class="headerlink" title="3.2.2.2 注意"></a>3.2.2.2 注意</h5><p>‘/bar/README.md’ 像这种直接写路径的一定要写title</p>
<h5 id="3-2-2-3-侧边栏分组"><a href="#3-2-2-3-侧边栏分组" class="headerlink" title="3.2.2.3 侧边栏分组"></a>3.2.2.3 侧边栏分组</h5><h5 id="3-2-2-4-自动生成侧栏"><a href="#3-2-2-4-自动生成侧栏" class="headerlink" title="3.2.2.4 自动生成侧栏"></a>3.2.2.4 自动生成侧栏</h5><h5 id="3-2-2-5-禁用侧边栏"><a href="#3-2-2-5-禁用侧边栏" class="headerlink" title="3.2.2.5 禁用侧边栏"></a>3.2.2.5 禁用侧边栏</h5><h2 id="四、新增Md渲染"><a href="#四、新增Md渲染" class="headerlink" title="四、新增Md渲染"></a>四、新增Md渲染</h2><h3 id="4-1-内置组件"><a href="#4-1-内置组件" class="headerlink" title="4.1 内置组件"></a>4.1 内置组件</h3><h4 id="4-1-1-Badge-标识"><a href="#4-1-1-Badge-标识" class="headerlink" title="4.1.1 Badge 标识"></a>4.1.1 Badge 标识</h4><ol>
<li><p>语法</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> VuePress - <span class="xml"><span class="tag">&lt;<span class="name">Badge</span> <span class="attr">type</span>=<span class="string">&quot;warning&quot;</span> <span class="attr">text</span>=<span class="string">&quot;v2&quot;</span> <span class="attr">vertical</span>=<span class="string">&quot;middle&quot;</span> /&gt;</span></span></span><br></pre></td></tr></table></figure></li>
<li><p>属性</p>
<ol>
<li>type 类型：’tip’ | ‘warning’ | ‘danger’</li>
<li>vertical 位置：’top’ | ‘middle’ | ‘bottom’ | undefined</li>
</ol>
</li>
</ol>
<h4 id="4-1-2-CodeGroup-多类型代码"><a href="#4-1-2-CodeGroup-多类型代码" class="headerlink" title="4.1.2 CodeGroup 多类型代码"></a>4.1.2 CodeGroup 多类型代码</h4><h4 id="4-1-3-自定义容器"><a href="#4-1-3-自定义容器" class="headerlink" title="4.1.3 自定义容器"></a>4.1.3 自定义容器</h4><ol>
<li><p>语法</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">::: <span class="xml"><span class="tag">&lt;<span class="name">type</span>&gt;</span></span> [title]</span><br><span class="line">[content]</span><br><span class="line">:::</span><br></pre></td></tr></table></figure></li>
<li><p>属性</p>
<ol>
<li>type 类型：tip、warning、danger、details</li>
<li>title 标题  容器提示语</li>
<li>content 内容</li>
</ol>
</li>
</ol>
<h4 id="4-2-渲染"><a href="#4-2-渲染" class="headerlink" title="4.2 渲染"></a>4.2 渲染</h4><h4 id="4-2-1-链接"><a href="#4-2-1-链接" class="headerlink" title="4.2.1 链接"></a>4.2.1 链接</h4><ol>
<li>绝对路径链接 带外链接符号 </li>
<li>相对路径链接 不带</li>
</ol>
<h4 id="4-2-2-标题锚点"><a href="#4-2-2-标题锚点" class="headerlink" title="4.2.2 标题锚点"></a>4.2.2 标题锚点</h4><h4 id="4-2-3-Emoji"><a href="#4-2-3-Emoji" class="headerlink" title="4.2.3 Emoji"></a>4.2.3 <a href="https://github.com/ikatyang/emoji-cheat-sheet">Emoji</a></h4><h4 id="4-2-4-目录"><a href="#4-2-4-目录" class="headerlink" title="4.2.4 目录"></a>4.2.4 目录</h4><h4 id="4-2-5-代码块"><a href="#4-2-5-代码块" class="headerlink" title="4.2.5 代码块"></a>4.2.5 代码块</h4><ol>
<li>行高亮</li>
<li>可编译</li>
</ol>
<h2 id="五、插件"><a href="#五、插件" class="headerlink" title="五、插件"></a>五、插件</h2><h3 id="5-1-google-analytics-网络流量分析"><a href="#5-1-google-analytics-网络流量分析" class="headerlink" title="5.1  google-analytics 网络流量分析"></a>5.1  google-analytics 网络流量分析</h3><h3 id="5-2-search-搜索"><a href="#5-2-search-搜索" class="headerlink" title="5.2 search 搜索"></a>5.2 search 搜索</h3><ol>
<li><p>下载</p>
<figure class="highlight stata"><table><tr><td class="code"><pre><span class="line">npm install vuepress-<span class="keyword">plugin</span>-fulltext-<span class="keyword">search</span></span><br></pre></td></tr></table></figure></li>
<li><p>vi docs/.vuepress/config.js</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">module</span>.<span class="keyword">exports</span> = &#123;</span><br><span class="line"><span class="comment">// .</span></span><br><span class="line">plugins: [<span class="string">&#x27;fulltext-search&#x27;</span>],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="5-3-pwa-渐进式web"><a href="#5-3-pwa-渐进式web" class="headerlink" title="5.3  pwa 渐进式web"></a>5.3  pwa 渐进式web</h3><h2 id="六、主题"><a href="#六、主题" class="headerlink" title="六、主题"></a>六、主题</h2>]]></content>
      <categories>
        <category>util</category>
      </categories>
  </entry>
  <entry>
    <title>时间组件</title>
    <url>/2022/04/09/java/java%E7%BB%84%E4%BB%B6/%E6%97%B6%E9%97%B4%E7%B1%BB/</url>
    <content><![CDATA[<p>[toc]</p>
<h2 id="一、java-util-Date"><a href="#一、java-util-Date" class="headerlink" title="一、java.util.Date"></a>一、java.util.Date</h2><h2 id="二、java-util-calendar"><a href="#二、java-util-calendar" class="headerlink" title="二、java.util.calendar"></a>二、java.util.calendar</h2><h2 id="三、java-time"><a href="#三、java-time" class="headerlink" title="三、java.time"></a>三、java.time</h2><blockquote>
<p>jdk8的新类，</p>
</blockquote>
<h3 id="新类出现的原因"><a href="#新类出现的原因" class="headerlink" title="新类出现的原因"></a>新类出现的原因</h3><ol>
<li><p>原始的Date的toString显示的是Tue Sep 10 09:34:04 CST 2019，</p>
</li>
<li><p>可以用sdf格式化，但是sdf线程不安全，而且格式化类和本类不在一起，影响性能</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> StringBuffer <span class="title">format</span><span class="params">(Date)</span></span>&#123;</span><br><span class="line">	calendar.setTime(date);</span><br><span class="line">&#125;<span class="comment">//sdf的格式默认为year-month-day pm hour:mounth</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">System.out.println(LocalDateTime.now());</span><br><span class="line">System.out.println(LocalDateTime.now().format(DateTimeFormatter.ISO_LOCAL_DATE_TIME));</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="LocalDate"><a href="#LocalDate" class="headerlink" title="LocalDate"></a>LocalDate</h3><h3 id="LocalTime"><a href="#LocalTime" class="headerlink" title="LocalTime"></a>LocalTime</h3><h3 id="LocalDateTime"><a href="#LocalDateTime" class="headerlink" title="LocalDateTime"></a>LocalDateTime</h3><h2 id="四、Calendar"><a href="#四、Calendar" class="headerlink" title="四、Calendar"></a>四、Calendar</h2><h3 id="3-1-创建"><a href="#3-1-创建" class="headerlink" title="3.1 创建"></a>3.1 创建</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Calendar c = Calendar.getInstance();</span><br><span class="line">System.out.println(c.getTime());</span><br></pre></td></tr></table></figure>

<h3 id="3-2-获得部分日期"><a href="#3-2-获得部分日期" class="headerlink" title="3.2 获得部分日期"></a>3.2 获得部分日期</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Calendar c = Calendar.getInstance();</span><br><span class="line">System.out.println(c.get(Calendar.YEAR)); 输出：<span class="number">2021</span></span><br><span class="line">System.out.println(c.get(Calendar.MONTH)); 输出：<span class="number">7</span></span><br><span class="line">System.out.println(c.get(Calendar.DAY_OF_MONTH)); 输出：<span class="number">26</span></span><br></pre></td></tr></table></figure>

<h3 id="3-3-赋值"><a href="#3-3-赋值" class="headerlink" title="3.3 赋值"></a>3.3 赋值</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Calendar ca = Calendar.getInstance();</span><br><span class="line">ca.set(Calendar.YEAR, <span class="number">2019</span>);</span><br><span class="line">ca.set(Calendar.MONTH, <span class="number">0</span>);</span><br><span class="line">ca.set(Calendar.DATE, <span class="number">1</span>);</span><br><span class="line">ca.set(Calendar.HOUR_OF_DAY, <span class="number">0</span>);</span><br><span class="line">ca.set(Calendar.MINUTE, <span class="number">0</span>);</span><br><span class="line">ca.set(Calendar.SECOND, <span class="number">0</span>);</span><br><span class="line">SimpleDateFormat sdf = <span class="keyword">new</span> SimpleDateFormat(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);</span><br><span class="line">System.out.println(sdf.format(ca.getTime())); 输出：<span class="number">2019</span>-<span class="number">01</span>-<span class="number">01</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span></span><br></pre></td></tr></table></figure>

<h3 id="3-4-转换"><a href="#3-4-转换" class="headerlink" title="3.4 转换"></a>3.4 转换</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Cal.setTime(<span class="keyword">new</span> Date());</span><br><span class="line">Date date = cal.getTime;</span><br></pre></td></tr></table></figure>





<h3 id=""><a href="#" class="headerlink" title=""></a></h3><h3 id="自定义"><a href="#自定义" class="headerlink" title="自定义"></a>自定义</h3><ol>
<li><p>sql—util转换</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">java.sql.Date sqlDate = <span class="keyword">new</span> java.sql.Date(utilDate.getTime());</span><br><span class="line">Date date = <span class="keyword">new</span> Date(sqlDate.getTime());<span class="comment">//sql.Date转util.Date        </span></span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="jar包–joda"><a href="#jar包–joda" class="headerlink" title="jar包–joda"></a>jar包–joda</h3><ol>
<li><p>joda</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>joda-time<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>joda-time<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>主要获取当前时间 好看字符串</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">DateTime dt = <span class="keyword">new</span> DateTime();</span><br><span class="line">DateTime dt1 = DateTime.now();<span class="comment">//2021-10-21T13:59:41.040+08:00</span></span><br><span class="line">DateTime dt2 = <span class="keyword">new</span> DateTime(<span class="keyword">new</span> Date());<span class="comment">//2021-10-21T13:59:41.132+08:00</span></span><br><span class="line"><span class="comment">// 指定年月日点分秒生成(参数依次是：年,月,日,时,分,秒,毫秒)</span></span><br><span class="line">DateTime dt3 = <span class="keyword">new</span> DateTime(<span class="number">2012</span>, <span class="number">5</span>, <span class="number">20</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">0</span>, <span class="number">0</span>);        <span class="comment">// 制定ISO8601生成</span></span><br><span class="line">DateTime dt4 = <span class="keyword">new</span> DateTime(<span class="string">&quot;2014-08-01T12:32:3&quot;</span>);</span><br><span class="line">DateTime dt5 = <span class="keyword">new</span> DateTime(<span class="string">&quot;2014-08-01&quot;</span>);</span><br><span class="line">DateTime dt6 = <span class="keyword">new</span> DateTime(Calendar.getInstance())</span><br></pre></td></tr></table></figure>

<span id="more"></span></li>
<li><p>转换  插入数据库</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Date date = <span class="keyword">new</span> Date(<span class="keyword">new</span> DateTime().toDate().getTime());</span><br></pre></td></tr></table></figure></li>
<li></li>
</ol>
]]></content>
      <categories>
        <category>javautils</category>
      </categories>
  </entry>
  <entry>
    <title>java网络请求</title>
    <url>/2022/03/12/java/java%E7%BB%84%E4%BB%B6/%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82/</url>
    <content><![CDATA[<h3 id="org-apache-httpcomponents"><a href="#org-apache-httpcomponents" class="headerlink" title="org.apache.httpcomponents"></a>org.apache.httpcomponents</h3><ol>
<li><p>依赖</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.apache.httpcomponents&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;httpclient&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">4.5</span><span class="number">.13</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>get请求</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title">sendGet</span><span class="params">(String url, Map&lt;String, String&gt; params)</span> </span>&#123;</span><br><span class="line">       CloseableHttpClient client = HttpClients.createDefault();</span><br><span class="line">       HttpGet httpGet = <span class="keyword">new</span> HttpGet(url);</span><br><span class="line">       CloseableHttpResponse response = client.execute(httpGet);</span><br><span class="line">       InputStream respInputStream = response.getEntity().getContent();</span><br><span class="line">       response.close();</span><br><span class="line">       <span class="keyword">return</span> respInputStream;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></li>
<li><p>post请求</p>
<span id="more"></span>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">send</span><span class="params">(String url, String jsonObject, String encoding)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//创建httpclient对象</span></span><br><span class="line">    CloseableHttpClient client = HttpClients.createDefault();</span><br><span class="line">    <span class="comment">//创建post方式请求对象</span></span><br><span class="line">    HttpPost httpPost = <span class="keyword">new</span> HttpPost(url);</span><br><span class="line">    <span class="comment">//装填参数</span></span><br><span class="line">    StringEntity postBody = <span class="keyword">new</span> StringEntity(<span class="string">&quot;[&quot;</span> + jsonObject.toString() + <span class="string">&quot;]&quot;</span>, <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">    postBody.setContentType(<span class="keyword">new</span> BasicHeader(HTTP.CONTENT_TYPE,</span><br><span class="line">                                            <span class="string">&quot;application/json;charset=utf-8&quot;</span>));</span><br><span class="line">    <span class="comment">//设置参数到请求对象中</span></span><br><span class="line">    httpPost.setEntity(postBody);</span><br><span class="line">    <span class="comment">//        System.out.println(&quot;请求参数：&quot;+nvps.toString());</span></span><br><span class="line">    <span class="comment">//设置header信息</span></span><br><span class="line">    <span class="comment">//指定报文头【Content-type】、【User-Agent】</span></span><br><span class="line">    <span class="comment">//        httpPost.setHeader(&quot;Content-type&quot;, &quot;application/x-www-form-urlencoded&quot;);</span></span><br><span class="line">    httpPost.setHeader(<span class="string">&quot;Content-type&quot;</span>, <span class="string">&quot;application/json;charset=utf-8&quot;</span>);</span><br><span class="line">    <span class="comment">//执行请求操作，并拿到结果（同步阻塞）</span></span><br><span class="line">    CloseableHttpResponse response = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">boolean</span> flag = <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">while</span> (flag) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            response = client.execute(httpPost);</span><br><span class="line">            flag = <span class="keyword">false</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClientProtocolException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            System.out.println(<span class="string">&quot;请求API出错&quot;</span>);</span><br><span class="line">            flag = <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            System.out.println(<span class="string">&quot;请求API出错&quot;</span>);</span><br><span class="line">            flag = <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//获取结果实体</span></span><br><span class="line">    HttpEntity entity = response.getEntity();</span><br><span class="line">    <span class="comment">//按指定编码转换结果实体为String类型</span></span><br><span class="line">    String body = entity == <span class="keyword">null</span> ? <span class="string">&quot;&quot;</span> : EntityUtils.toString(entity, encoding);</span><br><span class="line">    EntityUtils.consume(entity);</span><br><span class="line">    <span class="comment">//释放链接</span></span><br><span class="line">    response.close();</span><br><span class="line">    <span class="keyword">return</span> body;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>java</category>
      </categories>
  </entry>
  <entry>
    <title>SPI机制</title>
    <url>/2022/03/12/java/java%E8%AE%BE%E8%AE%A1/SPI%E6%9C%BA%E5%88%B6/</url>
    <content><![CDATA[<h2 id="一、SPI-Jdbc"><a href="#一、SPI-Jdbc" class="headerlink" title="一、SPI-Jdbc"></a>一、SPI-Jdbc</h2><p><a href="https://www.jianshu.com/p/51b0cf78210f">参考-JavaSPI</a></p>
<p><a href="https://www.jianshu.com/p/97c01234ba79">参考-SpringSPI</a></p>
<p><a href="https://www.jianshu.com/p/3a3edbcd8f24">参考-jdbcSPI</a></p>
<blockquote>
<p>SPI , Service Provider Interface，是一种服务发现机制。它通过在ClassPath路径下的META-INF/services文件夹查找文件，自动加载文件里所定义的类</p>
</blockquote>
<h3 id="1-1-JDBC的class-foname"><a href="#1-1-JDBC的class-foname" class="headerlink" title="1.1 JDBC的class.foname"></a>1.1 JDBC的class.foname</h3><ol>
<li><p>jdbc执行Class.forName(‘com.mysql.cj.jdbc.Driver’)是加载Driver的意思</p>
<p>但是再Driver这个类有个静态代码块（再类信息第一次加载到内存的时候会运行一次）</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> &#123; </span><br><span class="line">	DriverManager.registerDriver(<span class="keyword">new</span> Driver());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> <span class="comment">//registerDriver会根据一系列过程把driver加进来</span></span><br><span class="line">Object[] newElements = Arrays.copyOf(current, len + <span class="number">1</span>);</span><br><span class="line">newElements[len] = e;<span class="comment">//就是driver</span></span><br><span class="line">setArray(newElements);</span><br></pre></td></tr></table></figure></li>
<li><p>DriverManager.getConnection(url,info)</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span>(DriverInfo aDriver : registeredDrivers) &#123;</span><br><span class="line">    Connection con = aDriver.driver.connect(url, info);</span><br><span class="line">    <span class="keyword">if</span> (con != <span class="keyword">null</span>) </span><br><span class="line">        <span class="keyword">return</span> (con);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="1-2-JDBC加入SPI机制之后"><a href="#1-2-JDBC加入SPI机制之后" class="headerlink" title="1.2 JDBC加入SPI机制之后"></a>1.2 JDBC加入SPI机制之后</h3><ol>
<li><p>DriverManager的static代码块 </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> &#123;</span><br><span class="line">    loadInitialDrivers();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">loadInitialDrivers</span> <span class="params">()</span></span>&#123;</span><br><span class="line">     AccessController.doPrivileged(<span class="keyword">new</span> PrivilegedAction&lt;Void&gt;() &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> Void <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                ServiceLoader&lt;Driver&gt; loadedDrivers = ServiceLoader.load(Driver.class);</span><br><span class="line">                Iterator&lt;Driver&gt; driversIterator = loadedDrivers.iterator();</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="二、我对spi的解读"><a href="#二、我对spi的解读" class="headerlink" title="二、我对spi的解读"></a>二、我对spi的解读</h2><h3 id="2-1-先决条件"><a href="#2-1-先决条件" class="headerlink" title="2.1 先决条件"></a>2.1 先决条件</h3><h4 id="2-1-1-类接口与类实现"><a href="#2-1-1-类接口与类实现" class="headerlink" title="2.1.1 类接口与类实现"></a>2.1.1 类接口与类实现</h4><blockquote>
<p>面向接口编程，Java标准库提供接口，研发者提供实现</p>
</blockquote>
<ol>
<li><p>Java官方的接口</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Driver</span></span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>我的实现</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wyg.service.abc;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyDriverImpl</span> <span class="keyword">implements</span> <span class="title">Driver</span></span>&#123;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="2-1-2-文件结构"><a href="#2-1-2-文件结构" class="headerlink" title="2.1.2 文件结构"></a>2.1.2 文件结构</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">META-INF</span><br><span class="line">--services</span><br><span class="line">-----java.sql.Driver</span><br></pre></td></tr></table></figure>

<p>内容为</p>
<figure class="highlight tex"><table><tr><td class="code"><pre><span class="line">com.wyg.service.abc.MyDriverImpl</span><br></pre></td></tr></table></figure>

<h3 id="2-2-关键代码"><a href="#2-2-关键代码" class="headerlink" title="2.2 关键代码"></a>2.2 关键代码</h3><h4 id="2-2-1-构造函数"><a href="#2-2-1-构造函数" class="headerlink" title="2.2.1 构造函数"></a>2.2.1 构造函数</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String PREFIX = <span class="string">&quot;META-INF/services/&quot;</span>;</span><br><span class="line"><span class="keyword">private</span> LinkedHashMap&lt;String,S&gt; providers = <span class="keyword">new</span> LinkedHashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="title">ServiceLoader</span><span class="params">(Class&lt;S&gt; svc, ClassLoader cl)</span> </span>&#123;</span><br><span class="line">      service = Objects.requireNonNull(svc, <span class="string">&quot;Service interface cannot be null&quot;</span>);</span><br><span class="line">      loader = (cl == <span class="keyword">null</span>) ? ClassLoader.getSystemClassLoader() : cl;</span><br><span class="line">      acc = (System.getSecurityManager() != <span class="keyword">null</span>) ? AccessController.getContext() : <span class="keyword">null</span>;</span><br><span class="line">      reload();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-2-2-找到所有的全限定类名"><a href="#2-2-2-找到所有的全限定类名" class="headerlink" title="2.2.2 找到所有的全限定类名"></a>2.2.2 找到所有的全限定类名</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String fullName = PREFIX + service.getName();</span><br><span class="line">configs = ClassLoader.getSystemResources(fullName);</span><br><span class="line">Class  pending = parse(service, configs.nextElement());</span><br></pre></td></tr></table></figure>

<h4 id="2-2-3-加载类并实例化"><a href="#2-2-3-加载类并实例化" class="headerlink" title="2.2.3 加载类并实例化"></a>2.2.3 加载类并实例化</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">c = Class.forName(cn, <span class="keyword">false</span>, loader);</span><br><span class="line">S p = service.cast(c.newInstance());</span><br><span class="line">providers.put(cn, p)</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>java高级</category>
      </categories>
  </entry>
  <entry>
    <title>java懒加载</title>
    <url>/2021/10/10/java/java%E8%AE%BE%E8%AE%A1/java%E6%87%92%E5%8A%A0%E8%BD%BD/</url>
    <content><![CDATA[<ol>
<li><p>[参考](<a href="https://zhuanlan.zhihu.com/p/428095023?utm_source=qq&utm_medium=social&utm_oi=1044004825763094528">函数式编程的Java编码实践：利用惰性写出高性能且抽象的代码 - 知乎 (zhihu.com)</a>)</p>
</li>
<li><p>懒加载的例子</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Supplier&lt; Integer&gt; a = () -&gt; <span class="number">10</span> + <span class="number">1</span>;</span><br><span class="line"><span class="keyword">int</span> b = a.get() + <span class="number">1</span>;<span class="comment">//创建b的时候才会运算a</span></span><br></pre></td></tr></table></figure>

<span id="more"></span></li>
<li><p>一次计算永久保存的懒加载</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 为了方便与标准的 Java 函数式接口交互，Lazy 也实现了 Supplier</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Lazy</span>&lt; <span class="title">T</span>&gt; <span class="keyword">implements</span> <span class="title">Supplier</span>&lt; <span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Supplier&lt; ? extends T&gt; supplier;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 利用 value 属性缓存 supplier 计算后的值</span></span><br><span class="line">    <span class="keyword">private</span> T value;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Lazy</span><span class="params">(Supplier&lt; ? extends T&gt; supplier)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.supplier = supplier;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt; T&gt; Lazy&lt; T&gt; of(Supplier&lt; ? extends T&gt; supplier) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Lazy&lt; &gt;(supplier);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (value == <span class="keyword">null</span>) &#123;</span><br><span class="line">            T newValue = supplier.get();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (newValue == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">&quot;Lazy value can not be null!&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            value = newValue;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//调用</span></span><br><span class="line">Lazy&lt; Integer&gt; a = Lazy.of(() -&gt; <span class="number">10</span> + <span class="number">1</span>);</span><br><span class="line"><span class="keyword">int</span> b = a.get() + <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<!--more--></li>
<li><p>双重依赖型的懒加载：函子</p>
</li>
<li><p>函子(Functor) 或者叫mapper 或者叫映射</p>
<ol>
<li><p>定义</p>
<p>函子运算可以将一个 T 映射到 S 的 function 应用到 Box&lt; T&gt; 上，让其成为 Box&lt; S&gt;</p>
</li>
<li><p>函数</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> &lt; S&gt; Lazy&lt; S&gt; map(Function&lt; ? <span class="keyword">super</span> T, ? extends S&gt; function) &#123;</span><br><span class="line">	<span class="keyword">return</span> Lazy.of(() -&gt; function.apply(get()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>调用</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Lazy&lt; Lazy&lt; Set&lt; String&gt;&gt;&gt; permissions = departmentLazy.map(department -&gt;</span><br><span class="line">         supervisorLazy.map(supervisor -&gt; getPermissions(department, supervisor))</span><br><span class="line">);</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p>解决多层菱形运算符的懒加载：单子</p>
</li>
<li><p>单子：flatMap</p>
<ol>
<li><p>函数</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> &lt; S&gt; Lazy&lt; S&gt; flatMap(Function&lt; ? <span class="keyword">super</span> T, Lazy&lt; ? extends S&gt;&gt; function) &#123;</span><br><span class="line">        <span class="keyword">return</span> Lazy.of(() -&gt; function.apply(get()).get());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
<li><p>调用</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Lazy&lt; Set&lt; String&gt;&gt; permissions = departmentLazy.flatMap(department -&gt;</span><br><span class="line">         supervisorLazy.map(supervisor -&gt; getPermissions(department, supervisor))</span><br><span class="line">);</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ol>
]]></content>
      <categories>
        <category>java设计</category>
      </categories>
  </entry>
  <entry>
    <title>socket编程</title>
    <url>/2022/01/13/java/java%E8%AE%BE%E8%AE%A1/socket%E7%BC%96%E7%A8%8B/</url>
    <content><![CDATA[<h2 id="一、网络编程概念"><a href="#一、网络编程概念" class="headerlink" title="一、网络编程概念"></a>一、网络编程概念</h2><blockquote>
<p>socket就是对UDP、TCP的封装</p>
</blockquote>
<h3 id="1-1-TCP-UDP"><a href="#1-1-TCP-UDP" class="headerlink" title="1.1 TCP UDP"></a>1.1 TCP UDP</h3><ul>
<li><strong>TCP</strong>：传输控制协议，是一种面向连接的、可靠的、基于字节流的传输层通信协议，TCP 层是位于 IP 层之上，应用层之下的中间层。TCP 保障了两个应用程序之间的可靠通信。通常用于互联网协议，被称 TCP / IP。</li>
<li><strong>UDP</strong>：用户数据报协议，位于 OSI 模型的传输层。一个无连接的协议。提供了应用程序之间要发送数据的数据报。由于UDP缺乏可靠性且属于无连接协议，所以应用程序通常必须容许一些丢失、错误或重复的数据包。不局限于端到端，可以广播</li>
</ul>
<h3 id="1-2-socket概念"><a href="#1-2-socket概念" class="headerlink" title="1.2 socket概念"></a>1.2 socket概念</h3><ol>
<li><p>在计算机网络中，叫套接字socket (ip:port)</p>
<p>top连接={socket1,socket2}</p>
</li>
<li><p>在程序通信中，叫socket Api，网络通信接口，这是对TCP、IP的封装</p>
</li>
</ol>
<h3 id="1-3-socket编程"><a href="#1-3-socket编程" class="headerlink" title="1.3 socket编程"></a>1.3 socket编程</h3><blockquote>
<p>当连接建立时，服务器会创建一个 Socket 对象。客户端和服务器现在可以通过对 Socket 对象的写入和读取来进行通信。</p>
</blockquote>
<h3 id="1-4-IO模型"><a href="#1-4-IO模型" class="headerlink" title="1.4  IO模型"></a>1.4  IO模型</h3><ol>
<li><p>阻塞IO</p>
<p>进程进行IO操作的适合被挂起，防止被运行，指导IO操作完成。</p>
</li>
<li><p>非阻塞IO</p>
<p>IO操作立即返回，返回值为读取到的数据大小。等到总线发送了中断信号，就表示IO操作完成。</p>
</li>
</ol>
<h3 id="1-5-Java中的net"><a href="#1-5-Java中的net" class="headerlink" title="1.5 Java中的net"></a>1.5 Java中的net</h3><p>​    网络编程的基本模型是Client/Server模型，也就是两个进程之间进行相互通信，客户端 - 服务端是完全同步，完全耦合的</p>
<ul>
<li>服务端ServerSocket，负责绑定IP地址和端口，提供位置信息</li>
<li>客户端Socket，通过连接操作，向服务端监听的端口地址发起连接请求</li>
<li>基于TCP协议下进行三次握手连接</li>
<li>连接成功后，双方通过网络套接字（Socket）（输入和输出流）进行同步阻塞式通信</li>
</ul>
<h3 id="1-6-关键技术"><a href="#1-6-关键技术" class="headerlink" title="1.6 关键技术"></a>1.6 关键技术</h3><h4 id="1-6-1-flush"><a href="#1-6-1-flush" class="headerlink" title="1.6.1 flush"></a>1.6.1 flush</h4><ol>
<li>通常情况下，流式传输时基于1KB缓冲区的，当写入数据满1KB就会发送</li>
<li>但是有时候不足1KB需要使用flush才发送</li>
</ol>
<h3 id="1-7-演进"><a href="#1-7-演进" class="headerlink" title="1.7 演进"></a>1.7 演进</h3><ol>
<li><p>BIO</p>
</li>
<li><p>伪异步IO </p>
<p>采用线程池 + 任务队列</p>
<p>依然是同步阻塞，客户端会发生大量连接超时</p>
</li>
<li><p>NIO</p>
</li>
</ol>
<h2 id="二、类"><a href="#二、类" class="headerlink" title="二、类"></a>二、类</h2><table>
<thead>
<tr>
<th>名称</th>
<th>协议</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>Socket</td>
<td>tcp</td>
<td>同时工作于客户端和服务端，所有方法都是通用的，这个类三个主要作用，校验包信息，发起连接（Client），操作流数据（Client/Server）f</td>
</tr>
<tr>
<td>ServerSocket</td>
<td>tcp</td>
<td>ServerSocket表示为服务端，主要作用就是绑定并监听一个服务器端口，为每个建立连接的客户端“克隆/映射”一个Socket对象，具体数据操作都是通过这个Socket对象完成的，ServerSocket只关注如何和客户端建立连接</td>
</tr>
<tr>
<td>DatagramSocket</td>
<td>udp</td>
<td>用于表示发送和接收数据报包的套接字</td>
</tr>
<tr>
<td>DatagramPacket</td>
<td>udp</td>
<td>类用来表示数据报包，数据报包用来实现无连接包投递服务</td>
</tr>
<tr>
<td>InetAddress</td>
<td>ip+端口</td>
<td>代表互联网协议（IP）地址，InetAddress类没有提供构造器，而是提供了如下两个静态方法来获取InetAddress实例</td>
</tr>
<tr>
<td>InetSocketAddress</td>
<td>ip+端口</td>
<td>在使用Socket来连接服务器时最简单的方式就是直接使用IP和端口，但Socket类中并未提供这种方式，而是靠SocketAddress的子类InetSocketAddress来实现 IP 地址 + 端口号的创建，不依赖任何协议。</td>
</tr>
</tbody></table>
<h3 id="2-1-ServerSocket"><a href="#2-1-ServerSocket" class="headerlink" title="2.1 ServerSocket"></a>2.1 ServerSocket</h3><table>
<thead>
<tr>
<th>序号</th>
<th>方法名</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>ServerSocket(int port)</td>
<td>构造函数</td>
</tr>
<tr>
<td>2</td>
<td><strong>getLocalPort</strong></td>
<td>获得端口</td>
</tr>
<tr>
<td>3</td>
<td><strong>accept</strong></td>
<td>监听</td>
</tr>
</tbody></table>
<h3 id="2-2-Socket"><a href="#2-2-Socket" class="headerlink" title="2.2 Socket"></a>2.2 Socket</h3><table>
<thead>
<tr>
<th>序号</th>
<th>方法名</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>Socket(String host, int port)</td>
<td>构造函数</td>
</tr>
<tr>
<td>2</td>
<td>**connect(**SocketAddress host, int timeout)</td>
<td>连接</td>
</tr>
<tr>
<td>3</td>
<td><strong>getInetAddress</strong></td>
<td>获得地址</td>
</tr>
<tr>
<td>4</td>
<td><strong>getPort</strong></td>
<td></td>
</tr>
<tr>
<td>5</td>
<td><strong>getInputStream</strong></td>
<td>获得输入流</td>
</tr>
<tr>
<td>6</td>
<td>OutputStream</td>
<td>获得输出流</td>
</tr>
<tr>
<td></td>
<td><strong>close</strong></td>
<td>关闭</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h3 id="2-3-InetAddress"><a href="#2-3-InetAddress" class="headerlink" title="2.3 InetAddress"></a>2.3 InetAddress</h3><table>
<thead>
<tr>
<th>序号</th>
<th>方法名</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h2 id="三、步骤"><a href="#三、步骤" class="headerlink" title="三、步骤"></a>三、步骤</h2><ol>
<li>创建一个ServerSocket，监听并绑定一个端口</li>
<li>一系列客户端来请求这个端口</li>
<li>服务器使用Accept，获得一个来自客户端的Socket连接对象 </li>
<li>启动一个新线程处理连接 <ol>
<li>读Socket，得到字节流</li>
<li>解码协议，得到Http请求对象 </li>
<li>处理Http请求，得到一个结果，封装成一个HttpResponse对象 </li>
<li>编码协议，将结果序列化字节流 写Socket，将字节流发给客户端 </li>
</ol>
</li>
<li>继续循环步骤3</li>
</ol>
<h3 id="3-1-单发、单客户端"><a href="#3-1-单发、单客户端" class="headerlink" title="3.1 单发、单客户端"></a>3.1 单发、单客户端</h3><h4 id="3-1-1-客户端"><a href="#3-1-1-客户端" class="headerlink" title="3.1.1 客户端"></a>3.1.1 客户端</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    Java提供了一个包：java.net下的类都是用于网络通信。</span></span><br><span class="line"><span class="comment">    Java提供了基于套接字（端口）Socket的网络通信模式，我们基于这种模式就可以直接实现TCP通信。</span></span><br><span class="line"><span class="comment">    只要用Socket通信，那么就是基于TCP可靠传输通信。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    功能1：客户端发送一个消息，服务端接口一个消息，通信结束！！</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    创建客户端对象：</span></span><br><span class="line"><span class="comment">        （1）创建一个Socket的通信管道，请求与服务端的端口连接。</span></span><br><span class="line"><span class="comment">        （2）从Socket管道中得到一个字节输出流。</span></span><br><span class="line"><span class="comment">        （3）把字节流改装成自己需要的流进行数据的发送</span></span><br><span class="line"><span class="comment">    创建服务端对象：</span></span><br><span class="line"><span class="comment">        （1）注册端口</span></span><br><span class="line"><span class="comment">        （2）开始等待接收客户端的连接,得到一个端到端的Socket管道</span></span><br><span class="line"><span class="comment">        （3）从Socket管道中得到一个字节输入流。</span></span><br><span class="line"><span class="comment">        （4）把字节输入流包装成自己需要的流进行数据的读取。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    Socket的使用：</span></span><br><span class="line"><span class="comment">        构造器：public Socket(String host, int port)</span></span><br><span class="line"><span class="comment">        方法：  public OutputStream getOutputStream()：获取字节输出流</span></span><br><span class="line"><span class="comment">               public InputStream getInputStream() :获取字节输入流</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    ServerSocket的使用：</span></span><br><span class="line"><span class="comment">        构造器：public ServerSocket(int port)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    小结：</span></span><br><span class="line"><span class="comment">        通信是很严格的，对方怎么发你就怎么收，对方发多少你就只能收多少！！</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ClientDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;==客户端的启动==&quot;</span>);</span><br><span class="line">        <span class="comment">// （1）创建一个Socket的通信管道，请求与服务端的端口连接。</span></span><br><span class="line">        Socket socket = <span class="keyword">new</span> Socket(<span class="string">&quot;127.0.0.1&quot;</span>,<span class="number">8888</span>);</span><br><span class="line">        <span class="comment">// （2）从Socket通信管道中得到一个字节输出流。</span></span><br><span class="line">        OutputStream os = socket.getOutputStream();</span><br><span class="line">        <span class="comment">// （3）把字节流改装成自己需要的流进行数据的发送</span></span><br><span class="line">        PrintStream ps = <span class="keyword">new</span> PrintStream(os);</span><br><span class="line">        <span class="comment">// （4）开始发送消息</span></span><br><span class="line">        ps.println(<span class="string">&quot;我是客户端，我想约你吃小龙虾！！！&quot;</span>);</span><br><span class="line">        ps.flush();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-1-2-服务端"><a href="#3-1-2-服务端" class="headerlink" title="3.1.2 服务端"></a>3.1.2 服务端</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServerDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;==服务器的启动==&quot;</span>);</span><br><span class="line">        <span class="comment">// （1）注册端口</span></span><br><span class="line">        ServerSocket serverSocket = <span class="keyword">new</span> ServerSocket(<span class="number">8888</span>);</span><br><span class="line">        <span class="comment">//（2）开始在这里暂停等待接收客户端的连接,得到一个端到端的Socket管道</span></span><br><span class="line">        Socket socket = serverSocket.accept();</span><br><span class="line">        <span class="comment">//（3）从Socket管道中得到一个字节输入流。</span></span><br><span class="line">        InputStream is = socket.getInputStream();</span><br><span class="line">        <span class="comment">//（4）把字节输入流包装成自己需要的流进行数据的读取。</span></span><br><span class="line">        BufferedReader br = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(is));</span><br><span class="line">        <span class="comment">//（5）读取数据</span></span><br><span class="line">        String line ;</span><br><span class="line">        <span class="keyword">while</span>((line = br.readLine())!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;服务端收到：&quot;</span>+line);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-2-多发"><a href="#3-2-多发" class="headerlink" title="3.2 多发"></a>3.2 多发</h3><blockquote>
<p>关键：while(true)  + flush推送</p>
</blockquote>
<h4 id="3-2-1-客户端"><a href="#3-2-1-客户端" class="headerlink" title="3.2.1 客户端"></a>3.2.1 客户端</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ClientDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;==客户端的启动==&quot;</span>);</span><br><span class="line">        <span class="comment">// （1）创建一个Socket的通信管道，请求与服务端的端口连接。</span></span><br><span class="line">        Socket socket = <span class="keyword">new</span> Socket(<span class="string">&quot;127.0.0.1&quot;</span>,<span class="number">8888</span>);</span><br><span class="line">        <span class="comment">// （2）从Socket通信管道中得到一个字节输出流。</span></span><br><span class="line">        OutputStream os = socket.getOutputStream();</span><br><span class="line">        <span class="comment">// （3）把字节流改装成自己需要的流进行数据的发送</span></span><br><span class="line">        PrintStream ps = <span class="keyword">new</span> PrintStream(os);</span><br><span class="line">        <span class="comment">// （4）开始发送消息</span></span><br><span class="line">        Scanner sc = <span class="keyword">new</span> Scanner(System.in);</span><br><span class="line">        <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">            System.out.print(<span class="string">&quot;请说:&quot;</span>);</span><br><span class="line">            String msg = sc.nextLine();</span><br><span class="line">            ps.println(msg);</span><br><span class="line">            ps.flush();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-2-2-服务端"><a href="#3-2-2-服务端" class="headerlink" title="3.2.2 服务端"></a>3.2.2 服务端</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServerDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        String s = <span class="string">&quot;886&quot;</span>;</span><br><span class="line">        System.out.println(<span class="string">&quot;886&quot;</span>.equals(s));</span><br><span class="line">        System.out.println(<span class="string">&quot;==服务器的启动==&quot;</span>);</span><br><span class="line">        <span class="comment">//（1）注册端口</span></span><br><span class="line">        ServerSocket serverSocket = <span class="keyword">new</span> ServerSocket(<span class="number">8888</span>);</span><br><span class="line">        <span class="comment">//（2）开始在这里暂停等待接收客户端的连接,得到一个端到端的Socket管道</span></span><br><span class="line">        Socket socket = serverSocket.accept();</span><br><span class="line">        <span class="comment">//（3）从Socket管道中得到一个字节输入流。</span></span><br><span class="line">        InputStream is = socket.getInputStream();</span><br><span class="line">        <span class="comment">//（4）把字节输入流包装成  自己需要的流进行数据的读取。</span></span><br><span class="line">        BufferedReader br = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(is));</span><br><span class="line">        <span class="comment">//（5）读取数据</span></span><br><span class="line">        String line ;</span><br><span class="line">        <span class="keyword">while</span>((line = br.readLine())!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;服务端收到：&quot;</span>+line);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-3-多客户端"><a href="#3-3-多客户端" class="headerlink" title="3.3 多客户端"></a>3.3 多客户端</h3><p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20200615181141593.png" alt="image-20200615181141593"></p>
<blockquote>
<p>关键：while(true) + 多线程</p>
</blockquote>
<h4 id="3-3-1-客户端"><a href="#3-3-1-客户端" class="headerlink" title="3.3.1 客户端"></a>3.3.1 客户端</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ClientDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;==客户端的启动==&quot;</span>);</span><br><span class="line">        <span class="comment">// （1）创建一个Socket的通信管道，请求与服务端的端口连接。</span></span><br><span class="line">        Socket socket = <span class="keyword">new</span> Socket(<span class="string">&quot;127.0.0.1&quot;</span>,<span class="number">7777</span>);</span><br><span class="line">        <span class="comment">// （2）从Socket通信管道中得到一个字节输出流。</span></span><br><span class="line">        OutputStream os = socket.getOutputStream();</span><br><span class="line">        <span class="comment">// （3）把字节流改装成自己需要的流进行数据的发送</span></span><br><span class="line">        PrintStream ps = <span class="keyword">new</span> PrintStream(os);</span><br><span class="line">        <span class="comment">// （4）开始发送消息</span></span><br><span class="line">        Scanner sc = <span class="keyword">new</span> Scanner(System.in);</span><br><span class="line">        <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">            System.out.print(<span class="string">&quot;请说:&quot;</span>);</span><br><span class="line">            String msg = sc.nextLine();</span><br><span class="line">            ps.println(msg);</span><br><span class="line">            ps.flush();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="3-3-2-服务端"><a href="#3-3-2-服务端" class="headerlink" title="3.3.2 服务端"></a>3.3.2 服务端</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServerDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;==服务器的启动==&quot;</span>);</span><br><span class="line">        <span class="comment">// （1）注册端口</span></span><br><span class="line">        ServerSocket serverSocket = <span class="keyword">new</span> ServerSocket(<span class="number">7777</span>);</span><br><span class="line">        <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">            <span class="comment">//（2）开始在这里暂停等待接收客户端的连接,得到一个端到端的Socket管道</span></span><br><span class="line">            Socket socket = serverSocket.accept();</span><br><span class="line">            <span class="keyword">new</span> ServerReadThread(socket).start();</span><br><span class="line">            System.out.println(socket.getRemoteSocketAddress()+<span class="string">&quot;上线了！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ServerReadThread</span> <span class="keyword">extends</span> <span class="title">Thread</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Socket socket;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ServerReadThread</span><span class="params">(Socket socket)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.socket = socket;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="comment">//（3）从Socket管道中得到一个字节输入流。</span></span><br><span class="line">            InputStream is = socket.getInputStream();</span><br><span class="line">            <span class="comment">//（4）把字节输入流包装成自己需要的流进行数据的读取。</span></span><br><span class="line">            BufferedReader br = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(is));</span><br><span class="line">            <span class="comment">//（5）读取数据</span></span><br><span class="line">            String line ;</span><br><span class="line">            <span class="keyword">while</span>((line = br.readLine())!=<span class="keyword">null</span>)&#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;服务端收到：&quot;</span>+socket.getRemoteSocketAddress()+<span class="string">&quot;:&quot;</span>+line);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            System.out.println(socket.getRemoteSocketAddress()+<span class="string">&quot;下线了！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-4-伪异步"><a href="#3-4-伪异步" class="headerlink" title="3.4 伪异步"></a>3.4 伪异步</h3><p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20200619085953166.png" alt="image-20200619085953166"></p>
<blockquote>
<p>采用线程池和任务队列实现</p>
</blockquote>
<h4 id="3-4-0-线程池"><a href="#3-4-0-线程池" class="headerlink" title="3.4.0 线程池"></a>3.4.0 线程池</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 线程池处理类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HandlerSocketThreadPool</span> </span>&#123;</span><br><span class="line">   </span><br><span class="line">   <span class="comment">// 线程池 </span></span><br><span class="line">   <span class="keyword">private</span> ExecutorService executor;</span><br><span class="line">   </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">HandlerSocketThreadPool</span><span class="params">(<span class="keyword">int</span> maxPoolSize, <span class="keyword">int</span> queueSize)</span></span>&#123;</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">this</span>.executor = <span class="keyword">new</span> ThreadPoolExecutor(</span><br><span class="line">            <span class="number">3</span>, <span class="comment">// 8</span></span><br><span class="line">            maxPoolSize,  </span><br><span class="line">            <span class="number">120L</span>, </span><br><span class="line">            TimeUnit.SECONDS,</span><br><span class="line">            <span class="keyword">new</span> ArrayBlockingQueue&lt;Runnable&gt;(queueSize) );</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(Runnable task)</span></span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.executor.execute(task);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="3-4-1-客户端"><a href="#3-4-1-客户端" class="headerlink" title="3.4.1 客户端"></a>3.4.1 客户端</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">         <span class="comment">// 1.简历一个与服务端的Socket对象：套接字</span></span><br><span class="line">         Socket socket = <span class="keyword">new</span> Socket(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">9999</span>);</span><br><span class="line">         <span class="comment">// 2.从socket管道中获取一个输出流，写数据给服务端 </span></span><br><span class="line">         OutputStream os = socket.getOutputStream() ;</span><br><span class="line">         <span class="comment">// 3.把输出流包装成一个打印流 </span></span><br><span class="line">         PrintWriter pw = <span class="keyword">new</span> PrintWriter(os);</span><br><span class="line">         <span class="comment">// 4.反复接收用户的输入 </span></span><br><span class="line">         BufferedReader br = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(System.in));</span><br><span class="line">         String line = <span class="keyword">null</span> ;</span><br><span class="line">         <span class="keyword">while</span>((line = br.readLine()) != <span class="keyword">null</span>)&#123;</span><br><span class="line">            pw.println(line);</span><br><span class="line">            pw.flush();</span><br><span class="line">         &#125;</span><br><span class="line">      &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">         e.printStackTrace();</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-4-2-服务端"><a href="#3-4-2-服务端" class="headerlink" title="3.4.2 服务端"></a>3.4.2 服务端</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Server</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">         System.out.println(<span class="string">&quot;----------服务端启动成功------------&quot;</span>);</span><br><span class="line">         ServerSocket ss = <span class="keyword">new</span> ServerSocket(<span class="number">9999</span>);</span><br><span class="line"></span><br><span class="line">         <span class="comment">// 一个服务端只需要对应一个线程池</span></span><br><span class="line">         HandlerSocketThreadPool handlerSocketThreadPool =</span><br><span class="line">               <span class="keyword">new</span> HandlerSocketThreadPool(<span class="number">3</span>, <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">         <span class="comment">// 客户端可能有很多个</span></span><br><span class="line">         <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">            Socket socket = ss.accept() ; <span class="comment">// 阻塞式的！</span></span><br><span class="line">            System.out.println(<span class="string">&quot;有人上线了！！&quot;</span>);</span><br><span class="line">            <span class="comment">// 每次收到一个客户端的socket请求，都需要为这个客户端分配一个</span></span><br><span class="line">            <span class="comment">// 独立的线程 专门负责对这个客户端的通信！！</span></span><br><span class="line">            handlerSocketThreadPool.execute(<span class="keyword">new</span> ReaderClientRunnable(socket));</span><br><span class="line">         &#125;</span><br><span class="line"></span><br><span class="line">      &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">         e.printStackTrace();</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ReaderClientRunnable</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> Socket socket ;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">ReaderClientRunnable</span><span class="params">(Socket socket)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.socket = socket;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">         <span class="comment">// 读取一行数据</span></span><br><span class="line">         InputStream is = socket.getInputStream() ;</span><br><span class="line">         <span class="comment">// 转成一个缓冲字符流</span></span><br><span class="line">         Reader fr = <span class="keyword">new</span> InputStreamReader(is);</span><br><span class="line">         BufferedReader br = <span class="keyword">new</span> BufferedReader(fr);</span><br><span class="line">         <span class="comment">// 一行一行的读取数据</span></span><br><span class="line">         String line = <span class="keyword">null</span> ;</span><br><span class="line">         <span class="keyword">while</span>((line = br.readLine())!=<span class="keyword">null</span>)&#123; <span class="comment">// 阻塞式的！！</span></span><br><span class="line">            System.out.println(<span class="string">&quot;服务端收到了数据：&quot;</span>+line);</span><br><span class="line">         &#125;</span><br><span class="line">      &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">         System.out.println(<span class="string">&quot;有人下线了&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-5-客户端转发"><a href="#3-5-客户端转发" class="headerlink" title="3.5 客户端转发"></a>3.5 客户端转发</h3><p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20200619123304241.png" alt="image-20200619123304241"></p>
]]></content>
  </entry>
  <entry>
    <title>linux配置</title>
    <url>/2022/03/11/linux/%E9%85%8D%E7%BD%AE%E7%8E%AF%E5%A2%83/linux%E9%85%8D%E7%BD%AE/</url>
    <content><![CDATA[<p>[toc]</p>
<h2 id="一、免密配置"><a href="#一、免密配置" class="headerlink" title="一、免密配置"></a>一、免密配置</h2><ol>
<li><p>ssh免密登录</p>
<ol>
<li><p>编写主机名 gedit /etc/hostname</p>
<p>master</p>
</li>
<li><p>临时设置hostname hostname master</p>
</li>
<li><p>上一步生效 bash</p>
</li>
<li><p>验证主机名 hostname</p>
<span id="more"></span></li>
<li><p>关闭防火墙systemctl stop/disable firewalld/firewalld.service   </p>
</li>
<li><p>ifconfig获取Ipc</p>
<p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20211007023706983.png" alt="image-20211007023706983"></p>
</li>
<li><p>修改主机—ip 列表  vi /etc/hosts</p>
<p>10.42.0.93 master</p>
</li>
<li><p>时钟同步</p>
</li>
<li><p>Ping主机名测试  ping master -c 3</p>
</li>
<li><p>*0生成ssh-key   ssh-keygen -t rsa</p>
</li>
<li><p>*1密钥<font color="red">cat ~/.ssh/id_rsa.pub &gt;&gt; ~/.ssh/authorized_keys</font>&gt;</p>
</li>
<li><p>*2chmod 600 ~/.ssh/authorized_keys</p>
</li>
<li><p>*3复制scp <del>/.ssh/authorized_keys zkpk@slave01:</del>/.ssh</p>
</li>
<li><p>*4换节点生成密钥ssh-keygen -t rsa</p>
</li>
<li><p>复制scp <del>/.ssh/authorized_keys zkpk@slave02:</del>/.ssh/temp</p>
</li>
<li><p>覆盖 cat t authorized &gt; authorized_keys</p>
<p>或者追加cat t &gt;&gt; authorized _keys</p>
<p>这个key在那个用户就能对那个用户免密</p>
</li>
</ol>
</li>
<li><p>不同用户名</p>
<ol>
<li><p>在.ssh下创建最低644文件config</p>
<p>Host </p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">Host es</span><br><span class="line"><span class="keyword">user</span> <span class="title">root</span></span><br></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p>windows下的host</p>
<p>C:\Windows\System32\drivers\etc</p>
</li>
</ol>
<h2 id="二、其他配置"><a href="#二、其他配置" class="headerlink" title="二、其他配置"></a>二、其他配置</h2><h4 id="1-中文输入法"><a href="#1-中文输入法" class="headerlink" title="1. 中文输入法"></a>1. 中文输入法</h4><ol>
<li>下载中文输入法yum install ibus-libpinyin</li>
<li>在设置添加输入数据源汉语(pinyin)</li>
<li>按win+空格切换</li>
</ol>
<h4 id="2-配置时钟同步"><a href="#2-配置时钟同步" class="headerlink" title="2. 配置时钟同步"></a>2. 配置时钟同步</h4><ol>
<li>定时任务 crontab -e</li>
<li>0 1 * * * /usr/sbin/ntpdate cn.pool.ntp.org</li>
<li>手动：/usr/sbin/ntpdate cn.pool.ntp.or</li>
</ol>
<h4 id="3-localtime换成UTC-time"><a href="#3-localtime换成UTC-time" class="headerlink" title="3. localtime换成UTC time"></a>3. localtime换成UTC time</h4><ol>
<li>rm /etc/localtime</li>
<li>ln -s /usr/share/zoneinfo/Universal /etc/localtime</li>
</ol>
<h4 id="4-pdf中文配置"><a href="#4-pdf中文配置" class="headerlink" title="4. pdf中文配置"></a>4. pdf中文配置</h4><p>​    打开windows c:\Windows\fonts\simsun.ttc拷贝到linux服务器/usr/share/fonts/目录下,再次生成pdf中文显示正常。</p>
<h2 id="三、下载"><a href="#三、下载" class="headerlink" title="三、下载"></a>三、下载</h2><ol>
<li><p>redis</p>
<ol>
<li><p>tar -zxvf</p>
</li>
<li><p>下载gcc语言环境,tcl</p>
<p>root-&gt;yum install gcc</p>
<p>root-&gt;yum install tcl </p>
</li>
<li><p>cd redis—&gt;make</p>
</li>
<li><p>make install</p>
</li>
<li><p>启动</p>
<ol>
<li>前台启动redis-server</li>
<li>后台启动  –&gt;cp redis.conf–&gt;etc  </li>
<li>daemonize yes</li>
<li>启动usr/local/bin/redis-server /etc/redis.conf </li>
<li>关闭 redis-cli shutdown</li>
</ol>
</li>
</ol>
</li>
</ol>
]]></content>
      <categories>
        <category>os</category>
      </categories>
  </entry>
  <entry>
    <title>多数据源</title>
    <url>/2022/04/08/spring/springMaster/%E5%A4%9A%E6%95%B0%E6%8D%AE%E6%BA%90/</url>
    <content><![CDATA[<p>[toc]</p>
<blockquote>
<p><strong>关键：指定MapperScan的SqlSessionRef</strong></p>
<p>这里提前注入了sqlsessionFactory</p>
</blockquote>
<h3 id="大致步骤"><a href="#大致步骤" class="headerlink" title="大致步骤"></a>大致步骤</h3><ol>
<li>再yml中配置两个druid连接池的参数(type,url,password)</li>
<li>在configruation中配置两个@Bean，每个bea注入不同的druid连接池参数</li>
</ol>
<h3 id="Mapper的对应关系"><a href="#Mapper的对应关系" class="headerlink" title="Mapper的对应关系"></a>Mapper的对应关系</h3><p>首先拥有两个文件/类</p>
<ul>
<li><p>resources/mapper/mysql.mapper </p>
</li>
<li><p>resources/mapper/oracle.mapper</p>
<p>这两个mapper文件的namespace对应不同的mapper.class</p>
</li>
<li><p>com.wyg.mapper.MysqlMapper.class</p>
</li>
<li><p>com.wyg.mapper.OracleMapper.class</p>
</li>
<li></li>
</ul>
<h3 id="application-yml"><a href="#application-yml" class="headerlink" title="application.yml"></a>application.yml</h3><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment">#spring.datasource.druid.</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">druid:</span></span><br><span class="line"></span><br><span class="line">      <span class="comment"># 数据库访问配置, 使用druid数据源</span></span><br><span class="line">      <span class="comment"># 数据源1 mysql</span></span><br><span class="line">      <span class="attr">mysql:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line">        <span class="attr">driver-class-name:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line">        <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/test?useUnicode=true&amp;characterEncoding=UTF-8&amp;rewriteBatchedStatements=true&amp;autoReconnect=true&amp;failOverReadOnly=false&amp;zeroDateTimeBehavior=convertToNull</span></span><br><span class="line">        <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">      <span class="comment"># 数据源2 oracle</span></span><br><span class="line">      <span class="attr">oracle:</span> </span><br><span class="line">        <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line">        <span class="attr">driver-class-name:</span> <span class="string">oracle.jdbc.driver.OracleDriver</span></span><br><span class="line">        <span class="attr">url:</span> <span class="string">jdbc:oracle:thin:@localhost:1521:ORCL</span></span><br><span class="line">        <span class="attr">username:</span> <span class="string">test</span></span><br><span class="line">        <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">        </span><br><span class="line">      <span class="comment"># 连接池配置</span></span><br><span class="line">      <span class="attr">initial-size:</span> <span class="number">5</span></span><br><span class="line">      <span class="attr">min-idle:</span> <span class="number">5</span></span><br><span class="line">      <span class="attr">max-active:</span> <span class="number">20</span></span><br><span class="line">      <span class="comment"># 连接等待超时时间</span></span><br><span class="line">      <span class="attr">max-wait:</span> <span class="number">30000</span></span><br><span class="line">      <span class="comment"># 配置检测可以关闭的空闲连接间隔时间</span></span><br><span class="line">      <span class="attr">time-between-eviction-runs-millis:</span> <span class="number">60000</span></span><br><span class="line">      <span class="comment"># 配置连接在池中的最小生存时间</span></span><br><span class="line">      <span class="attr">min-evictable-idle-time-millis:</span> <span class="number">300000</span></span><br><span class="line">      <span class="attr">validation-query:</span> <span class="string">select</span> <span class="string">&#x27;1&#x27;</span> <span class="string">from</span> <span class="string">dual</span></span><br><span class="line">      <span class="attr">test-while-idle:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">test-on-borrow:</span> <span class="literal">false</span></span><br><span class="line">      <span class="attr">test-on-return:</span> <span class="literal">false</span></span><br><span class="line">      <span class="comment"># 打开PSCache，并且指定每个连接上PSCache的大小</span></span><br><span class="line">      <span class="attr">pool-prepared-statements:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">max-open-prepared-statements:</span> <span class="number">20</span></span><br><span class="line">      <span class="attr">max-pool-prepared-statement-per-connection-size:</span> <span class="number">20</span></span><br><span class="line">      <span class="comment"># 配置监控统计拦截的filters, 去掉后监控界面sql无法统计, &#x27;wall&#x27;用于防火墙</span></span><br><span class="line">      <span class="attr">filters:</span> <span class="string">stat,wall</span></span><br><span class="line">      <span class="comment"># Spring监控AOP切入点，如x.y.z.service.*,配置多个英文逗号分隔</span></span><br><span class="line">      <span class="attr">aop-patterns:</span> <span class="string">com.springboot.servie.*</span></span><br><span class="line">      </span><br><span class="line">    </span><br><span class="line">      <span class="comment"># WebStatFilter配置</span></span><br><span class="line">      <span class="attr">web-stat-filter:</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">        <span class="comment"># 添加过滤规则</span></span><br><span class="line">        <span class="attr">url-pattern:</span> <span class="string">/*</span></span><br><span class="line">        <span class="comment"># 忽略过滤的格式</span></span><br><span class="line">        <span class="attr">exclusions:</span> <span class="string">&#x27;*.js,*.gif,*.jpg,*.png,*.css,*.ico,/druid/*&#x27;</span></span><br><span class="line">      </span><br><span class="line">      <span class="comment"># StatViewServlet配置 </span></span><br><span class="line">      <span class="attr">stat-view-servlet:</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">        <span class="comment"># 访问路径为/druid时，跳转到StatViewServlet</span></span><br><span class="line">        <span class="attr">url-pattern:</span> <span class="string">/druid/*</span></span><br><span class="line">        <span class="comment"># 是否能够重置数据</span></span><br><span class="line">        <span class="attr">reset-enable:</span> <span class="literal">false</span></span><br><span class="line">        <span class="comment"># 需要账号密码才能访问控制台</span></span><br><span class="line">        <span class="attr">login-username:</span> <span class="string">druid</span></span><br><span class="line">        <span class="attr">login-password:</span> <span class="string">druid123</span></span><br><span class="line">        <span class="comment"># IP白名单</span></span><br><span class="line">        <span class="comment"># allow: 127.0.0.1</span></span><br><span class="line">        <span class="comment">#　IP黑名单（共同存在时，deny优先于allow）</span></span><br><span class="line">        <span class="comment"># deny: 192.168.1.218</span></span><br><span class="line">      </span><br><span class="line">      <span class="comment"># 配置StatFilter</span></span><br><span class="line">      <span class="attr">filter:</span> </span><br><span class="line">        <span class="attr">stat:</span> </span><br><span class="line">          <span class="attr">log-slow-sql:</span> <span class="literal">true</span> </span><br></pre></td></tr></table></figure>

<h3 id="stat-view"><a href="#stat-view" class="headerlink" title="stat-view"></a>stat-view</h3><h3 id="servlet的作用"><a href="#servlet的作用" class="headerlink" title="-servlet的作用"></a>-servlet的作用</h3>]]></content>
      <categories>
        <category>spring</category>
        <category>springMaster</category>
      </categories>
  </entry>
  <entry>
    <title>bean生命周期</title>
    <url>/2021/11/14/spring/spring%E6%A0%B8%E5%BF%83/Bean%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/</url>
    <content><![CDATA[<h3 id="Bean声明周期"><a href="#Bean声明周期" class="headerlink" title="Bean声明周期"></a>Bean声明周期</h3><p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20211021203128542.png" alt="image-20211021203128542"></p>
<ol>
<li><a href="https://www.cnblogs.com/javazhiyin/p/10905294.html">整体步骤-摘自</a>    <ol>
<li>Spring启动，查找并加载需要被Spring管理的bean，进行Bean的实例化</li>
<li>Bean实例化后对将Bean的引入和值注入到Bean的属性中</li>
<li>如果Bean实现了BeanNameAware接口的话，Spring将Bean的Id传递给setBeanName()方法</li>
<li>如果Bean实现了BeanFactoryAware接口的话，Spring将调用setBeanFactory()方法，将BeanFactory容器实例传入</li>
<li>如果Bean实现了ApplicationContextAware接口的话，Spring将调用Bean的setApplicationContext()方法，将bean所在应用上下文引用传入进来。</li>
<li>如果Bean实现了BeanPostProcessor接口，Spring就将调用他们的postProcessBeforeInitialization()方法。</li>
<li>如果Bean 实现了InitializingBean接口，Spring将调用他们的afterPropertiesSet()方法。类似的，如果bean使用init-method声明了初始化方法，该方法也会被调用</li>
<li>如果Bean 实现了BeanPostProcessor接口，Spring就将调用他们的postProcessAfterInitialization()方法。</li>
<li>此时，Bean已经准备就绪，可以被应用程序使用了。他们将一直驻留在应用上下文中，直到应用上下文被销毁。</li>
<li>如果bean实现了DisposableBean接口，Spring将调用它的destory()接口方法，同样，如果bean使用了destory-method 声明销毁方法，该方法也会被调用。</li>
</ol>
</li>
<li>创建声明周期</li>
</ol>
<h3 id="特别的"><a href="#特别的" class="headerlink" title="特别的"></a>特别的</h3><ol>
<li><p>@componet</p>
<ol>
<li><p>这个类就会在运行的时候放入单例池</p>
<ol>
<li>spring通过它的构造方法–&gt;默认无</li>
<li>或者用@autoware注解加在指定注解上。</li>
<li>对于有参的构造方法，从spring容器中找到对应的<ol>
<li>现根据类型，如果找到多个，再根据名字找</li>
<li>先 by Type</li>
<li>byName 容器里面可以有很多名称不一样但同类的bean</li>
</ol>
</li>
</ol>
</li>
<li><p>可以作为别人的依赖/注入bean. @autuware</p>
</li>
<li><p>可以注入属性@value</p>
</li>
<li><p>@PostConstruct.Method</p>
<p>初始化前，运行这个方法</p>
<p>这样能够处理一些配置文件不能处理的属性。</p>
</li>
<li><p>implements InitializiBean 对于实现了这个接口的componet</p>
<p>@override</p>
<p>初始化(属性注入完后运行这个方法)  public void AfterProper</p>
</li>
<li><p>初始化后</p>
<ol>
<li>AOP–&gt;代理对象</li>
</ol>
</li>
<li><p>对应于注入，基于反射+注解</p>
<p>扫描注解，扫描到通过反射+池子注入</p>
</li>
</ol>
</li>
<li><p>一些官方方法</p>
<ol>
<li>doCreateBean</li>
</ol>
</li>
</ol>
]]></content>
      <categories>
        <category>spring</category>
      </categories>
  </entry>
  <entry>
    <title>springIOC</title>
    <url>/2021/11/22/spring/spring%E6%A0%B8%E5%BF%83/springIOC/</url>
    <content><![CDATA[<p>[toc]</p>
<h2 id="IOC概念"><a href="#IOC概念" class="headerlink" title="IOC概念"></a>IOC概念</h2><h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><ol>
<li>解决的问题<ol>
<li><p>原来一个对象使用另一个对象，只能new </p>
<ul>
<li>只能new,加入我改变了new 的参数,<font color='red'>那我要在很多代码里面改</font>那我要在很多代码里面改，耦合度太高 ，所以创建一个工厂统一管理对象的创建，用到的地方不需要知道怎么new，只需要过去就行了</li>
<li>每次都New 很浪费资源，所以<font color='red'>改为</font>通过xml解析获得</li>
<li>Class.forName获取,进一步获取bean，进一步降低耦合度</li>
</ul>
</li>
<li><p>实际解决问题</p>
<ol>
<li><p>注入bean，，setter等方式</p>
</li>
<li><p>@bean放到方法上，并且这个方法有参数，那么spring就能帮我们从ioc中找到这个参数</p>
<blockquote>
<p>如果是我们自己创建的，ioc根本无法不知道有哪些类被创建了</p>
</blockquote>
</li>
</ol>
</li>
</ol>
</li>
<li>技术<ul>
<li>xml解析</li>
<li>工厂模式</li>
<li>反射技术</li>
<li>DI技术</li>
</ul>
</li>
</ol>
<h2 id="bean注册"><a href="#bean注册" class="headerlink" title="bean注册"></a>bean注册</h2><h3 id="1-sping-xml注册"><a href="#1-sping-xml注册" class="headerlink" title="1. sping.xml注册"></a>1. sping.xml注册</h3><ol>
<li><p>注意</p>
<ul>
<li>默认无参构造,也可以有参</li>
<li>注入属性是基于DI</li>
</ul>
</li>
<li><p>属性注入方法</p>
<ol>
<li><p>set方法&lt;properity&gt;</p>
</li>
<li><p>构造函数</p>
</li>
<li><p>p命名空间 基于set</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">xmlns:p=&quot;http://www.springframework.org/schema/p&quot;</span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;s2&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.wyg.epidemicsituation.entity.vo.Student&quot;</span> <span class="attr">p:age</span>=<span class="string">&quot;20&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p>属性注入特殊情况</p>
<ol>
<li><p>null  &lt;null&gt;&lt;/null&gt;</p>
</li>
<li><p>大于小于号;lt</p>
</li>
<li><p>外部bean</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;testID&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>内部bean,作用和外部bean一样，就是形式不一样</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;aa&quot;</span>&gt;</span> <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;&quot;</span>&lt;/<span class="attr">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p>注册bean</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;s2&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.wyg.epidemicsituation.entity.vo.Student&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;20&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;wang&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span>//有参</span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>getBean</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ApplicationContext ioc=<span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;/config/beans.xml&quot;</span>);</span><br><span class="line">Student student= (Student) ioc.getBean(<span class="string">&quot;s2&quot;</span>) ;</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="2-注解配置"><a href="#2-注解配置" class="headerlink" title="2.  注解配置"></a>2.  注解配置</h3><h2 id="二-获取bean"><a href="#二-获取bean" class="headerlink" title="二 获取bean"></a>二 获取bean</h2><ol>
<li>i</li>
</ol>
<h3 id="注解"><a href="#注解" class="headerlink" title="注解"></a>注解</h3><ol>
<li><p>qualifier要小写,且要和@autowire一起使用</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Qualifier(&quot;companyIntroServiceImpl&quot;)</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="spring中两种Bean"><a href="#spring中两种Bean" class="headerlink" title="spring中两种Bean"></a>spring中两种Bean</h3><ul>
<li>普通bean<ul>
<li>定义Student 返回就是Student</li>
</ul>
</li>
<li>工厂bean<ul>
<li>定义为Student，返回可能是其他类型</li>
<li>接口FactoryBean</li>
</ul>
</li>
</ul>
<h3 id="Bean的作用域"><a href="#Bean的作用域" class="headerlink" title="Bean的作用域"></a>Bean的作用域</h3><p>spring里面bean默认为单例，可以设置为单例和多例</p>
<ol>
<li><p>设置为多例 </p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">&lt;bean  <span class="attribute">scope</span>=<span class="string">&quot;prototype&quot;</span>&gt; 多例</span><br><span class="line"> <span class="attribute">scope</span>=<span class="string">&quot;session&quot;</span>   保存在session中</span><br></pre></td></tr></table></figure></li>
<li><p>多例规则：懒加载</p>
</li>
<li><p>单例规则：饿汉式</p>
</li>
</ol>
]]></content>
      <categories>
        <category>spring</category>
      </categories>
  </entry>
  <entry>
    <title>spring</title>
    <url>/2022/04/03/spring/spring%E5%AE%B6%E6%97%8F/spring/</url>
    <content><![CDATA[<h3 id="配合启动"><a href="#配合启动" class="headerlink" title="配合启动"></a>配合启动</h3><blockquote>
<p>该xml</p>
</blockquote>
<h4 id="web-xml"><a href="#web-xml" class="headerlink" title="web.xml"></a>web.xml</h4><blockquote>
<p>ServletContext   –&gt;实现类  org.apache.catalina.core.ApplicationContextFacade</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee</span></span></span><br><span class="line"><span class="string"><span class="tag">         http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">version</span>=<span class="string">&quot;4.0&quot;</span>&gt;</span> </span><br><span class="line">	<span class="comment">&lt;!--dispatchServlet--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>servlet-01<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:config/servlet-01.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--立即加载--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>servlet-01<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--spring监听器,监听上下文的创建--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--spring配置路径--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:applicationContext.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--filter--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>encodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>utf-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>encodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>default<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>*.html<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h4 id="servlet-01-xml"><a href="#servlet-01-xml" class="headerlink" title="servlet-01.xml"></a>servlet-01.xml</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:mvc</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd http://www.springframework.org/schema/mvc https://www.springframework.org/schema/mvc/spring-mvc.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--controller(servlet)交由mvc控制，其他component交由spring控制--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--此处是mvc-servlet配置文件--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--扫描controller--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.wyg.mvcwork.controller&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--注解驱动--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:annotation-driven</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--视图解析器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;viewResolver&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suffix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;.jsp&quot;</span>/&gt;</span><span class="comment">&lt;!--后缀--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/jsp/&quot;</span>/&gt;</span><span class="comment">&lt;!--前缀--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--静态资源--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!----&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">mapping</span>=<span class="string">&quot;/html/**&quot;</span> <span class="attr">location</span>=<span class="string">&quot;classpath:html/&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h4 id="application-xml"><a href="#application-xml" class="headerlink" title="application.xml"></a>application.xml</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span> <span class="attr">xmlns:tx</span>=<span class="string">&quot;http://www.springframework.org/schema/tx&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--controller(servlet)交由mvc控制，其他component交由spring控制--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--此处是spring配置文件--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.wyg.mvcwork&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">context:exclude-filter</span> <span class="attr">type</span>=<span class="string">&quot;annotation&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;org.springframework.stereotype.Controller&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath:config/db.properties&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:property-placeholder</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--=========================配置Mybatis整合===============================--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置数据源--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.driver&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.username&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 初始化连接大小 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;initialSize&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 连接池最大使用连接数量 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxActive&quot;</span> <span class="attr">value</span>=<span class="string">&quot;20&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 连接池最小空闲 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;minIdle&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 获取连接最大等待时间 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxWait&quot;</span> <span class="attr">value</span>=<span class="string">&quot;60000&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 指定mybatis配置文件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;sqlSessionFactory&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;configLocation&quot;</span> <span class="attr">value</span>=<span class="string">&quot;classpath:config/mybatis.xml&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--指定dao层,注入@Mapper到IOC--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.mapper.MapperScannerConfigurer&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;basePackage&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.wyg.mvcwork.mapper&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;sqlSessionFactoryBeanName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;sqlSessionFactory&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    &lt;bean class=&quot;org.mybatis.confi&quot;--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 开启事务 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;transactionManager&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 可通过注解控制事务 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:annotation-driven</span> <span class="attr">transaction-manager</span>=<span class="string">&quot;transactionManager&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>spring</category>
      </categories>
  </entry>
  <entry>
    <title>SpringCloud</title>
    <url>/2021/12/14/spring/spring%E5%AE%B6%E6%97%8F/springCloud/</url>
    <content><![CDATA[<p>[toc]</p>
<ol>
<li><p>springCloud是一系列框架的集合</p>
</li>
<li><p>自动挡的房车</p>
</li>
<li><p>依赖.pom+配置.properties+@注解</p>
</li>
<li><p>微服务架构技术落地实现的集合体，是微服务架构下的一站式解决方案</p>
<p>服务发现——Netflix Eureka /  nacos<br>客服端负载均衡——Netflix Ribbon</p>
<p>服务调用—— netflix fergn</p>
<p>断路器——Netflix Hystrix<br>服务网关——Netflix Zuul /Sprin Cloud CateWay<br>分布式配置——Spring Cloud Config /nacos</p>
<p>消息总线 —— Spring Cloud Bus/ nacos</p>
<span id="more"></span></li>
<li><h1 id="微服务实现"><a href="#微服务实现" class="headerlink" title="微服务实现"></a>微服务实现</h1><ol>
<li>微服务架构：SpringCloud、Dubbo、SpringCloudAlibaba</li>
<li>网关–&gt;负载均衡–&gt;微服务集群–&gt;数据库</li>
</ol>
<h2 id="ribbon负载均衡"><a href="#ribbon负载均衡" class="headerlink" title="ribbon负载均衡"></a>ribbon负载均衡</h2><h2 id="nacos注册中心"><a href="#nacos注册中心" class="headerlink" title="nacos注册中心"></a>nacos注册中心</h2></li>
</ol>
<h2 id="SpringCloud"><a href="#SpringCloud" class="headerlink" title="SpringCloud"></a>SpringCloud</h2><ol>
<li>版本对应</li>
</ol>
<table>
<thead>
<tr>
<th>springCloud</th>
<th>springBoot</th>
</tr>
</thead>
<tbody><tr>
<td><a href="https://github.com/spring-cloud/spring-cloud-release/wiki/Spring-Cloud-2020.0-Release-Notes">2020.0.x</a> aka Ilford</td>
<td>2.4.x, 2.5.x (Starting with 2020.0.3)</td>
</tr>
<tr>
<td><a href="https://github.com/spring-cloud/spring-cloud-release/wiki/Spring-Cloud-Hoxton-Release-Notes">Hoxton</a><a href="https://github.com/spring-cloud/spring-cloud-release/wiki/Spring-Cloud-Hoxton-Release-Notes">Hoxton</a></td>
<td>2.2.x, 2.3.x (Starting with SR5)</td>
</tr>
<tr>
<td><a href="https://github.com/spring-projects/spring-cloud/wiki/Spring-Cloud-Greenwich-Release-Notes">Greenwich</a><a href="https://github.com/spring-projects/spring-cloud/wiki/Spring-Cloud-Greenwich-Release-Notes">Greenwich</a></td>
<td>2.1.x2.1.x</td>
</tr>
<tr>
<td><a href="https://github.com/spring-projects/spring-cloud/wiki/Spring-Cloud-Finchley-Release-Notes">Finchley</a><a href="https://github.com/spring-projects/spring-cloud/wiki/Spring-Cloud-Finchley-Release-Notes">Finchley</a></td>
<td>2.0.x2.0.x</td>
</tr>
<tr>
<td><a href="https://github.com/spring-projects/spring-cloud/wiki/Spring-Cloud-Edgware-Release-Notes">Edgware</a></td>
<td>1.5.x</td>
</tr>
<tr>
<td><a href="https://github.com/spring-projects/spring-cloud/wiki/Spring-Cloud-Dalston-Release-Notes">Dalston</a></td>
<td>1.5.x</td>
</tr>
</tbody></table>
<h2 id="1、服务拆分、"><a href="#1、服务拆分、" class="headerlink" title="1、服务拆分、"></a>1、服务拆分、</h2><ol>
<li><p>数据独立、每个模块一个数据库</p>
</li>
<li><p><strong>提供者</strong>接口暴露</p>
</li>
<li><p>业务独立</p>
</li>
<li><p><strong>消费者</strong>远程调用<strong>提供者</strong>：8080–java代码发起请求http请求—&gt;8081</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//application中注入RestTemplate</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> RestTemplate <span class="title">restTemplate</span><span class="params">(id)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> RestTemplate(param)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//service调用restTemplate</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">(order)</span></span>&#123;</span><br><span class="line">	String url=<span class="string">&quot;http://localhost:8081/user/&quot;</span>+order.getId<span class="string">&#x27;;</span></span><br><span class="line"><span class="string">    return restTemplate.getForObject(url,User.class).getName();</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="eureka注册中心"><a href="#eureka注册中心" class="headerlink" title="eureka注册中心"></a>eureka注册中心</h2><ol>
<li><p>8081可能会改变，所以需要用注册中心</p>
</li>
<li><p>消费者—注册中心—提供者</p>
</li>
<li><p>每一个模块启动，都会向eureka注册的报道登记（每30秒也会）（因为每一个模块都可能成为提供者），比如user模块：我来了，我是user。如果30s内没有报道，就会除去这个接口。</p>
</li>
<li><p>然后来了一个消费者：帮我找找user，看有没有，eureka一看有3个User，eureka就会根据负载均衡挑选一个接口。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//application中注入RestTemplate</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@LoadBalance</span> <span class="comment">//负载均衡</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> RestTemplate <span class="title">restTemplate</span><span class="params">(id)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> RestTemplate(param)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//service调用restTemplate</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">(order)</span></span>&#123;</span><br><span class="line">	String url=<span class="string">&quot;http://userservice/user/&quot;</span>+order.getId<span class="string">&#x27;;</span></span><br><span class="line"><span class="string">    return restTemplate.getForObject(url,User.class).getName();</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="Riboon负载均衡"><a href="#Riboon负载均衡" class="headerlink" title="Riboon负载均衡"></a>Riboon负载均衡</h3><ol>
<li><p>步骤</p>
<img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20210913002823604.png" alt="image-20210913002823604" style="zoom:80%;" /></li>
<li><p>负载均衡原理：Riboon负载均衡的原则是IRule接口实现的ZoneAvoiddanceRule&lt;—-RoundRobinRule，是轮循类。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">其中zone可以指定地方</span><br><span class="line">会优先原则离这个地方最近的服务接口</span><br><span class="line">其他调整方法：</span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">   	<span class="function"><span class="keyword">public</span> IRule <span class="title">testRule</span><span class="params">()</span></span>&#123;</span><br><span class="line">    	<span class="keyword">return</span> RandomRule(); 随机</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="Nacos注册中心—-gt-eureka"><a href="#Nacos注册中心—-gt-eureka" class="headerlink" title="Nacos注册中心—&gt;eureka"></a>Nacos注册中心—&gt;eureka</h3><ol>
<li><p>特点：</p>
<ol>
<li>房产中介，桥梁，注册中心</li>
</ol>
</li>
<li><p>启动</p>
<figure class="highlight dos"><table><tr><td class="code"><pre><span class="line">startup.<span class="built_in">cmd</span> -m standalone </span><br><span class="line">其中nacos中</span><br><span class="line">	standlone是单机启动</span><br><span class="line">	clusters</span><br></pre></td></tr></table></figure></li>
<li></li>
</ol>
]]></content>
  </entry>
  <entry>
    <title>springMVC</title>
    <url>/2022/02/21/spring/spring%E5%AE%B6%E6%97%8F/springMVC/</url>
    <content><![CDATA[<p>[toc]</p>
<p><a href="https://www.cnblogs.com/bsjl/p/7723440.html">优秀文章</a></p>
<h2 id="一、MVC的理解"><a href="#一、MVC的理解" class="headerlink" title="一、MVC的理解"></a>一、MVC的理解</h2><blockquote>
<p>MVC包括MVC、MVP、MVVM</p>
</blockquote>
<h3 id="1-1-侠义MVC"><a href="#1-1-侠义MVC" class="headerlink" title="1.1 侠义MVC"></a>1.1 侠义MVC</h3><blockquote>
<p>mvc是前后端不分离的model view controller 对应springmvc的</p>
</blockquote>
<h4 id="1-1-1-mvc含义"><a href="#1-1-1-mvc含义" class="headerlink" title="1.1.1 mvc含义"></a>1.1.1 mvc含义</h4><ol>
<li>model=pojo    数据模型，核心</li>
<li>view=jsp/html+modelAndView 渲染数据</li>
<li>controller=controller，接收用户请求<ol>
<li>前端控制器 dispatch</li>
<li>后端控制器 controller</li>
</ol>
</li>
</ol>
<h4 id="1-1-2-ModelAndView"><a href="#1-1-2-ModelAndView" class="headerlink" title="1.1.2 ModelAndView"></a>1.1.2 ModelAndView</h4><ol>
<li>model 响应数据（map结构）/ javaBean    <ol>
<li>请求的最后阶段 框架会把数据加入到request作用域</li>
</ol>
</li>
<li>view jsp地址<ol>
<li>框架对视图执行forward重定向操作</li>
</ol>
</li>
</ol>
<h4 id="1-1-3-model-返回的数据"><a href="#1-1-3-model-返回的数据" class="headerlink" title="1.1.3 model  返回的数据"></a>1.1.3 model  返回的数据</h4><ol>
<li>modelAndView.addObject(“name”,”王勇敢”);其实和request.serAttribute(“name”,”王勇敢”)</li>
<li>四种数据<ol>
<li>obj<ol>
<li>json的转换   和    返回设置格式 context:json是固定重复代码</li>
<li>除去重复代码：基于消息转换器.jackon<ol>
<li>加入依赖  jackson-core  jackson-databind  注意版本</li>
<li>加入注解驱动 注意是mvc的driven</li>
<li>加@ResponseBody</li>
</ol>
</li>
<li>返回json原理<ol>
<li>注解驱动的接口httpMessageConverter定义很多obj转换方法，如xml,json,txt</li>
<li>spring注入这个接口的是是实现类。</li>
</ol>
</li>
</ol>
</li>
<li>string(视图路径)</li>
<li>string,int 数据</li>
<li>void使用response.WriteStream响应（只有数据，没有视图）</li>
</ol>
</li>
</ol>
<h3 id="1-2-MVVM"><a href="#1-2-MVVM" class="headerlink" title="1.2 MVVM"></a>1.2 MVVM</h3><blockquote>
<p>MVVM是流行的前后端分离model view modelAndView，这个更多的体现在前端</p>
</blockquote>
<ol>
<li>model=controller+pojo</li>
<li>view=html(model)</li>
<li>modelAndView=model-view转换器</li>
</ol>
<h3 id="1-3-mvc优缺点"><a href="#1-3-mvc优缺点" class="headerlink" title="1.3 mvc优缺点"></a>1.3 mvc优缺点</h3><h4 id="1-3-1-优点"><a href="#1-3-1-优点" class="headerlink" title="1.3.1 优点"></a>1.3.1 优点</h4><ol>
<li>耦合度低：表改了，只需修改model</li>
<li>复用性高：model可以在不同的视图中使用</li>
<li>可维护性高</li>
<li>分层，结构清晰，开发快</li>
</ol>
<h4 id="1-3-2-缺点："><a href="#1-3-2-缺点：" class="headerlink" title="1.3.2 缺点："></a>1.3.2 缺点：</h4><ol>
<li>适合大型项目，但是现在的小型项目也在使用这种模式，就有点得不偿失</li>
<li>增加了系统的复杂性，降低了运行效率</li>
</ol>
<h2 id="二、SpringMVC"><a href="#二、SpringMVC" class="headerlink" title="二、SpringMVC"></a>二、SpringMVC</h2><h3 id="2-1-概念"><a href="#2-1-概念" class="headerlink" title="2.1 概念"></a>2.1 概念</h3><ol>
<li><p>spring web mvc   spring&gt;3.0</p>
</li>
<li><p>支持restful</p>
</li>
<li><p>单例 每个servlet只有一个。所以说ssm是基于方法的，struts2是基于类的。</p>
</li>
<li><p>模块化，各个组件一次进行</p>
<ol>
<li>dispatch前端控制器</li>
<li>controller后端配置器</li>
<li>handler请求映射器</li>
<li>handlerAdapter处理适配器</li>
<li>ViewRelover视图解析器</li>
<li>验证器viliader Jsr303</li>
</ol>
</li>
<li><p>springmvc  spring、IOC是容器，ioc管理对象  </p>
<ol>
<li>&lt;bean&gt; @controller @respository @ mapper</li>
<li>@controller是控制器对象  不是servlet</li>
</ol>
</li>
</ol>
<h3 id="2-2-dispatcherservlet"><a href="#2-2-dispatcherservlet" class="headerlink" title="2.2 dispatcherservlet"></a>2.2 dispatcherservlet</h3><ol>
<li><p>springmvc 内置的<strong>超级servlet</strong> 用于接受所有请求 ，然后把请求分发给controller</p>
</li>
<li><p>dispatcherservlet别名</p>
<ol>
<li>超级servlet  继承自httpserlvet</li>
<li>中央调度器</li>
<li>前端控制器</li>
</ol>
</li>
<li><p>dispatcherservlet作用</p>
<ol>
<li>接受所有请求 调用控制器对象</li>
<li>把请求响应返还个用户</li>
<li>核心方法 doDispatch(req,resp)</li>
</ol>
</li>
</ol>
<h3 id="2-3-mvc启动过程"><a href="#2-3-mvc启动过程" class="headerlink" title="2.3 mvc启动过程"></a>2.3 mvc启动过程</h3><ol>
<li><p>tomcat启动  </p>
</li>
<li><p>创建dispatcher</p>
</li>
<li><p>执行servlet.inti() 创建sprig容器webapplicationContext</p>
</li>
<li><p>把spring容器放进serlevtContext</p>
<p>getServletContext().setAttribute(name,webapplicationContext)</p>
<p>这个servlet就是dispatcher</p>
</li>
<li><p>把对象注入spring容器</p>
</li>
</ol>
<h2 id="三、创建springmvc项目"><a href="#三、创建springmvc项目" class="headerlink" title="三、创建springmvc项目"></a>三、创建springmvc项目</h2><ol>
<li><p>创建</p>
<ol>
<li><p>maven -&gt;maven-archetype-webapp模板</p>
</li>
<li><p>加入依赖</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>wel.xml 全局serlvet配置</p>
</li>
<li><p>创建springmvc配置</p>
</li>
<li><p>创建控制器@Controller 加入@requetMapping</p>
</li>
<li><p>创建jsp</p>
</li>
</ol>
</li>
<li><p>idea配置</p>
<ol>
<li>项目结构–模块–删除部署描述  添加部署描述为web1.xml </li>
<li>更改web1.xml 为web.xml</li>
</ol>
</li>
<li><p>web.xml配置</p>
<ol>
<li>servlet<ol>
<li>name </li>
<li>url-partter</li>
</ol>
</li>
<li>过滤器 ：处理请求乱码</li>
</ol>
</li>
<li><p>st.xml配置</p>
<ol>
<li>控制器扫描器</li>
<li>视图解析器</li>
</ol>
</li>
<li><p>tomcat配置</p>
</li>
</ol>
<h3 id="注入mybatis的-mapper"><a href="#注入mybatis的-mapper" class="headerlink" title="注入mybatis的@mapper"></a>注入mybatis的@mapper</h3><h3 id="访问html"><a href="#访问html" class="headerlink" title="访问html"></a>访问html</h3><p>servlet-01.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">mapping</span>=<span class="string">&quot;/html/**&quot;</span> <span class="attr">location</span>=<span class="string">&quot;classpath:html/&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="四、其他"><a href="#四、其他" class="headerlink" title="四、其他"></a>四、其他</h2><ol>
<li>@requestMapper{“a”,”b”} 访问两个路径都可以</li>
<li>url-parrten 为接受所有请求 且表示优先级最高 一般用于过滤器</li>
<li>访问资源<ol>
<li>动态资源.html/jsp的路径tomcat</li>
<li>静态资源  tomcat      因为tomcat内置一个dafaultServlet(在tomcat.conf)    启动的时候自动创建 ,<ol>
<li>处理为映射到controller.Mapping的路径</li>
<li>对所有的静态资源 </li>
<li>当某个servlet的url-patter为/或者/* 那么这个servlet就会接手这个内置servlet的工作</li>
</ol>
</li>
<li>url(controller)  有mvc内置的servlet    dispatchServlet处理</li>
</ol>
</li>
</ol>
<h2 id="五、SpringMVC问题"><a href="#五、SpringMVC问题" class="headerlink" title="五、SpringMVC问题"></a>五、SpringMVC问题</h2><ol>
<li>静态资源访问失败<ol>
<li>原因可能是servlet的partten接手了//资源，而静态资源默认是//路径</li>
<li>处理：加配置</li>
</ol>
</li>
</ol>
<h3 id="springmvc处理请求流程"><a href="#springmvc处理请求流程" class="headerlink" title="springmvc处理请求流程"></a>springmvc处理请求流程</h3><ol>
<li>tomcat–&gt;url-partter匹配—&gt;dispatcher—&gt;st.servlet—&gt;wyg.controller–&gt;TestController</li>
</ol>
<p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20211019003549650.png" alt="image-20211019003549650"></p>
]]></content>
      <categories>
        <category>spring</category>
      </categories>
  </entry>
  <entry>
    <title>schedule注解</title>
    <url>/2022/03/26/spring/%E6%B3%A8%E8%A7%A3/schdule/</url>
    <content><![CDATA[<table>
<thead>
<tr>
<th>注解</th>
<th>作用</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>@EnableScheduling</td>
<td>开启定时任务功能</td>
<td>configuration</td>
</tr>
<tr>
<td>@Scheduled(cron=”0/10 * * * * ? “)</td>
<td>指定cron表达式</td>
<td>method</td>
</tr>
<tr>
<td>@Schedules</td>
<td>指定多个周期</td>
<td>method</td>
</tr>
<tr>
<td>@EnableAsync</td>
<td>开启异步支持</td>
<td>Configuration</td>
</tr>
<tr>
<td>@Async</td>
<td>异步任务，spring自带的线程池(可以修改)调用该方法</td>
<td>Method</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h4 id="Scheduled"><a href="#Scheduled" class="headerlink" title="@Scheduled"></a>@Scheduled</h4><ol>
<li>@Scheduled(fixedRate=2000)  // 每隔执行时间+2秒执行一次 </li>
<li>@Scheduled(fixDelay=2000) //每隔2秒一次</li>
<li>@Scheduled(cron=”0/10 * * * * ? “)  // 每隔10秒执行一次 </li>
<li>@Scheduled(cron=”0 33/3 * * * ?”) //每小时的33分钟开始执行，每3分钟执行1次 </li>
</ol>
<h4 id="异步、-Async失效"><a href="#异步、-Async失效" class="headerlink" title="异步、@Async失效"></a>异步、@Async失效</h4><ol>
<li>异步方法使用static修饰</li>
<li>异步类没有使用@Component注解（或其他注解）导致spring无法扫描到异步类</li>
<li>异步方法不能与异步方法在同一个类中</li>
<li>类中需要使用@Autowired或@Resource等注解自动注入，不能自己手动new对象</li>
<li>如果使用SpringBoot框架必须在启动类中增加@EnableAsync注解</li>
<li>在Async 方法上标注@Transactional是没用的。 在Async 方法调用的方法上标注@Transactional 有效。</li>
<li>调用被@Async标记的方法的调用者不能和被调用的方法在同一类中不然不会起作用！！！！！！！</li>
<li>使用@Async时要求是不能有返回值的不然会报错的 因为异步要求是不关心结果的</li>
</ol>
<h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h3><ul>
<li>使用简单。</li>
<li>支持cron表达式，支持固定频率执行。</li>
<li>代码侵入性低。</li>
</ul>
<h3 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h3><ul>
<li>无法解决分布式调度问题。</li>
<li>无法监控任务状态。</li>
<li>无其他骚功能。如失败提醒，重试等等。</li>
</ul>
]]></content>
      <categories>
        <category>spring</category>
      </categories>
  </entry>
  <entry>
    <title>spring配置注解</title>
    <url>/2021/12/12/spring/%E6%B3%A8%E8%A7%A3/spring%E9%85%8D%E7%BD%AE%E6%B3%A8%E8%A7%A3/</url>
    <content><![CDATA[<p>[toc]</p>
<h2 id="一、配置型注解"><a href="#一、配置型注解" class="headerlink" title="一、配置型注解"></a>一、配置型注解</h2><h3 id="1-1-Bean"><a href="#1-1-Bean" class="headerlink" title="1.1 @Bean"></a>1.1 @Bean</h3><p><a href="https://www.cnblogs.com/feiyu127/p/7700090.html">参考</a></p>
<ol>
<li><p>@Bean</p>
<ul>
<li>@Bean是一个方法级别上的注解，主要用在@Configuration注解的类里，也可以用在@Component注解的类里。添加的bean的id为方法名</li>
<li>对于依赖型的@Bean，直接用参数注入</li>
</ul>
</li>
<li><p>注入IOC</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IOC</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Bean2 <span class="title">bean2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Bean2();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Bean3 <span class="title">getBean3</span><span class="params">(Bean2 bean2)</span> </span>&#123;</span><br><span class="line">        Bean3 bean3 = <span class="keyword">new</span> Bean3();</span><br><span class="line">        bean3.setName(<span class="string">&quot;zhang&quot;</span>);</span><br><span class="line">        bean3.setBean2(bean2);</span><br><span class="line">        <span class="keyword">return</span> bean3;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Bean3 <span class="title">needBean3</span><span class="params">(Bean2 bean2)</span> </span>&#123;</span><br><span class="line">        Bean3 bean3 = <span class="keyword">new</span> Bean3();</span><br><span class="line">        bean3.setName(<span class="string">&quot;wang&quot;</span>);</span><br><span class="line">        bean3.setBean2(bean2);</span><br><span class="line">        <span class="keyword">return</span> bean3;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Controller</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BeanController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="meta">@Qualifier(&quot;needBean3&quot;)</span></span><br><span class="line">    Bean3 bean31;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="meta">@Qualifier(&quot;getBean3&quot;)</span></span><br><span class="line">    Bean3 bean32;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;获得bean&quot;)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;bean1&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ApiResult <span class="title">bean1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(bean31);</span><br><span class="line">        System.out.println(bean32);</span><br><span class="line">        <span class="keyword">return</span> ApiResult.ok();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Bean3(name=wang, age=<span class="number">0</span>, bean2=com.wyg.boottest.config.bean.Bean2@<span class="number">50906524</span>)</span><br><span class="line">Bean3(name=zhang, age=<span class="number">0</span>, bean2=com.wyg.boottest.config.bean.Bean2@<span class="number">50906524</span>)</span><br></pre></td></tr></table></figure>

<p>等同于</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;getBean3&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.wyg.epidemicsituation.entity.vo.Bean3&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;Bean2&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;bean2&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>属性</p>
<ul>
<li><p>name 自定义名字</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean(name = &#123;&quot;myFoo&quot;,&quot;y&quot;&#125;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Foo <span class="title">foo</span><span class="params">()</span> </span></span><br><span class="line"><span class="function">    return new <span class="title">Foo</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>获取@Configruation的beans见@Configruation</p>
</li>
</ol>
<h3 id="1-2-Configruation"><a href="#1-2-Configruation" class="headerlink" title="1.2 @Configruation"></a>1.2 @Configruation</h3><ol>
<li><p>获取Context,这种方法相当于另创一个@Configruation，里面的@Bean需要重新创建一遍</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">AnnotationConfigApplicationContext applicationContext2 = <span class="keyword">new</span> AnnotationConfigApplicationContext(BeanConfig.class);</span><br></pre></td></tr></table></figure></li>
<li><p>从Spring3.0，@Configuration用于定义配置类，可替换xml配置文件，被注解的类内部包含有一个或多个被@Bean注解的方法，这些方法将会被AnnotationConfigApplicationContext或AnnotationConfigWebApplicationContext类进行扫描，并用于构建bean定义，初始化Spring容器。</p>
<ol>
<li>@Configuration不可以是final类型；</li>
<li>@Configuration不可以是匿名类；</li>
<li>嵌套的configuration必须是静态类</li>
</ol>
</li>
<li><p>一个@Configuration下面可以定义多个@Bean</p>
</li>
<li><p>基于java而没注解@Configuration的注册方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">AnnotationConfigApplicationContext cxt=<span class="keyword">new</span> AnnotationConfigApplicationContext();</span><br><span class="line">cxt.register(MyConfig.class);</span><br><span class="line">cxt.getBean(<span class="string">&quot;aaa&quot;</span>)</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="1-3-Service-controller-repository和-Component区别"><a href="#1-3-Service-controller-repository和-Component区别" class="headerlink" title="1.3 @Service,controller,repository和@Component区别"></a>1.3 @Service,controller,repository和@Component区别</h3><ol>
<li>前三者含有特定功能的Component 比如<ol>
<li>dispatchServlet寻找的是@Conroller的GetMapping而不是@Component的mapping</li>
</ol>
</li>
<li>后者可用前三者代替</li>
</ol>
<h3 id="1-4-Mapper和-Repository的区别"><a href="#1-4-Mapper和-Repository的区别" class="headerlink" title="1.4 @Mapper和@Repository的区别"></a>1.4 @Mapper和@Repository的区别</h3><ol>
<li><a href="https://blog.csdn.net/qq_36816062/article/details/108086097">相同点</a><br>@Mapper和@Repository都是作用在dao层接口，使得其生成代理对象bean，交给spring 容器管理<br>对于mybatis来说，都可以不用写mapper.xml文件</li>
<li>不同点<br>@Mapper不需要配置扫描地址，通过xml里面的namespace里面的接口地址，生成了Bean后注入到Service层中。@MapperScan(“mapper文件所在包”)，这样就不需要每个mapper文件都加@Mapper注解了<br>而@Repository不可以单独使用,需要配置@MapperScan(“com.anson.dao”) </li>
</ol>
<h3 id="1-5-Bean和-Component区别"><a href="#1-5-Bean和-Component区别" class="headerlink" title="1.5 @Bean和@Component区别"></a>1.5 @Bean和@Component区别</h3><ol>
<li><p>前者作用于methon，后者作用于class</p>
</li>
<li><p>@Component通过@ComponentScan扫描得到</p>
</li>
<li><p>@Bean在@Configuration Class下</p>
</li>
<li><p>@Bean更灵活—&gt;配置文件调控的时候就只能用@Bean</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Student</span><span class="params">(<span class="keyword">int</span> status)</span></span>&#123;</span><br><span class="line">    <span class="keyword">switch</span>(status):</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>: <span class="keyword">return</span> <span class="keyword">new</span> Student(<span class="number">1</span>,<span class="string">&quot;王&quot;</span>);</span><br><span class="line">    <span class="keyword">case</span> <span class="number">2</span>: <span class="keyword">return</span> <span class="keyword">new</span> Student(<span class="number">2</span>,<span class="string">&quot;张&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="1-6-Autowire和-Resource的区别"><a href="#1-6-Autowire和-Resource的区别" class="headerlink" title="1.6 @Autowire和@Resource的区别"></a>1.6 @Autowire和@Resource的区别</h3><ol>
<li>作用域相同<ol>
<li>属性</li>
<li>setter</li>
</ol>
</li>
<li>@Autowire 默认先按类型装配</li>
<li>@Resource 默认先按名称装配</li>
<li>@Resource =@Autowrie+@Qualifier</li>
</ol>
<h3 id="1-7-ComponentScan与ComponentScans"><a href="#1-7-ComponentScan与ComponentScans" class="headerlink" title="1.7 @ComponentScan与ComponentScans"></a>1.7 @ComponentScan与ComponentScans</h3><ol>
<li><a href="https://www.cnblogs.com/jiafa/p/13800766.html">@ComponentScan和@ComponentScans注解</a></li>
</ol>
<h3 id="1-8-ControllerAdvice"><a href="#1-8-ControllerAdvice" class="headerlink" title="1.8 @ControllerAdvice"></a>1.8 @ControllerAdvice</h3><ol>
<li>全局异常处理器</li>
</ol>
<h3 id="1-9-ConfigurationProperties"><a href="#1-9-ConfigurationProperties" class="headerlink" title="1.9 @ConfigurationProperties"></a>1.9 @ConfigurationProperties</h3><ol>
<li>前缀配置–更灵活</li>
</ol>
<h3 id="1-10-ContextConfiguration"><a href="#1-10-ContextConfiguration" class="headerlink" title="1.10 @ContextConfiguration"></a>1.10 @ContextConfiguration</h3>]]></content>
      <categories>
        <category>spring</category>
      </categories>
  </entry>
  <entry>
    <title>spring-properties</title>
    <url>/2021/12/11/spring/%E9%85%8D%E7%BD%AE/@value-%E8%87%AA%E5%AE%9A%E4%B9%89/</url>
    <content><![CDATA[<p>[toc]</p>
<h3 id="一、调用值"><a href="#一、调用值" class="headerlink" title="一、调用值"></a>一、调用值</h3><ol>
<li><p>引入@PropertySource</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@PropertySource(&quot;classpath:config.properties&quot;)</span></span><br></pre></td></tr></table></figure></li>
<li><p>注入普通字符串</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Debug</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Value(&quot;normal&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String myDebug; <span class="comment">// 注入普通字符串</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<span id="more"></span></li>
<li><p>@value接受类型</p>
<ol>
<li><p>string</p>
</li>
<li><p>boolean</p>
</li>
<li><p>long</p>
</li>
<li><p>表达式</p>
</li>
<li></li>
<li><p>强大</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Value(&quot;#&#123;$&#123;EMAIL_CODE_EXPIRATION_TIME&#125;&#125;&quot;)</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">long</span> EMAIL_CODE_EXPIRATION_TIME;</span><br></pre></td></tr></table></figure>

<p>自定义配置文件    ${}取得</p>
</li>
</ol>
</li>
<li><p>@value的$ 和 $区别</p>
<ul>
<li><p>@Value(“#{}”)  SpEL表达式</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Value(&quot;#&#123;1&#125;&quot;)</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> number; <span class="comment">//获取数字 1</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Value(&quot;#&#123;&#x27;Spring Expression Language&#x27;&#125;&quot;)</span> <span class="comment">//获取字符串常量</span></span><br><span class="line"><span class="keyword">private</span> String str;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Value(&quot;#&#123;dataSource.url&#125;&quot;)</span> <span class="comment">//获取bean的属性</span></span><br><span class="line"><span class="keyword">private</span> String jdbcUrl;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>@Value(“${}”)  获取string</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@PropertySource(&quot;classpath:config.properties&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConfigProperty</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;name&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="二、自定义配置properties"><a href="#二、自定义配置properties" class="headerlink" title="二、自定义配置properties"></a>二、自定义配置properties</h3><ol>
<li><p>创建文件</p>
<p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20211030115341905.png" alt="image-20211030115341905"></p>
</li>
<li><p>加上注解</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@PropertySource(&quot;classpath:config/values.properties&quot;)</span>+<span class="meta">@Configuration</span>读取</span><br></pre></td></tr></table></figure>

<!-- more --></li>
<li><p>implements InitializingBean 饿汉式加载</p>
<p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20211030115459989.png" alt="image-20211030115459989"></p>
</li>
<li><p>@Value(“${name}”)获取属性</p>
</li>
</ol>
<h3 id="三、注意"><a href="#三、注意" class="headerlink" title="三、注意"></a>三、注意</h3><ol>
<li><p>yml&gt;yaml&gt;properties</p>
</li>
<li><p>yml能调用Pro ,当有yml和pro的时候会优先使用pro,如果yml没特定内容，就会使用pro</p>
<p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20211026215034623.png" alt="image-20211026215034623"></p>
</li>
</ol>
<h3 id="四、总文件"><a href="#四、总文件" class="headerlink" title="四、总文件"></a>四、总文件</h3><ol>
<li><p>yml1</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line">  <span class="attr">servlet:</span></span><br><span class="line">    <span class="attr">context-path:</span> <span class="string">/</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:8&amp;zeroDateTimeBehavior=convertToNull&amp;allowMultiQueries=true&amp;useSSL=false</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line">  <span class="attr">jpa:</span></span><br><span class="line">    <span class="attr">database:</span> <span class="string">MySQL</span></span><br><span class="line">    <span class="attr">database-platform:</span> <span class="string">org.hibernate.dialect.MySQL5InnoDBDialect</span></span><br><span class="line">    <span class="attr">show-sql:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">hibernate:</span></span><br><span class="line">      <span class="attr">ddl-auto:</span> <span class="string">update</span></span><br><span class="line">  <span class="attr">devtools:</span></span><br><span class="line">    <span class="attr">restart:</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">additional-paths:</span> <span class="string">src/main/java</span></span><br></pre></td></tr></table></figure></li>
<li><p>yml2–dev</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment">#配置数据源</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">druid:</span></span><br><span class="line">      <span class="attr">db-type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line">      <span class="attr">driverClassName:</span> <span class="string">net.sf.log4jdbc.sql.jdbcapi.DriverSpy</span></span><br><span class="line">      <span class="attr">url:</span> <span class="string">jdbc:serverTimezone=Asia/Shanghai&amp;characterEncoding=utf8&amp;useSSL=false</span></span><br><span class="line">      <span class="attr">username:</span> <span class="string">$&#123;DB_USER:root&#125;</span></span><br><span class="line">      <span class="attr">password:</span> <span class="string">$&#123;DB_PWD:root&#125;</span></span><br><span class="line">      <span class="comment"># 初始连接数</span></span><br><span class="line">      <span class="attr">initial-size:</span> <span class="number">5</span></span><br><span class="line">      <span class="comment"># 最小连接数</span></span><br><span class="line">      <span class="attr">min-idle:</span> <span class="number">15</span></span><br><span class="line">      <span class="comment"># 最大连接数</span></span><br><span class="line">      <span class="attr">max-active:</span> <span class="number">30</span></span><br><span class="line">      <span class="comment"># 超时时间(以秒数为单位)</span></span><br><span class="line">      <span class="attr">remove-abandoned-timeout:</span> <span class="number">180</span></span><br><span class="line">      <span class="comment"># 获取连接超时时间</span></span><br><span class="line">      <span class="attr">max-wait:</span> <span class="number">3000</span></span><br><span class="line">      <span class="comment"># 连接有效性检测时间</span></span><br><span class="line">      <span class="attr">time-between-eviction-runs-millis:</span> <span class="number">60000</span></span><br><span class="line">      <span class="comment"># 连接在池中最小生存的时间</span></span><br><span class="line">      <span class="attr">min-evictable-idle-time-millis:</span> <span class="number">300000</span></span><br><span class="line">      <span class="comment"># 连接在池中最大生存的时间</span></span><br><span class="line">      <span class="attr">max-evictable-idle-time-millis:</span> <span class="number">900000</span></span><br><span class="line">      <span class="comment"># 指明连接是否被空闲连接回收器(如果有)进行检验.如果检测失败,则连接将被从池中去除</span></span><br><span class="line">      <span class="attr">test-while-idle:</span> <span class="literal">true</span></span><br><span class="line">      <span class="comment"># 指明是否在从池中取出连接前进行检验,如果检验失败, 则从池中去除连接并尝试取出另一个</span></span><br><span class="line">      <span class="attr">test-on-borrow:</span> <span class="literal">true</span></span><br><span class="line">      <span class="comment"># 是否在归还到池中前进行检验</span></span><br><span class="line">      <span class="attr">test-on-return:</span> <span class="literal">false</span></span><br><span class="line">      <span class="comment"># 检测连接是否有效</span></span><br><span class="line">      <span class="attr">validation-query:</span> <span class="string">select</span> <span class="number">1</span></span><br><span class="line">      <span class="comment"># 配置监控统计</span></span><br><span class="line">      <span class="attr">webStatFilter:</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">stat-view-servlet:</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">url-pattern:</span> <span class="string">/druid/*</span></span><br><span class="line">        <span class="attr">reset-enable:</span> <span class="literal">false</span></span><br><span class="line">      <span class="attr">filter:</span></span><br><span class="line">        <span class="attr">stat:</span></span><br><span class="line">          <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">          <span class="comment"># 记录慢SQL</span></span><br><span class="line">          <span class="attr">log-slow-sql:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">slow-sql-millis:</span> <span class="number">1000</span></span><br><span class="line">          <span class="attr">merge-sql:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">wall:</span></span><br><span class="line">          <span class="attr">config:</span></span><br><span class="line">            <span class="attr">multi-statement-allow:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 登录相关配置</span></span><br><span class="line"><span class="attr">login:</span></span><br><span class="line">  <span class="comment"># 登录缓存</span></span><br><span class="line">  <span class="attr">cache-enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment">#  是否限制单用户登录</span></span><br><span class="line">  <span class="attr">single-login:</span> <span class="literal">false</span></span><br><span class="line">  <span class="comment">#  验证码</span></span><br><span class="line">  <span class="attr">login-code:</span></span><br><span class="line">    <span class="comment">#  验证码类型配置 查看 LoginProperties 类</span></span><br><span class="line">    <span class="attr">code-type:</span> <span class="string">arithmetic</span></span><br><span class="line">    <span class="comment">#  登录图形验证码有效时间/分钟</span></span><br><span class="line">    <span class="attr">expiration:</span> <span class="number">2</span></span><br><span class="line">    <span class="comment">#  验证码高度</span></span><br><span class="line">    <span class="attr">width:</span> <span class="number">111</span></span><br><span class="line">    <span class="comment">#  验证码宽度</span></span><br><span class="line">    <span class="attr">height:</span> <span class="number">36</span></span><br><span class="line">    <span class="comment"># 内容长度</span></span><br><span class="line">    <span class="attr">length:</span> <span class="number">2</span></span><br><span class="line">    <span class="comment"># 字体名称，为空则使用默认字体</span></span><br><span class="line">    <span class="attr">font-name:</span></span><br><span class="line">    <span class="comment"># 字体大小</span></span><br><span class="line">    <span class="attr">font-size:</span> <span class="number">25</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#jwt</span></span><br><span class="line"><span class="attr">jwt:</span></span><br><span class="line">  <span class="attr">header:</span> <span class="string">Authorization</span></span><br><span class="line">  <span class="comment"># 令牌前缀</span></span><br><span class="line">  <span class="attr">token-start-with:</span> <span class="string">Bearer</span></span><br><span class="line">  <span class="comment"># 必须使用最少88位的Base64对该令牌进行编码</span></span><br><span class="line">  <span class="comment"># 令牌过期时间 此处单位/毫秒 ，默认4小时，可在此网站生成 https://www.convertworld.com/zh-hans/time/milliseconds.html</span></span><br><span class="line">  <span class="attr">token-validity-in-seconds:</span> <span class="number">14400000</span></span><br><span class="line">  <span class="comment"># 在线用户key</span></span><br><span class="line">  <span class="attr">online-key:</span> <span class="string">online-token-</span></span><br><span class="line">  <span class="comment"># 验证码</span></span><br><span class="line">  <span class="attr">code-key:</span> <span class="string">code-key-</span></span><br><span class="line">  <span class="comment"># token 续期检查时间范围（默认30分钟，单位毫秒），在token即将过期的一段时间内用户操作了，则给用户的token续期</span></span><br><span class="line">  <span class="attr">detect:</span> <span class="number">1800000</span></span><br><span class="line">  <span class="comment"># 续期时间范围，默认1小时，单位毫秒</span></span><br><span class="line">  <span class="attr">renew:</span> <span class="number">3600000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#是否允许生成代码，生产环境设置为false</span></span><br><span class="line"><span class="attr">generator:</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#是否开启 swagger-ui</span></span><br><span class="line"><span class="attr">swagger:</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># IP 本地解析</span></span><br><span class="line"><span class="attr">ip:</span></span><br><span class="line">  <span class="attr">local-parsing:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 文件存储路径</span></span><br><span class="line"><span class="attr">file:</span></span><br><span class="line">  <span class="attr">mac:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">~/file/</span></span><br><span class="line">    <span class="attr">avatar:</span> <span class="string">~/avatar/</span></span><br><span class="line">  <span class="attr">linux:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/home/eladmin/file/</span></span><br><span class="line">    <span class="attr">avatar:</span> <span class="string">/home/eladmin/avatar/</span></span><br><span class="line">  <span class="attr">windows:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">C:\eladmin\file\</span></span><br><span class="line">    <span class="attr">avatar:</span> <span class="string">C:\eladmin\avatar\</span></span><br><span class="line">  <span class="comment"># 文件大小 /M</span></span><br><span class="line">  <span class="attr">maxSize:</span> <span class="number">100</span></span><br><span class="line">  <span class="attr">avatarMaxSize:</span> <span class="number">5</span></span><br></pre></td></tr></table></figure></li>
<li><p>yml3-prod</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment">#配置数据源</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">devtools:</span></span><br><span class="line">    <span class="attr">restart:</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">additional-paths:</span> <span class="string">src/main/java</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">druid:</span></span><br><span class="line">      <span class="attr">db-type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line">      <span class="attr">driverClassName:</span> <span class="string">net.sf.log4jdbc.sql.jdbcapi.DriverSpy</span></span><br><span class="line">      <span class="attr">url:</span> <span class="string">jdbc:log4jdbc:mysql:serverTimezone=Asia/Shanghai&amp;characterEncoding=utf8&amp;useSSL=false</span></span><br><span class="line">      <span class="attr">username:</span> <span class="string">$&#123;D</span></span><br><span class="line">      <span class="comment"># 初始连接数</span></span><br><span class="line">      <span class="attr">initial-size:</span> <span class="number">5</span></span><br><span class="line">      <span class="comment"># 最小连接数</span></span><br><span class="line">      <span class="attr">min-idle:</span> <span class="number">15</span></span><br><span class="line">      <span class="comment"># 最大连接数</span></span><br><span class="line">      <span class="attr">max-active:</span> <span class="number">30</span></span><br><span class="line">      <span class="comment"># 获取连接超时时间</span></span><br><span class="line">      <span class="attr">max-wait:</span> <span class="number">5000</span></span><br><span class="line">      <span class="comment"># 连接有效性检测时间</span></span><br><span class="line">      <span class="attr">time-between-eviction-runs-millis:</span> <span class="number">60000</span></span><br><span class="line">      <span class="comment"># 连接在池中最小生存的时间</span></span><br><span class="line">      <span class="attr">min-evictable-idle-time-millis:</span> <span class="number">300000</span></span><br><span class="line">      <span class="comment"># 连接在池中最大生存的时间</span></span><br><span class="line">      <span class="attr">max-evictable-idle-time-millis:</span> <span class="number">900000</span></span><br><span class="line">      <span class="comment"># 指明连接是否被空闲连接回收器(如果有)进行检验.如果检测失败,则连接将被从池中去除</span></span><br><span class="line">      <span class="attr">test-while-idle:</span> <span class="literal">true</span></span><br><span class="line">      <span class="comment"># 指明是否在从池中取出连接前进行检验,如果检验失败, 则从池中去除连接并尝试取出另一个</span></span><br><span class="line">      <span class="attr">test-on-borrow:</span> <span class="literal">true</span></span><br><span class="line">      <span class="comment"># 是否在归还到池中前进行检验</span></span><br><span class="line">      <span class="attr">test-on-return:</span> <span class="literal">false</span></span><br><span class="line">      <span class="comment"># 检测连接是否有效</span></span><br><span class="line">      <span class="attr">validation-query:</span> <span class="string">select</span> <span class="number">1</span></span><br><span class="line">      <span class="comment"># 配置监控统计</span></span><br><span class="line">      <span class="attr">webStatFilter:</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">stat-view-servlet:</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">        <span class="comment"># 控制台管理用户名和密码</span></span><br><span class="line">        <span class="attr">url-pattern:</span> <span class="string">/druid/*</span></span><br><span class="line">        <span class="attr">reset-enable:</span> <span class="literal">false</span></span><br><span class="line">        <span class="attr">login-username:</span> <span class="string">admin</span></span><br><span class="line">        <span class="attr">login-password:</span> <span class="number">123456</span></span><br><span class="line">      <span class="attr">filter:</span></span><br><span class="line">        <span class="attr">stat:</span></span><br><span class="line">          <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">          <span class="comment"># 记录慢SQL</span></span><br><span class="line">          <span class="attr">log-slow-sql:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">slow-sql-millis:</span> <span class="number">1000</span></span><br><span class="line">          <span class="attr">merge-sql:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">wall:</span></span><br><span class="line">          <span class="attr">config:</span></span><br><span class="line">            <span class="attr">multi-statement-allow:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 登录相关配置</span></span><br><span class="line"><span class="attr">login:</span></span><br><span class="line">  <span class="comment"># 登录缓存</span></span><br><span class="line">  <span class="attr">cache-enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment">#  是否限制单用户登录</span></span><br><span class="line">  <span class="attr">single-login:</span> <span class="literal">false</span></span><br><span class="line">  <span class="comment">#  验证码</span></span><br><span class="line">  <span class="attr">login-code:</span></span><br><span class="line">    <span class="comment">#  验证码类型配置 查看 LoginProperties 类</span></span><br><span class="line">    <span class="attr">code-type:</span> <span class="string">arithmetic</span></span><br><span class="line">    <span class="comment">#  登录图形验证码有效时间/分钟</span></span><br><span class="line">    <span class="attr">expiration:</span> <span class="number">2</span></span><br><span class="line">    <span class="comment">#  验证码高度</span></span><br><span class="line">    <span class="attr">width:</span> <span class="number">111</span></span><br><span class="line">    <span class="comment">#  验证码宽度</span></span><br><span class="line">    <span class="attr">height:</span> <span class="number">36</span></span><br><span class="line">    <span class="comment"># 内容长度</span></span><br><span class="line">    <span class="attr">length:</span> <span class="number">2</span></span><br><span class="line">    <span class="comment"># 字体名称，为空则使用默认字体，如遇到线上乱码，设置其他字体即可</span></span><br><span class="line">    <span class="attr">font-name:</span></span><br><span class="line">    <span class="comment"># 字体大小</span></span><br><span class="line">    <span class="attr">font-size:</span> <span class="number">25</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#jwt</span></span><br><span class="line"><span class="attr">jwt:</span></span><br><span class="line">  <span class="attr">header:</span> <span class="string">Authorization</span></span><br><span class="line">  <span class="comment"># 令牌前缀</span></span><br><span class="line">  <span class="attr">token-start-with:</span> <span class="string">Bearer</span></span><br><span class="line">  <span class="comment"># 必须使用最少88位的Base64对该令牌进行编码</span></span><br><span class="line">  <span class="attr">base64-secret:</span> <span class="string">ZmQ0GI5</span></span><br><span class="line">  <span class="comment"># 令牌过期时间 此处单位/毫秒 ，默认2小时，可在此网站生成 https://www.convertworld.com/zh-hans/time/milliseconds.html</span></span><br><span class="line">  <span class="attr">token-validity-in-seconds:</span> <span class="number">7200000</span></span><br><span class="line">  <span class="comment"># 在线用户key</span></span><br><span class="line">  <span class="attr">online-key:</span> <span class="string">online-token-</span></span><br><span class="line">  <span class="comment"># 验证码</span></span><br><span class="line">  <span class="attr">code-key:</span> <span class="string">code-key-</span></span><br><span class="line">  <span class="comment"># token 续期检查时间范围（默认30分钟，单位默认毫秒），在token即将过期的一段时间内用户操作了，则给用户的token续期</span></span><br><span class="line">  <span class="attr">detect:</span> <span class="number">1800000</span></span><br><span class="line">  <span class="comment"># 续期时间范围，默认 1小时，这里单位毫秒</span></span><br><span class="line">  <span class="attr">renew:</span> <span class="number">3600000</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># IP 本地解析</span></span><br><span class="line"><span class="attr">ip:</span></span><br><span class="line">  <span class="attr">local-parsing:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#是否允许生成代码，生产环境设置为false</span></span><br><span class="line"><span class="attr">generator:</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#如果生产环境要开启swagger，需要配置请求地址</span></span><br><span class="line"><span class="comment">#springfox:</span></span><br><span class="line"><span class="comment">#  documentation:</span></span><br><span class="line"><span class="comment">#    swagger:</span></span><br><span class="line"><span class="comment">#      v2:</span></span><br><span class="line"><span class="comment">#        host: # 接口域名或外网ip</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#是否开启 swagger-ui</span></span><br><span class="line"><span class="attr">swagger:</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 文件存储路径</span></span><br><span class="line"><span class="attr">file:</span></span><br><span class="line">  <span class="attr">mac:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">~/file/</span></span><br><span class="line">    <span class="attr">avatar:</span> <span class="string">~/avatar/</span></span><br><span class="line">  <span class="attr">linux:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/home/eladmin/file/</span></span><br><span class="line">    <span class="attr">avatar:</span> <span class="string">/home/eladmin/avatar/</span></span><br><span class="line">  <span class="attr">windows:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">C:\eladmin\file\</span></span><br><span class="line">    <span class="attr">avatar:</span> <span class="string">C:\eladmin\avatar\</span></span><br><span class="line">  <span class="comment"># 文件大小 /M</span></span><br><span class="line">  <span class="attr">maxSize:</span> <span class="number">100</span></span><br><span class="line">  <span class="attr">avatarMaxSize:</span> <span class="number">5</span></span><br></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>spring</category>
      </categories>
  </entry>
  <entry>
    <title>WebMvcConfigurer</title>
    <url>/2022/02/25/spring/%E9%85%8D%E7%BD%AE/WebMvcConfigurer/</url>
    <content><![CDATA[<p>[toc]</p>
<p><a href="https://blog.csdn.net/zhangpower1993/article/details/89016503">参考</a></p>
<h2 id="一、概述"><a href="#一、概述" class="headerlink" title="一、概述"></a>一、概述</h2><h3 id="1-概念"><a href="#1-概念" class="headerlink" title="1. 概念"></a>1. 概念</h3><ol>
<li><p>WebMvcConfigurer和spring，springBoot的关系</p>
<p>WebMvcConfigurer和SpringBoot没啥关系，只不过原本在Spring中以xml配置文件中存在的相关配置，到SpringBoot中都会使用配置类的方式进行管理，即加了@Configuration注解的类。</p>
</li>
<li><p>WebMvcConfigurer配置类其实是<code>Spring</code>内部的一种配置方式，采用<code>JavaBean</code>的形式来代替传统的<code>xml</code>配置文件形式进行针对框架个性化定制，可以自定义一些Handler，Interceptor，ViewResolver，MessageConverter.</p>
</li>
<li><p>在Spring Boot 1.5版本都是靠重写<strong>WebMvcConfigurerAdapter</strong>的方法来添加自定义拦截器，消息转换器等</p>
</li>
</ol>
<h3 id="2-接口方法"><a href="#2-接口方法" class="headerlink" title="2. 接口方法"></a>2. 接口方法</h3><ol>
<li><p>所有方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">WebMvcConfigurer</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">configurePathMatch</span><span class="params">(PathMatchConfigurer var1)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">configureContentNegotiation</span><span class="params">(ContentNegotiationConfigurer var1)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">configureAsyncSupport</span><span class="params">(AsyncSupportConfigurer var1)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">configureDefaultServletHandling</span><span class="params">(DefaultServletHandlerConfigurer var1)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addFormatters</span><span class="params">(FormatterRegistry var1)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addInterceptors</span><span class="params">(InterceptorRegistry var1)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry var1)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addCorsMappings</span><span class="params">(CorsRegistry var1)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addViewControllers</span><span class="params">(ViewControllerRegistry var1)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">configureViewResolvers</span><span class="params">(ViewResolverRegistry var1)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addArgumentResolvers</span><span class="params">(List&lt;HandlerMethodArgumentResolver&gt; var1)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addReturnValueHandlers</span><span class="params">(List&lt;HandlerMethodReturnValueHandler&gt; var1)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">configureMessageConverters</span><span class="params">(List&lt;HttpMessageConverter&lt;?&gt;&gt; var1)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">extendMessageConverters</span><span class="params">(List&lt;HttpMessageConverter&lt;?&gt;&gt; var1)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">configureHandlerExceptionResolvers</span><span class="params">(List&lt;HandlerExceptionResolver&gt; var1)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">extendHandlerExceptionResolvers</span><span class="params">(List&lt;HandlerExceptionResolver&gt; var1)</span></span>;</span><br><span class="line">    <span class="function">Validator <span class="title">getValidator</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">MessageCodesResolver <span class="title">getMessageCodesResolver</span><span class="params">()</span></span>;&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>常用方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> <span class="comment">/* 拦截器配置 */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addInterceptors</span><span class="params">(InterceptorRegistry var1)</span></span>;</span><br><span class="line"><span class="comment">/* 视图跳转控制器 */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span></span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     *静态资源处理</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span></span>;</span><br><span class="line"><span class="comment">/* 默认静态资源处理器 */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">configureDefaultServletHandling</span><span class="params">(DefaultServletHandlerConfigurer configurer)</span></span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 这里配置视图解析器</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">configureViewResolvers</span><span class="params">(ViewResolverRegistry registry)</span></span>;</span><br><span class="line"><span class="comment">/* 配置内容裁决的一些选项*/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">configureContentNegotiation</span><span class="params">(ContentNegotiationConfigurer configurer)</span></span>;</span><br><span class="line"><span class="comment">/** 解决跨域问题 **/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addCorsMappings</span><span class="params">(CorsRegistry registry)</span> </span>;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="三、配件"><a href="#三、配件" class="headerlink" title="三、配件"></a>三、配件</h2><h3 id="1-addInterceptors：拦截器"><a href="#1-addInterceptors：拦截器" class="headerlink" title="1. addInterceptors：拦截器"></a>1. addInterceptors：拦截器</h3><ul>
<li>addInterceptor：需要一个实现HandlerInterceptor接口的拦截器实例</li>
<li>addPathPatterns：用于设置拦截器的过滤路径规则；<code>addPathPatterns(&quot;/**&quot;)</code>对所有请求都拦截</li>
<li>excludePathPatterns：用于设置不需要拦截的过滤规则</li>
<li>拦截器主要用途：进行用户登录状态的拦截，日志的拦截等。</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.addInterceptors(registry);</span><br><span class="line">    registry.addInterceptor(<span class="keyword">new</span> TestInterceptor()).addPathPatterns(<span class="string">&quot;/**&quot;</span>).excludePathPatterns(<span class="string">&quot;/emp/toLogin&quot;</span>,<span class="string">&quot;/emp/login&quot;</span>,<span class="string">&quot;/js/**&quot;</span>,<span class="string">&quot;/css/**&quot;</span>,<span class="string">&quot;/images/**&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-addViewControllers：页面跳转"><a href="#2-addViewControllers：页面跳转" class="headerlink" title="2. addViewControllers：页面跳转"></a>2. addViewControllers：页面跳转</h3><p>​    以前写SpringMVC的时候，如果需要访问一个页面，必须要写Controller类，然后再写一个方法跳转到页面，感觉好麻烦，下面这种方法可以省略一个Controller的requestMapping</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> </span>&#123;</span><br><span class="line">    registry.addViewController(<span class="string">&quot;/toLogin&quot;</span>).setViewName(<span class="string">&quot;login&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>​    在这里重写addViewControllers方法，并不会覆盖<strong>WebMvcAutoConfiguration</strong>（Springboot自动配置）中的addViewControllers（在此方法中，Spring Boot将“/”映射至index.html），这也就意味着自己的配置和Spring Boot的自动配置同时有效，这也是我们推荐添加自己的MVC配置的方式。</p>
</blockquote>
<h3 id="3-addResourceHandlers：静态资源"><a href="#3-addResourceHandlers：静态资源" class="headerlink" title="3. addResourceHandlers：静态资源"></a>3. addResourceHandlers：静态资源</h3><p>比如，我们想自定义静态资源映射目录的话，只需重写addResourceHandlers方法即可。</p>
<p>注：如果继承WebMvcConfigurationSupport类实现配置时必须要重写该方法，具体见其它文章</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyWebMvcConfigurerAdapter</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> </span>&#123;</span><br><span class="line">        registry.addResourceHandler(<span class="string">&quot;/my/**&quot;</span>).addResourceLocations(<span class="string">&quot;classpath:/my/&quot;</span>);</span><br><span class="line">        registry.addResourceHandler(<span class="string">&quot;/img/**&quot;</span>).addResourceLocations(<span class="string">&quot;classpath:/img/&quot;</span>);</span><br><span class="line">        registry.addResourceHandler(<span class="string">&quot;/img/**&quot;</span>).addResourceLocations(<span class="string">&quot;file:&quot;</span> + Constant.fileLoadPath + <span class="string">&quot;/&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>addResoureHandler：指的是对外暴露的访问路径</li>
<li>addResourceLocations：指的是内部文件放置的目录</li>
</ul>
<h3 id="2-4-configureDefaultServletHandling：默认静态资源处理器Servlet"><a href="#2-4-configureDefaultServletHandling：默认静态资源处理器Servlet" class="headerlink" title="2.4 configureDefaultServletHandling：默认静态资源处理器Servlet"></a>2.4 configureDefaultServletHandling：默认静态资源处理器Servlet</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configureDefaultServletHandling</span><span class="params">(DefaultServletHandlerConfigurer configurer)</span> </span>&#123;</span><br><span class="line">        configurer.enable();</span><br><span class="line">        configurer.enable(<span class="string">&quot;defaultServletName&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​    此时会注册一个默认的Handler：DefaultServletHttpRequestHandler，这个Handler也是用来处理静态文件的，它会尝试映射/。当DispatcherServelt映射/时（/ 和/ 是有区别的），并且没有找到合适的Handler来处理请求时，就会交给DefaultServletHttpRequestHandler 来处理。注意：这里的静态资源是放置在web根目录下，而非WEB-INF 下。<br>　可能这里的描述有点不好懂（我自己也这么觉得），所以简单举个例子，例如：在webroot目录下有一个图片：1.png 我们知道Servelt规范中web根目录（webroot）下的文件可以直接访问的，但是由于DispatcherServlet配置了映射路径是：/ ，它几乎把所有的请求都拦截了，从而导致1.png 访问不到，这时注册一个DefaultServletHttpRequestHandler 就可以解决这个问题。其实可以理解为DispatcherServlet破坏了Servlet的一个特性（根目录下的文件可以直接访问），DefaultServletHttpRequestHandler是帮助回归这个特性的。</p>
<h3 id="2-5-configureViewResolvers：视图解析器"><a href="#2-5-configureViewResolvers：视图解析器" class="headerlink" title="2.5 configureViewResolvers：视图解析器"></a>2.5 configureViewResolvers：视图解析器</h3><p>这个方法是用来配置视图解析器的，该方法的参数ViewResolverRegistry 是一个注册器，用来注册你想自定义的视图解析器等。ViewResolverRegistry 常用的几个方法：<a href="https://blog.csdn.net/fmwind/article/details/81235401">https://blog.csdn.net/fmwind/article/details/81235401</a></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> InternalResourceViewResolver <span class="title">resourceViewResolver</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	InternalResourceViewResolver internalResourceViewResolver = <span class="keyword">new</span> InternalResourceViewResolver();</span><br><span class="line">	<span class="comment">//请求视图文件的前缀地址</span></span><br><span class="line">	internalResourceViewResolver.setPrefix(<span class="string">&quot;/WEB-INF/jsp/&quot;</span>);</span><br><span class="line">	<span class="comment">//请求视图文件的后缀</span></span><br><span class="line">	internalResourceViewResolver.setSuffix(<span class="string">&quot;.jsp&quot;</span>);</span><br><span class="line">	<span class="keyword">return</span> internalResourceViewResolver;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configureViewResolvers</span><span class="params">(ViewResolverRegistry registry)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">super</span>.configureViewResolvers(registry);</span><br><span class="line">	registry.viewResolver(resourceViewResolver());</span><br><span class="line">	<span class="comment">/*registry.jsp(&quot;/WEB-INF/jsp/&quot;,&quot;.jsp&quot;);*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-6-configureContentNegotiation：配置内容裁决的一些参数"><a href="#2-6-configureContentNegotiation：配置内容裁决的一些参数" class="headerlink" title="2.6 configureContentNegotiation：配置内容裁决的一些参数"></a>2.6 configureContentNegotiation：配置内容裁决的一些参数</h3><h3 id="2-7-addCorsMappings：跨域"><a href="#2-7-addCorsMappings：跨域" class="headerlink" title="2.7 addCorsMappings：跨域"></a>2.7 addCorsMappings：跨域</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addCorsMappings</span><span class="params">(CorsRegistry registry)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.addCorsMappings(registry);</span><br><span class="line">    registry.addMapping(<span class="string">&quot;/cors/**&quot;</span>)</span><br><span class="line">        </span><br><span class="line">            .allowedHeaders(<span class="string">&quot;*&quot;</span>)</span><br><span class="line">            .allowedMethods(<span class="string">&quot;POST&quot;</span>,<span class="string">&quot;GET&quot;</span>)</span><br><span class="line">            .allowedOrigins(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-8-configureMessageConverters：信息转换器"><a href="#2-8-configureMessageConverters：信息转换器" class="headerlink" title="2.8 configureMessageConverters：信息转换器"></a>2.8 configureMessageConverters：信息转换器</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//配置fastJson返回json转换</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configureMessageConverters</span><span class="params">(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters)</span> </span></span><br><span class="line"><span class="function">    <span class="keyword">super</span>.<span class="title">configureMessageConverters</span><span class="params">(converters)</span></span>;</span><br><span class="line">    <span class="comment">//创建fastJson消息转换器</span></span><br><span class="line">    FastJsonHttpMessageConverter fastConverter = <span class="keyword">new</span> FastJsonHttpMessageConverter();</span><br><span class="line">    <span class="comment">//创建配置类</span></span><br><span class="line">    FastJsonConfig fastJsonConfig = <span class="keyword">new</span> FastJsonConfig();</span><br><span class="line">    <span class="comment">//修改配置返回内容的过滤</span></span><br><span class="line">    fastJsonConfig.setSerializerFeatures(</span><br><span class="line">            SerializerFeature.DisableCircularReferenceDetect,</span><br><span class="line">            SerializerFeature.WriteMapNullValue,</span><br><span class="line">            SerializerFeature.WriteNullStringAsEmpty</span><br><span class="line">    );</span><br><span class="line">    fastConverter.setFastJsonConfig(fastJsonConfig);</span><br><span class="line">    <span class="comment">//将fastjson添加到视图消息转换器列表内</span></span><br><span class="line">    converters.add(fastConverter);</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>spring</category>
      </categories>
  </entry>
  <entry>
    <title>matplotlib基本用法</title>
    <url>/2021/12/30/utils/python/matplotlib/</url>
    <content><![CDATA[<h2 id="一、介绍"><a href="#一、介绍" class="headerlink" title="一、介绍"></a>一、介绍</h2><h3 id="1-1-简单使用"><a href="#1-1-简单使用" class="headerlink" title="1.1 简单使用"></a>1.1 简单使用</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line">x=[<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line">y=[<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">3</span>]</span><br><span class="line">plt.plot(x,y)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>



<h2 id="二、API"><a href="#二、API" class="headerlink" title="二、API"></a>二、API</h2><h3 id="2-1-常见API"><a href="#2-1-常见API" class="headerlink" title="2.1 常见API"></a>2.1 常见API</h3><ol>
<li><p>plt.plot 画图</p>
</li>
<li><p>plt.axis 修改坐标</p>
</li>
<li><p>plt.show 显示</p>
</li>
<li><p>plt.grid(True) 设置网格</p>
</li>
<li><p>添加说明：explain</p>
<ol>
<li><p>xy轴标注：plt.xlabel(“Money Earned”)  plt.ylabel(“Consume Level”)</p>
</li>
<li><p>标题：plt.title(“Figure.1”)</p>
</li>
<li><p>添加图内文字：plt.text(2,3,”text”)  ：在坐标(2,3)处显示”text”</p>
</li>
<li><p>添加箭头</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">plt.annotate(<span class="string">&#x27;箭头说明文字&#x27;</span>, xy=(<span class="number">20</span>, <span class="number">400</span>), xytext=(<span class="number">12.5</span>, <span class="number">400</span>),</span><br><span class="line">             arrowprops=<span class="built_in">dict</span>(facecolor=<span class="string">&#x27;black&#x27;</span>, shrink=<span class="number">0.05</span>),)</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ol>
<h3 id="2-2-plt-plot"><a href="#2-2-plt-plot" class="headerlink" title="2.2 plt.plot()"></a>2.2 plt.plot()</h3><blockquote>
<p>plt.plot(x, y, format_string, **kwargs) ,返回Line2D 对象</p>
</blockquote>
<h4 id="2-2-1-format-string"><a href="#2-2-1-format-string" class="headerlink" title="2.2.1 format_string"></a>2.2.1 format_string</h4><blockquote>
<p>控制颜色字符、风格字符、标记字</p>
</blockquote>
<ul>
<li>颜色：’b’ 蓝色</li>
<li>字符风格：默认’-‘折线段</li>
<li>节点标记：默认没有 可选.^</li>
</ul>
<h4 id="2-2-2-kwargs"><a href="#2-2-2-kwargs" class="headerlink" title="2.2.2 kwargs:"></a>2.2.2 kwargs:</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">color : 控制颜色, color=<span class="string">&#x27;green&#x27;</span></span><br><span class="line">linestyle : 线条风格, linestyle=<span class="string">&#x27;dashed&#x27;</span></span><br><span class="line">marker : 标记风格, marker=<span class="string">&#x27;o&#x27;</span></span><br><span class="line">markerfacecolor: 标记颜色, markerfacecolor=<span class="string">&#x27;blue&#x27;</span></span><br><span class="line">markersize: 标记尺寸, markersize=<span class="number">20</span></span><br></pre></td></tr></table></figure>

<h4 id="2-2-3-plt-多线"><a href="#2-2-3-plt-多线" class="headerlink" title="2.2.3 plt.多线"></a>2.2.3 plt.多线</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">plt.plot(t1,<span class="string">&#x27;b--&#x27;</span>,t2,<span class="string">&#x27;r--&#x27;</span>)</span><br><span class="line"><span class="comment">#或</span></span><br><span class="line">x1=[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>],y1=[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]</span><br><span class="line">x2=[<span class="number">2</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">8</span>],y2=[<span class="number">4</span>,<span class="number">8</span>,<span class="number">12</span>,<span class="number">16</span>]</span><br><span class="line">plt.plot(x1,y1,<span class="string">&#x27;r-&#x27;</span>,x2,y2,<span class="string">&#x27;g--&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="2-2-4-函数表示y"><a href="#2-2-4-函数表示y" class="headerlink" title="2.2.4 函数表示y"></a>2.2.4 函数表示y</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">x = np.arange(<span class="number">0</span>, <span class="number">20</span>, <span class="number">0.01</span>)</span><br><span class="line">plt.plot(x, np.sin(x), <span class="string">&#x27;r-&#x27;</span>, x, np.cos(x), <span class="string">&#x27;b--&#x27;</span>)</span><br></pre></td></tr></table></figure>



<h3 id="2-3-plt-axis"><a href="#2-3-plt-axis" class="headerlink" title="2.3 plt.axis"></a>2.3 plt.axis</h3><ol>
<li><p>plt.axis([1, 2, 3, 4])</p>
<p>设置x范围 1-2 y范围3-4</p>
</li>
<li><p>plt.axis(<code>option</code>=‘equal’) </p>
<ol>
<li>equal：x-y坐标等长</li>
<li>off： 关闭</li>
<li>auto：自动</li>
<li>square：正方形</li>
</ol>
</li>
</ol>
<h3 id="2-4-plt-explain-说明文字参数"><a href="#2-4-plt-explain-说明文字参数" class="headerlink" title="2.4 plt.explain 说明文字参数"></a>2.4 plt.explain 说明文字参数</h3><ol>
<li>color : 颜色</li>
<li>size：大小</li>
<li><a href="https://blog.csdn.net/xHibiki/article/details/84866887">其他</a>：字体系列，对其方式，行距，粗细，样式，字体名</li>
</ol>
<h3 id="2-5-plt-subplots-子图"><a href="#2-5-plt-subplots-子图" class="headerlink" title="2.5 plt.subplots 子图"></a>2.5 plt.subplots 子图</h3><blockquote>
<p>返回一个包含figure和axes对象的元组</p>
<p>figure: 拿到整张图</p>
<p>ax： np.array[axe 对象]</p>
</blockquote>
<h4 id="subplots-和subplot-区别"><a href="#subplots-和subplot-区别" class="headerlink" title="subplots 和subplot 区别"></a>subplots 和subplot 区别</h4><ul>
<li><p>subplots 一次性创建并返回所有的子图和其 axe 对象</p>
</li>
<li><p>subplot分开子图并拿到指定位置的子图plt.subplot(2, 1, 2) 分成2行1类并拿到第二个ax对象</p>
</li>
</ul>
<h2 id="三、对象"><a href="#三、对象" class="headerlink" title="三、对象"></a>三、对象</h2><h3 id="3-2-AxesSubplot-子图对象"><a href="#3-2-AxesSubplot-子图对象" class="headerlink" title="3.2 AxesSubplot 子图对象"></a>3.2 AxesSubplot 子图对象</h3><h4 id="1-ax-plot"><a href="#1-ax-plot" class="headerlink" title="1 ax.plot()"></a>1 ax.plot()</h4><h4 id="2-ax-axis"><a href="#2-ax-axis" class="headerlink" title="2 ax.axis"></a>2 ax.axis</h4><h4 id="3-set-title"><a href="#3-set-title" class="headerlink" title="3 set_title"></a>3 set_title</h4><p>​    </p>
]]></content>
      <categories>
        <category>python</category>
      </categories>
  </entry>
  <entry>
    <title>python爬虫</title>
    <url>/2021/11/21/utils/python/python%E7%88%AC%E8%99%AB/</url>
    <content><![CDATA[<p>[toc]</p>
<h2 id="BS4-以下内容参考自官方文档"><a href="#BS4-以下内容参考自官方文档" class="headerlink" title="BS4-以下内容参考自官方文档"></a><a href="https://beautifulsoup.readthedocs.io/zh_CN/v4.4.0/">BS4-以下内容参考自官方文档</a></h2><h3 id="2-1-语法"><a href="#2-1-语法" class="headerlink" title="2.1 语法"></a>2.1 语法</h3><ol>
<li><p>基本</p>
<ul>
<li>找到第一个: find</li>
<li>找到所有的: find_all</li>
</ul>
</li>
<li><p>属性</p>
<ul>
<li>name  就是&lt;&gt;中间的  比如&lt;a&gt; 就是a</li>
</ul>
</li>
<li><p>获取链接</p>
<ol>
<li><p>从文档中找到所有<a>标签的链接:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> link <span class="keyword">in</span> soup.find_all(<span class="string">&#x27;a&#x27;</span>):</span><br><span class="line">    <span class="built_in">print</span>(link.get(<span class="string">&#x27;href&#x27;</span>))</span><br></pre></td></tr></table></figure></li>
<li><p>所有内容  print(soup.get_text())</p>
</li>
</ol>
</li>
</ol>
<h3 id="2-2-遍历文档树"><a href="#2-2-遍历文档树" class="headerlink" title="2.2 遍历文档树"></a>2.2 遍历文档树</h3><h4 id="2-2-1-通过名字"><a href="#2-2-1-通过名字" class="headerlink" title="2.2.1 通过名字"></a>2.2.1 通过名字</h4><p>​    tag[‘class’] –&gt; # u’boldest’</p>
<p>​    tag.a  -&gt;# &lt;a class=”sister” href=”<a href="http://example.com/elsie&quot;">http://example.com/elsie&quot;</a> id=”link1”&gt;Elsie</a></p>
<blockquote>
<p>这种方法只能获得第一个,若要多个 用get_all</p>
</blockquote>
<h4 id="2-2-2-contents-descendants"><a href="#2-2-2-contents-descendants" class="headerlink" title="2.2.2 contents descendants"></a>2.2.2 contents descendants</h4><p>tag的contents属性可以将tag的子节点以列表的方式输出</p>
<p>descendants包括子孙节点</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">head_tag = soup.head</span><br><span class="line">head_tag</span><br><span class="line"><span class="comment"># &lt;head&gt;&lt;title&gt;The Dormouse&#x27;s story&lt;/title&gt;&lt;/head&gt;</span></span><br><span class="line">head_tag.contents</span><br><span class="line">[&lt;title&gt;The Dormouse<span class="string">&#x27;s story&lt;/title&gt;]</span></span><br><span class="line"><span class="string">title_tag = head_tag.contents[0]</span></span><br><span class="line"><span class="string">title_tag</span></span><br><span class="line"><span class="string"># &lt;title&gt;The Dormouse&#x27;</span>s story&lt;/title&gt;</span><br><span class="line">title_tag.contents</span><br><span class="line"><span class="comment"># [u&#x27;The Dormouse&#x27;s story&#x27;]</span></span><br></pre></td></tr></table></figure>



<h4 id="2-2-3-children-parent"><a href="#2-2-3-children-parent" class="headerlink" title="2.2.3 children parent"></a>2.2.3 children parent</h4><h4 id="2-2-4-next-sibling-previous-sibling-兄弟节点"><a href="#2-2-4-next-sibling-previous-sibling-兄弟节点" class="headerlink" title="2.2.4 next_sibling previous_sibling  兄弟节点"></a>2.2.4 next_sibling previous_sibling  兄弟节点</h4><p>​    .next_siblings 和 .previous_siblings 兄弟节点们</p>
<h4 id="2-2-1"><a href="#2-2-1" class="headerlink" title="2.2.1"></a>2.2.1</h4><h3 id="2-3-搜索文档树"><a href="#2-3-搜索文档树" class="headerlink" title="2.3 搜索文档树"></a>2.3 搜索文档树</h3><blockquote>
<p>​    记住: <code>find_all()</code> 和 <code>find()</code> 只搜索当前节点的所有子节点,孙子节点等. <code>find_parents()</code> 和 <code>find_parent()</code> 用来搜索当前节点的父辈节点,搜索方法与普通tag的搜索方法相同,搜索文档搜索文档包含的内容. 我们从一个文档中的一个叶子节点开始:</p>
</blockquote>
<h4 id="2-3-1-find"><a href="#2-3-1-find" class="headerlink" title="2.3.1 find"></a>2.3.1 find</h4><h4 id="2-3-2-find-all"><a href="#2-3-2-find-all" class="headerlink" title="2.3.2 find_all()"></a>2.3.2 find_all()</h4><blockquote>
<p>find_all( <a href="https://beautifulsoup.readthedocs.io/zh_CN/v4.4.0/#id35">name</a> , <a href="https://beautifulsoup.readthedocs.io/zh_CN/v4.4.0/#css">attrs</a> , <a href="https://beautifulsoup.readthedocs.io/zh_CN/v4.4.0/#recursive">recursive</a> , <a href="https://beautifulsoup.readthedocs.io/zh_CN/v4.4.0/#id36">string</a> , <a href="https://beautifulsoup.readthedocs.io/zh_CN/v4.4.0/#keyword">**kwargs</a> )</p>
</blockquote>
<ol>
<li><p>name=[String]</p>
</li>
<li><p>string</p>
<blockquote>
<p>stirng=re,String,lambda-bool</p>
<p>搜索text用到,常与正则和lambda使用</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">soup.find_all(string=re.<span class="built_in">compile</span>(<span class="string">&quot;Dormouse&quot;</span>)) <span class="comment">#包含Dormouse的text</span></span><br><span class="line">[<span class="string">u&quot;The Dormouse&#x27;s story&quot;</span>, <span class="string">u&quot;The Dormouse&#x27;s story&quot;</span>]</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_the_only_string_within_a_tag</span>(<span class="params">s</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;</span>Return <span class="literal">True</span> <span class="keyword">if</span> this string <span class="keyword">is</span> the only child of its parent tag.<span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> (s == s.parent.string)</span><br><span class="line">soup.find_all(string=is_the_only_string_within_a_tag)</span><br><span class="line"><span class="comment"># [u&quot;The Dormouse&#x27;s story&quot;, u&quot;The Dormouse&#x27;s story&quot;, u&#x27;Elsie&#x27;, u&#x27;Lacie&#x27;, u&#x27;Tillie&#x27;, u&#x27;...&#x27;]</span></span><br></pre></td></tr></table></figure></li>
<li><p>kewords</p>
<blockquote>
<p>kewords:   1. href id link 等tag.name   2. limit=2取两条 3. recursive=False 只搜子节点</p>
<p>=String、正则、列表、boolean</p>
</blockquote>
<ol>
<li><p>String–正则</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">soup.find_all(href=re.<span class="built_in">compile</span>(<span class="string">&quot;elsie&quot;</span>), <span class="built_in">id</span>=<span class="string">&#x27;link1&#x27;</span>)<span class="comment"># 找到 包含elsie且id为link1的href</span></span><br></pre></td></tr></table></figure></li>
<li><p>boolean</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">soup.find_all(<span class="built_in">id</span>=<span class="literal">True</span>)<span class="comment">#找到包含id的tags</span></span><br></pre></td></tr></table></figure></li>
</ol>
</li>
<li></li>
</ol>
<h4 id="2-3-3-正则表达式"><a href="#2-3-3-正则表达式" class="headerlink" title="2.3.3 正则表达式"></a>2.3.3 正则表达式</h4><blockquote>
<p>如果传入正则表达式作为参数,Beautiful Soup会通过正则表达式的 <code>match()</code> 来匹配内容.</p>
</blockquote>
<p>找出所有以b开头的标签,这表示<body>和<b>标签都应该被找到:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">for</span> tag <span class="keyword">in</span> soup.find_all(re.<span class="built_in">compile</span>(<span class="string">&quot;^b&quot;</span>)):</span><br><span class="line">    <span class="built_in">print</span>(tag.name)       <span class="comment"># body  # b</span></span><br></pre></td></tr></table></figure>

<p>找出所有名字中包含”t”的标签:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> tag <span class="keyword">in</span> soup.find_all(re.<span class="built_in">compile</span>(<span class="string">&quot;t&quot;</span>)):</span><br><span class="line">    <span class="built_in">print</span>(tag.name)  <span class="comment"># html  # title</span></span><br></pre></td></tr></table></figure>

<h4 id="2-3-4-基础参数-：String、正则、列表、boolean"><a href="#2-3-4-基础参数-：String、正则、列表、boolean" class="headerlink" title="2.3.4 基础参数 ：String、正则、列表、boolean"></a>2.3.4 基础参数 ：String、正则、列表、boolean</h4><ol>
<li><p>boolean–lambda</p>
<p>下面方法校验了当前元素,如果包含 <code>class</code> 属性却不包含 <code>id</code> 属性,那么将返回 <code>True</code>:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">has_class_but_no_id</span>(<span class="params">tag</span>):</span></span><br><span class="line">    <span class="keyword">return</span> tag.has_attr(<span class="string">&#x27;class&#x27;</span>) <span class="keyword">and</span> <span class="keyword">not</span> tag.has_attr(<span class="string">&#x27;id&#x27;</span>)</span><br><span class="line">soup.find_all(has_class_but_no_id)</span><br><span class="line"><span class="comment"># [&lt;p class=&quot;title&quot;&gt;&lt;b&gt;The Dormouse&#x27;s story&lt;/b&gt;&lt;/p&gt;,</span></span><br><span class="line"><span class="comment">#  &lt;p class=&quot;story&quot;&gt;Once upon a time there were...&lt;/p&gt;,</span></span><br><span class="line"><span class="comment">#  &lt;p class=&quot;story&quot;&gt;...&lt;/p&gt;]</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="2-3-5-keyword"><a href="#2-3-5-keyword" class="headerlink" title="2.3.5 keyword"></a>2.3.5 keyword</h4><ol>
<li>id</li>
<li>href</li>
</ol>
<h4 id="2-3-6-keyword-值"><a href="#2-3-6-keyword-值" class="headerlink" title="2.3.6 keyword 值"></a>2.3.6 keyword 值</h4><ol>
<li><p>正则      href=re.compile(“elsie”)</p>
</li>
<li><p>string   id=”testEle”</p>
</li>
<li><p>bool</p>
</li>
<li><p>列表</p>
<p>如果传入列表参数,Beautiful Soup会将与列表中任一元素匹配的内容返回.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">soup.find_all([<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>])</span><br><span class="line"><span class="comment"># [&lt;b&gt;The Dormouse&#x27;s story&lt;/b&gt;,</span></span><br><span class="line"><span class="comment">#  &lt;a class=&quot;sister&quot; href=&quot;http://example.com/elsie&quot; id=&quot;link1&quot;&gt;Elsie&lt;/a&gt;,</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="2-3-7-attrs"><a href="#2-3-7-attrs" class="headerlink" title="2.3.7 attrs"></a>2.3.7 attrs</h4><blockquote>
<p>对于keyword没有的key，那么用attr字典</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">data_soup.find_all(attrs=&#123;<span class="string">&quot;data-foo&quot;</span>: <span class="string">&quot;value&quot;</span>&#125;)</span><br><span class="line"><span class="comment"># [&lt;div data-foo=&quot;value&quot;&gt;foo!&lt;/div&gt;]</span></span><br></pre></td></tr></table></figure>

<h3 id="2-5-四种对象"><a href="#2-5-四种对象" class="headerlink" title="2.5 四种对象"></a>2.5 四种对象</h3><blockquote>
<p>Beautiful Soup将复杂HTML文档转换成一个复杂的树形结构,每个节点都是Python对象,所有对象可以归纳为4种: <code>Tag</code> , <code>NavigableString</code> , <code>BeautifulSoup</code> , <code>Comment</code> .</p>
</blockquote>
<h4 id="2-5-1-Tag-tag-soup-b"><a href="#2-5-1-Tag-tag-soup-b" class="headerlink" title="2.5.1 Tag  tag = soup.b"></a>2.5.1 Tag  tag = soup.b</h4><p>​    BeautifulSoup中的所有标签都是Tag类型,并且BeautifulSoup的对象Beautiful的对象其实本质上也是一个Tag类型,tag的属性可以被添加,删除或修改. 再说一次, tag的属性操作方法与字典一样。</p>
<h4 id="2-5-2-NavigableString"><a href="#2-5-2-NavigableString" class="headerlink" title="2.5.2 NavigableString"></a>2.5.2 NavigableString</h4><p>​    继承自python中的str,用起来就跟使用python的str是一样的。</p>
<h4 id="2-5-2-BeautifulSoup"><a href="#2-5-2-BeautifulSoup" class="headerlink" title="2.5.2 BeautifulSoup"></a>2.5.2 BeautifulSoup</h4><p>​    继承自Tag,用来生成BeautifulSoup树的。对于一些查找方法,比如find,select这些,其实还是Tag的</p>
<h4 id="2-5-2-Comment"><a href="#2-5-2-Comment" class="headerlink" title="2.5.2 Comment"></a>2.5.2 Comment</h4><p>​    继承NavigableString</p>
<h3 id="2-6-对象方法"><a href="#2-6-对象方法" class="headerlink" title="2.6 对象方法"></a>2.6 对象方法</h3><h4 id="2-6-1-tag"><a href="#2-6-1-tag" class="headerlink" title="2.6.1 tag"></a>2.6.1 tag</h4><ol>
<li>通过tag的名字获取属性 tag.title     <title>The Dormouse’s story</title> </li>
<li>tag.title.name   title   </li>
<li>获取有效字符串 tag.title.string    The Dormouse’s story</li>
<li>替换有效字符串 tag.string.replace_with(“No longer bold”)</li>
<li>tag.title.parent.name   head</li>
<li>获取所有属性tag.attrs   –&gt; # {u’class’:  u’boldest’}</li>
<li>获取特定属性 tag[‘class’] –&gt; # u’boldest’</li>
</ol>
<h3 id="2-7-其他"><a href="#2-7-其他" class="headerlink" title="2.7 其他"></a>2.7 其他</h3><h4 id="2-7-1-解析器"><a href="#2-7-1-解析器" class="headerlink" title="2.7.1 解析器"></a>2.7.1 解析器</h4><table>
<thead>
<tr>
<th>解析器</th>
<th>使用方法</th>
<th>优势</th>
<th>劣势</th>
</tr>
</thead>
<tbody><tr>
<td>Python标准库</td>
<td>BeautifulSoup(markup, “html.parser”)</td>
<td>Python的内置标准库执行速度适中文档容错能力强</td>
<td>Python 2.7.3 or 3.2.2)前 的版本中文档容错能力差</td>
</tr>
<tr>
<td>lxml HTML 解析器</td>
<td>BeautifulSoup(markup, “lxml”)</td>
<td>速度快文档容错能力强</td>
<td>需要安装C语言库</td>
</tr>
<tr>
<td>lxml XML 解析器</td>
<td><code>BeautifulSoup(markup, [&quot;lxml-xml&quot;])``BeautifulSoup(markup, &quot;xml&quot;)</code></td>
<td>速度快唯一支持XML的解析器</td>
<td>需要安装C语言库</td>
</tr>
<tr>
<td>html5lib</td>
<td><code>BeautifulSoup(markup, &quot;html5lib&quot;)</code></td>
<td>最好的容错性以浏览器的方式解析文档生成HTML5格式的文档</td>
<td>速度慢不依赖外部扩展</td>
</tr>
</tbody></table>
<h4 id="2-7-2-等价代码"><a href="#2-7-2-等价代码" class="headerlink" title="2.7.2 等价代码"></a>2.7.2 等价代码</h4><ol>
<li><p> soup.find_all(“a”) = soup(“a”)</p>
</li>
<li><p>soup.title.find_all(string=True) = soup.title(string=True)</p>
</li>
<li><p>soup.find_all(‘title’, limit=1) = soup.find(‘title’)</p>
</li>
<li><p>soup.head.title = soup.find(“head”).find(“title”) # <title>The Dormouse’s story</title></p>
</li>
</ol>
<h3 id="2-8-神技"><a href="#2-8-神技" class="headerlink" title="2.8 神技"></a>2.8 神技</h3><blockquote>
<p>tag的三大基本类型  attr,string,child</p>
</blockquote>
<h4 id="2-8-1-find-all"><a href="#2-8-1-find-all" class="headerlink" title="2.8.1 find_all"></a>2.8.1 find_all</h4><h4 id="2-8-1-自定义过滤"><a href="#2-8-1-自定义过滤" class="headerlink" title="2.8.1 自定义过滤"></a>2.8.1 自定义过滤</h4><ol>
<li><p>基于attr</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">atags=[tag <span class="keyword">for</span> tag <span class="keyword">in</span> tags <span class="keyword">if</span> tag.has_attr(<span class="string">&#x27;name&#x27;</span>) <span class="keyword">and</span> tag.attrs[<span class="string">&#x27;name&#x27;</span>]==<span class="string">&#x27;周六&#x27;</span>]</span><br></pre></td></tr></table></figure></li>
<li><p>基于string</p>
</li>
<li></li>
</ol>
<h4 id="2-8-3-tag获取attr-用"><a href="#2-8-3-tag获取attr-用" class="headerlink" title="2.8.3 tag获取attr  用[]"></a>2.8.3 tag获取attr  用[]</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">tag[<span class="string">&#x27;id&#x27;</span>]</span><br><span class="line"><span class="comment"># &#x27;id1&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="2-8-4-tag获取child用’-‘-children用"><a href="#2-8-4-tag获取child用’-‘-children用" class="headerlink" title="2.8.4 tag获取child用’ . ‘  children用()"></a>2.8.4 tag获取child用’ . ‘  children用()</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">tag.div</span><br><span class="line"><span class="comment"># &lt;div&gt;aaaa&lt;/div&gt;</span></span><br><span class="line">tag(<span class="string">&#x27;div&#x27;</span>)</span><br><span class="line"><span class="comment"># [&lt;div class=&quot;top_adimg&quot; id=&quot;dv_top_adimg&quot; style=&quot;margin: 0 auto; clear: both;width: 1000px;&quot;&gt;&lt;a href=&quot;http://www.310win.com/Recommend/RecommendIndex.aspx?t=1&amp;amp;bt=1&quot; target=&quot;_blank&quot;&gt;&lt;img height=&quot;40&quot; src=&quot;/Files/ff/fc_637196007271076151.jpg&quot; width=&quot;1000&quot;/&gt;&lt;/a&gt;&lt;/div&gt;]</span></span><br></pre></td></tr></table></figure>







]]></content>
      <categories>
        <category>utils</category>
      </categories>
  </entry>
  <entry>
    <title>elasticSearch语法</title>
    <url>/2022/03/13/%E6%95%B0%E6%8D%AE%E5%BA%93/nosql/elasticsearch%E8%AF%AD%E6%B3%95/</url>
    <content><![CDATA[<h2 id="Rest-Api"><a href="#Rest-Api" class="headerlink" title="Rest Api"></a>Rest Api</h2><p>122133</p>
<h2 id="一、Rest-Api"><a href="#一、Rest-Api" class="headerlink" title="一、Rest Api"></a>一、Rest Api</h2><h3 id="1-1-索引的增删改查"><a href="#1-1-索引的增删改查" class="headerlink" title="1.1 索引的增删改查"></a>1.1 索引的增删改查</h3><h4 id="创建索引"><a href="#创建索引" class="headerlink" title="创建索引"></a>创建索引</h4><figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">put</span> /shopping</span><br></pre></td></tr></table></figure>

<h4 id="删除索引"><a href="#删除索引" class="headerlink" title="删除索引"></a>删除索引</h4><figure class="highlight actionscript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">delete</span> /shopping</span><br></pre></td></tr></table></figure>

<h4 id="获得所有的索引信息"><a href="#获得所有的索引信息" class="headerlink" title="获得所有的索引信息"></a>获得所有的索引信息</h4><figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/_cat/i</span>ndices?v</span><br></pre></td></tr></table></figure>

<h3 id="1-2-文档的增删改查"><a href="#1-2-文档的增删改查" class="headerlink" title="1.2 文档的增删改查"></a>1.2 文档的增删改查</h3><h4 id="创建文档"><a href="#创建文档" class="headerlink" title="创建文档"></a>创建文档</h4><figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">post <span class="regexp">/index1/</span>_doc/ +json</span><br><span class="line">post <span class="regexp">/index1/</span>_doc/id +json</span><br></pre></td></tr></table></figure>

<h4 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h4><figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="keyword">delete</span>     /index1</span><br><span class="line"><span class="keyword">delete</span>     <span class="regexp">/index1/</span>_doc/id</span><br></pre></td></tr></table></figure>

<h4 id="更改"><a href="#更改" class="headerlink" title="更改"></a>更改</h4><figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">全量更新 put  <span class="regexp">/index1/</span>_doc/id +json</span><br><span class="line">局部更新 post <span class="regexp">/index1/</span>_update/id +json</span><br></pre></td></tr></table></figure>

<h4 id="根据id查询文档"><a href="#根据id查询文档" class="headerlink" title="根据id查询文档"></a>根据id查询文档</h4><figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/index1/</span>_doc/<span class="number">1001</span></span><br></pre></td></tr></table></figure>

<h4 id="获得引的所有文档"><a href="#获得引的所有文档" class="headerlink" title="获得引的所有文档"></a>获得引的所有文档</h4><figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/index1/</span>_search</span><br></pre></td></tr></table></figure>

<h4 id="批量"><a href="#批量" class="headerlink" title="批量"></a>批量</h4><pre><code>1. 插入
1. 删除
</code></pre>
<h2 id="二、查询"><a href="#二、查询" class="headerlink" title="二、查询"></a>二、查询</h2><h3 id="2-0-两种"><a href="#2-0-两种" class="headerlink" title="2.0 两种"></a>2.0 两种</h3><h4 id="2-0-1-get-url"><a href="#2-0-1-get-url" class="headerlink" title="2.0.1 get+url"></a>2.0.1 get+url</h4><figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">ip:port<span class="regexp">/shopping/</span>_search?q=name:<span class="string">&quot;wyg&quot;</span></span><br></pre></td></tr></table></figure>

<h4 id="2-0-2-get-json"><a href="#2-0-2-get-json" class="headerlink" title="2.0.2  get+json"></a>2.0.2  get+json</h4><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;<span class="comment">//条件查询</span></span><br><span class="line">    </span><br><span class="line">	<span class="attr">&quot;query&quot;</span>:&#123;</span><br><span class="line">		<span class="attr">&quot;match&quot;</span>:&#123;</span><br><span class="line">			<span class="attr">&quot;name&quot;</span>:<span class="string">&quot;wyg&quot;</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">     <span class="comment">//只需要特定字段</span></span><br><span class="line">    <span class="string">&quot;_source&quot;</span>:[<span class="string">&quot;name&quot;</span>,<span class="string">&quot;id&quot;</span>,<span class="string">&quot;age&quot;</span>],</span><br><span class="line">	<span class="comment">//排序</span></span><br><span class="line">	<span class="attr">&quot;sort&quot;</span>:&#123;  </span><br><span class="line">        <span class="attr">&quot;age&quot;</span>:&#123;</span><br><span class="line">            <span class="attr">&quot;order&quot;</span>:<span class="string">&quot;desc&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">	<span class="comment">//分页</span></span><br><span class="line">    <span class="attr">&quot;from&quot;</span>:<span class="number">3</span>,  <span class="comment">//当前页</span></span><br><span class="line">    <span class="attr">&quot;size&quot;</span>:<span class="number">10</span>  <span class="comment">//一页数量</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;   <span class="comment">//查询全部</span></span><br><span class="line">    <span class="attr">&quot;query&quot;</span>:&#123;</span><br><span class="line">		<span class="attr">&quot;match_all&quot;</span>:&#123;	</span><br><span class="line">		&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>

<h3 id="2-1-base"><a href="#2-1-base" class="headerlink" title="2.1 base"></a>2.1 base</h3><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;<span class="comment">//条件查询</span></span><br><span class="line">	<span class="attr">&quot;query&quot;</span>:&#123;</span><br><span class="line">		<span class="attr">&quot;match&quot;</span>:&#123;</span><br><span class="line">			<span class="attr">&quot;name&quot;</span>:<span class="string">&quot;wyg&quot;</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-2-多条件查询"><a href="#2-2-多条件查询" class="headerlink" title="2.2 多条件查询"></a>2.2 多条件查询</h3><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">&quot;query&quot;</span>:&#123;</span><br><span class="line">		<span class="attr">&quot;bool&quot;</span>:&#123;  <span class="comment">//条件</span></span><br><span class="line">			<span class="attr">&quot;should&quot;</span>:[  <span class="comment">//多条件必须匹配,还有must</span></span><br><span class="line">                &#123; </span><br><span class="line">                    <span class="attr">&quot;match&quot;</span>:&#123;</span><br><span class="line">                        <span class="attr">&quot;name&quot;</span>:<span class="string">&quot;wyg&quot;</span></span><br><span class="line">                	&#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                	<span class="attr">&quot;mathch&quot;</span>:&#123;</span><br><span class="line">                	    <span class="attr">&quot;name&quot;</span>:<span class="string">&quot;abc&quot;</span></span><br><span class="line">                	&#125;</span><br><span class="line">                &#125;</span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">&quot;filter&quot;</span>:&#123;  <span class="comment">//过滤条件</span></span><br><span class="line">                <span class="attr">&quot;range&quot;</span>:&#123; <span class="comment">//范围</span></span><br><span class="line">                    <span class="attr">&quot;age&quot;</span>:&#123;</span><br><span class="line">                        <span class="attr">&quot;gt&quot;</span>:<span class="number">20</span><span class="comment">//20岁以上</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="2-3-模糊查询—-gt-基于倒排索引"><a href="#2-3-模糊查询—-gt-基于倒排索引" class="headerlink" title="2.3 模糊查询—&gt;基于倒排索引"></a>2.3 模糊查询—&gt;基于倒排索引</h3><h4 id="模糊"><a href="#模糊" class="headerlink" title="模糊"></a>模糊</h4><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">/ &#123;<span class="comment">//条件查询</span></span><br><span class="line">	<span class="attr">&quot;query&quot;</span>:&#123;</span><br><span class="line">		<span class="attr">&quot;match&quot;</span>:&#123;</span><br><span class="line">			<span class="attr">&quot;name&quot;</span>:<span class="string">&quot;wyg&quot;</span> <span class="comment">//拆解 w y g </span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="完全匹配"><a href="#完全匹配" class="headerlink" title="完全匹配"></a>完全匹配</h4><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">&quot;query&quot;</span>:&#123;</span><br><span class="line">		<span class="attr">&quot;match_phrase&quot;</span>:&#123;</span><br><span class="line">			<span class="attr">&quot;name&quot;</span>:<span class="string">&quot;wyg&quot;</span> <span class="comment">//拆解 w y g </span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">    <span class="comment">//对字段高亮</span></span><br><span class="line">    <span class="attr">&quot;highlight&quot;</span>:&#123;</span><br><span class="line">        <span class="attr">&quot;fields&quot;</span>:&#123;</span><br><span class="line">            <span class="attr">&quot;name&quot;</span>:&#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="三、mapping"><a href="#三、mapping" class="headerlink" title="三、mapping"></a>三、mapping</h2><blockquote>
<p>mapping 是对<strong>文档</strong>的约束， 类似于DDL，create table（）</p>
<p>也用于es    index的创建</p>
</blockquote>
<table>
<thead>
<tr>
<th>属性</th>
<th>名称</th>
<th>选项</th>
</tr>
</thead>
<tbody><tr>
<td>type</td>
<td>数据类型</td>
<td>text（可拆分）  keyword  八大类型 date  object</td>
</tr>
<tr>
<td>index</td>
<td>释放创建倒排索引</td>
<td>true  false</td>
</tr>
<tr>
<td>analyzer</td>
<td>分词器</td>
<td></td>
</tr>
<tr>
<td>properties</td>
<td>字段</td>
<td></td>
</tr>
</tbody></table>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">&quot;mapping&quot;</span>:&#123;</span><br><span class="line">        <span class="attr">&quot;properties&quot;</span>:&#123;</span><br><span class="line">            <span class="attr">&quot;name&quot;</span>:&#123;</span><br><span class="line">                type:<span class="string">&quot;keyword&quot;</span>,</span><br><span class="line">                index:<span class="string">&quot;false&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">&quot;info&quot;</span>:&#123;</span><br><span class="line">                <span class="attr">&quot;type&quot;</span>:<span class="string">&quot;text&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;index&quot;</span>:<span class="string">&quot;true&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">&quot;edu&quot;</span>:&#123;</span><br><span class="line">                <span class="attr">&quot;type&quot;</span>:<span class="string">&quot;object&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;properties&quot;</span>&#123;</span><br><span class="line">                </span><br><span class="line">            &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>







<h2 id="四、elasticsearch-java"><a href="#四、elasticsearch-java" class="headerlink" title="四、elasticsearch-java"></a>四、elasticsearch-java</h2><blockquote>
<p>操作elasticSearch的两种方式，通过restApi http:9200  通过tco:9300</p>
</blockquote>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/client/java-rest/current/java-rest-high-search.html">官网</a></p>
<h3 id="三个组件"><a href="#三个组件" class="headerlink" title="三个组件"></a>三个组件</h3><ol>
<li>api cilent</li>
<li>json mapping</li>
<li>传输层</li>
<li>、、</li>
</ol>
]]></content>
  </entry>
  <entry>
    <title>mysql分析</title>
    <url>/2022/02/10/%E6%95%B0%E6%8D%AE%E5%BA%93/nosql/mysql%E4%B8%80%E6%9D%A1%E8%AF%AD%E5%8F%A5/</url>
    <content><![CDATA[<h3 id="Buffer-pool"><a href="#Buffer-pool" class="headerlink" title="Buffer pool"></a>Buffer pool</h3><p>第一次在查询的时候会将查询的结果存到  Buffer Pool 中，这样后面再有请求的时候就会先从缓冲池中去查询，如果没有再去磁盘中查找，然后在放到  Buffer Pool 中</p>
<h3 id="执行顺序"><a href="#执行顺序" class="headerlink" title="执行顺序"></a>执行顺序</h3><p>undo</p>
<p>磁盘——–&gt;buffer Pool———&gt;在buffer中完成运算—&gt;结果写入到redo log buffer —-&gt;写入redo log —&gt;</p>
<p>​      ——-&gt;将更新语句反句加载到undo</p>
<ul>
<li>准备更新一条 SQL 语句</li>
<li>MySQL（innodb）会先去缓冲池（BufferPool）中去查找这条数据，没找到就会去磁盘中查找，如果查找到就会将这条数据加载到缓冲池（BufferPool）中</li>
<li>在加载到 Buffer Pool 的同时，会将这条数据的原始记录保存到 undo 日志文件中</li>
<li>innodb 会在 Buffer Pool 中执行更新操作</li>
<li>更新后的数据会记录在 redo log buffer 中</li>
<li>MySQL 提交事务的时候，会将 redo log buffer 中的数据写入到 redo 日志文件中 刷磁盘可以通过 innodb_flush_log_at_trx_commit 参数来设置<ul>
<li>值为 0 表示不刷入磁盘</li>
<li>值为 1 表示立即刷入磁盘</li>
<li>值为 2 表示先刷到 os cache</li>
</ul>
</li>
<li>myslq 重启的时候会将 redo 日志恢复到缓冲池中</li>
</ul>
<h4 id="当前读"><a href="#当前读" class="headerlink" title="当前读"></a>当前读</h4><blockquote>
<p>当前读, 读取的是最新版本, 并且<strong>对读取的记录加锁, 阻塞其他事务同时改动相同</strong>记录，避免出现安全问题</p>
</blockquote>
<p>当前读的实现方式：next-key锁(行记录锁+Gap间隙锁)</p>
<ol>
<li>对主键或唯一索引，如果当前读时，where条件全部精确命中(=或者in)，这种场景本身就不会出现幻读，所以只会加行记录锁。</li>
<li>没有索引的列，当前读操作时，会加全表gap锁，生产环境要注意。</li>
<li>非唯一索引列，如果where条件部分命中(&gt;、&lt;、like等)或者全未命中，则会加附近Gap间隙锁。例如，某表数据如下，非唯一索引2,6,9,9,11,15。如下语句要操作非唯一索引列9的数据，gap锁将会锁定的列是(6,11]，该区间内无法插入数据。</li>
</ol>
<h4 id="快照读"><a href="#快照读" class="headerlink" title="快照读"></a>快照读</h4><blockquote>
<p>readView  [未提交事务数组]、max_id</p>
<p>执行DML才会给事务id</p>
</blockquote>
<blockquote>
<p>版本链上适合自己的一个版本快照</p>
<p>通过 </p>
<p>生成时机：begin<strong>之后第一条</strong>语句</p>
<p>作用范围：库的所有表，每个表都对应一个版本链，</p>
</blockquote>
<p>只读事务不分配trx_id（会分配一个假trx_id），只有涉及到数据更新才会分配事务ID。</p>
<ul>
<li>在事务隔离级别为<code>RR</code>时，在第一次进行<code>select</code>查询时生成<code>read view</code>;</li>
<li>在事务隔离级别为<code>RC</code>时，每一次<code>select</code>查询都会生成<code>read view</code>;</li>
</ul>
<p><a href="https://blog.csdn.net/lmlzww/article/details/119087426?utm_medium=distribute.pc_relevant.none-task-blog-2~default~baidujs_baidulandingword~default-0.pc_relevant_default&amp;spm=1001.2101.3001.4242.1&amp;utm_relevant_index=2">https://blog.csdn.net/lmlzww/article/details/119087426?utm_medium=distribute.pc_relevant.none-task-blog-2~default~baidujs_baidulandingword~default-0.pc_relevant_default&amp;spm=1001.2101.3001.4242.1&amp;utm_relevant_index=2</a></p>
<p><a href="https://blog.csdn.net/qq_44823898/article/details/115718622">https://blog.csdn.net/qq_44823898/article/details/115718622</a></p>
]]></content>
  </entry>
  <entry>
    <title>elasticSearch</title>
    <url>/2022/03/09/%E6%95%B0%E6%8D%AE%E5%BA%93/nosql/elasticSearch%E6%95%B0%E6%8D%AE%E5%BA%93/</url>
    <content><![CDATA[<h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><ol>
<li><p>ELK</p>
<blockquote>
<p>常用于日志分析</p>
</blockquote>
<ol>
<li>elasticSearch(数据库，搜索引擎)</li>
<li>logstach(数据采集，出来)</li>
<li>kibana(可视化展现)</li>
<li>Beats(数据采集)</li>
<li>elasticSearch Cloud</li>
<li>X-pack</li>
</ol>
</li>
<li><p>流程</p>
<ol>
<li><p>beats 数据采集(cpu使用情况，日志，网络流量)</p>
<p><em>&gt; es</em></p>
<p><em>&gt;</em> logstash–&gt;es</p>
</li>
</ol>
</li>
<li><p>es特点</p>
<ol>
<li>分布式</li>
<li>基于java</li>
<li>配置简单</li>
<li>索引自动切分</li>
<li>restful风格</li>
</ol>
</li>
</ol>
<h2 id="学习"><a href="#学习" class="headerlink" title="学习"></a>学习</h2><p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20220324155918088.png" alt="image-20220324155918088"></p>
<h3 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h3><ol>
<li>数据分为几种<ol>
<li>索引：表，可以有多个副本，多个分片</li>
<li>文档：一条记录</li>
</ol>
</li>
</ol>
<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><ol>
<li><p>网络配置yml</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">network</span>:<span class="number">0.0.0.0</span></span><br></pre></td></tr></table></figure></li>
<li><p>jvm配置yml</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">xms128m</span>  测试环境下内存占用</span><br></pre></td></tr></table></figure></li>
<li><p>跨域配置</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">   </span><br></pre></td></tr></table></figure></li>
<li><p>linux配置</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/etc/</span>sysctl.conf</span><br><span class="line">追加</span><br><span class="line">vm.max_map_count=<span class="number">655360</span></span><br><span class="line">sysctl -p</span><br></pre></td></tr></table></figure></li>
<li><p>master配置用户名  yml</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">cluster<span class="selector-class">.initial_master_nodes</span>: <span class="selector-attr">[<span class="string">&quot;web1&quot;</span>]</span></span><br></pre></td></tr></table></figure></li>
<li><p>启动</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line"><span class="string">./elasearch</span>  启动   -d g  -d表示h</span><br></pre></td></tr></table></figure></li>
<li><p>停止</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">kill</span> -sigterm pid</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="设置密码登录"><a href="#设置密码登录" class="headerlink" title="设置密码登录"></a>设置密码登录</h3><ol>
<li><p>开启xpack验证，追加内容到yml</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">xpack<span class="selector-class">.security</span><span class="selector-class">.enabled</span>: true</span><br><span class="line">xpack<span class="selector-class">.license</span><span class="selector-class">.self_generated</span><span class="selector-class">.type</span>: basic</span><br><span class="line">xpack<span class="selector-class">.security</span><span class="selector-class">.transport</span><span class="selector-class">.ssl</span><span class="selector-class">.enabled</span>: true</span><br></pre></td></tr></table></figure></li>
<li><p>设置密码</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">./elasticsearch-keystore <span class="builtin-name">add</span> <span class="string">&quot;bootstrap.password&quot;</span></span><br></pre></td></tr></table></figure></li>
<li><p>重启</p>
</li>
<li><p>访问</p>
<ol>
<li>curl <a href="http://elastic:wyg123@114.55.253.244:9200/">http://elastic:wyg123@114.55.253.244:9200/</a></li>
<li></li>
</ol>
</li>
<li><p>其他</p>
<p>linux开启9200端口</p>
<p>阿里云开启9200端口</p>
</li>
</ol>
<h2 id="集群"><a href="#集群" class="headerlink" title="集群"></a>集群</h2><ol>
<li>分片，每个节点一个主分片</li>
<li>故障处理，每个节点多个备份分片(副分片)</li>
</ol>
<h2 id="Ik分词器"><a href="#Ik分词器" class="headerlink" title="Ik分词器"></a>Ik分词器</h2><h3 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h3><h3 id="配置禁用词和自定义词"><a href="#配置禁用词和自定义词" class="headerlink" title="配置禁用词和自定义词"></a>配置禁用词和自定义词</h3><h2 id="logstash"><a href="#logstash" class="headerlink" title="logstash"></a>logstash</h2><h3 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h3><p>bin/logstatsh -f aa.conf</p>
<h3 id="三大插件"><a href="#三大插件" class="headerlink" title="三大插件"></a>三大插件</h3><ol>
<li>input 采集数据来源：github,jdbc,es</li>
<li>output:保存地点</li>
<li>filter: 数据处理</li>
</ol>
<h3 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">input &#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">filter &#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output &#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="jdbc导入"><a href="#jdbc导入" class="headerlink" title="jdbc导入"></a>jdbc导入</h3><ol>
<li>基本格式</li>
</ol>
<figure class="highlight puppet"><table><tr><td class="code"><pre><span class="line"><span class="keyword">input</span> &#123;</span><br><span class="line">  jdbc &#123;</span><br><span class="line">    <span class="attr">jdbc_driver_library</span> =&gt; <span class="string">&quot;mysql-connector-java-5.1.36-bin.jar&quot;</span></span><br><span class="line">    <span class="attr">jdbc_driver_class</span> =&gt; <span class="string">&quot;com.mysql.jdbc.Driver&quot;</span></span><br><span class="line">    <span class="attr">jdbc_connection_string</span> =&gt; <span class="string">&quot;jdbc:mysql://localhost:3306/mydb&quot;</span></span><br><span class="line">    <span class="attr">jdbc_user</span> =&gt; <span class="string">&quot;mysql&quot;</span></span><br><span class="line">    <span class="attr">parameters</span> =&gt; &#123; <span class="string">&quot;favorite_artist&quot;</span> =&gt; <span class="string">&quot;Beethoven&quot;</span> &#125;</span><br><span class="line">    <span class="keyword">schedule</span> =&gt; <span class="string">&quot;* * * * *&quot;</span></span><br><span class="line">    statement =&gt; <span class="string">&quot;SELECT * from songs where artist = :favorite_artist&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p>实时更新性原理</p>
<ol>
<li>sql_last_value关键字 用于表示上一条sql记录</li>
<li>当use_column_value=true时，表示用自增行</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">input &#123;</span><br><span class="line">  stdin&#123;&#125;</span><br><span class="line">  jdbc &#123;</span><br><span class="line">    jdbc_driver_library <span class="operator">=</span><span class="operator">&gt;</span> &quot;D:\mysql-connector-java-5.1.48-bin.jar&quot;</span><br><span class="line">    jdbc_driver_class <span class="operator">=</span><span class="operator">&gt;</span> &quot;com.mysql.jdbc.Driver&quot;</span><br><span class="line">    jdbc_connection_string <span class="operator">=</span><span class="operator">&gt;</span> &quot;jdbc:mysql://localhost:3306/es&quot;</span><br><span class="line">    jdbc_user <span class="operator">=</span><span class="operator">&gt;</span> &quot;root&quot;</span><br><span class="line">    jdbc_password <span class="operator">=</span><span class="operator">&gt;</span> &quot;root&quot;</span><br><span class="line">	use_column_value <span class="operator">=</span><span class="operator">&gt;</span> <span class="literal">true</span></span><br><span class="line">    tracking_column <span class="operator">=</span><span class="operator">&gt;</span> id</span><br><span class="line">	record_last_run <span class="operator">=</span><span class="operator">&gt;</span> <span class="literal">true</span></span><br><span class="line">  	last_run_metadata_path <span class="operator">=</span><span class="operator">&gt;</span> &quot;D:\ChromeDown\logstash-8.0.1\liblogstash_metadata&quot;</span><br><span class="line">    statement <span class="operator">=</span><span class="operator">&gt;</span> &quot;select * from data_result where id &gt; :sql_last_value&quot;</span><br><span class="line">    schedule <span class="operator">=</span><span class="operator">&gt;</span>&quot;* * * * *&quot;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">filter</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output &#123;</span><br><span class="line">  stdout &#123;</span><br><span class="line">    codec <span class="operator">=</span><span class="operator">&gt;</span> rubydebug</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  elasticsearch &#123;</span><br><span class="line">    hosts <span class="operator">=</span><span class="operator">&gt;</span> [&quot;114.55.253.244:9200&quot;]</span><br><span class="line">	index <span class="operator">=</span><span class="operator">&gt;</span> &quot;es_index&quot;</span><br><span class="line">	document_id <span class="operator">=</span><span class="operator">&gt;</span> &quot;%&#123;id&#125;&quot;</span><br><span class="line">	<span class="keyword">user</span> <span class="operator">=</span><span class="operator">&gt;</span> &quot;elastic&quot;</span><br><span class="line">   	password <span class="operator">=</span><span class="operator">&gt;</span> &quot;wyg123&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
]]></content>
  </entry>
  <entry>
    <title>DML数据库，操纵语言</title>
    <url>/2022/02/08/%E6%95%B0%E6%8D%AE%E5%BA%93/sql/DML/</url>
    <content><![CDATA[<p>[toc]</p>
<h3 id="一、Select"><a href="#一、Select" class="headerlink" title="一、Select"></a>一、Select</h3><h4 id="1-1-where-like-and-or-between-in"><a href="#1-1-where-like-and-or-between-in" class="headerlink" title="1.1 where  like  and  or  between  in"></a>1.1 where  like  and  or  between  in</h4><ol>
<li><p>select * from name where  age &lt;&gt; 18; 查询年龄不等于18的人</p>
</li>
<li><p>select * from name where age&gt;18 and sex=’男’ </p>
</li>
<li><p>update name set age =18 where not id =10;  按条件修改</p>
</li>
<li><p>select * from name where age between 4 and 10; 查询4-10岁  前闭后开</p>
</li>
<li><p>select * from name where age in (3,4,10)  查询3，4，10 岁数据</p>
<span id="more"></span></li>
</ol>
<h4 id="1-2-with-as-子查询"><a href="#1-2-with-as-子查询" class="headerlink" title="1.2 with as 子查询"></a>1.2 with as 子查询</h4><ol>
<li><p>子查询是派生表，Mysql规定派生表必须有别名</p>
<p>SELECT id FROM (SELECT * FROM el_paper )</p>
<p>错误信息:Every derived table must have its own alias</p>
<p>正确格式: SELECT id FROM (SELECT * FROM el_paper )as a</p>
</li>
<li><p>特殊情况：。。in 听该不需要</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> keyword <span class="keyword">FROM</span> article_kw <span class="keyword">where</span> article_id <span class="keyword">in</span>  (<span class="keyword">SELECT</span> article_id <span class="keyword">FROM</span> article_entity <span class="keyword">where</span> entity<span class="operator">=</span><span class="string">&#x27;PPmoney&#x27;</span> ); </span><br></pre></td></tr></table></figure></li>
<li><p>in形式的as写里面,普通selete形式的as 在()外面</p>
<ol>
<li><p>查询前100条，并将100条排序</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> (<span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> company_num LIMIT <span class="number">100</span> )a  <span class="keyword">ORDER</span> <span class="keyword">BY</span> all_num;</span><br></pre></td></tr></table></figure></li>
<li><p>简单in查询,不确定</p>
<blockquote>
<p>牵强解释：派生表的来源与主表一样的时候用as</p>
</blockquote>
</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> id <span class="keyword">FROM</span>  el_paper <span class="keyword">where</span>  id <span class="keyword">in</span> (<span class="keyword">SELECT</span> id <span class="keyword">FROM</span> el_paper <span class="keyword">as</span> a)</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="1-3-group-by"><a href="#1-3-group-by" class="headerlink" title="1.3 group by"></a>1.3 group by</h4><ol>
<li><p>选出每个学生最大分数的试卷信息(注意，这种会有两列user_score)</p>
<p>SELECT *,user_score FROM el_paper GROUP BY(user_id);</p>
</li>
</ol>
<h4 id="1-4-join"><a href="#1-4-join" class="headerlink" title="1.4 join"></a>1.4 join</h4><ol>
<li>神奇的不join</li>
</ol>
<h4 id="1-5-exists-和-in"><a href="#1-5-exists-和-in" class="headerlink" title="1.5 exists 和 in"></a>1.5 exists 和 in</h4><ol>
<li><p>in</p>
<p>​    in在查询的时候，首先查询子查询的表，然后将内表和外表做一个笛卡尔积.所以相对内表比较小的时候，in的速度较快。</p>
</li>
<li><p>exists</p>
<p>​    指定一个子查询，检测行的存在。遍历循环外表，然后看外表中的记录有没有和内表的数据一样的。匹配上就将结果放入结果集中</p>
</li>
</ol>
<h4 id="1-10-其他select"><a href="#1-10-其他select" class="headerlink" title="1.10 其他select"></a>1.10 其他select</h4><table>
<thead>
<tr>
<th>关键字</th>
<th>含义</th>
<th>语句</th>
</tr>
</thead>
<tbody><tr>
<td>\G</td>
<td>分行显示</td>
<td>select *  from student \G;</td>
</tr>
<tr>
<td>distinct</td>
<td>去重</td>
<td>select distinct age, sex from student</td>
</tr>
<tr>
<td>别名</td>
<td>别名</td>
<td>select age 年龄 from student s</td>
</tr>
<tr>
<td>like</td>
<td>模糊查询</td>
<td>select * from name where  namex  like ‘黄%’  所有姓黄的</td>
</tr>
<tr>
<td>in</td>
<td>范围</td>
<td>select * from student where name in (“wang”,”zhang”)</td>
</tr>
<tr>
<td>子查询1</td>
<td>子查询先执行 in表达式</td>
<td>select * from student where name not in select fail_name from file_exam</td>
</tr>
<tr>
<td>子查询2</td>
<td>函数表达式</td>
<td>select * from name where age &gt;(select avg(age) from name)</td>
</tr>
<tr>
<td>子查询3</td>
<td></td>
<td>select * from  name where (age,high) =(select max(age),max(high) from name )</td>
</tr>
<tr>
<td>exists</td>
<td>和in差不多</td>
<td></td>
</tr>
<tr>
<td>is null</td>
<td>空判断</td>
<td>select * from name where age is null;</td>
</tr>
<tr>
<td>union</td>
<td>组合查询</td>
<td></td>
</tr>
<tr>
<td>子查询</td>
<td></td>
<td></td>
</tr>
<tr>
<td>order by</td>
<td>排序</td>
<td></td>
</tr>
<tr>
<td>asc ,desc</td>
<td>升降,与orderby同用</td>
<td></td>
</tr>
<tr>
<td>limit</td>
<td>前几条/分页</td>
<td>select * from name where sex=’男’ limit page, sizeg;</td>
</tr>
<tr>
<td>group by</td>
<td>统计分组，与fun同用</td>
<td>select sex ,avg(age) from name group by sex ; 男女各自的平均年龄</td>
</tr>
<tr>
<td>having</td>
<td>分组过滤,</td>
<td>select sex ,count(*) from name group by sex having count(*)&gt;2  ; 人数大于2的性别数量</td>
</tr>
<tr>
<td>group_concat</td>
<td>信息分组,group by 同用</td>
<td>select id</td>
</tr>
<tr>
<td>count,avg…</td>
<td>聚合函数，可单独使用</td>
<td>select * from name where age &gt;(select avg(age) from name)</td>
</tr>
</tbody></table>
<h3 id="二、Update"><a href="#二、Update" class="headerlink" title="二、Update"></a>二、Update</h3><p>update  students set age=10</p>
<h3 id="三、Insert"><a href="#三、Insert" class="headerlink" title="三、Insert"></a>三、Insert</h3><ol>
<li>外表数据  insert into t3 select * from choose where sno=’s00001’;</li>
<li>多行插入 多行 insert into name values(…), (…)</li>
<li>部分字段插入 insert into name (列1，列2) values(100,’张三’)</li>
<li>三种<ol>
<li>value</li>
<li>values</li>
<li>无valuu</li>
</ol>
</li>
<li>对于自增键，需要指定是null或者0 来让mysql自行处理，而不是不指定。</li>
</ol>
<h3 id="四、Delete"><a href="#四、Delete" class="headerlink" title="四、Delete"></a>四、Delete</h3><ol>
<li><p>delete from name where id=6;</p>
</li>
<li><p>删除所有数据    </p>
<ol>
<li>delete from name;        dml 在确认不rollback后生效</li>
<li>truncate table name;    ddl 立即生效</li>
</ol>
</li>
</ol>
]]></content>
      <categories>
        <category>数据库</category>
        <category>sql语句</category>
      </categories>
  </entry>
  <entry>
    <title>sql函数</title>
    <url>/2022/02/10/%E6%95%B0%E6%8D%AE%E5%BA%93/sql/sql%E5%87%BD%E6%95%B0/</url>
    <content><![CDATA[<ol>
<li><p>replace</p>
<ol>
<li><p>查询替换  select *,replace(address,’区’,’呕’)  from test_tb</p>
</li>
<li><p>更新替换  update set address=replace(address,’区’,’呕’) from test_tb</p>
</li>
<li><p>插入替换 (类似于saveOrUpdate)  replace into test_tb VALUES(6,’wokou’,’新九州岛’,’日本’)</p>
<p>向表中“替换插入”一条数据，如果原表中没有id=6这条数据就作为新数据插入(相当于insert into作用)；如果原表中有id=6这条数据就做替换(相当于update作用)。对于没有指定的字段以默认值插入。</p>
<span id="more"></span></li>
</ol>
</li>
<li><p>concat</p>
<ol>
<li>将字符串/字段拼接</li>
<li>concat_ws() 拼接并用’,’分割，也可以指定分隔符</li>
<li>select concat (id, name, score) as info from tt2;</li>
<li>注意<ol>
<li>如果任意一个为Null，返回null，一般的sql函数只要表达式的一个null就会返回Null</li>
</ol>
</li>
</ol>
</li>
<li><p>group_concat</p>
<ol>
<li><p>分组信息，同group by通用</p>
<p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20211106013507369.png" alt="image-20211106013507369"></p>
</li>
<li><p>如果选中多列，可以指定分隔符</p>
</li>
</ol>
</li>
<li><p>ifnull </p>
<ol>
<li>如果arg0为null，就返回arg1</li>
<li>SELECT IFNULL(“Hello”, “RUNOOB”);  返回hello</li>
<li>select sum(ifnull(age,100)) from name  年龄缺失按100统计</li>
</ol>
</li>
<li><p>char_length 返回字符串长度</p>
</li>
</ol>
<h4 id="数值函数"><a href="#数值函数" class="headerlink" title="数值函数"></a>数值函数</h4><ol>
<li><p>计算函数</p>
<table>
<thead>
<tr>
<th>函数</th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>取余</td>
<td>select mod(3,2)</td>
<td>1</td>
</tr>
<tr>
<td>除</td>
<td>select 10 div 2</td>
<td>5</td>
</tr>
<tr>
<td>abs</td>
<td></td>
<td></td>
</tr>
<tr>
<td>sqrt</td>
<td></td>
<td></td>
</tr>
<tr>
<td>ceil.floor</td>
<td>向上取整，向下取整</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
</li>
</ol>
<h3 id="字符串函数"><a href="#字符串函数" class="headerlink" title="字符串函数"></a>字符串函数</h3><p>ength 计算字符串长度函数，返回字符串的字节长度 </p>
<p>concat 合并字符串函数，返回结果为连接参数产生的字符串，参数可以使一个或 多个 </p>
<p>insert 替换字符串函数 </p>
<p>lower 将字符串中的字母转换为小写 </p>
<p>upper 将字符串中的字母转换为大写 </p>
<p>left 从左侧字截取符串，返回字符串左边的若干个字符 </p>
<p>right 从右侧字截取符串，返回字符串右边的若干个字符</p>
<p>trim 删除字符串左右两侧的空格 </p>
<p>replace 字符串替换函数，返回替换后的新字符串 </p>
<p>substr 和 substring 截取字符串，返回从指定位置开始的指定长度的字符换 </p>
<p>reverse 字符串反转（逆序）函数，返回与原始字符串顺序相反的字符串</p>
<h3 id="日期函数"><a href="#日期函数" class="headerlink" title="日期函数"></a>日期函数</h3><p>curtime 和 current_time 两个函数作用相同，返回当前系统的时间值</p>
<p>now 和 sysdate 两个函数作用相同，返回当前系统的日期和时间值 unix_timestamp 获取UNIX时间戳函数，返回一个以 UNIX 时间戳为基础的无符号整数 from_unixtime 将 UNIX 时间戳转换为时间格式，与UNIX_TIMESTAMP互为反函数 </p>
<p>month 获取指定日期中的月份 </p>
<p>monthname 获取指定日期中的月份英文名称 </p>
<p>dayname 获取指定曰期对应的星期几的英文名称 </p>
<p>dayofweek 获取指定日期是一周中是第几天，返回值范围是1~7,1=周日 </p>
<p>week 获取指定日期是一年中的第几周，返回值的范围是否为 0〜52 或 1〜 53 </p>
<p>dayofyear 获取指定曰期是一年中的第几天，返回值范围是1~366 </p>
<p>dayofmonth 获取指定日期是一个月中是第几天，返回值范围是1~31 </p>
<p>year 获取年份，返回值范围是 1970〜2069 </p>
<p>time_to_sec 将时间参数转换为秒数 </p>
<p>sec_to_time 将秒数转换为时间，</p>
<p>与TIME_TO_SEC 互为反函数 </p>
<p>date_add 和 adddate 两个函数功能相同，都是向日期添加指定的时间间隔 </p>
<p>date_sub 和 subdate 两个函数功能相同，都是向日期减去指定的时间间隔 </p>
<p>addtime 时间加法运算，在原始时间上添加指定的时间 </p>
<p>subtime 时间减法运算，在原始时间上减去指定的时间 </p>
<p>datediff 获取两个日期之间间隔，返回参数 1 减去参数 2 的值 </p>
<p>date_format 格式化指定的日期，根据参数返回指定格式的值 </p>
<p>weekday 获取指定日期在一周内的对应的工作日索引</p>
<h3 id="其他函数"><a href="#其他函数" class="headerlink" title="其他函数"></a>其他函数</h3><p>if 判断，流程控制 </p>
<p>ifnull 判断是否为空 </p>
<p>case 搜索语句</p>
<p>version 数据库版本号 </p>
<p>database 当前的数据库 </p>
<p>user 当前连接用户 </p>
<p>password 返回字符串密码形式 </p>
<p>md5 返回字符串的md5数据</p>
]]></content>
      <categories>
        <category>数据库</category>
        <category>sql语句</category>
      </categories>
  </entry>
  <entry>
    <title>复杂的sql</title>
    <url>/2022/04/10/%E6%95%B0%E6%8D%AE%E5%BA%93/sql/%E5%A4%8D%E6%9D%82sql/</url>
    <content><![CDATA[<ol>
<li><p>查询这个entity=PPmoney的前十的关键字</p>
<blockquote>
<p>sort + limit </p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">count</span>(<span class="operator">*</span>) b, keyword <span class="keyword">FROM</span> article_kw <span class="keyword">where</span> article_id <span class="keyword">in</span>  (<span class="keyword">SELECT</span> article_id <span class="keyword">FROM</span> article_entity <span class="keyword">where</span> entity<span class="operator">=</span><span class="string">&#x27;PPmoney&#x27;</span> ) <span class="keyword">GROUP</span> <span class="keyword">BY</span> keyword <span class="keyword">ORDER</span> <span class="keyword">BY</span> b <span class="keyword">desc</span> LIMIT <span class="number">10</span>; </span><br></pre></td></tr></table></figure></li>
<li><p>再选出上面的名字</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> keyword <span class="keyword">FROM</span>(<span class="keyword">SELECT</span> <span class="built_in">count</span>(<span class="operator">*</span>) b, keyword <span class="keyword">FROM</span> article_kw <span class="keyword">where</span> article_id <span class="keyword">in</span>  (<span class="keyword">SELECT</span> article_id <span class="keyword">FROM</span> article_entity <span class="keyword">where</span> entity<span class="operator">=</span><span class="string">&#x27;PPmoney&#x27;</span> ) <span class="keyword">GROUP</span> <span class="keyword">BY</span> keyword <span class="keyword">ORDER</span> <span class="keyword">BY</span> b <span class="keyword">desc</span> LIMIT <span class="number">10</span>) c; </span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="一、统计"><a href="#一、统计" class="headerlink" title="一、统计"></a>一、统计</h2><ol>
<li><p>按月统计</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> DATE_FORMAT(<span class="type">date</span>,<span class="string">&#x27;%Y-%m&#x27;</span>) <span class="keyword">as</span> <span class="keyword">month</span>,<span class="built_in">sum</span>(money) <span class="keyword">as</span> money</span><br><span class="line"><span class="keyword">from</span> finance</span><br><span class="line"><span class="keyword">where</span> DATE_FORMAT(<span class="type">date</span>,<span class="string">&#x27;%Y&#x27;</span>)<span class="operator">=</span><span class="number">2010</span> <span class="keyword">group</span> <span class="keyword">by</span> <span class="keyword">month</span></span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> <span class="keyword">month</span></span><br></pre></td></tr></table></figure></li>
<li><p>按周统计</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> DATE_FORMAT(<span class="type">date</span>,<span class="string">&#x27;%x年-第%v周&#x27;</span>) <span class="keyword">as</span> week,<span class="built_in">sum</span>(money) <span class="keyword">as</span> money <span class="keyword">from</span> finance_base <span class="keyword">where</span> DATE_FORMAT(<span class="type">date</span>,<span class="string">&#x27;%Y&#x27;</span>)<span class="operator">=</span><span class="number">2010</span> <span class="keyword">group</span> <span class="keyword">by</span> week</span><br></pre></td></tr></table></figure></li>
<li><!-- 按日查询 -->  
<p>SELECT DATE_FORMAT(created_date,’%Y-%m-%d’) as time,sum(money) money FROM o_finance_detail where org_id = 1000  GROUP BY  time  </p>
<!-- 按月查询 -->  
<p>SELECT DATE_FORMAT(created_date,’%Y-%m’) as time,sum(money)  money FROM o_finance_detail where org_id = 1000  GROUP BY  time  </p>
<!-- 按年查询 -->  
<p>SELECT DATE_FORMAT(created_date,’%Y’) as time,sum(money)  money FROM o_finance_detail where org_id = 1000  GROUP BY  time   </p>
<!-- 按周查询 -->  
<p>SELECT DATE_FORMAT(created_date,’%Y-%u’) as time,sum(money)  money FROM o_finance_detail where org_id = 1000  GROUP BY  time</p>
</li>
</ol>
<h2 id="二、重复数据"><a href="#二、重复数据" class="headerlink" title="二、重复数据"></a>二、重复数据</h2><h3 id="2-1-统计重复数据"><a href="#2-1-统计重复数据" class="headerlink" title="2.1 统计重复数据"></a>2.1 统计重复数据</h3><p>以下我们将统计表中 first_name 和 last_name的重复记录数：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">as</span> repetitions, last_name, first_name</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">FROM</span> person_tbl</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> last_name, first_name</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">HAVING</span> repetitions <span class="operator">&gt;</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<h3 id="2-2-去重"><a href="#2-2-去重" class="headerlink" title="2.2 去重"></a>2.2 去重</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 去重保留最小的</span></span><br><span class="line"><span class="comment">-- 步骤</span></span><br><span class="line"><span class="comment">-- 前提：选出每个id最大的value</span></span><br><span class="line"><span class="comment">-- 选出count&gt;1 and not in (最大的value&amp;&amp;count&gt;1)</span></span><br><span class="line"><span class="keyword">DELETE</span></span><br><span class="line"><span class="keyword">FROM</span> testdelete</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">ONE</span> <span class="keyword">IN</span>(<span class="keyword">SELECT</span></span><br><span class="line">               <span class="keyword">ONE</span></span><br><span class="line">             <span class="keyword">FROM</span> (<span class="keyword">SELECT</span></span><br><span class="line">                     <span class="keyword">ONE</span></span><br><span class="line">                   <span class="keyword">FROM</span> testdelete</span><br><span class="line">                   <span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">ONE</span></span><br><span class="line">                   <span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(<span class="keyword">ONE</span>) <span class="operator">&gt;</span> <span class="number">1</span>) a)</span><br><span class="line">    <span class="keyword">AND</span> id <span class="keyword">NOT</span> <span class="keyword">IN</span>(<span class="keyword">SELECT</span></span><br><span class="line">                    <span class="operator">*</span></span><br><span class="line">                  <span class="keyword">FROM</span> (<span class="keyword">SELECT</span></span><br><span class="line">                          <span class="built_in">MIN</span>(id)</span><br><span class="line">                        <span class="keyword">FROM</span> testdelete</span><br><span class="line">                        <span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">ONE</span></span><br><span class="line">                        <span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(<span class="keyword">ONE</span>) <span class="operator">&gt;</span> <span class="number">1</span>) b)</span><br></pre></td></tr></table></figure>

<h4 id="方式2-新建表"><a href="#方式2-新建表" class="headerlink" title="方式2 新建表"></a>方式2 新建表</h4><blockquote>
<p>主要用于实时删除</p>
</blockquote>
<ol>
<li><p>新建一个表进行迁移</p>
</li>
<li><p>代码解决</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="number">1.</span> <span class="keyword">delete</span>  <span class="keyword">from</span> student <span class="keyword">where</span> id <span class="keyword">not</span> <span class="keyword">in</span> (selete id,<span class="built_in">max</span>(age) <span class="keyword">from</span> student <span class="keyword">group</span> <span class="keyword">by</span> (name) <span class="keyword">as</span> a)</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span> <span class="keyword">DELETE</span> <span class="keyword">from</span> el_paper <span class="keyword">where</span> id <span class="keyword">not</span> <span class="keyword">in</span> (<span class="keyword">SELECT</span> id <span class="keyword">from</span> (<span class="keyword">SELECT</span> id,user_score <span class="keyword">FROM</span> el_paper <span class="keyword">GROUP</span> <span class="keyword">BY</span>(user_id)) <span class="keyword">as</span> a )</span><br></pre></td></tr></table></figure></li>
<li><p>实时删除：先找到重复的数据，复制到新表，对新表逻辑去重，然后根据新表的is_delete字段删除旧表重复数据</p>
</li>
</ol>
<h4 id="方式3-建立主键"><a href="#方式3-建立主键" class="headerlink" title="方式3 建立主键"></a>方式3 建立主键</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> IGNORE <span class="keyword">TABLE</span> person_tbl <span class="keyword">ADD</span> <span class="keyword">PRIMARY</span> KEY (last_name, first_name);</span><br></pre></td></tr></table></figure>



<h2 id="三、聚合"><a href="#三、聚合" class="headerlink" title="三、聚合"></a>三、聚合</h2><h3 id="group-by"><a href="#group-by" class="headerlink" title="group by"></a>group by</h3><ol>
<li><p>聚集user，exam选出用户每场考试的最高分和其他详细信息。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> user_id,exam_id,depart_id,title,<span class="built_in">max</span>(qualify_score) <span class="keyword">from</span> el_paper <span class="keyword">group</span> <span class="keyword">by</span> user_id,exam_id;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="四、子查询"><a href="#四、子查询" class="headerlink" title="四、子查询"></a>四、子查询</h2><h3 id="select-后面"><a href="#select-后面" class="headerlink" title="select 后面"></a>select 后面</h3><ol>
<li><p>带外表的聚合数据， a.name,a.age, b. count(a.name)</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">a.dept_name,(<span class="keyword">SELECT</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> dept_emp b <span class="keyword">WHERE</span> b.dept_no <span class="operator">=</span> a.dept_no) <span class="keyword">AS</span> 员工个数</span><br><span class="line"><span class="keyword">FROM</span> departments a;</span><br></pre></td></tr></table></figure></li>
<li><p>普通的 类似于连接</p>
<blockquote>
<p>测试结果没有连接快</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> a.<span class="operator">*</span> ,(<span class="keyword">SELECT</span> b.dept_name <span class="keyword">from</span> departments b <span class="keyword">where</span> a.dept_no<span class="operator">=</span>b.dept_no) name <span class="keyword">FROM</span> dept_emp a LIMIT <span class="number">20</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">--  测试二</span></span><br><span class="line"><span class="comment">-- 大表 left join 小表   时间 0.6s </span></span><br><span class="line"><span class="keyword">SELECT</span> a.<span class="operator">*</span>,b.dept_name <span class="keyword">FROM</span> dept_emp a   <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> departments  b <span class="keyword">on</span> a.dept_no<span class="operator">=</span>b.dept_no;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 大表 right join 小表   时间 0.7s </span></span><br><span class="line"><span class="keyword">SELECT</span> a.<span class="operator">*</span>,b.dept_name <span class="keyword">FROM</span> dept_emp a   R <span class="keyword">JOIN</span> departments  b <span class="keyword">on</span> a.dept_no<span class="operator">=</span>b.dept_no;</span><br></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>数据库</category>
      </categories>
  </entry>
  <entry>
    <title>事务-MVCC</title>
    <url>/2022/03/21/%E6%95%B0%E6%8D%AE%E5%BA%93/%E6%95%B0%E6%8D%AE%E5%BA%93%E6%A6%82%E5%BF%B52.0/%E4%BA%8B%E5%8A%A1-MVCC/</url>
    <content><![CDATA[<p>`</p>
<p>参考: <a href="https://juejin.cn/post/7016165148020703246">掘金</a></p>
<h2 id="一、锁"><a href="#一、锁" class="headerlink" title="一、锁"></a>一、锁</h2><h3 id="1-1-行锁"><a href="#1-1-行锁" class="headerlink" title="1.1 行锁"></a>1.1 行锁</h3><p>效率相对较低，但是并发度高</p>
<h4 id="1-1-1-Record-Lock"><a href="#1-1-1-Record-Lock" class="headerlink" title="1.1.1 Record Lock"></a>1.1.1 Record Lock</h4><blockquote>
<p>基本行锁</p>
</blockquote>
<h4 id="1-1-2-Gap-Lock"><a href="#1-1-2-Gap-Lock" class="headerlink" title="1.1.2 Gap Lock"></a>1.1.2 Gap Lock</h4><blockquote>
<p>范围锁，单不包括本身，防止出现幻读</p>
</blockquote>
<h4 id="1-1-3-Next-Key-Lock"><a href="#1-1-3-Next-Key-Lock" class="headerlink" title="1.1.3 Next-Key Lock"></a>1.1.3 Next-Key Lock</h4><blockquote>
<p>临键锁=行锁+间隙锁</p>
</blockquote>
<h3 id="1-2-表锁"><a href="#1-2-表锁" class="headerlink" title="1.2 表锁"></a>1.2 表锁</h3><p>效率高，但是并发度低</p>
<h3 id="1-3-页级锁"><a href="#1-3-页级锁" class="headerlink" title="1.3 页级锁"></a>1.3 页级锁</h3><blockquote>
<p>是表锁和行锁的折中，一次锁住这一页的数据</p>
</blockquote>
<ol>
<li>可能出现死锁</li>
</ol>
<h3 id="1-加锁方式"><a href="#1-加锁方式" class="headerlink" title="1. 加锁方式"></a>1. 加锁方式</h3><h2 id="二、事务"><a href="#二、事务" class="headerlink" title="二、事务"></a>二、事务</h2><blockquote>
<p>C是事务的根本追求数据一致性的破坏主要来自两个方面</p>
<ol>
<li>事务的并发执行    —&gt;  并发控制技术MVCC(也可以用锁,但是锁性能太低)–&gt;undo</li>
<li>事务故障或系统故障   —&gt; 日志恢复技 –&gt;redo</li>
</ol>
</blockquote>
<h3 id="2-1-ACID"><a href="#2-1-ACID" class="headerlink" title="2.1 ACID"></a>2.1 ACID</h3><ol>
<li><p>Atomicity 原子性</p>
<ol>
<li>begin</li>
<li>sql1</li>
<li>sql2</li>
<li>commit</li>
<li>构成逻辑整体的这些数据库操作,要么全部执行成功,要么全部不执行。基于以事务为单位执行</li>
</ol>
</li>
</ol>
<span id="more"></span>

<ol start="2">
<li><p>Consistency一致性：正确性，一个一致性转移到另一个一致性，并且拥有完整性约束。</p>
</li>
<li><p>Isolation隔离性：</p>
<blockquote>
<p>在事务并发执行时，他们内部的操作不能互相干扰，可串行化，即并发执行和串行执行结果一样。因此有了一定的隔离级别。</p>
</blockquote>
</li>
<li><p>Durability持久性：事务一旦提交，其对数据库的更新是永久的。</p>
</li>
</ol>
<table>
<thead>
<tr>
<th>缩写</th>
<th>名称</th>
<th>原理</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>A</td>
<td>原子性</td>
<td>由undo log日志保证，记录了需要回滚的日志(反向操作)</td>
<td></td>
</tr>
<tr>
<td>C</td>
<td>一致性</td>
<td>由其他三大特性保证(数据一致性由数据库保证，业务一致性由程序保证)</td>
<td></td>
</tr>
<tr>
<td>I</td>
<td>隔离性</td>
<td>由MVCC保证—–&gt;隔离级别—-&gt;底层实现是1. 快照+undo log 2. 锁 两种方式</td>
<td></td>
</tr>
<tr>
<td>D</td>
<td>持久性</td>
<td>由内存+redo log保证</td>
<td></td>
</tr>
</tbody></table>
<p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20220320144726900.png" alt="image-20220320144726900"></p>
<h3 id="2-2-MVCC"><a href="#2-2-MVCC" class="headerlink" title="2.2 MVCC"></a>2.2 MVCC</h3><blockquote>
<p><strong>Multi-Version Concurrency Control</strong>  多版本并发控制</p>
<ol>
<li>undo log  –&gt; 版本产生的本因</li>
<li>read view –&gt; 协助字段</li>
</ol>
<p>解决的问题</p>
<ol>
<li>RC</li>
<li>RR</li>
<li>解决幻读需要加锁</li>
</ol>
</blockquote>
<blockquote>
<p>​    最早的数据库系统，只有读读之间可以并发，读写，写读，写写都要阻塞。引入多版本之后，<strong>只有写写之间相互阻塞，其他三种操作都可以并行</strong>，这样大幅度提高了InnoDB的并发度。InnoDB是在undolog中实现的，通过undolog可以找回数据的历史版本。找回的数据历史版本可以提供给用户读(按照隔离级别的定义，有些读请求只能看到比较老的数据版本)，也可以在回滚的时候覆盖数据页上的数据。在InnoDB内部中，会记录一个全局的活跃读写事务数组，其主要用来判断事务的可见性。</p>
</blockquote>
<blockquote>
<p>​    通俗的讲，数据库中同时存在多个版本的数据，并不是整个数据库的多个版本，而是某一条记录的多个版本同时存在，在某个事务对其进行操作的时候，需要查看这一条记录的隐藏列事务版本id，比对事务id并根据事物隔离级别去判断读取哪个版本的数据。</p>
</blockquote>
<h4 id="2-2-1-事务版本号"><a href="#2-2-1-事务版本号" class="headerlink" title="2.2.1 事务版本号"></a>2.2.1 事务版本号</h4><blockquote>
<p>事务每次开启前，都会从数据库获得一个<strong>自增</strong>长的事务ID，可以从事务ID判断事务的执行先后顺序。这就是事务版本号。</p>
</blockquote>
<h4 id="2-2-2-隐式字段"><a href="#2-2-2-隐式字段" class="headerlink" title="2.2.2 隐式字段"></a>2.2.2 隐式字段</h4><blockquote>
<p>对于InnoDB存储引擎，每一行记录都有两个隐藏列<strong>trx_id</strong>、<strong>roll_pointer</strong>，如果表中没有主键和非NULL唯一键时，则还会有第三个隐藏的主键列<strong>row_id</strong></p>
</blockquote>
<table>
<thead>
<tr>
<th>名称</th>
<th>是否必须</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>row_id</td>
<td>否</td>
<td>单调递增的行ID，不是必需的，占用6个字节</td>
</tr>
<tr>
<td>trx_id</td>
<td>是</td>
<td>记录操作该数据事务的事务ID</td>
</tr>
<tr>
<td>roll_pointer</td>
<td>是</td>
<td>这个隐藏列就相当于一个指针，指向回滚段的undo日志</td>
</tr>
</tbody></table>
<h4 id="2-2-3-undo-log"><a href="#2-2-3-undo-log" class="headerlink" title="2.2.3 undo log"></a>2.2.3 undo log</h4><p>回滚日志，用于记录数据被修改前的信息。在表记录修改之前，会先把数据拷贝到undo log里，如果事务回滚，即可以通过undo log来还原数据。可以这样认为，当delete一条记录时，undo log 中会记录一条对应的insert记录，当update一条记录时，它记录一条对应相反的update记录。</p>
<p>undo log有什么<strong>用途</strong>呢？</p>
<ol>
<li>事务回滚时，保证原子性和一致性。</li>
<li>用于MVCC<strong>快照读</strong>。</li>
</ol>
<h4 id="2-2-4-版本链"><a href="#2-2-4-版本链" class="headerlink" title="2.2.4 版本链"></a>2.2.4 版本链</h4><p>多个事务并行操作某一行数据时，不同事务对该行数据的修改会产生多个版本，然后通过回滚指针（roll_pointer），连成一个链表，这个链表就称为<strong>版本链</strong>。</p>
<p>其实，通过版本链，我们就可以看出<strong>事务版本号、表格隐藏的列和undo log</strong>它们之间的关系。</p>
<p>现在开启一个事务A： 对user表执行<code>update core_user set name =&quot;曹操&quot; where id=1</code>,会进行如下流程操作</p>
<ul>
<li>首先获得一个事务ID=100</li>
<li>把core_user表修改前的数据,拷贝到undo log</li>
<li>修改core_user表中，id=1的数据，名字改为曹操</li>
<li>把修改后的数据事务Id=101改成当前事务版本号，并把<strong>roll_pointer</strong>指向undo log数据地址。</li>
</ul>
<h4 id="2-2-5-Read-View"><a href="#2-2-5-Read-View" class="headerlink" title="2.2.5 Read View"></a>2.2.5 Read View</h4><ol>
<li><p>结构</p>
<p><code>m_ids</code>: 一个列表, 存储当前系统活跃的事务id (重点)</p>
<p><code>min_trx_id</code>: 存<code>m_ids</code>的最小值</p>
<p><code>max_trx_id</code>: 系统分配给下一个事务的id</p>
<p><code>creator_trx_id</code>: 生成readView事务的事务id</p>
</li>
<li></li>
</ol>
<h3 id="2-3-事务并发的问题"><a href="#2-3-事务并发的问题" class="headerlink" title="2.3 事务并发的问题"></a>2.3 事务并发的问题</h3><table>
<thead>
<tr>
<th>问题</th>
<th>描述</th>
<th>例子</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>脏读</td>
<td>事务读取了其他事务还没提交的事务</td>
<td>假设现在A的余额是100，事务A正在准备查询Jay的余额 事务B先扣减Jay的余额，扣了10，但是还没提交 最后A读到的余额是90，即扣减后的余额.这时候B撤回了操作就产生了问题</td>
<td></td>
</tr>
<tr>
<td>不可重读</td>
<td>同一个事务内，前后多次读取，读取到的数据内容不一致</td>
<td>事务A先查询Jay的余额，查到结果是100. 这时候事务B 对Jay的账户余额进行扣减，扣去10后，提交事务 事务A再去查询Jay的账户余额发现变成了90</td>
<td></td>
</tr>
<tr>
<td>幻读</td>
<td>如果一个事务先根据某些搜索条件查询出一些记录，在该事务提交前，另一个事务写入了一些符合那些搜索条件的记录（如insert、delete、update），就意味着发生了<strong>幻读</strong>。</td>
<td>事务A先查询id大于2的账户记录，得到记录id=2和id=3的两条记录 这时候，事务B开启，插入一条id=4的记录，并且提交了 事务A再去执行相同的查询，却得到了id=2,3,4的3条记录了。</td>
<td></td>
</tr>
<tr>
<td>丢失更新</td>
<td>2个事务对相同的值进行更改</td>
<td>两个事务对相同的值进行更改，造成了一个更改失败。：a=10   q:a=a-10</td>
<td></td>
</tr>
</tbody></table>
<p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20220320201848647.png" alt="image-20220320201848647"></p>
<h3 id="2-4-隔离级别"><a href="#2-4-隔离级别" class="headerlink" title="2.4 隔离级别"></a>2.4 隔离级别</h3><blockquote>
<p>为了解决并发事务存在的<strong>脏读、不可重复读、幻读</strong>等问题，数据库大叔设计了四种隔离级别。分别是<strong>读未提交，读已提交，可重复读，串行化（Serializable）</strong>。</p>
</blockquote>
<table>
<thead>
<tr>
<th>名称</th>
<th>描述</th>
<th>实现方式</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>读未提交</td>
<td>读未提交隔离级别，只限制了两个数据<strong>不能同时修改</strong>，但是修改数据的时候，即使事务<strong>未提交</strong>，都是可以被别的事务读取到的，这级别的事务隔离有<strong>脏读、重复读、幻读</strong>的问题；</td>
<td></td>
<td></td>
</tr>
<tr>
<td>读已提交</td>
<td>读已提交隔离级别，当前事务只能读取到其他事务<strong>提交</strong>的数据，所以这种事务的隔离级别<strong>解决了脏读</strong>问题，但还是会存在<strong>重复读、幻读</strong>问题；</td>
<td></td>
<td></td>
</tr>
<tr>
<td>可重复读</td>
<td>可重复读隔离级别，限制了读取数据的时候，不可以进行修改，所以<strong>解决了重复读</strong>的问题，但是读取范围数据的时候，是可以插入数据，所以还会存在<strong>幻读</strong>问题；</td>
<td></td>
<td></td>
</tr>
<tr>
<td>串行化</td>
<td>事务最高的隔离级别，在该级别下，所有事务都是进行<strong>串行化顺序</strong>执行的。可以避免脏读、不可重复读与幻读所有并发问题。但是这种事务隔离级别下，事务执行很耗性能。</td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20220320145942607.png" alt="image-20220320145942607"></p>
<h4 id="2-4-隔离级别实现"><a href="#2-4-隔离级别实现" class="headerlink" title="2.4 隔离级别实现"></a>2.4 隔离级别实现</h4><table>
<thead>
<tr>
<th></th>
<th>读</th>
<th>写</th>
</tr>
</thead>
<tbody><tr>
<td>读已提交</td>
<td>当前读</td>
<td>加行锁</td>
</tr>
<tr>
<td>可重复读</td>
<td>MVCC+快照读</td>
<td>有索引就锁索引记录，没有索引就锁表</td>
</tr>
<tr>
<td>串行读</td>
<td>读加共享锁</td>
<td>写加排他锁</td>
</tr>
<tr>
<td></td>
<td></td>
<td>也可以使用MVCC+临键锁</td>
</tr>
</tbody></table>
]]></content>
  </entry>
  <entry>
    <title>数据库调优2</title>
    <url>/2022/04/10/%E6%95%B0%E6%8D%AE%E5%BA%93/%E6%95%B0%E6%8D%AE%E5%BA%93%E6%A6%82%E5%BF%B52.0/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%B0%83%E4%BC%982.0/</url>
    <content><![CDATA[<p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20211223120007692.png" alt="image-20211223120007692"></p>
<h2 id="一、优化维度"><a href="#一、优化维度" class="headerlink" title="一、优化维度"></a>一、优化维度</h2><h3 id="1-1-业务需求"><a href="#1-1-业务需求" class="headerlink" title="1.1 业务需求"></a>1.1 业务需求</h3><ol>
<li>分页减少查询</li>
<li>砍掉不必要的join(用详情代替join)</li>
</ol>
<h3 id="1-2-系统架构"><a href="#1-2-系统架构" class="headerlink" title="1.2  系统架构"></a>1.2  系统架构</h3><ol>
<li>读写分离</li>
<li>分库分表</li>
<li>主从配置</li>
<li>数据库选择,nosql,mysql,orcle,hbase</li>
</ol>
<h3 id="1-3-sql索引"><a href="#1-3-sql索引" class="headerlink" title="1.3 sql索引"></a>1.3 sql索引</h3><h3 id="1-4-表结构"><a href="#1-4-表结构" class="headerlink" title="1.4 表结构"></a>1.4 表结构</h3><h3 id="1-5-数据库配置参数"><a href="#1-5-数据库配置参数" class="headerlink" title="1.5 数据库配置参数"></a>1.5 数据库配置参数</h3><ol>
<li>sort buffer</li>
<li></li>
</ol>
<h3 id="1-6-系统配置"><a href="#1-6-系统配置" class="headerlink" title="1.6 系统配置"></a>1.6 系统配置</h3><h3 id="1-7-硬件"><a href="#1-7-硬件" class="headerlink" title="1.7 硬件"></a>1.7 硬件</h3><h2 id="数据源"><a href="#数据源" class="headerlink" title="数据源"></a>数据源</h2><p>mysq官网–&gt;document–&gt;more–&gt;employee data</p>
<h2 id="二、慢查询与sql分析"><a href="#二、慢查询与sql分析" class="headerlink" title="二、慢查询与sql分析"></a>二、慢查询与sql分析</h2><h3 id="2-1-explain配置参数"><a href="#2-1-explain配置参数" class="headerlink" title="2.1 explain配置参数"></a>2.1 explain配置参数</h3><table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>log_output</td>
<td>慢查询日志文件类型,默认File</td>
<td></td>
</tr>
<tr>
<td>long_query_time</td>
<td>进入日志的最短时间</td>
<td></td>
</tr>
<tr>
<td>slow_query_log_file</td>
<td>日志路径，默认在mysql.slow_log</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h3 id="2-2-修改慢查询参数"><a href="#2-2-修改慢查询参数" class="headerlink" title="2.2 修改慢查询参数"></a>2.2 修改慢查询参数</h3><h4 id="2-2-1-方法1-修改my-conf"><a href="#2-2-1-方法1-修改my-conf" class="headerlink" title="2.2.1 方法1 修改my.conf"></a>2.2.1 方法1 修改my.conf</h4><blockquote>
<p>永久配置，需要重启</p>
</blockquote>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">slow_query_log</span> = <span class="literal">ON</span></span><br><span class="line"><span class="attr">long_query_time</span> = <span class="number">0.1</span></span><br></pre></td></tr></table></figure>

<h4 id="2-2-2-方法2-set-变量"><a href="#2-2-2-方法2-set-变量" class="headerlink" title="2.2.2 方法2 set 变量"></a>2.2.2 方法2 set 变量</h4><blockquote>
<p>一次性，不要重启，但是需要重新连接session</p>
</blockquote>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">set</span> global long_query_time = <span class="number">0</span>.<span class="number">1</span></span><br></pre></td></tr></table></figure>

<h3 id="2-3-explain参数"><a href="#2-3-explain参数" class="headerlink" title="2.3 explain参数"></a>2.3 explain参数</h3><table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>指定父子查询，id大的先执行，如果没有子查询，一般都是1</td>
<td></td>
</tr>
<tr>
<td>select_type</td>
<td>查询类型(父查询，子查询，普通查询，联合查询)</td>
<td></td>
</tr>
<tr>
<td>table</td>
<td>使用的表别名</td>
<td></td>
</tr>
<tr>
<td><strong>type</strong></td>
<td>all: 全表扫描 index:遍历所引述 range:</td>
<td></td>
</tr>
<tr>
<td>ref做分界线</td>
<td>system &gt; const &gt; eq_ref &gt; <strong>[ref]</strong> &gt; fulltext &gt; ref_or_null &gt; index_merge &gt; unique_subquery &gt; index_subquery &gt; range &gt; index &gt; ALL</td>
<td></td>
</tr>
<tr>
<td>possiable_keys</td>
<td>可能使用的索引</td>
<td></td>
</tr>
<tr>
<td>key</td>
<td>实际用的索引</td>
<td></td>
</tr>
<tr>
<td>key_len</td>
<td>当前使用索引的长度</td>
<td></td>
</tr>
<tr>
<td>ref</td>
<td></td>
<td></td>
</tr>
<tr>
<td>rows</td>
<td>需要扫描的行数</td>
<td></td>
</tr>
<tr>
<td>filtered</td>
<td>表示符合条件条数占比</td>
<td></td>
</tr>
<tr>
<td>extra</td>
<td>useTemp 使用临时表，useFileSory 使用文件排序(需要被优化)</td>
<td></td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>名称</th>
<th>描述</th>
<th>例子</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td><strong>查询</strong>时间 &lt; <strong>扫描</strong>时间</td>
<td></td>
</tr>
<tr>
<td><strong>system</strong></td>
<td>查询系统表</td>
<td>select * from mysql.time_zone</td>
</tr>
<tr>
<td>const</td>
<td>where主键索引或唯一索引，且为常量</td>
<td>select * from user where id=1</td>
</tr>
<tr>
<td>eq_ref</td>
<td>用到了唯一索引 数量很多</td>
<td></td>
</tr>
<tr>
<td>ref</td>
<td>用到了不唯一索引，join 索引=外键索引</td>
<td>select * from u1,u2 where u1.name=u2.name</td>
</tr>
<tr>
<td>range</td>
<td>索引范围<strong>查询</strong>，避免了<strong>扫描</strong>索引</td>
<td>select * from user where id &lt; 10</td>
</tr>
<tr>
<td>index</td>
<td>扫描全部索引文件，且不需要回表(<strong>索引覆盖</strong>)</td>
<td>select count(*) from user</td>
</tr>
<tr>
<td>all</td>
<td>没命中索引全表扫描</td>
<td>select * from user where age=10</td>
</tr>
<tr>
<td></td>
<td></td>
<td>select * from user limit 2</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h3 id="2-4-使用profiling分"><a href="#2-4-使用profiling分" class="headerlink" title="2.4 使用profiling分"></a>2.4 使用profiling分</h3><ol>
<li>可以观察一条语句经历了几个阶段</li>
<li>每个阶段消耗的时间</li>
<li>每个阶段占用的内存</li>
</ol>
<h2 id="三、索引"><a href="#三、索引" class="headerlink" title="三、索引"></a>三、索引</h2><h3 id="3-1-索引数据结构"><a href="#3-1-索引数据结构" class="headerlink" title="3.1 索引数据结构"></a>3.1 索引数据结构</h3><h2 id="四、语句优化"><a href="#四、语句优化" class="headerlink" title="四、语句优化"></a>四、语句优化</h2><h2 id="五、mysql存储过程"><a href="#五、mysql存储过程" class="headerlink" title="五、mysql存储过程"></a>五、mysql存储过程</h2><blockquote>
<p>存储例程是存储在数据库服务器中的一组sql语句，通过在查询中调用一个指定的名称来执行这些sql语句命令</p>
</blockquote>
<h3 id="存储过程的优点"><a href="#存储过程的优点" class="headerlink" title="存储过程的优点"></a>存储过程的优点</h3><ol>
<li>减少网络通信量</li>
<li>执行速度更快<ol>
<li>在存储过程创建的时候，数据库已经对其进行了一次解析和优化</li>
<li>存储过程会(备份)保存在内存中</li>
</ol>
</li>
<li>更强的适应性</li>
</ol>
<h3 id="5-1-DELIMITER"><a href="#5-1-DELIMITER" class="headerlink" title="5.1 DELIMITER"></a>5.1 DELIMITER</h3><p> 声明自定义分隔符：DELIMITER //      </p>
<h3 id="5-2-PROCEDURE"><a href="#5-2-PROCEDURE" class="headerlink" title="5.2 PROCEDURE"></a>5.2 PROCEDURE</h3><p>声明存储过程：CREATE PROCEDURE demo_in_parameter(IN p_in int) </p>
<h3 id="5-3-IN、OUT"><a href="#5-3-IN、OUT" class="headerlink" title="5.3 IN、OUT"></a>5.3 IN、OUT</h3><ol>
<li>IN  形式参数</li>
<li>OUT 实际参数(会影响到外面的值)，传入为null</li>
<li>INOUT 输入输出参数:调用时指定，并且可被改变和返回</li>
</ol>
<h3 id="5-4-BEGIN、END"><a href="#5-4-BEGIN、END" class="headerlink" title="5.4 BEGIN、END"></a>5.4 BEGIN、END</h3><p>存储过程开始和结束符号</p>
<h3 id="5-5-SET-p-in-1-变量赋值"><a href="#5-5-SET-p-in-1-变量赋值" class="headerlink" title="5.5 SET @p_in=1 变量赋值"></a>5.5 SET @p_in=1 变量赋值</h3><h4 id="5-5-1-变量声明declare"><a href="#5-5-1-变量声明declare" class="headerlink" title="5.5.1 变量声明declare"></a>5.5.1 变量声明declare</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">declare</span> variable_name  datatype [<span class="keyword">DEFAULT</span> <span class="keyword">value</span>];</span><br></pre></td></tr></table></figure>

<ol>
<li><p>变量类型datatype</p>
<p>int, float, date,varchar(length),datetim</p>
</li>
<li><p>例子</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">DECLARE</span> l_int <span class="type">int</span> unsigned <span class="keyword">default</span> <span class="number">4000000</span>;</span><br><span class="line"><span class="keyword">DECLARE</span> l_numeric number(<span class="number">8</span>,<span class="number">2</span>) <span class="keyword">DEFAULT</span> <span class="number">9.95</span>;  </span><br><span class="line"><span class="keyword">DECLARE</span> l_date <span class="type">date</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;1999-12-31&#x27;</span>;  </span><br><span class="line"><span class="keyword">DECLARE</span> l_datetime datetime <span class="keyword">DEFAULT</span> <span class="string">&#x27;1999-12-31 23:59:59&#x27;</span>;  </span><br><span class="line"><span class="keyword">DECLARE</span> l_varchar <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;This will not be padded&#x27;</span>; </span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="5-5-2-变量赋值set"><a href="#5-5-2-变量赋值set" class="headerlink" title="5.5.2 变量赋值set"></a>5.5.2 变量赋值set</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="variable">@x</span> <span class="operator">=</span> <span class="number">1</span><span class="operator">+</span><span class="number">2</span><span class="operator">+</span><span class="number">3</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;Hello World&#x27;</span> <span class="keyword">into</span> <span class="variable">@x</span>;  </span><br></pre></td></tr></table></figure>

<h3 id="5-6-call-调用存储过程"><a href="#5-6-call-调用存储过程" class="headerlink" title="5.6 call 调用存储过程"></a>5.6 call 调用存储过程</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="number">1.</span> delimiter <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="number">2.</span> <span class="keyword">create</span> <span class="keyword">procedure</span> out_param(<span class="keyword">out</span> p_out <span class="type">int</span>)</span><br><span class="line">     <span class="keyword">begin</span></span><br><span class="line">       <span class="keyword">select</span> p_out;</span><br><span class="line">        <span class="keyword">set</span> p_out<span class="operator">=</span><span class="number">2</span>;</span><br><span class="line">        <span class="keyword">select</span> p_out;</span><br><span class="line">       <span class="keyword">end</span></span><br><span class="line">     <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="number">3.</span> <span class="keyword">set</span> <span class="variable">@p</span>_out<span class="operator">=</span><span class="number">1</span>;</span><br><span class="line"><span class="number">4.</span> <span class="keyword">call</span> out_param(<span class="variable">@p</span>_out);</span><br></pre></td></tr></table></figure>

<h3 id="5-7-条件-case-if-then-else"><a href="#5-7-条件-case-if-then-else" class="headerlink" title="5.7 条件 case-if-then-else"></a>5.7 条件 case-if-then-else</h3><h4 id=""><a href="#" class="headerlink" title=""></a></h4><h3 id="5-8-循环-while-lables"><a href="#5-8-循环-while-lables" class="headerlink" title="5.8 循环 while-lables"></a>5.8 循环 while-lables</h3><h3 id="存储函数"><a href="#存储函数" class="headerlink" title="存储函数"></a>存储函数</h3><p>见附录1.1 </p>
<h2 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h2><h3 id="1-存储函数"><a href="#1-存储函数" class="headerlink" title="1. 存储函数"></a>1. 存储函数</h3><h4 id="1-1-字符串类"><a href="#1-1-字符串类" class="headerlink" title="1.1 字符串类"></a>1.1 字符串类</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">CHARSET(str) <span class="operator">/</span><span class="operator">/</span>返回字串字符集</span><br><span class="line">CONCAT (string2 [,... ]) <span class="operator">/</span><span class="operator">/</span>连接字串</span><br><span class="line">INSTR (string ,substring ) <span class="operator">/</span><span class="operator">/</span>返回substring首次在string中出现的位置,不存在返回<span class="number">0</span></span><br><span class="line">LCASE (string2 ) <span class="operator">/</span><span class="operator">/</span>转换成小写</span><br><span class="line"><span class="keyword">LEFT</span> (string2 ,length ) <span class="operator">/</span><span class="operator">/</span>从string2中的左边起取length个字符</span><br><span class="line">LENGTH (string ) <span class="operator">/</span><span class="operator">/</span>string长度</span><br><span class="line">LOAD_FILE (file_name ) <span class="operator">/</span><span class="operator">/</span>从文件读取内容</span><br><span class="line">LOCATE (substring , string [,start_position ] ) 同INSTR,但可指定开始位置</span><br><span class="line">LPAD (string2 ,length ,pad ) <span class="operator">/</span><span class="operator">/</span>重复用pad加在string开头,直到字串长度为length</span><br><span class="line">LTRIM (string2 ) <span class="operator">/</span><span class="operator">/</span>去除前端空格</span><br><span class="line">REPEAT (string2 ,count ) <span class="operator">/</span><span class="operator">/</span>重复count次</span><br><span class="line">REPLACE (str ,search_str ,replace_str ) <span class="operator">/</span><span class="operator">/</span>在str中用replace_str替换search_str</span><br><span class="line">RPAD (string2 ,length ,pad) <span class="operator">/</span><span class="operator">/</span>在str后用pad补充,直到长度为length</span><br><span class="line">RTRIM (string2 ) <span class="operator">/</span><span class="operator">/</span>去除后端空格</span><br><span class="line">STRCMP (string1 ,string2 ) <span class="operator">/</span><span class="operator">/</span>逐字符比较两字串大小,</span><br><span class="line"><span class="built_in">SUBSTRING</span> (str , position [,length ]) <span class="operator">/</span><span class="operator">/</span>从str的position开始,取length个字符,</span><br><span class="line"><span class="built_in">TRIM</span>([[<span class="keyword">BOTH</span><span class="operator">|</span><span class="keyword">LEADING</span><span class="operator">|</span><span class="keyword">TRAILING</span>][padding] <span class="keyword">FROM</span>]string2) <span class="operator">/</span><span class="operator">/</span>去除指定位置的指定字符</span><br><span class="line">UCASE (string2 ) <span class="operator">/</span><span class="operator">/</span>转换成大写</span><br><span class="line"><span class="keyword">RIGHT</span>(string2,length) <span class="operator">/</span><span class="operator">/</span>取string2最后length个字符</span><br><span class="line">SPACE(count) <span class="operator">/</span><span class="operator">/</span>生成count个空格</span><br></pre></td></tr></table></figure>

<h4 id="1-2-数字类"><a href="#1-2-数字类" class="headerlink" title="1.2 数字类"></a>1.2 数字类</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="built_in">ABS</span> (number2 ) <span class="operator">/</span><span class="operator">/</span>绝对值</span><br><span class="line">BIN (decimal_number ) <span class="operator">/</span><span class="operator">/</span>十进制转二进制</span><br><span class="line"><span class="built_in">CEILING</span> (number2 ) <span class="operator">/</span><span class="operator">/</span>向上取整</span><br><span class="line">CONV(number2,from_base,to_base) <span class="operator">/</span><span class="operator">/</span>进制转换</span><br><span class="line"><span class="built_in">FLOOR</span> (number2 ) <span class="operator">/</span><span class="operator">/</span>向下取整</span><br><span class="line">FORMAT (number,decimal_places ) <span class="operator">/</span><span class="operator">/</span>保留小数位数</span><br><span class="line">HEX (DecimalNumber ) <span class="operator">/</span><span class="operator">/</span>转十六进制</span><br><span class="line">LEAST (number , number2 [,..]) <span class="operator">/</span><span class="operator">/</span>求最小值</span><br><span class="line"><span class="built_in">MOD</span> (numerator ,denominator ) <span class="operator">/</span><span class="operator">/</span>求余</span><br><span class="line"><span class="built_in">POWER</span> (number ,power ) <span class="operator">/</span><span class="operator">/</span>求指数</span><br><span class="line">RAND([seed]) <span class="operator">/</span><span class="operator">/</span>随机数</span><br><span class="line">ROUND (number [,decimals ]) <span class="operator">/</span><span class="operator">/</span>四舍五入,decimals为小数位数]</span><br></pre></td></tr></table></figure>

<h4 id="1-4-日期时间类"><a href="#1-4-日期时间类" class="headerlink" title="1.4 日期时间类"></a>1.4 日期时间类</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">ADDTIME (date2 ,time_interval )<span class="operator">/</span><span class="operator">/</span>将time_interval加到date2</span><br><span class="line">CONVERT_TZ (datetime2 ,fromTZ ,toTZ ) <span class="operator">/</span><span class="operator">/</span>转换时区</span><br><span class="line"><span class="built_in">CURRENT_DATE</span> ( ) <span class="operator">/</span><span class="operator">/</span>当前日期</span><br><span class="line"><span class="built_in">CURRENT_TIME</span> ( ) <span class="operator">/</span><span class="operator">/</span>当前时间</span><br><span class="line"><span class="built_in">CURRENT_TIMESTAMP</span> ( ) <span class="operator">/</span><span class="operator">/</span>当前时间戳</span><br><span class="line"><span class="type">DATE</span> (datetime ) <span class="operator">/</span><span class="operator">/</span>返回datetime的日期部分</span><br><span class="line">DATE_ADD (date2 , <span class="type">INTERVAL</span> d_value d_type ) <span class="operator">/</span><span class="operator">/</span>在date2中加上日期或时间</span><br><span class="line">DATE_FORMAT (datetime ,FormatCodes ) <span class="operator">/</span><span class="operator">/</span>使用formatcodes格式显示datetime</span><br><span class="line">DATE_SUB (date2 , <span class="type">INTERVAL</span> d_value d_type ) <span class="operator">/</span><span class="operator">/</span>在date2上减去一个时间</span><br><span class="line">DATEDIFF (date1 ,date2 ) <span class="operator">/</span><span class="operator">/</span>两个日期差</span><br><span class="line"><span class="keyword">DAY</span> (<span class="type">date</span> ) <span class="operator">/</span><span class="operator">/</span>返回日期的天</span><br><span class="line">DAYNAME (<span class="type">date</span> ) <span class="operator">/</span><span class="operator">/</span>英文星期</span><br><span class="line">DAYOFWEEK (<span class="type">date</span> ) <span class="operator">/</span><span class="operator">/</span>星期(<span class="number">1</span><span class="number">-7</span>) ,<span class="number">1</span>为星期天</span><br><span class="line">DAYOFYEAR (<span class="type">date</span> ) <span class="operator">/</span><span class="operator">/</span>一年中的第几天</span><br><span class="line"><span class="built_in">EXTRACT</span> (interval_name <span class="keyword">FROM</span> <span class="type">date</span> ) <span class="operator">/</span><span class="operator">/</span>从<span class="type">date</span>中提取日期的指定部分</span><br><span class="line">MAKEDATE (<span class="keyword">year</span> ,<span class="keyword">day</span> ) <span class="operator">/</span><span class="operator">/</span>给出年及年中的第几天,生成日期串</span><br><span class="line">MAKETIME (<span class="keyword">hour</span> ,<span class="keyword">minute</span> ,<span class="keyword">second</span> ) <span class="operator">/</span><span class="operator">/</span>生成时间串</span><br><span class="line">MONTHNAME (<span class="type">date</span> ) <span class="operator">/</span><span class="operator">/</span>英文月份名</span><br><span class="line">NOW ( ) <span class="operator">/</span><span class="operator">/</span>当前时间</span><br><span class="line">SEC_TO_TIME (seconds ) <span class="operator">/</span><span class="operator">/</span>秒数转成时间</span><br><span class="line">STR_TO_DATE (string ,format ) <span class="operator">/</span><span class="operator">/</span>字串转成时间,以format格式显示</span><br><span class="line">TIMEDIFF (datetime1 ,datetime2 ) <span class="operator">/</span><span class="operator">/</span>两个时间差</span><br><span class="line">TIME_TO_SEC (<span class="type">time</span> ) <span class="operator">/</span><span class="operator">/</span>时间转秒数]</span><br><span class="line">WEEK (date_time [,start_of_week ]) <span class="operator">/</span><span class="operator">/</span>第几周</span><br><span class="line"><span class="keyword">YEAR</span> (datetime ) <span class="operator">/</span><span class="operator">/</span>年份</span><br><span class="line">DAYOFMONTH(datetime) <span class="operator">/</span><span class="operator">/</span>月的第几天</span><br><span class="line"><span class="keyword">HOUR</span>(datetime) <span class="operator">/</span><span class="operator">/</span>小时</span><br><span class="line">LAST_DAY(<span class="type">date</span>) <span class="operator">/</span><span class="operator">/</span><span class="type">date</span>的月的最后日期</span><br><span class="line">MICROSECOND(datetime) <span class="operator">/</span><span class="operator">/</span>微秒</span><br><span class="line"><span class="keyword">MONTH</span>(datetime) <span class="operator">/</span><span class="operator">/</span>月</span><br><span class="line"><span class="keyword">MINUTE</span>(datetime) <span class="operator">/</span><span class="operator">/</span>分返回符号,正负或<span class="number">0</span></span><br><span class="line"><span class="built_in">SQRT</span>(number2) <span class="operator">/</span><span class="operator">/</span>开平方</span><br></pre></td></tr></table></figure>









]]></content>
      <categories>
        <category>数据库</category>
      </categories>
  </entry>
  <entry>
    <title>ORM框架</title>
    <url>/2022/03/20/%E7%BB%84%E4%BB%B6/ORM/ORM%E6%A1%86%E6%9E%B6/</url>
    <content><![CDATA[<p>[toc]</p>
<h2 id="一、技术发展"><a href="#一、技术发展" class="headerlink" title="一、技术发展"></a>一、技术发展</h2><h3 id="1-1-JDBC–传统的数据库操作"><a href="#1-1-JDBC–传统的数据库操作" class="headerlink" title="1.1 JDBC–传统的数据库操作"></a>1.1 JDBC–传统的数据库操作</h3><blockquote>
<p> 数据库种类太多而产生的一个规范，一种接口</p>
</blockquote>
<h4 id="1-1-1-步骤"><a href="#1-1-1-步骤" class="headerlink" title="1.1.1 步骤"></a>1.1.1 步骤</h4><ol>
<li><p>加载驱动</p>
</li>
<li><p>获得连接conn</p>
</li>
<li><p>创建sql语句</p>
</li>
<li><p>获得报表-</p>
</li>
<li><p>执行的到结果集</p>
</li>
<li><p>while resultSet.next()</p>
<ol>
<li>创建user</li>
<li>setter.getInt</li>
<li>addToList</li>
</ol>
</li>
<li><p>关闭</p>
<span id="more"></span></li>
</ol>
<h4 id="1-1-2-缺陷"><a href="#1-1-2-缺陷" class="headerlink" title="1.1.2 缺陷"></a>1.1.2 缺陷</h4><ol>
<li>操作繁琐<ol>
<li>每次statement</li>
<li>每次取得的数据都要next+new user</li>
<li>表的属性名称繁琐，下划线与驼峰命名的转换</li>
</ol>
</li>
<li>占位符</li>
<li>连接浪费每次都链接—连接池</li>
<li>代码重复</li>
<li>sql硬编码–xml反射</li>
<li>没缓存</li>
</ol>
<h4 id="1-1-3-代码"><a href="#1-1-3-代码" class="headerlink" title="1.1.3 代码"></a>1.1.3 代码</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Class.forName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line">            conn = DriverManager.getConnection(URL, USER, PASSWORD);</span><br><span class="line">             String sql = <span class="string">&quot;select * from student2&quot;</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ps = conn.prepareStatement(sql);</span><br><span class="line">            ResultSet resultSet = ps.executeQuery();</span><br><span class="line">            <span class="keyword">while</span> (resultSet.next()) &#123;</span><br><span class="line">                Student student = <span class="keyword">new</span> Student();</span><br><span class="line">                student.setId(resultSet.getInt(<span class="string">&quot;id&quot;</span>));</span><br><span class="line">                student.setName(resultSet.getString(<span class="string">&quot;name&quot;</span>));</span><br><span class="line">                ScoreCourse scoreCourse = <span class="keyword">new</span> ScoreCourse();</span><br><span class="line">                <span class="keyword">for</span> (String course : Course.getCourses()) &#123;</span><br><span class="line">                    scoreCourse.getScoreCourseMap().put(course, resultSet.getInt(course));</span><br><span class="line">                &#125;</span><br><span class="line">                student.setScoreCourse(scoreCourse);</span><br><span class="line">                res.add(student);</span><br></pre></td></tr></table></figure>



<h3 id="1-2-ORM思想"><a href="#1-2-ORM思想" class="headerlink" title="1.2 ORM思想"></a>1.2 ORM思想</h3><blockquote>
<p>就好像抽掉各个部件的计算机主板，它没有实际作用，但是有许多部件接口，部件被装上后就能使用了</p>
<p>优点：提高开发效率  统一规则，利于团队管理  灵活的配置，利于维护   </p>
</blockquote>
<ol>
<li>两个映射关系<ol>
<li>实体类—表</li>
<li>实体类属性—表字段</li>
</ol>
</li>
<li>封装jdbc，全自动hibernate</li>
</ol>
<h3 id="1-3-JPA"><a href="#1-3-JPA" class="headerlink" title="1.3 JPA"></a>1.3 JPA</h3><ol>
<li>Java对象持久化API</li>
<li>ORM框架太多产生的规范，一种规范</li>
<li>常见<ol>
<li>hebernate</li>
<li>OpenJPA</li>
<li>TopLink</li>
</ol>
</li>
<li>三方面<ol>
<li><strong>ORM映射元数据</strong>： 支持XML和注解两种元数据的形式，元数据描述对象和表之间的映射关系</li>
<li><strong>API</strong>： 操作实体对象来执行CRUD操作</li>
<li><strong>查询语言</strong>： 通过面向对象而非面向数据库的查询语言（<code>JPQL</code>）查询数据，避免程序的SQL语句紧密耦合</li>
</ol>
</li>
</ol>
<h2 id="二、springData-jap"><a href="#二、springData-jap" class="headerlink" title="二、springData-jap"></a>二、<a href="https://spring.io/projects/spring-data-jpa#overview">springData-jap</a></h2><ol>
<li><p>依赖-配置</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">jpa:</span></span><br><span class="line">    <span class="attr">database:</span> <span class="string">MySQL</span></span><br><span class="line">    <span class="attr">database-platform:</span> <span class="string">org.hibernate.dialect.MySQL5InnoDBDialect</span></span><br><span class="line">    <span class="attr">show-sql:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">hibernate:</span></span><br><span class="line">      <span class="attr">ddl-auto:</span> <span class="string">update</span></span><br></pre></td></tr></table></figure>

<p>参数:</p>
<ol>
<li><code>create</code>：每次运行程序时，都会重新创建表，故而数据会丢失</li>
<li><code>create-drop</code>：每次运行程序时会先创建表结构，然后待程序结束时清空表</li>
<li><code>upadte</code>：每次运行程序，没有表时会创建表，如果对象发生改变会更新表结构，原有数据不会清空，只会更新（推荐使用）</li>
<li><code>validate</code>：运行程序会校验数据与数据库的字段类型是否相同，字段不同会报错</li>
<li><code>none</code>: 禁用DDL处理</li>
<li>show-sql：打印sql语句，方便调试</li>
</ol>
</li>
<li><p>uml图</p>
<p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20211009005723461.png" alt="image-20211009005723461"></p>
<ol>
<li>Repository：最顶层的接口，是一个空的接口，目的是为了统一所有Repository的类型，且能让组件扫描的时候自动识别。Repository&lt;T, ID&gt;使用泛型定义的实体类类型和主健类型。</li>
<li>CrudRepository ：是Repository的子接口，提供CRUD的功能,有哪些接口看API，默认是很简单的CRUD操作。</li>
<li>PagingAndSortingRepository：是CrudRepository的子接口，添加分页和排序的功能，很少使用。</li>
<li>JpaRepository：是PagingAndSortingRepository的子接口，增加了一些实用的功能，比如：批量操作等。如果有分页操作，一般继承这个类。</li>
<li>JpaSpecificationExecutor：用来做负责查询的接口</li>
<li>Specification：是Spring Data JPA提供的一个查询规范，要做复杂的查询，只需围绕这个规范来设置查询条件即可</li>
</ol>
</li>
<li><p>细节</p>
<ol>
<li><p>entity</p>
<p>@entity @table  @id @Column</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@GenericGenerator(name = &quot;idGenerator&quot;, strategy = &quot;uuid&quot;)</span></span><br><span class="line"><span class="meta">@GeneratedValue(generator = &quot;idGenerator&quot;)</span></span><br></pre></td></tr></table></figure></li>
<li><p>dao</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserRepository</span> <span class="keyword">extends</span> <span class="title">JpaRepository</span>&lt;<span class="title">User</span>, <span class="title">String</span>&gt; </span>&#123;&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>controller</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> UserRepository userRepository;</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ol>
]]></content>
      <categories>
        <category>组件</category>
      </categories>
  </entry>
  <entry>
    <title>DDL数据库定义语言</title>
    <url>/2022/02/08/%E6%95%B0%E6%8D%AE%E5%BA%93/sql/DDL/</url>
    <content><![CDATA[<p>[TOC]</p>
<h2 id="一、创建"><a href="#一、创建" class="headerlink" title="一、创建"></a>一、创建</h2><h3 id="1-1-库"><a href="#1-1-库" class="headerlink" title="1.1 库"></a>1.1 库</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> database a <span class="keyword">default</span> <span class="type">character</span> <span class="keyword">set</span> utf8mb4 <span class="keyword">collate</span> utf8mb4_unicode_ci;</span><br></pre></td></tr></table></figure>

<h3 id="1-2-表"><a href="#1-2-表" class="headerlink" title="1.2 表"></a>1.2 表</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Persons(</span><br><span class="line">    id <span class="type">int</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">	name <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">	city <span class="type">varchar</span>(<span class="number">255</span>),</span><br><span class="line">	<span class="keyword">PRIMARY</span> KEY (ID)	</span><br><span class="line">)ENGINE<span class="operator">=</span>INNODB  <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> test (name <span class="type">varchar</span>(<span class="number">20</span>),age <span class="type">int</span>(<span class="number">2</span>) <span class="keyword">PRIMARY</span> key auto_increment) auto_increment<span class="operator">=</span><span class="number">2</span> ;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> test (name <span class="type">varchar</span>(<span class="number">20</span>),age <span class="type">int</span>(<span class="number">2</span>)  auto_increment ,<span class="keyword">unique</span>(age) ,key(name));</span><br></pre></td></tr></table></figure>



<span id="more"></span>

<h2 id="二、约束"><a href="#二、约束" class="headerlink" title="二、约束"></a>二、约束</h2><ol>
<li><p>不为空 not null </p>
</li>
<li><p>default ‘xx’ </p>
</li>
<li><p>自增 auto_increment</p>
<ol>
<li><p>放在字段后面</p>
</li>
<li><p>每个表只能有一个</p>
</li>
<li><p>这个必须是unique或者primary key</p>
</li>
<li><p>设置起始值 AUTO_INCREMENT=100   </p>
<p>auto_increment</p>
</li>
</ol>
</li>
<li><p>唯一键  unique </p>
<ol>
<li>可以放在最后unique(name)，也能放在字段后面 name char(20) unique</li>
<li>不同厂商不同处理，mysql唯一多个NULL</li>
</ol>
</li>
<li><p>主键 primary key(id)  <!--放最后--></p>
</li>
<li><p>foreign key <!--放最后--><!-- foreign key (name1) references table2(name2)--></p>
</li>
<li><p>枚举 color enum(‘blue’,’green’,’red’) DEFAULT NULL <!--这种的底层索引是1,2,3，节省了内存但是灵活性差，每次增加都要修改表，数值字段别用枚举，容易混淆他的索引和真实值--></p>
<!--传入的值是blue,存进的是1,2,3,选出的也是blue--></li>
</ol>
<h2 id="三、属性类型约束"><a href="#三、属性类型约束" class="headerlink" title="三、属性类型约束"></a>三、属性类型约束</h2><h4 id="3-1字符"><a href="#3-1字符" class="headerlink" title="3.1字符"></a>3.1字符</h4><h4 id="3-2数字"><a href="#3-2数字" class="headerlink" title="3.2数字"></a>3.2数字</h4><pre><code>##### 3.21整数
</code></pre>
<ol>
<li>tinyint </li>
<li>smallint</li>
<li>mediumint </li>
<li>int</li>
<li>integer</li>
<li>bigint</li>
<li>long </li>
</ol>
<h5 id="3-22小数"><a href="#3-22小数" class="headerlink" title="3.22小数"></a>3.22小数</h5><ol>
<li>decimal </li>
<li>float</li>
<li>(丢失数据因为0.2=1/8+1/16…所以一般用decimal) </li>
</ol>
<h4 id="3-3时间"><a href="#3-3时间" class="headerlink" title="3.3时间"></a>3.3时间</h4><ol>
<li>date 3</li>
<li>time 3</li>
<li>year 1</li>
<li>datetime 8</li>
<li> timestamp 4</li>
</ol>
<h2 id="四、索引"><a href="#四、索引" class="headerlink" title="四、索引"></a>四、索引</h2><ol>
<li>create index 索引名 on 表名(字段名 desc); 降序</li>
<li>create index 索引名 on 表名(字段名 asc); 升序</li>
<li>create table name{ ,,, index index_name(列)}</li>
<li>show index from name 查看索引</li>
<li>drop index index_name on name</li>
<li>alter table name drop index index_name</li>
<li>主键、外键会自动创建索引</li>
</ol>
]]></content>
      <categories>
        <category>数据库</category>
        <category>sql语句</category>
      </categories>
  </entry>
  <entry>
    <title>数据库连接过程</title>
    <url>/2021/12/13/%E7%BB%84%E4%BB%B6/ORM/jdbc-mybatis-druid/</url>
    <content><![CDATA[<p>[toc]</p>
<h2 id="一、JDBC"><a href="#一、JDBC" class="headerlink" title="一、JDBC"></a>一、JDBC</h2><p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20211107122656442.png" alt="image-20211107122656442"></p>
<h3 id="1-1代码"><a href="#1-1代码" class="headerlink" title="1.1代码"></a>1.1代码</h3><ol>
<li><p>创建连接</p>
<span id="more"></span>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Class.forName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);   <span class="comment">//加载驱动</span></span><br><span class="line">String url=<span class="string">&quot;jdbc:mysql://localhost:3306/testnewuser=root&amp;password=sa&amp;userUnicode=true&amp;characterEncoding=UTF8&quot;</span>;</span><br><span class="line">con = (Connection) DriverManager.getConnection(url,username,password)<span class="comment">//创建连接</span></span><br><span class="line">Statement s = c.createStatement();</span><br><span class="line">String sql = <span class="string">&quot;insert into hero values(null,&quot;</span>+<span class="string">&quot;&#x27;提莫&#x27;&quot;</span>+<span class="string">&quot;,&quot;</span>+<span class="number">313.0f</span>+<span class="string">&quot;,&quot;</span>+<span class="number">50</span>+<span class="string">&quot;)&quot;</span>;</span><br><span class="line">s.execute(sql);</span><br></pre></td></tr></table></figure></li>
<li><p>优化的Statement</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String sql=”.....”;<span class="comment">//PrepareStatement创建时直接指定sql对象</span></span><br><span class="line">PrepareStatement pstmt= conn.PrepareStatement(sql);</span><br><span class="line"><span class="comment">//PrepareStatement也有executeQuery，excuteUpdate方法，但是不带参数，因为创建PrepareStatement对象时候，conn.PrepareStatement(sql)方法已经指定sql语句。</span></span><br><span class="line">String sql = <span class="string">&quot;insert into hero values(null,?,?,?)&quot;</span>;</span><br><span class="line">PreparedStatement ps = c.prepareStatement(sql);<span class="comment">//此时会预编译</span></span><br><span class="line">ps.setString(<span class="number">1</span>, <span class="string">&quot;提莫&quot;</span>);</span><br><span class="line">ps.setFloat(<span class="number">2</span>, <span class="number">313.0f</span>);</span><br><span class="line">ps.setInt(<span class="number">3</span>, <span class="number">50</span>);</span><br><span class="line">ps.execute();</span><br></pre></td></tr></table></figure></li>
<li><p>执行方法</p>
<ol>
<li><p>executeQuery</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function">ResultSet <span class="title">executeQuery</span><span class="params">(String sql)</span><span class="comment">//执行select，返回结果集</span></span></span><br></pre></td></tr></table></figure></li>
<li><p>executeUpdate</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function">Int <span class="title">excuteUpdate</span><span class="params">(String sql)</span><span class="comment">//执行update，insert,delete，create返回一个整数</span></span></span><br></pre></td></tr></table></figure></li>
<li><p>execute</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">execute≈executeQuery+executeUpdate</span><br></pre></td></tr></table></figure>

<ul>
<li>不同1：<br>execute<strong>可以执行查询语句</strong><br>然后通过getResultSet，把结果集取出来<br>executeUpdate<strong>不能执行查询语句</strong></li>
<li>不同2:<br>execute<strong>返回boolean类型</strong>，true表示执行的是查询语句，false表示执行的是insert,delete,update等等<br>executeUpdate<strong>返回的是int</strong>，表示有多少条数据受到了影响</li>
</ul>
<p>代码比较复制代码</p>
</li>
<li><p>Batch</p>
</li>
</ol>
</li>
<li><p>结果</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ResultSet rs = s.getResultSet();</span><br><span class="line"><span class="keyword">while</span> (rs.next()) &#123;</span><br><span class="line">System.out.println(rs.getInt(<span class="string">&quot;id&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="1-2-Statement-PreparedStatement-CallableStatement"><a href="#1-2-Statement-PreparedStatement-CallableStatement" class="headerlink" title="1.2 Statement.PreparedStatement.CallableStatement"></a>1.2 Statement.PreparedStatement.CallableStatement</h3><p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20211107113334671.png" alt="image-20211107113334671"></p>
<ol start="2">
<li><a href="https://www.cnblogs.com/noteless/p/10307273.html">区别与联系</a><ul>
<li>Statement接口提供了执行语句和获取结果的基本方法；<ul>
<li>普通的不带参的查询SQL</li>
<li>不会预编译</li>
</ul>
</li>
<li>PreparedStatement接口添加了处理输入参数的方法；<ul>
<li>支持可变参数的SQL</li>
<li>性能快，尤其是执行多次相同的语句，因为已经预编译好了，就差参数了</li>
<li>防止注入攻击原理：参数加引号</li>
<li>会预编译</li>
</ul>
</li>
<li>CallableStatement接口添加了调用存储过程核函数以及处理输出参数的方法。<ul>
<li>支持调用存储过程,提供了对输出和输入/输出参数(INOUT)的支持</li>
</ul>
</li>
</ul>
</li>
</ol>
<h3 id="1-3-事务"><a href="#1-3-事务" class="headerlink" title="1.3 事务"></a>1.3 事务</h3><ol>
<li><p>代码</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">c.setAutoCommit(<span class="keyword">false</span>);</span><br><span class="line">String sql1 = <span class="string">&quot;update hero set hp = hp +1 where id = 22&quot;</span>;</span><br><span class="line">s.execute(sql1);</span><br><span class="line">String sql2 = <span class="string">&quot;updata hero set hp = hp -1 where id = 22&quot;</span>;</span><br><span class="line">s.execute(sql2);</span><br><span class="line"><span class="comment">// 手动提交,要么都成功，要么都失败</span></span><br><span class="line">c.commit() or c.rollback()</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="1-4-数据库连接池"><a href="#1-4-数据库连接池" class="headerlink" title="1.4 数据库连接池"></a>1.4 数据库连接池</h3><p>​    每个线程都需要连接数据库执行SQL语句，每个线程都会创建一个连接，并且在使用完毕后，关闭连接。创建连接和关闭连接的过程也是很消耗资源的。同时，一个数据库同时支持的连接总数也是有限的，如果多线程并发量很大，那么数据库连接的总数就被消耗光，后续线程发起的数据库连接就会失败。</p>
<blockquote>
<p>​    连接池在使用之前，就会创建好一定数量的连接。如果有任何线程需要使用连接，那么就从连接池里面借用，而不是自己重新创建。使用完毕后，又把这个连接归还给连接池供下一次或者其他线程使用。倘若发生多线程并发情况，连接池里的连接被借用光了，那么其他线程就会临时等待，直到有连接被归还回来，再继续使用。整个过程，这些连接都不会被关闭，而是不断的被循环使用，从而节约了启动和关闭连接的时间。</p>
</blockquote>
<ol>
<li><p>druid配置</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">driverClassName</span>=<span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="attr">url</span>=<span class="string">jdbc:mysql://127.0.0.1:3306/db</span></span><br><span class="line"><span class="attr">username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">password</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">initialSize</span>=<span class="string">5</span></span><br><span class="line"><span class="attr">maxActive</span>=<span class="string">10</span></span><br><span class="line"><span class="attr">maxWait</span>=<span class="string">3000</span></span><br><span class="line"><span class="attr">minIdle</span>=<span class="string">3  # 最小连接池数量</span></span><br></pre></td></tr></table></figure></li>
<li><p>连接池</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Properties prop = <span class="keyword">new</span> Properties();</span><br><span class="line">InputStream is = DruidDemo.class.getClassLoader().getResourceAsStream(<span class="string">&quot;mydruid.properties&quot;</span>);</span><br><span class="line">prop.load(is);</span><br><span class="line"><span class="comment">//druid工厂根据配置文件创建druid连接池对象</span></span><br><span class="line">DataSource dataSource = DruidDataSourceFactory.createDataSource(prop);</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="1-5-JdbcUtils"><a href="#1-5-JdbcUtils" class="headerlink" title="1.5 JdbcUtils"></a>1.5 JdbcUtils</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdbcUtils</span> </span>&#123;</span><br><span class="line">    <span class="comment">//声明配置信息</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String driver;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String url;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String username;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String password;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Connection con;</span><br><span class="line">    <span class="comment">//静态代码块,类加载时解析配置信息</span></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            InputStreamReader is = <span class="keyword">new</span> InputStreamReader</span><br><span class="line">                (JdbcUtils.class.getResourceAsStream(<span class="string">&quot;/jdbc.properties&quot;</span>));</span><br><span class="line">            Properties properties = <span class="keyword">new</span> Properties();</span><br><span class="line">            properties.load(is);</span><br><span class="line">            driver = properties.getProperty(<span class="string">&quot;jdbc.driver&quot;</span>).trim();</span><br><span class="line">            url = properties.getProperty(<span class="string">&quot;jdbc.url&quot;</span>).trim();</span><br><span class="line">            username = properties.getProperty(<span class="string">&quot;jdbc.username&quot;</span>).trim();  </span><br><span class="line">            password = properties.getProperty(<span class="string">&quot;jdbc.password&quot;</span>).trim();</span><br><span class="line">            <span class="comment">//加载驱动获取连接</span></span><br><span class="line">            Class.forName(driver);</span><br><span class="line">            con =  DriverManager.getConnection(url, username, password);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 获取数据库连接（如果连接关闭则重新创建）</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Connection <span class="title">getConnection</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (con.isClosed()) &#123;</span><br><span class="line">                con =  DriverManager.getConnection(</span><br><span class="line">                    url,username,password);</span><br><span class="line">                <span class="keyword">return</span> con;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> con;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 关闭资源（有结果集）</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">(ResultSet rs, Statement s, </span></span></span><br><span class="line"><span class="params"><span class="function">                             Connection con)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (rs != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                rs.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (s != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                s.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (con != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                con.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 关闭资源（无结果集）</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">(Statement s, Connection con)</span> </span>&#123;</span><br><span class="line">        close(<span class="keyword">null</span>, s, con);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-6-DruidUtils"><a href="#1-6-DruidUtils" class="headerlink" title="1.6 DruidUtils"></a>1.6 DruidUtils</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> DataSource dataSource;</span><br><span class="line"> <span class="keyword">static</span>&#123;</span><br><span class="line">     <span class="keyword">try</span> &#123;</span><br><span class="line">         <span class="comment">// 解析druid的配置文件</span></span><br><span class="line">         Properties prop = <span class="keyword">new</span> Properties();</span><br><span class="line">         InputStream is = JDBCUtil.class.getClassLoader().</span><br><span class="line">             getResourceAsStream(<span class="string">&quot;druid.properties&quot;</span>);</span><br><span class="line">         prop.load(is);</span><br><span class="line">         <span class="comment">// druid工厂使用配置文件创建druid连接池对象</span></span><br><span class="line">         dataSource = DruidDataSourceFactory.createDataSource(prop);</span><br><span class="line">     &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">         e.printStackTrace();</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="comment">//获取druid连接池</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> DataSource <span class="title">getDataSource</span><span class="params">()</span></span>&#123;</span><br><span class="line">     <span class="keyword">return</span> dataSource;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="comment">//获取druid连接池中的连接</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Connection <span class="title">getConnection</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">     <span class="keyword">return</span> dataSource.getConnection();</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="comment">//释放资源(归还连接)</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">(ResultSet rs, Statement st,Connection conn)</span> </span>&#123;</span><br><span class="line">     <span class="keyword">if</span>(rs!=<span class="keyword">null</span>)&#123;</span><br><span class="line">         <span class="keyword">try</span> &#123;</span><br><span class="line">             rs.close();</span><br><span class="line">         &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">             e.printStackTrace();</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">if</span>(st!=<span class="keyword">null</span>)&#123;</span><br><span class="line">         <span class="keyword">try</span> &#123;</span><br><span class="line">             st.close();</span><br><span class="line">         &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">             e.printStackTrace();</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">if</span>(conn!=<span class="keyword">null</span>)&#123;</span><br><span class="line">         <span class="keyword">try</span> &#123;</span><br><span class="line">             conn.close();</span><br><span class="line">         &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">             e.printStackTrace();</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">(Statement st,Connection conn)</span> </span>&#123;</span><br><span class="line">     close(<span class="keyword">null</span>,st,conn);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>数据库</category>
      </categories>
  </entry>
  <entry>
    <title>redisTemplata</title>
    <url>/2022/03/30/%E7%BB%84%E4%BB%B6/ORM/redisTemplate/</url>
    <content><![CDATA[<p>[toc]</p>
<p><a href="https://blog.csdn.net/lydms/article/details/105224210">参考-原文</a></p>
<h2 id="一、简介"><a href="#一、简介" class="headerlink" title="一、简介"></a>一、简介</h2><h3 id="1-1-Redis"><a href="#1-1-Redis" class="headerlink" title="1.1 Redis"></a>1.1 Redis</h3><p>​    redis是一款开源的Key-Value数据库，运行在内存中，由C语言编写。企业开发通常采用Redis来实现缓存。同类的产品还有memcache 、memcached 等。</p>
<h3 id="1-2-Jedis"><a href="#1-2-Jedis" class="headerlink" title="1.2 Jedis"></a>1.2 Jedis</h3><p>​    Jedis是Redis官方推出的一款面向Java的客户端，提供了很多接口供Java语言调用。可以在Redis官网下载，当然还有一些开源爱好者提供的客户端，如Jredis、SRP等等，推荐使用Jedis。</p>
<h3 id="1-3-Spring-Data-Redis"><a href="#1-3-Spring-Data-Redis" class="headerlink" title="1.3 Spring Data Redis"></a>1.3 Spring Data Redis</h3><p>​    Spring-data-redis是spring大家族的一部分，提供了在srping应用中通过简单的配置访问redis服务，对reids底层开发包(Jedis, JRedis, and RJC)进行了高度封装，RedisTemplate提供了redis各种操作、异常处理及序列化，支持发布订阅，并对spring 3.1 cache进行了实现。</p>
<h3 id="1-4-spring-data-redis针对jedis提供了如下功能："><a href="#1-4-spring-data-redis针对jedis提供了如下功能：" class="headerlink" title="1.4 spring-data-redis针对jedis提供了如下功能："></a>1.4 spring-data-redis针对jedis提供了如下功能：</h3><ol>
<li>连接池自动管理，提供了一个高度封装的“RedisTemplate”类</li>
<li>针对jedis客户端中大量api进行了归类封装,将同一类型操作封装为operation接口<ol>
<li>ValueOperations：简单K-V操作</li>
<li>SetOperations：set类型数据操作</li>
<li>ZSetOperations：zset类型数据操作</li>
<li>HashOperations：针对map类型的数据操作</li>
<li>ListOperations：针对list类型的数据操作</li>
</ol>
</li>
<li>提供了对key的“bound”(绑定)便捷化操作API，可以通过bound封装指定的key，然后进行一系列的操作而无须“显式”的再次指定Key，即BoundKeyOperations：<ul>
<li>BoundValueOperations</li>
<li>BoundSetOperations</li>
<li>BoundListOperations</li>
<li>BoundSetOperations</li>
<li>BoundHashOperations</li>
</ul>
</li>
<li>将事务操作封装，有容器控制。</li>
<li>针对数据的“序列化/反序列化”，提供了多种可选择策略(RedisSerializer)</li>
</ol>
<h3 id="1-5-三大类型"><a href="#1-5-三大类型" class="headerlink" title="1.5 三大类型"></a>1.5 三大类型</h3><h4 id="1-5-1-JdkSerializationRedisSerializer"><a href="#1-5-1-JdkSerializationRedisSerializer" class="headerlink" title="1.5.1 JdkSerializationRedisSerializer"></a>1.5.1 JdkSerializationRedisSerializer</h4><blockquote>
<p>​    POJO对象的存取场景，使用JDK本身序列化机制，将pojo类通过ObjectInputStream/ObjectOutputStream进行序列化操作，最终redis-server中将存储字节序列。是目前最常用的序列化策略。</p>
</blockquote>
<h4 id="1-5-2-StringRedisSerializer"><a href="#1-5-2-StringRedisSerializer" class="headerlink" title="1.5.2 StringRedisSerializer"></a>1.5.2 StringRedisSerializer</h4><blockquote>
<p>​    Key或者value为字符串的场景，根据指定的charset对数据的字节序列编码成string，是“new String(bytes, charset)”和“string.getBytes(charset)”的直接封装。是最轻量级和高效的策略。</p>
</blockquote>
<h4 id="JacksonJsonRedisSerializer"><a href="#JacksonJsonRedisSerializer" class="headerlink" title="JacksonJsonRedisSerializer"></a>JacksonJsonRedisSerializer</h4><blockquote>
<p>​    jackson-json工具提供了javabean与json之间的转换能力，可以将pojo实例序列化成json格式存储在redis中，也可以将json格式的数据转换成pojo实例。因为jackson工具在序列化和反序列化时，需要明确指定Class类型，因此此策略封装起来稍微复杂。【需要jackson-mapper-asl工具支持】</p>
</blockquote>
<h2 id="二、API"><a href="#二、API" class="headerlink" title="二、API"></a>二、API</h2><h3 id="2-1-直接用法"><a href="#2-1-直接用法" class="headerlink" title="2.1 直接用法"></a>2.1 直接用法</h3><ol>
<li><p>删除单个key   redisTemplate.delete(key);</p>
</li>
<li><p>删除多个key   redisTemplate.delete(keys);</p>
</li>
<li><p>指定key的失效时间</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">expire</span><span class="params">(String key,<span class="keyword">long</span> time)</span></span>&#123;</span><br><span class="line">    redisTemplate.expire(key,time,TimeUnit.MINUTES);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>根据key获取过期时间  Long expire = redisTemplate.getExpire(key);</p>
</li>
<li><p>判断key是否存在  redisTemplate.hasKey(key);</p>
</li>
</ol>
<h3 id="2-2-String"><a href="#2-2-String" class="headerlink" title="2.2 String"></a>2.2 String</h3><ol>
<li><p>添加缓存（2/3是1的递进值）</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//1、通过redisTemplate设置值</span></span><br><span class="line">redisTemplate.boundValueOps(<span class="string">&quot;StringKey&quot;</span>).set(<span class="string">&quot;StringValue&quot;</span>);</span><br><span class="line">redisTemplate.boundValueOps(<span class="string">&quot;StringKey&quot;</span>).set(<span class="string">&quot;StringValue&quot;</span>,<span class="number">1</span>, TimeUnit.MINUTES);</span><br><span class="line"><span class="comment">//2、通过BoundValueOperations设置值</span></span><br><span class="line">BoundValueOperations stringKey = redisTemplate.boundValueOps(<span class="string">&quot;StringKey&quot;</span>);</span><br><span class="line">stringKey.set(<span class="string">&quot;StringVaule&quot;</span>);</span><br><span class="line">stringKey.set(<span class="string">&quot;StringValue&quot;</span>,<span class="number">1</span>, TimeUnit.MINUTES);</span><br><span class="line"><span class="comment">//3、通过ValueOperations设置值</span></span><br><span class="line">ValueOperations ops = redisTemplate.opsForValue();</span><br><span class="line">ops.set(<span class="string">&quot;StringKey&quot;</span>, <span class="string">&quot;StringVaule&quot;</span>);</span><br><span class="line">ops.set(<span class="string">&quot;StringValue&quot;</span>,<span class="string">&quot;StringVaule&quot;</span>,<span class="number">1</span>, TimeUnit.MINUTES);</span><br></pre></td></tr></table></figure></li>
<li><p>设置过期时间(单独设置)<br>redisTemplate.boundValueOps(“StringKey”).expire(1,TimeUnit.MINUTES);<br>redisTemplate.expire(“StringKey”,1,TimeUnit.MINUTES);</p>
</li>
<li><p>获取缓存值（2/3是1的递进值）</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//1、通过redisTemplate设置值</span></span><br><span class="line">String str1 = (String) redisTemplate.boundValueOps(<span class="string">&quot;StringKey&quot;</span>).get();</span><br><span class="line"><span class="comment">//2、通过BoundValueOperations获取值</span></span><br><span class="line">BoundValueOperations stringKey = redisTemplate.boundValueOps(<span class="string">&quot;StringKey&quot;</span>);</span><br><span class="line">String str2 = (String) stringKey.get();</span><br><span class="line"><span class="comment">//3、通过ValueOperations获取值</span></span><br><span class="line">ValueOperations ops = redisTemplate.opsForValue();</span><br><span class="line">String str3 = (String) ops.get(<span class="string">&quot;StringKey&quot;</span>);</span><br></pre></td></tr></table></figure></li>
<li><p>删除key  Boolean result = redisTemplate.delete(“StringKey”)</p>
</li>
<li><p>顺序递增   redisTemplate.boundValueOps(“StringKey”).increment(3L);</p>
</li>
<li><p>顺序递减   redisTemplate.boundValueOps(“StringKey”).increment(-3L);</p>
</li>
</ol>
<h3 id="2-3-Hash"><a href="#2-3-Hash" class="headerlink" title="2.3 Hash"></a>2.3 Hash</h3><ol>
<li><p>添加缓存（2/3是1的递进值）</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//1、通过redisTemplate设置值</span></span><br><span class="line">redisTemplate.boundHashOps(<span class="string">&quot;HashKey&quot;</span>).put(<span class="string">&quot;SmallKey&quot;</span>, <span class="string">&quot;HashVaue&quot;</span>);</span><br><span class="line"><span class="comment">//2、通过BoundValueOperations设置值</span></span><br><span class="line">BoundHashOperations hashKey = redisTemplate.boundHashOps(<span class="string">&quot;HashKey&quot;</span>);</span><br><span class="line">hashKey.put(<span class="string">&quot;SmallKey&quot;</span>, <span class="string">&quot;HashVaue&quot;</span>);</span><br><span class="line"><span class="comment">//3、通过ValueOperations设置值</span></span><br><span class="line">HashOperations hashOps = redisTemplate.opsForHash();</span><br><span class="line">hashOps.put(<span class="string">&quot;HashKey&quot;</span>, <span class="string">&quot;SmallKey&quot;</span>, <span class="string">&quot;HashVaue&quot;</span>);</span><br></pre></td></tr></table></figure></li>
<li><p>设置过期时间(单独设置)<br>redisTemplate.boundValueOps(“HashKey”).expire(1,TimeUnit.MINUTES);<br>redisTemplate.expire(“HashKey”,1,TimeUnit.MINUTES);</p>
</li>
<li><p>添加一个Map集合<br>HashMap&lt;String, String&gt; hashMap = new HashMap&lt;&gt;();<br>redisTemplate.boundHashOps(“HashKey”).putAll(hashMap );</p>
</li>
<li><p>设置过期时间(单独设置)<br>redisTemplate.boundValueOps(“HashKey”).expire(1,TimeUnit.MINUTES);<br>redisTemplate.expire(“HashKey”,1,TimeUnit.MINUTES);</p>
</li>
<li><p>提取所有的小key</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//1、通过redisTemplate获取值</span></span><br><span class="line">Set keys1 = redisTemplate.boundHashOps(<span class="string">&quot;HashKey&quot;</span>).keys();</span><br><span class="line"><span class="comment">//2、通过BoundValueOperations获取值</span></span><br><span class="line">BoundHashOperations hashKey = redisTemplate.boundHashOps(<span class="string">&quot;HashKey&quot;</span>);</span><br><span class="line">Set keys2 = hashKey.keys();</span><br><span class="line"><span class="comment">//3、通过ValueOperations获取值</span></span><br><span class="line">HashOperations hashOps = redisTemplate.opsForHash();</span><br><span class="line">Set keys3 = hashOps.keys(<span class="string">&quot;HashKey&quot;</span>);</span><br></pre></td></tr></table></figure></li>
<li><p>提取所有的value值</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//1、通过redisTemplate获取值</span></span><br><span class="line">List values1 = redisTemplate.boundHashOps(<span class="string">&quot;HashKey&quot;</span>).values();</span><br><span class="line"><span class="comment">//2、通过BoundValueOperations获取值</span></span><br><span class="line">BoundHashOperations hashKey = redisTemplate.boundHashOps(<span class="string">&quot;HashKey&quot;</span>);</span><br><span class="line">List values2 = hashKey.values();</span><br><span class="line"><span class="comment">//3、通过ValueOperations获取值</span></span><br><span class="line">HashOperations hashOps = redisTemplate.opsForHash();</span><br><span class="line">List values3 = hashOps.values(<span class="string">&quot;HashKey&quot;</span>);</span><br></pre></td></tr></table></figure></li>
<li><p>根据key提取value值</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//1、通过redisTemplate获取</span></span><br><span class="line">String value1 = (String) redisTemplate.boundHashOps(<span class="string">&quot;HashKey&quot;</span>).get(<span class="string">&quot;SmallKey&quot;</span>);</span><br><span class="line"><span class="comment">//2、通过BoundValueOperations获取值</span></span><br><span class="line">BoundHashOperations hashKey = redisTemplate.boundHashOps(<span class="string">&quot;HashKey&quot;</span>);</span><br><span class="line">String value2 = (String) hashKey.get(<span class="string">&quot;SmallKey&quot;</span>);</span><br><span class="line"><span class="comment">//3、通过ValueOperations获取值</span></span><br><span class="line">HashOperations hashOps = redisTemplate.opsForHash();</span><br><span class="line">String value3 = (String) hashOps.get(<span class="string">&quot;HashKey&quot;</span>, <span class="string">&quot;SmallKey&quot;</span>);</span><br></pre></td></tr></table></figure></li>
<li><p>获取所有的键值对集合</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//1、通过redisTemplate获取</span></span><br><span class="line">Map entries = redisTemplate.boundHashOps(<span class="string">&quot;HashKey&quot;</span>).entries();</span><br><span class="line"><span class="comment">//2、通过BoundValueOperations获取值</span></span><br><span class="line">BoundHashOperations hashKey = redisTemplate.boundHashOps(<span class="string">&quot;HashKey&quot;</span>);</span><br><span class="line">Map entries1 = hashKey.entries();</span><br><span class="line"><span class="comment">//3、通过ValueOperations获取值</span></span><br><span class="line">HashOperations hashOps = redisTemplate.opsForHash();</span><br><span class="line">Map entries2 = hashOps.entries(<span class="string">&quot;HashKey&quot;</span>);</span><br></pre></td></tr></table></figure></li>
<li><p>删除<br>//删除小key<br>redisTemplate.boundHashOps(“HashKey”).delete(“SmallKey”);<br>//删除大key<br>redisTemplate.delete(“HashKey”);</p>
</li>
<li><p>判断Hash中是否含有该值<br>Boolean isEmpty = redisTemplate.boundHashOps(“HashKey”).hasKey(“SmallKey”);</p>
</li>
</ol>
<h3 id="2-4-LIST类型相关操作"><a href="#2-4-LIST类型相关操作" class="headerlink" title="2.4 LIST类型相关操作"></a>2.4 LIST类型相关操作</h3><ol>
<li><p>添加缓存（2/3是1的递进值）</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//1、通过redisTemplate设置值</span></span><br><span class="line">redisTemplate.boundListOps(<span class="string">&quot;listKey&quot;</span>).leftPush(<span class="string">&quot;listLeftValue1&quot;</span>);</span><br><span class="line">redisTemplate.boundListOps(<span class="string">&quot;listKey&quot;</span>).rightPush(<span class="string">&quot;listRightValue2&quot;</span>);</span><br><span class="line"><span class="comment">//2、通过BoundValueOperations设置值</span></span><br><span class="line">BoundListOperations listKey = redisTemplate.boundListOps(<span class="string">&quot;listKey&quot;</span>);</span><br><span class="line">listKey.leftPush(<span class="string">&quot;listLeftValue3&quot;</span>);</span><br><span class="line">listKey.rightPush(<span class="string">&quot;listRightValue4&quot;</span>);</span><br><span class="line"><span class="comment">//3、通过ValueOperations设置值</span></span><br><span class="line">ListOperations opsList = redisTemplate.opsForList();</span><br><span class="line">opsList.leftPush(<span class="string">&quot;listKey&quot;</span>, <span class="string">&quot;listLeftValue5&quot;</span>);</span><br><span class="line">opsList.rightPush(<span class="string">&quot;listKey&quot;</span>, <span class="string">&quot;listRightValue6&quot;</span>);</span><br></pre></td></tr></table></figure></li>
<li><p>将List放入缓存<br>ArrayList<String> list = new ArrayList&lt;&gt;();<br>redisTemplate.boundListOps(“listKey”).rightPushAll(list);<br>redisTemplate.boundListOps(“listKey”).leftPushAll(list);</p>
</li>
<li><p>设置过期时间(单独设置)<br>redisTemplate.boundValueOps(“listKey”).expire(1,TimeUnit.MINUTES);<br>redisTemplate.expire(“listKey”,1,TimeUnit.MINUTES);</p>
</li>
<li><p>获取List缓存全部内容（起始索引，结束索引）<br>List listKey1 = redisTemplate.boundListOps(“listKey”).range(0, 10); </p>
</li>
<li><p>从左或从右弹出一个元素<br>String listKey2 = (String) redisTemplate.boundListOps(“listKey”).leftPop();  //从左侧弹出一个元素<br>String listKey3 = (String) redisTemplate.boundListOps(“listKey”).rightPop(); //从右侧弹出一个元素</p>
</li>
<li><p>根据索引查询元素<br>String listKey4 = (String) redisTemplate.boundListOps(“listKey”).index(1);</p>
</li>
<li><p>获取List缓存的长度<br>Long size = redisTemplate.boundListOps(“listKey”).size();</p>
</li>
<li><p>根据索引修改List中的某条数据(key，索引，值)<br>redisTemplate.boundListOps(“listKey”).set(3L,”listLeftValue3”);</p>
</li>
<li><p>移除N个值为value(key,移除个数，值)<br>redisTemplate.boundListOps(“listKey”).remove(3L,”value”);</p>
</li>
</ol>
<h2 id="三、其他"><a href="#三、其他" class="headerlink" title="三、其他"></a>三、其他</h2><h3 id="3-1-StringRedisTemplate和RedisTemplate的区别"><a href="#3-1-StringRedisTemplate和RedisTemplate的区别" class="headerlink" title="3.1 StringRedisTemplate和RedisTemplate的区别"></a>3.1 StringRedisTemplate和RedisTemplate的区别</h3><ol>
<li><p>表面上</p>
<ul>
<li><p>写入上</p>
<ul>
<li><p>RedisTemplate会把value 带着”引号”加上转义字符写入</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;wang&quot;</span>)--&gt;(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;\&quot;wang&quot;</span>\<span class="string">&quot;&quot;</span>)</span><br></pre></td></tr></table></figure></li>
<li><p>StringRedisTemplate 不带”引号写入”</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;wang&quot;</span>)--&gt;(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;wang&quot;</span>)</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>读取上</p>
<ul>
<li><p>RedisTemplate只能读取带””+转义字符的k-v</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;\&quot;wang&quot;</span>\<span class="string">&quot;&quot;</span>)-&gt;(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;wang&quot;</span>)</span><br></pre></td></tr></table></figure></li>
<li><p>StringRedisTemplate  就像原生的命令行一样。读取任意，且格式和原生的一样。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;\&quot;wang&quot;</span>\<span class="string">&quot;&quot;</span>)-&gt;(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;&quot;</span>wang<span class="string">&quot;&quot;</span>)</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
</li>
<li><p>两者的关系是StringRedisTemplate继承RedisTemplate。</p>
</li>
</ol>
<blockquote>
<p>SDR默认采用的序列化策略有两种，一种是String的序列化策略，一种是JDK的序列化策略。</p>
</blockquote>
<ol start="3">
<li><p>序列化策略上:</p>
<ul>
<li><p>StringRedisTemplate默认采用的是String的序列化策略，保存的key和value都是采用此策略序列化保存的。（JdkSerializationRedisSerializer）</p>
</li>
<li><p>RedisTemplate默认采用的是JDK的序列化策略，保存的key和value都是采用此策略序列化保存的。（StringRedisSerializer)</p>
</li>
</ul>
</li>
<li><p>使用上：</p>
<ul>
<li>StringRedisTemplate：当你的redis数据库里面本来存的是字符串数据或者你要存取的数据就是字符串类型数据的时候。</li>
<li>RedisTemplate：但是如果你的数据是复杂的对象类型，而取出的时候又不想做任何的数据转换，直接从Redis里面取出一个对象。</li>
</ul>
</li>
</ol>
<p>二、StringRedistemplate的源码</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringRedisTemplate</span> <span class="keyword">extends</span> <span class="title">RedisTemplate</span>&lt;<span class="title">String</span>, <span class="title">String</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">StringRedisTemplate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.setKeySerializer(RedisSerializer.string());</span><br><span class="line">        <span class="keyword">this</span>.setValueSerializer(RedisSerializer.string());</span><br><span class="line">        <span class="keyword">this</span>.setHashKeySerializer(RedisSerializer.string());</span><br><span class="line">        <span class="keyword">this</span>.setHashValueSerializer(RedisSerializer.string());</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">StringRedisTemplate</span><span class="params">(RedisConnectionFactory connectionFactory)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>();</span><br><span class="line">        <span class="keyword">this</span>.setConnectionFactory(connectionFactory);</span><br><span class="line">        <span class="keyword">this</span>.afterPropertiesSet();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> RedisConnection <span class="title">preProcessConnection</span><span class="params">(RedisConnection connection, <span class="keyword">boolean</span> existingConnection)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DefaultStringRedisConnection(connection);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​    从上面创建StringRedisTemplate的无参构造方法可以看出，此时将keySerializer、valueSerializer、hashKeySerializer、hashValueSerializer的序列化方式为stringSerializer，也就是StringRedisSerializer序列化方式；此时执行完整个方法后，还需要接着执行setConnectionFactory()方法，然后转向他的父类RedisTemplate中的afterPropertiesSet方法，此时上述四个序列化方式已经设置；</p>
<p>三、Redis使用的区别<br>    RedisTemplate使用的序列类在在操作数据的时候，比如说存入数据会将数据先序列化成字节数组然后在存入Redis数据库，这个时候打开Redis查看的时候，你会看到你的数据不是以可读的形式展现的，而是以字节数组显示，类似下面（RedisTemplate）</p>
<p>​    当然从Redis获取数据的时候也会默认将数据当做字节数组转化，这样就会导致一个问题，当需要获取的数据不是以字节数组存在redis当中而是正常的可读的字符串的时候，比如说下面这种形式的数据（StringRedisTemplate）</p>
<p>​    当Redis当中的数据值是以数组形式显示出来的时候，只能使用RedisTemplate才能获取到里面的数据。<br>当Redis当中的数据值是以可读的形式显示出来的时候，只能使用StringRedisTemplate才能获取到里面的数据。<br>所以当你使用RedisTemplate获取不到数据为NULL时，一般是获取的方式错误。检查一下数据是否可读即可。</p>
<h2 id="四、例子"><a href="#四、例子" class="headerlink" title="四、例子"></a>四、例子</h2><h3 id="3-0-redis-java说明"><a href="#3-0-redis-java说明" class="headerlink" title="3.0 redis-java说明"></a>3.0 redis-java说明</h3><ol>
<li> redisTemplate 写入的不是普通String,而是</li>
</ol>
<h3 id="3-1-RedisUtil"><a href="#3-1-RedisUtil" class="headerlink" title="3.1 RedisUtil"></a>3.1 RedisUtil</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">RedisTemplate redisTemplate;</span><br><span class="line"><span class="meta">@ApiOperation(&quot;redisGet&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;redisGet&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ApiResult <span class="title">redisGet</span><span class="params">(<span class="meta">@RequestParam</span> String key)</span> </span>&#123;</span><br><span class="line">    key = StringUtils.isBlank(key) ? <span class="string">&quot;name&quot;</span> : key;</span><br><span class="line">    Object o = redisTemplate.opsForValue().get(key);</span><br><span class="line">    System.out.println(o);</span><br><span class="line">    <span class="keyword">return</span> ApiResult.ok(); </span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@ApiOperation(&quot;set&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;set&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ApiResult <span class="title">set</span><span class="params">(<span class="meta">@RequestParam</span> String key, <span class="meta">@RequestParam</span> String value)</span> </span>&#123;</span><br><span class="line">    redisTemplate.opsForValue().set(key, value);</span><br><span class="line">    <span class="keyword">return</span> ApiResult.ok();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="3-2-测试"><a href="#3-2-测试" class="headerlink" title="3.2 测试"></a>3.2 测试</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> com.ccasd.redis.StringRedisUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestBody;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMethod;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/excel&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WordExcelController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> StringRedisUtils stringRedisUtils;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 测试_向Redis中插入数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/add&quot;, method = &#123;RequestMethod.POST&#125;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="meta">@RequestBody</span> Map&lt;String, String&gt; en)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        String key = en.get(<span class="string">&quot;key&quot;</span>).toString();</span><br><span class="line">        String value = en.get(<span class="string">&quot;value&quot;</span>).toString();</span><br><span class="line">        stringRedisUtils.addRedis(key, value);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 测试_从Redis中查询数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/get&quot;, method = &#123;RequestMethod.POST&#125;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">get</span><span class="params">(<span class="meta">@RequestBody</span> Map&lt;String, Object&gt; en)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        String key = en.get(<span class="string">&quot;key&quot;</span>).toString();</span><br><span class="line">        String value = stringRedisUtils.getRedis(key);</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>中间件</category>
      </categories>
  </entry>
  <entry>
    <title>spring-redis</title>
    <url>/2021/12/04/%E7%BB%84%E4%BB%B6/ORM/spring-redis/</url>
    <content><![CDATA[<p>[toc]</p>
<h3 id="一、Redis"><a href="#一、Redis" class="headerlink" title="一、Redis"></a>一、Redis</h3><h4 id="1-1-使用步骤"><a href="#1-1-使用步骤" class="headerlink" title="1.1 使用步骤"></a>1.1 使用步骤</h4><ol>
<li><p>依赖</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- reids by boot --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- spring2.X集成redis所需common-pool2--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-pool2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<span id="more"></span></li>
<li><p>创建配置类(@Configuration)</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@EnableCaching</span> <span class="comment">//开启缓存</span></span><br><span class="line"><span class="meta">@Configuration</span>  <span class="comment">//配置类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisConfig</span> <span class="keyword">extends</span> <span class="title">CachingConfigurerSupport</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RedisTemplate&lt;String, Object&gt; <span class="title">redisTemplate</span><span class="params">(RedisConnectionFactory factory)</span> </span>&#123;</span><br><span class="line">        RedisTemplate&lt;String, Object&gt; template = <span class="keyword">new</span> RedisTemplate&lt;&gt;();</span><br><span class="line">        RedisSerializer&lt;String&gt; redisSerializer = <span class="keyword">new</span> StringRedisSerializer();</span><br><span class="line">        Jackson2JsonRedisSerializer jackson2JsonRedisSerializer = <span class="keyword">new</span> Jackson2JsonRedisSerializer(Object.class);</span><br><span class="line">        ObjectMapper om = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">        om.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);</span><br><span class="line">        om.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL);</span><br><span class="line">        jackson2JsonRedisSerializer.setObjectMapper(om);</span><br><span class="line">        template.setConnectionFactory(factory);</span><br><span class="line">        <span class="comment">//key序列化方式</span></span><br><span class="line">        template.setKeySerializer(redisSerializer);</span><br><span class="line">        <span class="comment">//value序列化</span></span><br><span class="line">        template.setValueSerializer(jackson2JsonRedisSerializer);</span><br><span class="line">        <span class="comment">//value hashmap序列化</span></span><br><span class="line">        template.setHashValueSerializer(jackson2JsonRedisSerializer);</span><br><span class="line">        <span class="keyword">return</span> template;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CacheManager <span class="title">cacheManager</span><span class="params">(RedisConnectionFactory factory)</span> </span>&#123;</span><br><span class="line">        RedisSerializer&lt;String&gt; redisSerializer = <span class="keyword">new</span> StringRedisSerializer();</span><br><span class="line">        Jackson2JsonRedisSerializer jackson2JsonRedisSerializer = <span class="keyword">new</span> Jackson2JsonRedisSerializer(Object.class);</span><br><span class="line">        <span class="comment">//解决查询缓存转换异常的问题</span></span><br><span class="line">        ObjectMapper om = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">        om.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);</span><br><span class="line">        om.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL);</span><br><span class="line">        jackson2JsonRedisSerializer.setObjectMapper(om);</span><br><span class="line">        <span class="comment">// 配置序列化（解决乱码的问题）,过期时间600秒</span></span><br><span class="line">        RedisCacheConfiguration config = RedisCacheConfiguration.defaultCacheConfig()</span><br><span class="line">                .entryTtl(Duration.ofSeconds(<span class="number">600</span>))</span><br><span class="line">                .serializeKeysWith(RedisSerializationContext.SerializationPair.fromSerializer(redisSerializer))</span><br><span class="line">                .serializeValuesWith(RedisSerializationContext.SerializationPair.fromSerializer(jackson2JsonRedisSerializer))</span><br><span class="line">                .disableCachingNullValues();</span><br><span class="line">        RedisCacheManager cacheManager = RedisCacheManager.builder(factory)</span><br><span class="line">                .cacheDefaults(config)</span><br><span class="line">                .build();</span><br><span class="line">        <span class="keyword">return</span> cacheManager;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
<li><p>Controller开启加上缓存注解</p>
<ol>
<li>```java<br>@Cacheable(value = “banner”,key = “‘selectIndexList’”)<figure class="highlight dts"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">   <span class="number">2.</span> 注意key 双引号里面有单引号</span><br><span class="line"></span><br><span class="line"><span class="number">4.</span> 启动redis</span><br><span class="line"></span><br><span class="line"><span class="meta">### 二、原生方式-jedis</span></span><br><span class="line"></span><br><span class="line"><span class="number">1.</span> 依赖</span><br><span class="line"></span><br><span class="line">   ```xml</span><br><span class="line">      <span class="params">&lt;dependency&gt;</span></span><br><span class="line">          <span class="params">&lt;groupId&gt;</span>org.slf4j<span class="params">&lt;/groupId&gt;</span></span><br><span class="line">          <span class="params">&lt;artifactId&gt;</span>slf4j-simple<span class="params">&lt;/artifactId&gt;</span></span><br><span class="line">          <span class="params">&lt;version&gt;</span><span class="number">1.7</span><span class="number">.25</span><span class="params">&lt;/version&gt;</span></span><br><span class="line">          <span class="params">&lt;scope&gt;</span>compile<span class="params">&lt;/scope&gt;</span></span><br><span class="line">      <span class="params">&lt;/dependency&gt;</span></span><br><span class="line">      <span class="params">&lt;dependency&gt;</span></span><br><span class="line">          <span class="params">&lt;groupId&gt;</span>redis.clients<span class="params">&lt;/groupId&gt;</span></span><br><span class="line">          <span class="params">&lt;artifactId&gt;</span>jedis<span class="params">&lt;/artifactId&gt;</span></span><br><span class="line">          <span class="params">&lt;version&gt;</span><span class="number">4.0</span><span class="number">.0</span>-beta4<span class="params">&lt;/version&gt;</span></span><br><span class="line">      <span class="params">&lt;/dependency&gt;</span></span><br></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p>使用</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Jedis jedis=<span class="keyword">new</span> Jedis(<span class="string">&quot;192.168.100.3&quot;</span>,<span class="number">6379</span>);</span><br><span class="line">jedis.auth(<span class="string">&quot;root2&quot;</span>);</span><br></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>组件</category>
      </categories>
  </entry>
  <entry>
    <title>auth2.0</title>
    <url>/2022/04/26/%E7%BB%84%E4%BB%B6/%E7%99%BB%E5%BD%95/auto2/</url>
    <content><![CDATA[<h3 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h3><p>OAuth2 协议一共支持 4 种不同的授权模式：</p>
<h4 id="授权码模式"><a href="#授权码模式" class="headerlink" title="授权码模式"></a>授权码模式</h4><p>常见的第三方平台登录功能基本都是使用这种模式。</p>
<h4 id="简化模式"><a href="#简化模式" class="headerlink" title="简化模式"></a>简化模式</h4><p>简化模式是不需要客户端服务器参与，直接在浏览器中向授权服务器申请令牌（token），一般如果网站是纯静态页面则可以采用这种方式。</p>
<h4 id="密码模式"><a href="#密码模式" class="headerlink" title="密码模式"></a>密码模式</h4><p>密码模式是用户把用户名密码直接告诉客户端，客户端使用说这些信息向授权服务器申请令牌（token）。这需要用户对客户端高度信任，例如客户端应用和服务提供商就是同一家公司，我们自己做前后端分离登录就可以采用这种模式。</p>
<h4 id="客户端模式"><a href="#客户端模式" class="headerlink" title="客户端模式"></a>客户端模式</h4><p>客户端模式是指客户端使用自己的名义而不是用户的名义向服务提供者申请授权，严格来说，客户端模式并不能算作 OAuth 协议要解决的问题的一种解决方案，但是，对于开发者而言，在一些前后端分离应用或者为移动端提供的认证授权服务器上使用这种模式还是非常方便的。</p>
<h3 id="流程"><a href="#流程" class="headerlink" title="流程"></a>流程</h3><blockquote>
<p>base 申请应用认证的 client_id  client_secret</p>
<p><a href="https://justauth.wiki/guide/oauth/gitee/#_2-4-%E4%BB%A5%E4%B8%8A%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81%E5%A6%82%E4%B8%8B">justauth</a></p>
</blockquote>
<ol>
<li><p><strong>用户</strong>请求gitee登录  <a href="http://127.0.0.1:8443/oauth/render/gitee">http://127.0.0.1:8443/oauth/render/gitee</a></p>
</li>
<li><p>后端根据  <code>client_id</code>  +<code> callback</code> + 随机<code>state</code>      生成特殊<strong>Url</strong></p>
<p>并把state    保存到redis</p>
<p>让<strong>用户</strong> <strong>转到</strong>特殊 第一个gitee <strong>url</strong></p>
<blockquote>
<p><a href="https://gitee.com/oauth/authorize">https://gitee.com/oauth/authorize</a>?<br><code>response_type</code>=code&amp;<br><code>client_id</code>=34c61d6a54926886f004&amp;<br><code>redirect_uri</code>=<a href="http://127.0.0.1:8443/oauth/callback/gitee&amp;">http://127.0.0.1:8443/oauth/callback/gitee&amp;</a><br><code>state</code>=8a924&amp;<br><code>scope</code>=user_info</p>
</blockquote>
</li>
<li><p>gitee这边</p>
<blockquote>
<p>有人用特殊<strong>url</strong> 访问我了，反正是自己的地盘，先让用户登陆了再说。</p>
<p>然后就拿出他的<code>client_id</code>，再随机生成一个<code>code</code>，带上<code>state</code></p>
<p>让<strong>用户</strong> <strong>转到</strong><code>redirect_uri</code></p>
<p>并且在我的hashMap里面存一个<code>&#123;code: client_id，userInfo&#125;</code></p>
</blockquote>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">code: gitee 提供的认证code  <span class="comment">//这个code是gitee通过client_id的，验证真伪需要用</span></span><br><span class="line">state: 之前随机生成的值</span><br></pre></td></tr></table></figure></li>
<li><p>后端callback路径 认证code</p>
<blockquote>
<p>有人造访我我的callback，并且他给了我一个<code>code</code>，一个<code>state</code>，咦，</p>
<p>我查下这个state是不是我发的，不是的话这就是恶意请求，想攻击我。</p>
<p>redis中存在，那就对了。</p>
<p>现在我需要根据code拿到用户的信息，</p>
<p>我把 <code>code</code>，<code>client_id</code>，<code>client_secret</code>  一组和，gitee <code>第二个url</code>就出现了</p>
<p>我拿着第二个url请求gitee 让他给我userinfo</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#第二个gitee  url</span></span><br><span class="line">https://gitee.com/oauth/token?code=18848b9a2e151f79ed94bdcf38f89e206b08a87a966ebc6f38decb4383d0&amp;</span><br><span class="line">client_id=3e9bf70483cccc65147eded006a80c3d8a511f5a965b61d4c61d6a54926886f0&amp;   client_secret=9698c0445da7a8f599b6b02b26897a2e6ea22243639ed22ffc3e8b7e7b50e4bc&amp;</span><br><span class="line">grant_type=authorization_code&amp;</span><br><span class="line">redirect_uri=http://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8443</span>/oauth/callback/gitee</span><br></pre></td></tr></table></figure></li>
<li><p>gitee的回应</p>
<blockquote>
<p><code>gitee的老板</code> 收到请求后，经过一系列认证，从hashmap中取到了userInfo，然后响应给我 </p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#x27;response&#x27;:&#123;</span><br><span class="line"> &#x27;code&#x27;:<span class="number">2000</span>,</span><br><span class="line"> &#x27;msg&#x27;:&#x27;没有消息&#x27;,</span><br><span class="line"> &#x27;data&#x27;:&#123;</span><br><span class="line">     &#x27;uuid&#x27;:&#x27;aaa&#x27;,</span><br><span class="line">     &#x27;username&#x27;:&#x27;wyg&#x27;,</span><br><span class="line">     &#x27;nickname&#x27;:&#x27;wyg&#x27;,</span><br><span class="line">     &#x27;avatar&#x27;:&#x27;头像地址&#x27;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></blockquote>
</li>
<li><p>至此我拿到了gitee背书的userInfo，剩下的就是我和用户的事情了。</p>
</li>
<li><p>拿到username后（这个Username是不会变的，gitee虽然可以改nickname，无法修改username）</p>
<p>我就去数据库查找有这个gitee_username的user，ok，就你了，大明，我就把</p>
</li>
<li><p>如果没找到，就是临时用户</p>
</li>
</ol>
<h3 id="简化讲述"><a href="#简化讲述" class="headerlink" title="简化讲述"></a>简化讲述</h3><ol>
<li><p>用户访问–&gt;服务器随机生成state，然后根据 p1 : {state，cilent_id，redirect_uri，<a href="http://gitee.com/login">http://gitee.com/login</a> }等信息生成一个url1，并用response让用户浏览器转发到这个url1，用户输入信息p2{username,password}</p>
</li>
<li><p>gitee 官方接收到用户浏览器的请求后，保存请求信息p1，p2 ，随机生成一个code，保存p3{code: userInfo}</p>
<p>带着p4{ code , state} 访问 p1.redirect_uri，</p>
</li>
<li><p>服务器根据p5{code，cilent_id，client_secret，redirect_uri，，<a href="http://gitee.com/auth/token%7D">http://gitee.com/auth/token}</a> 生成url2，访问url2等到authToken</p>
</li>
<li><p>服务器根据authToken生成url3 访问url3得到userInfo</p>
</li>
</ol>
<h4 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h4><ol>
<li><p>url1</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">https</span>://gitee.com/oauth/authorize?response_type=code&amp;client_id=<span class="number">3</span>e<span class="number">9</span>bf<span class="number">70483</span>cccc<span class="number">65147</span>eded<span class="number">006</span>a<span class="number">80</span>c<span class="number">3</span>d<span class="number">8</span>a<span class="number">5</span>f<span class="number">5</span>a<span class="number">965</span>b<span class="number">661</span>d<span class="number">6</span>a<span class="number">54926886</span>f<span class="number">004</span>&amp;redirect_uri=http://<span class="number">127.0.0.1:8443</span>/oauth/callback/gitee&amp;state=<span class="number">32</span>ca<span class="number">6594</span>d<span class="number">002</span>e<span class="number">6</span>f<span class="number">2</span>f<span class="number">7</span>d<span class="number">9</span>ee<span class="number">1</span>a<span class="number">12</span>b<span class="number">6</span>f<span class="number">5</span>a<span class="number">5</span>&amp;scope=user_info</span><br></pre></td></tr></table></figure></li>
<li><p>p4</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;code&quot;</span>:<span class="string">&quot;53732710f7337894000f5f3ff9a453d99b88daca8267162c2b92a75fe6e726aa&quot;</span>,<span class="attr">&quot;state&quot;</span>:<span class="string">&quot;32ca6594d002e6f2f7d9ee1a12b6f5a5&quot;</span>&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>url2</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">https</span>://gitee.com/oauth/token?code=<span class="number">1488557</span>e<span class="number">82</span>c<span class="number">1</span>bf<span class="number">1</span>fdd<span class="number">8</span>c<span class="number">29</span>c<span class="number">6</span>b<span class="number">653</span>c<span class="number">62</span>e<span class="number">511</span>be<span class="number">2</span>c<span class="number">7</span>fc<span class="number">3</span>e<span class="number">7</span>d<span class="number">78013</span>b<span class="number">4</span>f<span class="number">32</span>d<span class="number">0157</span>d<span class="number">8</span>d&amp;client_id=<span class="number">3</span>e<span class="number">9</span>bf<span class="number">70483</span>cccc<span class="number">65147</span>eded<span class="number">006</span>a<span class="number">80</span>c<span class="number">3</span>d<span class="number">8</span>a<span class="number">5</span>f<span class="number">5</span>a<span class="number">965</span>b<span class="number">61</span>d<span class="number">4</span>c<span class="number">61</span>d<span class="number">6</span>a<span class="number">54886</span>f&amp;client_secret=<span class="number">96</span>c<span class="number">045</span>da<span class="number">7</span>a<span class="number">8</span>f<span class="number">599</span>b<span class="number">6</span>b<span class="number">02</span>b<span class="number">26897</span>a<span class="number">2</span>e<span class="number">6</span>ea<span class="number">43639</span>ed<span class="number">22</span>ffc<span class="number">3</span>e<span class="number">8</span>b<span class="number">7</span>e<span class="number">7</span>b<span class="number">5</span>f<span class="number">1</span>c<span class="number">0</span>e<span class="number">4</span>&amp;grant_type=authorization_code&amp;redirect_uri=http://<span class="number">127.0.0.1:8443</span>/oauth/callback/gitee</span><br></pre></td></tr></table></figure>

<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">https</span>://gitee.com/oauth/token?code=eb<span class="number">5181</span>da<span class="number">1</span>f<span class="number">225000</span>d<span class="number">0</span>fa<span class="number">220</span>a<span class="number">896</span>a<span class="number">8</span>eda<span class="number">81</span>d<span class="number">8</span>d<span class="number">0385</span>fe<span class="number">269</span>ee<span class="number">5</span>fa<span class="number">2</span>aa<span class="number">19</span>d<span class="number">0054</span>d<span class="number">7</span>e&amp;client_id=e<span class="number">2</span>c<span class="number">295</span>ef<span class="number">1</span>c<span class="number">1</span>aa<span class="number">096</span>e<span class="number">4</span>f<span class="number">0</span>d<span class="number">2</span>a<span class="number">30590</span>ef<span class="number">91</span>e<span class="number">35</span>d<span class="number">3</span>a<span class="number">7</span>e<span class="number">2971</span>acdf<span class="number">82</span>fc<span class="number">837</span>b<span class="number">55439</span>fb<span class="number">1</span>&amp;client_secret=<span class="number">4</span>cda<span class="number">46</span>d<span class="number">4432</span>bf<span class="number">77</span>dd<span class="number">865002</span>c<span class="number">91</span>eb<span class="number">8232756607</span>f<span class="number">60</span>fb<span class="number">8</span>bfb<span class="number">2</span>f<span class="number">46</span>cf<span class="number">0</span>f<span class="number">92</span>d<span class="number">4339</span>ac&amp;grant_type=authorization_code&amp;redirect_uri=http://<span class="number">127.0.0.1:8001</span>/auth/gitee</span><br></pre></td></tr></table></figure></li>
<li><p>url3</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">https</span>://gitee.com/api/v<span class="number">5</span>/user?access_token=f<span class="number">8119934124</span>cb<span class="number">931</span>bd<span class="number">8</span>de<span class="number">62</span>e<span class="number">838</span>d<span class="number">6</span>ef<span class="number">2</span>f</span><br></pre></td></tr></table></figure>

<p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20220507145823512.png" alt="image-20220507145823512"></p>
</li>
</ol>
<h2 id="调试"><a href="#调试" class="headerlink" title="调试"></a>调试</h2><ol>
<li><p>url</p>
<figure class="highlight isbl"><table><tr><td class="code"><pre><span class="line"><span class="variable">utils.HttpUtils</span> <span class="number">35</span>行 <span class="function"><span class="title">post</span>(<span class="variable">url</span>)</span></span><br></pre></td></tr></table></figure></li>
</ol>
]]></content>
  </entry>
  <entry>
    <title>shiro</title>
    <url>/2022/04/08/%E7%BB%84%E4%BB%B6/%E7%99%BB%E5%BD%95/shiro/</url>
    <content><![CDATA[<p>[toc]</p>
<h2 id="一、功能"><a href="#一、功能" class="headerlink" title="一、功能"></a>一、功能</h2><ol>
<li>认证</li>
<li>授权</li>
<li>方法加权</li>
<li>自定义过滤</li>
<li>会话管理：Session Manager  一次登录，所有信息保存在session中</li>
<li>加密</li>
</ol>
<h3 id="1-1-Authentication-用户密码认证"><a href="#1-1-Authentication-用户密码认证" class="headerlink" title="1.1 Authentication 用户密码认证"></a>1.1 Authentication 用户密码认证</h3><h3 id="1-2-Authorization-验证是否有权限访问该方法"><a href="#1-2-Authorization-验证是否有权限访问该方法" class="headerlink" title="1.2 Authorization 验证是否有权限访问该方法"></a>1.2 Authorization 验证是否有权限访问该方法</h3><ol>
<li><p>MyRealm extends AuthorizingRealm</p>
<blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span><span class="comment">//授权</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> AuthorizationInfo <span class="title">doGetAuthorizationInfo</span><span class="params">(PrincipalCollection principalCollection)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//获得令牌/用户</span></span><br><span class="line">    User user=(User)principalCollection.asList().get(<span class="number">0</span>);</span><br><span class="line">    SimpleAuthorizationInfo authorizationInfo=<span class="keyword">new</span> SimpleAuthorizationInfo();</span><br><span class="line">    authorizationInfo.addRoles(user.getUserRoles());<span class="comment">//添加用户-授权</span></span><br><span class="line">    authorizationInfo.addStringPermissions(user.getUserPerms());<span class="comment">//添加权限-授权</span></span><br><span class="line">    <span class="keyword">return</span> authorizationInfo;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></blockquote>
</li>
</ol>
<h3 id="1-3-其他功能"><a href="#1-3-其他功能" class="headerlink" title="1.3 其他功能"></a>1.3 其他功能</h3><h4 id="1-3-1-方法加权"><a href="#1-3-1-方法加权" class="headerlink" title="1.3.1 方法加权"></a>1.3.1 方法加权</h4><ol>
<li><p>硬编码</p>
<p>在每个方法体里面进行手动获取当前用户权限，然后和该方法的权限进行对比。</p>
</li>
<li><p>ShiroConfig添加路径</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">filterFactoryBean.setUnauthorizedUrl(<span class="string">&quot;/wq.html&quot;</span>);<span class="comment">//无权限跳到指定路径</span></span><br></pre></td></tr></table></figure></li>
<li><p>注解</p>
<ol>
<li>@RequiresAuthentication 需要登录</li>
<li>@RequiresUser 需要reamberMe</li>
<li>@RequiresPermissions 需要权限</li>
</ol>
<ul>
<li>没权限会直接报500错误</li>
<li>需要异常处理机制</li>
</ul>
</li>
</ol>
<h4 id="1-3-2-自定义过滤"><a href="#1-3-2-自定义过滤" class="headerlink" title="1.3.2 自定义过滤"></a>1.3.2 自定义过滤</h4><ol>
<li><p>@Componet注册过滤器</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">F1</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;自定义过滤开始&quot;</span>);</span><br><span class="line">        filterChain.doFilter(servletRequest,servletResponse);</span><br><span class="line">        System.out.println(<span class="string">&quot;自定义过滤结束&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>加入到请求过滤器</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">filters.put(<span class="string">&quot;oauth2&quot;</span>, <span class="keyword">new</span> F1());</span><br><span class="line">filterFactoryBean.setFilters(filters);</span><br></pre></td></tr></table></figure></li>
<li></li>
</ol>
<h4 id="1-3-3-获取当前线程用户"><a href="#1-3-3-获取当前线程用户" class="headerlink" title="1.3.3 获取当前线程用户"></a>1.3.3 获取当前线程用户</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Subject subject = SecurityUtils.getSubject();</span><br></pre></td></tr></table></figure>

<ol>
<li><p>认证</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">UsernamePasswordToken token = <span class="keyword">new</span> UsernamePasswordToken(user.getUsername(), user.getPassword());</span><br><span class="line">subject.login(token);</span><br></pre></td></tr></table></figure></li>
<li><p>登录设置令牌</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">subject.getSession().setAttribute(<span class="string">&quot;currentUser&quot;</span>, subject.getPrincipal());</span><br></pre></td></tr></table></figure></li>
<li><p>登出</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">subject.logout();<span class="comment">//或者在过滤器中配置   filterMap.put(&quot;/aaa&quot;,&quot;logout&quot;);</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="二、组件"><a href="#二、组件" class="headerlink" title="二、组件"></a>二、组件</h2><h3 id="2-1-核心组件"><a href="#2-1-核心组件" class="headerlink" title="2.1 核心组件"></a>2.1 核心组件</h3><ol>
<li>Subjetc： 当前进程obj</li>
<li>Shiro SecurityManager</li>
<li>Realm ：安全中心，提供认证授权服务</li>
<li>ShiroFilterFactoryBean：请求过滤器<ol>
<li>设置Map&lt;路径，权限&gt;的过滤器Map</li>
<li>设置自定义过滤器</li>
<li>设置无权路径</li>
</ol>
</li>
</ol>
<h3 id="2-2-注解模式"><a href="#2-2-注解模式" class="headerlink" title="2.2 注解模式"></a>2.2 注解模式</h3><blockquote>
<p>对于Map&lt;路径，权限&gt;</p>
</blockquote>
<ol>
<li>@RequiresAuthentication 需登录</li>
<li>@RequiresPermissions(“b”)  需b权限</li>
<li>@RequiresRoles(“admin”)  需admin角色</li>
</ol>
<h3 id="2-3-user"><a href="#2-3-user" class="headerlink" title="2.3 user"></a>2.3 user</h3><ol>
<li>user<ol>
<li>userName</li>
<li>pasword</li>
<li>List&lt;String&gt;roles</li>
<li>List&lt;String&gt;perms</li>
</ol>
</li>
</ol>
<h2 id="三、原理"><a href="#三、原理" class="headerlink" title="三、原理"></a>三、原理</h2><h3 id="3-1-基于token"><a href="#3-1-基于token" class="headerlink" title="3.1 基于token"></a>3.1 基于token</h3><h3 id="3-2-安全中心-MyRealm"><a href="#3-2-安全中心-MyRealm" class="headerlink" title="3.2 安全中心 MyRealm"></a>3.2 安全中心 MyRealm</h3><ul>
<li><p>认证中心  AuthenticationInfo(username,password)</p>
<ul>
<li>登录的时候会用有一次</li>
<li>传入账号信息，通过数据库获得用户信息，返回token(user，passwod，Nmae)</li>
</ul>
</li>
<li><p>权限中心  AuthorizationInfo(user)</p>
<ul>
<li><p>每次访问需要权限的地方会用到</p>
</li>
<li><p>格式化user的权限</p>
</li>
<li><p>然后根据user权限对比[需要访问的方法]的权限，如果有权限，就退回到对应界面</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">filterFactoryBean.setLoginUrl(<span class="string">&quot;/login.html&quot;</span>);<span class="comment">//登录页面</span></span><br><span class="line">filterFactoryBean.setUnauthorizedUrl(<span class="string">&quot;/wq.html&quot;</span>);<span class="comment">//无权限</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h2 id="四、集成-改进"><a href="#四、集成-改进" class="headerlink" title="四、集成-改进"></a>四、集成-改进</h2><h3 id="5-1-shiro-redis集成"><a href="#5-1-shiro-redis集成" class="headerlink" title="5.1 shiro+redis集成"></a>5.1 shiro+redis集成</h3><h2 id="五、其他"><a href="#五、其他" class="headerlink" title="五、其他"></a>五、其他</h2><ol>
<li><p>过滤顺序问题</p>
<blockquote>
<p>过滤设置规则是从上到下，详细的规则配在前面，大范围的配在后面。</p>
</blockquote>
</li>
</ol>
<h2 id="六、RDBC模型-role-based-access-control"><a href="#六、RDBC模型-role-based-access-control" class="headerlink" title="六、RDBC模型 role based access control"></a>六、RDBC模型 role based access control</h2><h3 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">shiro-core</span><br><span class="line">shiro-spring</span><br><span class="line"></span><br><span class="line">f</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



]]></content>
      <categories>
        <category>中间件</category>
      </categories>
  </entry>
  <entry>
    <title>单点登录</title>
    <url>/2022/04/05/%E7%BB%84%E4%BB%B6/%E7%99%BB%E5%BD%95/%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95/</url>
    <content><![CDATA[<p>[toc]</p>
<h2 id="一、授权登录"><a href="#一、授权登录" class="headerlink" title="一、授权登录"></a>一、授权登录</h2><ol>
<li>单点登录，自系统登录，SSO， Singal Sign on</li>
<li>只需要登陆一次就能无需登录访问其他模块</li>
</ol>
<h2 id="二、SSO三种方法"><a href="#二、SSO三种方法" class="headerlink" title="二、SSO三种方法"></a>二、SSO三种方法</h2><blockquote>
<p> 在百度浏览器登录后，打开百度贴吧就自动登录了，不需要二次登录。这就是单点登录</p>
</blockquote>
<h3 id="2-1-session广播-session复制"><a href="#2-1-session广播-session复制" class="headerlink" title="2.1 session广播(session复制)"></a>2.1 session广播(session复制)</h3><ol>
<li>把session复制到其他模块<ol>
<li>缺点：复制太浪费资源（时间+内存）</li>
<li>session不能跨域，所以不能用不同域下的服务</li>
</ol>
</li>
</ol>
<h3 id="2-2-cookie-redis-session集中"><a href="#2-2-cookie-redis-session集中" class="headerlink" title="2.2 cookie+redis (session集中)"></a>2.2 cookie+redis (session集中)</h3><blockquote>
<p>相比于session广播就是节省了session复制，但还是不能跨域</p>
</blockquote>
<ol>
<li>redis  放置  k:生成随即唯一值（用户ip,id）,v:用户信息</li>
<li>cookie  将k放入cookie中</li>
<li>访问其他模块时，带着cookie，取出k,查询redis,如果查到并正确</li>
<li>也就是只需要验证签名，就能放心的取出的信息安全有效</li>
</ol>
<h3 id="2-3-token-redis"><a href="#2-3-token-redis" class="headerlink" title="2.3 token+redis"></a>2.3 token+redis</h3><ol>
<li>token是按照一定规则生成的并加密的字符串</li>
<li>用户登录–&gt;生成随机字符串–&gt;拼接用户信息</li>
<li>每次访问其他模块，带着这个字符串，其他模块会解码取出用户信息并验证</li>
<li>也就是没到一个模块都要通过User数据库验证token才能确保信息安全有效</li>
</ol>
<h4 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h4><ol>
<li>redis性能</li>
<li>redis故障</li>
</ol>
<span id="more"></span>

<h3 id="2-4-JWT-令牌"><a href="#2-4-JWT-令牌" class="headerlink" title="2.4 JWT(令牌)"></a>2.4 JWT(令牌)</h3><h3 id="2-5-CAS-中央认证服务"><a href="#2-5-CAS-中央认证服务" class="headerlink" title="2.5 CAS 中央认证服务"></a>2.5 CAS 中央认证服务</h3><p><img src="https://img-blog.csdnimg.cn/20181215232036639.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80Mzg0NDE4OQ==,size_16,color_FFFFFF,t_70" alt="fff"></p>
<h2 id="三、-JWT-json-web-token"><a href="#三、-JWT-json-web-token" class="headerlink" title="三、 JWT(json web token)"></a>三、 JWT(json web token)</h2><blockquote>
<p> 把信息进行安全的json封装，在不同服务器之间传输。</p>
</blockquote>
<h4 id="流程"><a href="#流程" class="headerlink" title="流程"></a>流程</h4><table>
<thead>
<tr>
<th>用户</th>
<th>网站</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>用户登录{username，password}—-&gt;</td>
<td>收到，且密码正确，生成jwt</td>
<td></td>
</tr>
<tr>
<td>访问 {jwt}     —-&gt;</td>
<td>jwt正确()，</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h4 id="2-3-1-组成-分割"><a href="#2-3-1-组成-分割" class="headerlink" title="2.3.1 组成(.分割)"></a>2.3.1 组成(.分割)</h4><ol>
<li><p>Header</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;&#x27;typ&#x27;:&#x27;jwt&#x27;, token类型</span><br><span class="line">&#x27;alg&#x27;:&#x27;hs256&#x27;&#125; 算法名称</span><br></pre></td></tr></table></figure></li>
<li><p>payload载荷(主要信息)</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;name&quot;</span>:<span class="string">&quot;wang&quot;</span>,<span class="attr">&quot;admin&quot;</span>:<span class="literal">true</span>&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>signature签名哈希(防伪标志)</p>
<ol>
<li>header的Base64编码</li>
<li>payload的Base64编码</li>
<li>使用header的加密算法加密1.2部分得到的结果</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">jwt=</span><br><span class="line">base64(header)+base64(payload)+<span class="string">&quot;.&quot;</span>+</span><br><span class="line">HMACSHA256( base64UrlEncode(header) +<span class="string">&quot;.&quot;</span>+ base64UrlEncode(payload)+<span class="string">&quot;.&quot;</span>+base65(secretKey)) </span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="2-3-2-相关网站"><a href="#2-3-2-相关网站" class="headerlink" title="2.3.2 相关网站"></a>2.3.2 相关网站</h4><ol>
<li><a href="https://jwt.io/">jwt生成</a></li>
<li><a href="https://1024tools.com/hmac">HMAC sha256加密</a></li>
<li><a href="https://base64.supfree.net/">base64解码</a></li>
</ol>
<h4 id="2-3-3-JWT登录流程"><a href="#2-3-3-JWT登录流程" class="headerlink" title="2.3.3 JWT登录流程"></a>2.3.3 JWT登录流程</h4><ol>
<li>登录–&gt;user<ol>
<li>数据库查询(md5,slat等等等)验证user</li>
<li>返回token=JWT(userInfo)</li>
</ol>
</li>
</ol>
<h4 id="2-3-4-基本使用"><a href="#2-3-4-基本使用" class="headerlink" title="2.3.4 基本使用"></a>2.3.4 基本使用</h4><ol>
<li><p>依赖</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.jsonwebtoken<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jjwt<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>工具类   id+name–&gt;token   </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JwtUtils</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> EXPIRE = <span class="number">1000</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span>; <span class="comment">//token过期时间</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String APP_SECRET = <span class="string">&quot;ukc8BDbRigUDaY6pZFfWus2jZWLPHO&quot;</span>; <span class="comment">//秘钥</span></span><br><span class="line">    <span class="comment">//生成token字符串的方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getJwtToken</span><span class="params">(String id, String nickname)</span></span>&#123;</span><br><span class="line">        String JwtToken = Jwts.builder()</span><br><span class="line">                .setHeaderParam(<span class="string">&quot;typ&quot;</span>, <span class="string">&quot;JWT&quot;</span>)<span class="comment">//1header  </span></span><br><span class="line">                .setHeaderParam(<span class="string">&quot;alg&quot;</span>, <span class="string">&quot;HS256&quot;</span>)<span class="comment">//header 加密算法</span></span><br><span class="line">                .setSubject(<span class="string">&quot;wangyonggan&quot;</span>)<span class="comment">//分类，随便写</span></span><br><span class="line">                .setIssuedAt(<span class="keyword">new</span> Date())  </span><br><span class="line">                .setExpiration(<span class="keyword">new</span> Date(System.currentTimeMillis() + EXPIRE))<span class="comment">//过期时间</span></span><br><span class="line">                .claim(<span class="string">&quot;id&quot;</span>, id)  <span class="comment">//2token主体部分 ，存储用户信息</span></span><br><span class="line">                .claim(<span class="string">&quot;nickname&quot;</span>, nickname)</span><br><span class="line">                .signWith(SignatureAlgorithm.HS256, APP_SECRET)<span class="comment">//3签名</span></span><br><span class="line">                .compact();<span class="comment">//拼接生成</span></span><br><span class="line">        <span class="keyword">return</span> JwtToken;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
<li><p>工具类—-&gt;解析JWT</p>
<ol>
<li>request.header的token</li>
<li>密钥</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getMemberIdByJwtToken</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">       String jwtToken = request.getHeader(<span class="string">&quot;token&quot;</span>);</span><br><span class="line">       <span class="keyword">if</span>(StringUtils.isEmpty(jwtToken)) <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="comment">//加入签名-密钥获得主体claims     </span></span><br><span class="line">       Jws&lt;Claims&gt; claimsJws = Jwts.parser().setSigningKey(APP_SECRET).parseClaimsJws(jwtToken);</span><br><span class="line">       Claims claims = claimsJws.getBody();</span><br><span class="line">       <span class="keyword">return</span> (String)claims.get(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="2-3-5-JWT缺点"><a href="#2-3-5-JWT缺点" class="headerlink" title="2.3.5 JWT缺点"></a>2.3.5 JWT缺点</h4><h5 id="续签问题"><a href="#续签问题" class="headerlink" title="续签问题"></a>续签问题</h5><ul>
<li>不允许修改jwt token</li>
</ul>
<ol>
<li><p>session自带30分钟的过期事件，如果30分钟内再次访问，会刷新为30分钟</p>
</li>
<li><p>JWT的过期参数在payload中，如果修改了payload，那么就会有签名起冲突</p>
</li>
<li><p>解决方案</p>
<ol>
<li>每次访问刷新JWT,把payload，连带签名一起修改了</li>
<li>快过期的时候再刷新payload和签名</li>
<li>redis做过期时间</li>
</ol>
</li>
<li><p>注销场景</p>
</li>
<li><p>修改密码场景</p>
</li>
<li><p>统计在线用户场景</p>
</li>
<li><p>验签性能</p>
</li>
</ol>
]]></content>
      <categories>
        <category>组件</category>
      </categories>
  </entry>
  <entry>
    <title>基于拦截器的</title>
    <url>/2022/04/10/%E7%BB%84%E4%BB%B6/%E7%99%BB%E5%BD%95/%E5%9F%BA%E4%BA%8E%E6%8B%A6%E6%88%AA%E5%99%A8%E7%9A%84/</url>
    <content><![CDATA[<h4 id="配置类"><a href="#配置类" class="headerlink" title="配置类"></a>配置类</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MvcConfig</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line">	<span class="comment">//注册拦截器</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 登录拦截器</span></span><br><span class="line">        registry.addInterceptor(<span class="keyword">new</span> LoginInterceptor())</span><br><span class="line">                .excludePathPatterns(</span><br><span class="line">                        <span class="string">&quot;/shop/**&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/voucher/**&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/shop-type/**&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/upload/**&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/blog/hot&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/user/code&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/user/login&quot;</span></span><br><span class="line">                ).order(<span class="number">1</span>);</span><br><span class="line">        <span class="comment">// token刷新的拦截器</span></span><br><span class="line">        registry.addInterceptor(<span class="keyword">new</span> RefreshTokenInterceptor(stringRedisTemplate)).addPathPatterns(<span class="string">&quot;/**&quot;</span>).order(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="自制拦截器"><a href="#自制拦截器" class="headerlink" title="自制拦截器"></a>自制拦截器</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//r</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginInterceptor</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// 1.判断是否需要拦截（ThreadLocal中是否有用户）</span></span><br><span class="line">        <span class="keyword">if</span> (UserHolder.getUser() == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// 没有，需要拦截，设置状态码</span></span><br><span class="line">            response.setStatus(<span class="number">401</span>);</span><br><span class="line">            <span class="comment">// 拦截</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 有用户，则放行</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//①根据token保存User到ThreadLocal</span></span><br><span class="line"><span class="comment">//②刷新token时间  </span></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> com.hmdp.utils.RedisConstants.LOGIN_USER_KEY;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> com.hmdp.utils.RedisConstants.LOGIN_USER_TTL;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RefreshTokenInterceptor</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">RefreshTokenInterceptor</span><span class="params">(StringRedisTemplate stringRedisTemplate)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.stringRedisTemplate = stringRedisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// 1.获取请求头中的token</span></span><br><span class="line">        String token = request.getHeader(<span class="string">&quot;authorization&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (StrUtil.isBlank(token)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 2.基于TOKEN获取redis中的用户</span></span><br><span class="line">        String key  = LOGIN_USER_KEY + token;</span><br><span class="line">        Map&lt;Object, Object&gt; userMap = stringRedisTemplate.opsForHash().entries(key);</span><br><span class="line">        <span class="comment">// 3.判断用户是否存在</span></span><br><span class="line">        <span class="keyword">if</span> (userMap.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 5.将查询到的hash数据转为UserDTO</span></span><br><span class="line">        UserDTO userDTO = BeanUtil.fillBeanWithMap(userMap, <span class="keyword">new</span> UserDTO(), <span class="keyword">false</span>);</span><br><span class="line">        <span class="comment">// 6.存在，保存用户信息到 ThreadLocal</span></span><br><span class="line">        UserHolder.saveUser(userDTO);</span><br><span class="line">        <span class="comment">// 7.刷新token有效期</span></span><br><span class="line">        stringRedisTemplate.expire(key, LOGIN_USER_TTL, TimeUnit.MINUTES);</span><br><span class="line">        <span class="comment">// 8.放行</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// 移除用户</span></span><br><span class="line">        UserHolder.removeUser();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
  </entry>
  <entry>
    <title>ConcurrentHashMap</title>
    <url>/2022/03/25/java/javaSE/JUC/ConcurrentHashMap/</url>
    <content><![CDATA[<h2 id="一、ConcurrentMap"><a href="#一、ConcurrentMap" class="headerlink" title="一、ConcurrentMap"></a>一、ConcurrentMap</h2><h3 id="1-1-理解"><a href="#1-1-理解" class="headerlink" title="1.1 理解"></a>1.1 理解</h3><blockquote>
<p>基于 Voliate + synchronized + 状态变量  + CSA + 尾插法</p>
</blockquote>
<ol>
<li>CSA用于创建table的新节点，谁CSA成功了谁就是链表的头节点</li>
<li>synchronized用于put </li>
<li>Voliate 用于链表可见性</li>
<li>状态变量用于记录map的状态</li>
</ol>
<h2 id="二、HashMap"><a href="#二、HashMap" class="headerlink" title="二、HashMap"></a>二、HashMap</h2><h3 id="1-HashMap的核心参数"><a href="#1-HashMap的核心参数" class="headerlink" title="1.HashMap的核心参数"></a>1.HashMap的核心参数</h3><ol>
<li><p>初始化桶大小，因为底层是数组，16  1&lt;&lt;4。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">transient</span> Entry&lt;K,V&gt;[] table = (Entry&lt;K,V&gt;[]) EMPTY_TABLE;</span><br></pre></td></tr></table></figure>

<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">为什么<span class="keyword">transient</span> 因为collection都实现了writeObject方法</span><br><span class="line">实现是先把<span class="keyword">size</span> buckets 放进，再把元素一一个个放入(先放k紧接着放v)</span><br></pre></td></tr></table></figure>

<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line"><span class="number">1.8</span>之后为红黑树，类为TreeNode 继承了<span class="keyword">Node</span>	<span class="title"></span></span><br></pre></td></tr></table></figure></li>
<li><p>桶最大值。</p>
</li>
<li><p><code>loadFactor</code>: 负载因子（0.75）</p>
</li>
<li><p><code>table</code> 真正存放数据的数组。</p>
</li>
<li><p><code>Map</code> 存放数量的大小1&lt;&lt;30。</p>
</li>
</ol>
<h3 id="2-HashMap遍历方式"><a href="#2-HashMap遍历方式" class="headerlink" title="2. HashMap遍历方式"></a>2. HashMap遍历方式</h3><h4 id="2-1-对entrySet遍历-不推荐"><a href="#2-1-对entrySet遍历-不推荐" class="headerlink" title="2.1 对entrySet遍历(不推荐)"></a>2.1 对entrySet遍历(不推荐)</h4><figure class="highlight lisp"><table><tr><td class="code"><pre><span class="line">for(<span class="name">entry</span><span class="symbol">:map</span>.entrySet().iterator())</span><br></pre></td></tr></table></figure>

<blockquote>
<p>entrySet()方法原理：：返回内部类，<code>内部类拿到外部类的属性ArrayList.this.value</code>,该内部类和HashMap共享table，<strong>这有一种懒加载的思想</strong></p>
<p>对entrySet()的foreach遍历就是对table的遍历</p>
</blockquote>
<h4 id="2-2-迭代器遍历"><a href="#2-2-迭代器遍历" class="headerlink" title="2.2 迭代器遍历"></a>2.2 迭代器遍历</h4><blockquote>
<p>其实和第一种一样</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">map.keySet().iterator()</span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="2-3-foreach迭代"><a href="#2-3-foreach迭代" class="headerlink" title="2.3 foreach迭代"></a>2.3 foreach迭代</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">map.foreach((k,v)-&gt;&#123;&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="3-几个特殊方法"><a href="#3-几个特殊方法" class="headerlink" title="3. 几个特殊方法"></a>3. 几个特殊方法</h3><h4 id="3-1-computeIfAbsent"><a href="#3-1-computeIfAbsent" class="headerlink" title="3.1 computeIfAbsent"></a>3.1 computeIfAbsent</h4><blockquote>
<p>两个参数(key，key-&gt;value) 最后这个value<strong>是一种懒加载的思想</strong>，</p>
<p>如果有了，那么就不计算了，返回value</p>
<p>如果不存在就加入-&gt;value，并返回-&gt;value  </p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">value=map.get(key)</span><br><span class="line"><span class="keyword">if</span>(value=<span class="keyword">null</span>)&#123;</span><br><span class="line">    value=-&gt;value;</span><br><span class="line">	map.put(key,value);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> value;</span><br></pre></td></tr></table></figure>

<h4 id="3-2-putIfAbsent"><a href="#3-2-putIfAbsent" class="headerlink" title="3.2 putIfAbsent"></a>3.2 putIfAbsent</h4><blockquote>
<p>和computeIfAbsent一样都是针对没存该key的情况 ，只不过<strong>没有懒加载</strong></p>
<p>如果不存在或者为null就存入</p>
<p>返回value</p>
</blockquote>
<h3 id="4-HashSet"><a href="#4-HashSet" class="headerlink" title="4. HashSet"></a>4. HashSet</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">HashSet底层采用的是HashMap进行实现的，但是没有key-value，只有HashMap的key set的视图，HashSet不容许重复的对象</span><br></pre></td></tr></table></figure>

<h4 id="ConcurrentHashMap为什么k-v不能为null"><a href="#ConcurrentHashMap为什么k-v不能为null" class="headerlink" title="ConcurrentHashMap为什么k v不能为null"></a>ConcurrentHashMap为什么k v不能为null</h4><h4 id="map并发环境下肯能造成死循环"><a href="#map并发环境下肯能造成死循环" class="headerlink" title="map并发环境下肯能造成死循环"></a>map并发环境下肯能造成死循环</h4><h3 id="put流程"><a href="#put流程" class="headerlink" title="put流程"></a>put流程</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> hash = spread(key.hashCode());</span><br><span class="line">Node&lt;K,V&gt;[] tab = table;</span><br><span class="line"><span class="keyword">while</span>(<span class="keyword">true</span>)&#123;<span class="comment">//@1</span></span><br><span class="line">    <span class="keyword">int</span> n = tab.length;</span><br><span class="line">    <span class="keyword">int</span> i = (n - <span class="number">1</span>) &amp; hash;<span class="comment">//位置</span></span><br><span class="line">    Node f = tabAt(tab, i);<span class="comment">//这个位置的node</span></span><br><span class="line">    <span class="keyword">int</span> fh=f.hash;</span><br><span class="line">    <span class="comment">//对应的hash为空</span></span><br><span class="line">    <span class="keyword">if</span> (f == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="comment">//csa放置，放置失败就会goto  @1</span></span><br><span class="line">        Node new_node=<span class="keyword">new</span> Node&lt;K,V&gt;(hash, key, value, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">if</span> (casTabAt(tab, i, <span class="keyword">null</span>,new_node))</span><br><span class="line">                    <span class="keyword">break</span>;                   </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//扩容的情况下，更换tab</span></span><br><span class="line">    <span class="keyword">if</span>(fh==-<span class="number">1</span>)</span><br><span class="line">        tab = helpTransfer(tab, f);</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    addCount();<span class="comment">//增j</span></span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
  </entry>
  <entry>
    <title>JUC</title>
    <url>/2022/04/08/java/javaSE/JUC/JUC/</url>
    <content><![CDATA[<p>.</p>
<h2 id="一、线程和进程概念"><a href="#一、线程和进程概念" class="headerlink" title="一、线程和进程概念"></a>一、线程和进程概念</h2><h3 id="1-1-进程与线程"><a href="#1-1-进程与线程" class="headerlink" title="1.1 进程与线程"></a>1.1 进程与线程</h3><ol>
<li>进程是<strong>分配资源</strong>的基本单元，运行的一个程序</li>
<li>线程是<strong>cpu调度</strong>的基本单元，程序执行的基本单位</li>
<li>管程:<ol>
<li>Monitor、监视器、锁</li>
<li>同步机制，保证只有一个线程能访问资源</li>
</ol>
</li>
<li>用户线程和守护线程<ol>
<li>用户线程：普通的线程，main结束了，用户线程还会继续运行</li>
<li>守护线程：后台默默运行的线程 isDaemon，main结束，收回线程会结束</li>
</ol>
</li>
</ol>
<h3 id="1-2-线程的状态"><a href="#1-2-线程的状态" class="headerlink" title="1.2 线程的状态"></a>1.2 线程的状态</h3><p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20220325162011992.png" alt="image-20220325162011992"></p>
<ol>
<li>新建</li>
<li>就绪</li>
<li>等待</li>
<li>运行</li>
<li>死亡</li>
</ol>
<h3 id="1-3-wati和sleep"><a href="#1-3-wati和sleep" class="headerlink" title="1.3 wati和sleep"></a>1.3 wati和sleep</h3><ol>
<li>Object.wait<ol>
<li>释放锁</li>
</ol>
</li>
<li>Thread.sleep<ol>
<li>不释放当前锁</li>
</ol>
</li>
</ol>
<h3 id="1-4-并发和并行"><a href="#1-4-并发和并行" class="headerlink" title="1.4 并发和并行"></a>1.4 并发和并行</h3><ol>
<li>串行：排队执行</li>
<li>并行：一并执行</li>
<li>并发：一个cpu表面上运行多个线程</li>
<li>并行：多个cpu</li>
</ol>
<h3 id="1-5-Lock、synchronize"><a href="#1-5-Lock、synchronize" class="headerlink" title="1.5 Lock、synchronize"></a>1.5 Lock、synchronize</h3><h4 id="1-5-1-synchronize，同步锁"><a href="#1-5-1-synchronize，同步锁" class="headerlink" title="1.5.1 synchronize，同步锁"></a>1.5.1 synchronize，同步锁</h4><ol>
<li>修饰代码块<ol>
<li>作用于对象是调用这个代码块的对象</li>
</ol>
</li>
<li>修饰方法<ol>
<li>被修饰的方法称为同步方法，其</li>
<li>作用的对象是调用这个方法的对象； </li>
</ol>
</li>
<li>修饰静态方法<ol>
<li>作用的对象是这个类的所有对象</li>
</ol>
</li>
<li>修饰类<ol>
<li>作用主的对象是这个类的所有对象</li>
</ol>
</li>
</ol>
<h4 id="1-5-2-lock和synchronized区别"><a href="#1-5-2-lock和synchronized区别" class="headerlink" title="1.5.2 lock和synchronized区别"></a>1.5.2 lock和synchronized区别</h4><ol>
<li><p>lock可获得更广泛的锁</p>
</li>
<li><p>lock是类，不是java内置</p>
</li>
<li><p>lock是手动锁，synchronized是自动锁</p>
</li>
<li><p>synchronized发生异常或者结束会自动释放，而lock发生了异常会一直占用锁</p>
</li>
<li><p>lock可以判断是否得到了锁</p>
</li>
<li><p>lock可以在竞争激烈的情况下提高效率</p>
</li>
<li><p>1. </p>
</li>
</ol>
<h3 id="多线程编程步骤"><a href="#多线程编程步骤" class="headerlink" title="多线程编程步骤"></a>多线程编程步骤</h3><ol>
<li>创建资源类</li>
<li>资源类的消费和供给方法<ol>
<li>判断<ol>
<li>否：wait等待其他线程的natify</li>
<li>是：干活<ol>
<li>通知</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
<li>创建线程，调用消费、共给方法</li>
</ol>
<h2 id="线程间通信"><a href="#线程间通信" class="headerlink" title="线程间通信"></a>线程间通信</h2><h3 id="线程间定制化通信"><a href="#线程间定制化通信" class="headerlink" title="线程间定制化通信"></a>线程间定制化通信</h3><ol>
<li>标志位</li>
</ol>
<h3 id="特殊"><a href="#特殊" class="headerlink" title="特殊"></a>特殊</h3><ol>
<li>wait 需要用while循环放置虚假唤醒</li>
</ol>
<h3 id="疑惑"><a href="#疑惑" class="headerlink" title="疑惑"></a>疑惑</h3><ol>
<li>lock原理</li>
<li>wait</li>
</ol>
]]></content>
      <categories>
        <category>java</category>
        <category>JUC</category>
      </categories>
  </entry>
  <entry>
    <title>java阻塞</title>
    <url>/2022/03/30/java/javaSE/JUC/java%E9%98%BB%E5%A1%9E/</url>
    <content><![CDATA[<p>·</p>
<p>挂起：一般是主动的，由系统或程序发出，甚至于辅存中去。（不释放CPU，可能释放内存，放在外存）</p>
<p>阻塞：一般是被动的，在抢占资源中得不到资源，被动的挂起在内存，等待某种资源或信号量（即有了资源）将他唤醒。（释放CPU，不释放内存）</p>
<h1 id="浅谈JAVA中的线程阻塞方法"><a href="#浅谈JAVA中的线程阻塞方法" class="headerlink" title="浅谈JAVA中的线程阻塞方法"></a>浅谈JAVA中的线程阻塞方法</h1><ol>
<li><a href="https://www.jianshu.com/p/c5715fa91dd8">参考</a></li>
</ol>
<blockquote>
<p>如果线程是因为调用了wait()、sleep()或者join()方法而导致的阻塞，可以中断线程，并且通过抛出InterruptedException来唤醒它;如果线程遇到了IO阻塞，无能为力，因为IO是操作系统实现的，Java代码并没有办法直接接触到操作系统。以下是详细的唤醒方法：</p>
</blockquote>
<ol>
<li><p>sleep() 方法</p>
<p>sleep(毫秒)，指定以毫秒为单位的时间，使线程在该时间内进入线程阻塞状态，期间得不到cpu的时间片，等到时间过去了，线程重新进入可执行状态。(暂停线程，不会释放锁)</p>
</li>
<li><p>suspend() 和 resume() 方法</p>
<p>挂起和唤醒线程，suspend()使线程进入阻塞状态，只有对应的resume()被调用的时候，线程才会进入可执行状态。(不建议用，容易发生死锁)</p>
</li>
<li><p>yield() 方法</p>
<p>会使的线程放弃当前分得的cpu时间片，进入<code>就绪</code>状态，接下来和平竞争，可能又直接进入<code>运行</code>状态。</p>
</li>
<li><p>wait() 和 notify() 方法</p>
<ul>
<li><p>wait()，线程进入<code>阻塞</code>状态</p>
<p>notify()，线程进入<code>就绪</code>状态。</p>
</li>
<li><p>wait()内可加或不加参数，加参数时是以毫秒为单位，当到了指定时间或调用notify()方法时，进入就绪状态。</p>
</li>
</ul>
</li>
<li><p>join()方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">doSome();</span><br><span class="line">B.join();</span><br><span class="line">doSome();</span><br></pre></td></tr></table></figure>



<p>是当前线程A调用另一个线程B的join()方法，当前线程转A入阻塞状态，直到线程B运行结束，线程A才由阻塞状态转为可执行状态。</p>
</li>
<li><p>以上是Java线程唤醒和阻塞的五种常用方法，不同的方法有不同的特点，其中wait() 和 notify()是其中功能最强大、使用最灵活的方法，但这也导致了它们效率较低、较容易出错的特性，因此，在实际应用中应灵活运用各种方法，以达到期望的目的与效果!</p>
</li>
</ol>
]]></content>
      <categories>
        <category>java</category>
        <category>JUC</category>
      </categories>
  </entry>
  <entry>
    <title>线程池</title>
    <url>/2022/03/27/java/javaSE/JUC/%E7%BA%BF%E7%A8%8B%E6%B1%A0/</url>
    <content><![CDATA[<h3 id="线程池的作用"><a href="#线程池的作用" class="headerlink" title="线程池的作用"></a>线程池的作用</h3><p>1.减少了创建和销毁线程的次数，每个工作线程都可以被重复利用，可执行多个任务。</p>
<p>2.可以根据系统的承受能力，调整线程池中工作线线程的数目，防止因为消耗过多的内存，而把服务器累趴下(每个线程需要大约1MB内存，线程开的越多，消耗的内存也就越大，最后死机)。</p>
<h4 id="submit与execute区别"><a href="#submit与execute区别" class="headerlink" title="submit与execute区别"></a>submit与execute区别</h4><ol>
<li>summit 提交 callable，可以进行异常管理</li>
<li>execute runable </li>
</ol>
<h3 id="参数-ThreadPoolExecutor"><a href="#参数-ThreadPoolExecutor" class="headerlink" title="参数 ThreadPoolExecutor"></a>参数 ThreadPoolExecutor</h3><table>
<thead>
<tr>
<th>参数</th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>int corePoolSize</td>
<td>常驻线程数量</td>
<td></td>
</tr>
<tr>
<td>int maximumPoolSize</td>
<td>表示最大线程数，如当前任务较多，将核心线程数都用完了，此时就会创建新的线程，但线程池内线程总数不会超过最大线程数</td>
<td></td>
</tr>
<tr>
<td>long keepAliveTime</td>
<td>空闲线程存活时间(减少到常驻数量)</td>
<td></td>
</tr>
<tr>
<td>TimeUnit unit</td>
<td>时间类型</td>
<td></td>
</tr>
<tr>
<td>BlockingQueue<Runnable> workQueue</td>
<td>多的线程进入–&gt;阻塞队列</td>
<td></td>
</tr>
<tr>
<td>ThreadFactory threadFactory</td>
<td>线程工厂</td>
<td></td>
</tr>
<tr>
<td>RejectedExecutionHandler handler</td>
<td>当队列满的时候，拒绝策略</td>
<td></td>
</tr>
</tbody></table>
<h2 id="二、类型"><a href="#二、类型" class="headerlink" title="二、类型"></a>二、类型</h2><table>
<thead>
<tr>
<th>名称</th>
<th>参数</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>newFixedThreadPool</td>
<td>(x,x)  0   LinkedBlockingQueue</td>
<td>前x个能运行，其余进入队列</td>
</tr>
<tr>
<td>newSingleThreadExecutor</td>
<td>(1,1)  0  LinkedBlockingQueue</td>
<td>只能一个运行，其余进入队列</td>
</tr>
<tr>
<td>newCachedThreadPool</td>
<td>(0,N) 60s  SynchronousQueue</td>
<td>无限长变化池，来一个运行一个</td>
</tr>
<tr>
<td>newScheduledThreadPool</td>
<td>(x,N) 0  DelayedWorkQueue</td>
<td>无限长变化池，延迟运行</td>
</tr>
</tbody></table>
<h4 id="2-1-定长线程池"><a href="#2-1-定长线程池" class="headerlink" title="2.1 定长线程池"></a>2.1 定长线程池</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ExecutorService pools = Executors.newFixedThreadPool(<span class="number">5</span>);<span class="comment">//一池5线程</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>多出的线程进入LinkedBlockingQueue，</p>
</blockquote>
<h4 id="2-2-一池一线程"><a href="#2-2-一池一线程" class="headerlink" title="2.2 一池一线程"></a>2.2 一池一线程</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">final</span> ExecutorService singleExecutor = Executors.newSingleThreadExecutor();</span><br></pre></td></tr></table></figure>

<h4 id="2-3-可扩容池"><a href="#2-3-可扩容池" class="headerlink" title="2.3 可扩容池"></a>2.3 可扩容池</h4><ul>
<li>它比较适合处理执行时间比较小的任务；</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">final</span> ExecutorService cachedThreadPool = Executors.newCachedThreadPool();</span><br></pre></td></tr></table></figure>

<h4 id="2-4-定长延迟线程池"><a href="#2-4-定长延迟线程池" class="headerlink" title="2.4 定长延迟线程池"></a>2.4 定长延迟线程池</h4><blockquote>
<p>可周期性，延迟性</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">final</span> ScheduledExecutorService scheduledThreadPool = Executors.newScheduledThreadPool(<span class="number">2</span>);<span class="comment">//2个线程</span></span><br><span class="line">scheduledThreadPool.schedule(()-&gt;sout,<span class="number">3</span>,TimeUtil.SECONDS);<span class="comment">//延迟性，3秒后执行</span></span><br><span class="line">scheduledThreadPool.schedule(()-&gt;sout,<span class="number">1</span>,<span class="number">3</span>,TimeUtil.SECONDS);<span class="comment">//周期性，延迟性，1秒后执行，每三秒执行一次</span></span><br></pre></td></tr></table></figure>

<h2 id="三、queue类型"><a href="#三、queue类型" class="headerlink" title="三、queue类型"></a>三、queue类型</h2><h3 id="SynchronousQueue"><a href="#SynchronousQueue" class="headerlink" title="SynchronousQueue"></a>SynchronousQueue</h3><blockquote>
<p>没有容量，直接提交。</p>
<p>SynchronousQueue阻塞队列一般要求maximumPoolSizes为无界，避免线程拒绝执行操作。</p>
</blockquote>
<h3 id="LinkedBlockingQueue"><a href="#LinkedBlockingQueue" class="headerlink" title="LinkedBlockingQueue"></a>LinkedBlockingQueue</h3><blockquote>
<p>无界队列，多于corePoolSize的线程被放进来等待，maximumPoolSizess变为无效参数</p>
</blockquote>
<h3 id="ArrayBlockingQueue"><a href="#ArrayBlockingQueue" class="headerlink" title="ArrayBlockingQueue"></a>ArrayBlockingQueue</h3><blockquote>
<p>有界队列，可以指定缓存队列的大小，当线程数量大于corePoolSize时，多余的任务会缓存在ArrayBlockingQueue队列中等待有空闲的线程时继续执行；当ArrayBlockingQueue满时，则又会开启新的线程去执行，直到线程数量达到maximumPoolSize；当线程数已经达到最大的maximumPoolSize时，再有新的任务到达时会执行拒绝执行策略</p>
</blockquote>
<h4 id="DelayedWorkQueue"><a href="#DelayedWorkQueue" class="headerlink" title="DelayedWorkQueue"></a>DelayedWorkQueue</h4><blockquote>
<p>无界阻塞延迟队列，根据剩余时间进行堆排序，最先过期的在最前面</p>
</blockquote>
<h2 id="四、其他"><a href="#四、其他" class="headerlink" title="四、其他"></a>四、其他</h2><h3 id="4-2-拒绝策略"><a href="#4-2-拒绝策略" class="headerlink" title="4.2 拒绝策略"></a>4.2 拒绝策略</h3><table>
<thead>
<tr>
<th>名称</th>
<th>作用</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>CallerRunsPolicy</td>
<td>使用调用线程直接运行任务</td>
<td></td>
</tr>
<tr>
<td>AbortPolicy</td>
<td>丢弃</td>
<td></td>
</tr>
<tr>
<td>DiscardPolicy</td>
<td>丢弃，抛出异常</td>
<td></td>
</tr>
<tr>
<td>DiscardOldestPolicy</td>
<td>丢弃阻塞队列 workQueue 中最老的一个任务，并将新任务加入</td>
<td></td>
</tr>
</tbody></table>
<h3 id="4-2-ThreadFactory"><a href="#4-2-ThreadFactory" class="headerlink" title="4.2 ThreadFactory"></a>4.2 ThreadFactory</h3><blockquote>
<p>线程池可选参数，在线程放入线程池前处理线程</p>
</blockquote>
<ol>
<li>设置名称</li>
<li>设置是否为守护线程</li>
<li>设置优先级</li>
</ol>
]]></content>
  </entry>
  <entry>
    <title>CountDownLatch</title>
    <url>/2022/04/02/java/javaSE/JUC/%E8%BE%85%E5%8A%A9%E7%B1%BB/</url>
    <content><![CDATA[<h3 id="CountDownLatch"><a href="#CountDownLatch" class="headerlink" title="CountDownLatch"></a>CountDownLatch</h3><blockquote>
<p>组线程 任务完成记录 技术</p>
<p>用于主线程汇总子线程</p>
<p>以前用join方法完成，现在用优美的CountDownLatch完成</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n=<span class="number">30</span>;</span><br><span class="line">    CountDownLatch latch=<span class="keyword">new</span> CountDownLatch(n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;号离开&quot;</span>);<span class="comment">//任务</span></span><br><span class="line">            latch.countDown();<span class="comment">//每个线程完成就减少一次</span></span><br><span class="line">                         &#125;, String.valueOf(i)<span class="comment">//线程名称</span></span><br><span class="line"></span><br><span class="line">                  ).start();</span><br><span class="line">    &#125;</span><br><span class="line">    latch.await();<span class="comment">//还没减少到0，等待</span></span><br><span class="line">    System.out.println(Thread.currentThread().getName()+<span class="string">&quot;锁门&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="CyclicBarrier循环屏障"><a href="#CyclicBarrier循环屏障" class="headerlink" title="CyclicBarrier循环屏障"></a>CyclicBarrier循环屏障</h3><blockquote>
<p>循环栅栏</p>
<p>可以重复利用</p>
<p>收集到7个后就会运行run方法，然后可以再收集7个</p>
<p>原理：index = 7   index–;  if(index==0)  breakBarrier()    ;</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//设置固定值</span></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> NUM=<span class="number">10</span>;</span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">     CyclicBarrier cyclicBarrier=<span class="keyword">new</span> CyclicBarrier(NUM,()-&gt; System.out.println(<span class="string">&quot;收集完成&quot;</span>));<span class="comment">//</span></span><br><span class="line">     <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;NUM;i++)&#123;</span><br><span class="line">         <span class="keyword">int</span> finalI = i;</span><br><span class="line">         <span class="keyword">new</span> Thread(()-&gt;&#123;</span><br><span class="line">             System.out.println(Thread.currentThread().getName()+<span class="string">&quot;被收集&quot;</span>);</span><br><span class="line">             <span class="keyword">try</span> &#123;</span><br><span class="line">                 cyclicBarrier.await();</span><br><span class="line">             &#125; <span class="keyword">catch</span> (InterruptedException | BrokenBarrierException e) &#123;</span><br><span class="line">                 e.printStackTrace();</span><br><span class="line">             &#125;</span><br><span class="line">             System.out.println(<span class="string">&quot;结束&quot;</span>+finalI);<span class="comment">//都完成后</span></span><br><span class="line">         &#125;,String.valueOf(i)).start();</span><br><span class="line">     &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="Semaphore信号灯"><a href="#Semaphore信号灯" class="headerlink" title="Semaphore信号灯"></a>Semaphore信号灯</h3><blockquote>
<p>限流，最多三个能同时进行</p>
<p>原理：资源抢占</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Semaphore semaphore=<span class="keyword">new</span> Semaphore(<span class="number">3</span>);<span class="comment">//创建资源</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">6</span>;i++)&#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> x=i;</span><br><span class="line">    <span class="keyword">new</span> Thread(()-&gt;&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            semaphore.acquire();<span class="comment">//抢占资源</span></span><br><span class="line">            System.out.println(x+<span class="string">&quot;抢到资源&quot;</span>);</span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">2</span>);<span class="comment">//占用资源</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            semaphore.release();<span class="comment">//释放资源</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;).start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="区别"><a href="#区别" class="headerlink" title="区别"></a>区别</h3><ul>
<li><p>CountdownLatch执行流程</p>
<ul>
<li>执行一组线程</li>
<li>CountdownLatch.awite()  阻塞主线程等待。知道全部完成</li>
<li>没有总结线程，他的main线程可以近似总结线程</li>
</ul>
</li>
<li><p>Syslicbarrier的执行流程是</p>
<ul>
<li><p>任务定义</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">work&#123;</span><br><span class="line">	beforeWork();</span><br><span class="line">	cyclicBarrier.await();</span><br><span class="line">	afterWork();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>执行一组任务的beforeWork</p>
</li>
<li><p>全部完成后执行cyclicBarrier的<code>总结</code>线程</p>
</li>
<li><p>执行这组任务的afterWork()</p>
</li>
</ul>
</li>
</ul>
]]></content>
  </entry>
  <entry>
    <title>锁</title>
    <url>/2022/04/08/java/javaSE/JUC/%E9%94%81/</url>
    <content><![CDATA[<p>·</p>
<h2 id="一、Lock的使用"><a href="#一、Lock的使用" class="headerlink" title="一、Lock的使用"></a>一、Lock的使用</h2><blockquote>
<p><code>ReentrantLock</code>的实现是基于其内部类<code>FairSync</code>(公平锁)和<code>NonFairSync</code>(非公平锁)实现的。 其可重入性是基于<code>Thread.currentThread()</code>实现的: 如果当前线程已经获得了执行序列中的锁， 那执行序列之后的所有方法都可以获得这个锁。</p>
</blockquote>
<blockquote>
<p>自增 lock上锁，condition 状态转换</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Lock lock = <span class="keyword">new</span> ReentrantLock();<span class="comment">//可重入锁，lock.lock()上锁 unlock解锁</span></span><br><span class="line">Condition condition = lock.newCondition();<span class="comment">//状态监视-转换器 await 等待， signalAll 唤醒全部</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> num;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">increment</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    lock.lock();<span class="comment">//上锁</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (num != <span class="number">0</span>) &#123;</span><br><span class="line">            condition.await();<span class="comment">//等待</span></span><br><span class="line">        &#125;</span><br><span class="line">        num++;</span><br><span class="line">        condition.signal();<span class="comment">//唤醒</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line"></span><br><span class="line">    &#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">    	lock.unlock();<span class="comment">//解锁</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h4><blockquote>
<p>基于AQS+CSA</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (compareAndSetState(<span class="number">0</span>, <span class="number">1</span>))</span><br><span class="line">    setExclusiveOwnerThread(Thread.currentThread());</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    acquire(<span class="number">1</span>);</span><br></pre></td></tr></table></figure>



<h4 id="精准唤醒"><a href="#精准唤醒" class="headerlink" title="精准唤醒"></a>精准唤醒</h4><h2 id="synchonized"><a href="#synchonized" class="headerlink" title="synchonized"></a>synchonized</h2><h3 id="内存语义"><a href="#内存语义" class="headerlink" title="内存语义"></a>内存语义</h3><h3 id="synchonized和Lock区别"><a href="#synchonized和Lock区别" class="headerlink" title="synchonized和Lock区别"></a>synchonized和Lock区别</h3><ol>
<li>synchonized是一个关键字，Lock是一个类</li>
<li>synchonized是隐式锁，自动上锁解锁，Lock是显式锁，手动操作</li>
<li>synchonized无法获得所得状态，Lock可以判断是否获得了锁，更灵活</li>
<li>synchonized是<code>非公平锁</code>，Lock默认是<code>非公平锁</code>，可设置</li>
<li>synchonized适合锁少量的代码，Lock是否大量代码<ol>
<li>conditon可以精准唤醒，可以灵活调整获得锁的顺序</li>
</ol>
</li>
</ol>
<h3 id="乐观锁"><a href="#乐观锁" class="headerlink" title="乐观锁"></a>乐观锁</h3><blockquote>
<p>基于版本</p>
</blockquote>
<ol>
<li><p>支持并发</p>
</li>
<li><p>在提交任务之前比较版本号，不一致就放弃，再申请提交，知道提交完成</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">update t_goods </span><br><span class="line"><span class="keyword">set</span> status<span class="operator">=</span><span class="number">2</span>,version<span class="operator">=</span>version<span class="operator">+</span><span class="number">1</span></span><br><span class="line"><span class="keyword">where</span> id<span class="operator">=</span>#&#123;id&#125; <span class="keyword">and</span> version<span class="operator">=</span>#&#123;version&#125;;</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="悲观锁"><a href="#悲观锁" class="headerlink" title="悲观锁"></a>悲观锁</h3><ol>
<li>串行化</li>
</ol>
<h3 id="表锁"><a href="#表锁" class="headerlink" title="表锁"></a>表锁</h3><h3 id="行锁"><a href="#行锁" class="headerlink" title="行锁"></a>行锁</h3><h3 id="读锁、共享锁、S锁、"><a href="#读锁、共享锁、S锁、" class="headerlink" title="读锁、共享锁、S锁、"></a>读锁、共享锁、S锁、</h3><blockquote>
<p>如果事务T对数据A加上共享锁后，则其他事务只能对A再加共享锁，不能加排他锁。获准共享锁的事务只能读数据，不能修改数据。</p>
</blockquote>
<h3 id="写锁、独占锁、排他锁、T锁"><a href="#写锁、独占锁、排他锁、T锁" class="headerlink" title="写锁、独占锁、排他锁、T锁"></a>写锁、独占锁、排他锁、T锁</h3><blockquote>
<p>如果事务T对数据A加上排他锁后，则其他事务不能再对A加任任何类型的封锁。获准排他锁的事务既能读数据，又能修改数据。</p>
</blockquote>
<h3 id="公平锁，非公平锁"><a href="#公平锁，非公平锁" class="headerlink" title="公平锁，非公平锁"></a>公平锁，非公平锁</h3><blockquote>
<p>最早请求的锁最早获得锁，需要队列实现，影响性能</p>
</blockquote>
<h3 id="对写锁"><a href="#对写锁" class="headerlink" title="对写锁"></a>对写锁</h3><blockquote>
<p>有独占锁，也有共享锁</p>
</blockquote>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title">Book</span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Lock=<span class="keyword">new</span> ReetranWriteReadLock();</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">read</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="keyword">lock</span>.writeLock().<span class="keyword">lock</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">wirte</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="keyword">lock</span>.rLock().<span class="keyword">lock</span>();</span><br><span class="line">	</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
  </entry>
  <entry>
    <title>阻塞队列BlockingQeque</title>
    <url>/2022/03/13/java/javaSE/JUC/%E9%98%BB%E5%A1%9E%E9%98%9F%E5%88%97/</url>
    <content><![CDATA[<p>BlockingQeque </p>
<p>put–&gt;[1,2,3,4,5]–&gt;take</p>
<p>当队列为空，take操作会被阻塞，直到有元素</p>
<p>当队列为满，put操作会被阻塞，直到有空位</p>
<p>优点：把生产者、消费者进行了封装</p>
<h2 id="二、类型"><a href="#二、类型" class="headerlink" title="二、类型"></a>二、类型</h2><p><strong>Deque</strong>是双向队列</p>
<h3 id="2-1-ArrayBlockingQueue"><a href="#2-1-ArrayBlockingQueue" class="headerlink" title="2.1 ArrayBlockingQueue"></a>2.1 ArrayBlockingQueue</h3><blockquote>
<p>基于数组结构的有界队列</p>
</blockquote>
<h3 id="2-2-LinkedBlockingQueue"><a href="#2-2-LinkedBlockingQueue" class="headerlink" title="2.2 LinkedBlockingQueue"></a>2.2 LinkedBlockingQueue</h3><blockquote>
<p>基于链表的有界队列</p>
</blockquote>
<h3 id="2-3-LinkedBlockingDeque"><a href="#2-3-LinkedBlockingDeque" class="headerlink" title="2.3 LinkedBlockingDeque"></a>2.3 LinkedBlockingDeque</h3><blockquote>
<p>基于链表的双向队列</p>
</blockquote>
<h3 id="2-4-PriorityBlockingQueue"><a href="#2-4-PriorityBlockingQueue" class="headerlink" title="2.4 PriorityBlockingQueue"></a>2.4 PriorityBlockingQueue</h3><blockquote>
<p>基于优先队列的，可延迟、无界</p>
</blockquote>
<h3 id="2-5-增删操作"><a href="#2-5-增删操作" class="headerlink" title="2.5 增删操作"></a>2.5 增删操作</h3><table>
<thead>
<tr>
<th>类型</th>
<th>异常</th>
<th>bool</th>
<th>阻塞</th>
<th>超时</th>
</tr>
</thead>
<tbody><tr>
<td>插入</td>
<td>add</td>
<td>offer</td>
<td>put</td>
<td>offer(time,unit)</td>
</tr>
<tr>
<td>删除</td>
<td>remove</td>
<td>poll</td>
<td>take</td>
<td>poll(time,unit)</td>
</tr>
<tr>
<td>检查</td>
<td>element</td>
<td>peek</td>
<td></td>
<td></td>
</tr>
<tr>
<td>说明</td>
<td>抛出异常</td>
<td>成功：true</td>
<td>一直等待成功</td>
<td></td>
</tr>
</tbody></table>
<h4 id="2-6-阻塞队列解决生产者消费者"><a href="#2-6-阻塞队列解决生产者消费者" class="headerlink" title="2.6 阻塞队列解决生产者消费者"></a>2.6 阻塞队列解决生产者消费者</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> 生产者消费者 </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//创建消费者</span></span><br><span class="line">        <span class="keyword">int</span> customerNum=<span class="number">2</span>;</span><br><span class="line">        <span class="keyword">int</span> producerNum=<span class="number">1</span>;</span><br><span class="line">        List&lt;Thread&gt;customers=<span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        List&lt;Thread&gt;producers=<span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;customerNum;i++)</span><br><span class="line">            customers.add(<span class="keyword">new</span> Thread(<span class="keyword">new</span> Customer()));</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;producerNum;i++)</span><br><span class="line">            producers.add(<span class="keyword">new</span> Thread(<span class="keyword">new</span> Producer()));</span><br><span class="line">        customers.forEach(Thread::start);</span><br><span class="line">        producers.forEach(Thread::start);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Foot</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Customer</span> <span class="keyword">extends</span> <span class="title">Resource</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                queue.take();</span><br><span class="line">                System.out.println(<span class="string">&quot;消费了第&quot;</span> + customFoot++ + <span class="string">&quot;个foot,现在容量为:&quot;</span> + queue.size());</span><br><span class="line">                TimeUnit.MILLISECONDS.sleep(<span class="number">20</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException ex) &#123;</span><br><span class="line">                ex.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Producer</span> <span class="keyword">extends</span> <span class="title">Resource</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                queue.put(<span class="keyword">new</span> 生产者消费者.Foot());</span><br><span class="line">                System.out.println(<span class="string">&quot;生产了第&quot;</span> + productFoot++ + <span class="string">&quot;个foot,现在容量为:&quot;</span> + queue.size());</span><br><span class="line">                TimeUnit.MILLISECONDS.sleep(<span class="number">20</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Resource</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> productFoot = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> customFoot = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> size = <span class="number">100</span>;</span><br><span class="line">    <span class="keyword">static</span> BlockingQueue&lt;生产者消费者.Foot&gt; queue = <span class="keyword">new</span> ArrayBlockingQueue&lt;&gt;(size);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="BlockingDeque-阻塞双端队列"><a href="#BlockingDeque-阻塞双端队列" class="headerlink" title="BlockingDeque 阻塞双端队列"></a>BlockingDeque 阻塞双端队列</h2><p>deque: double ended queue 双端队列，可以从首部和尾部插入元素</p>
<h2 id="BlockingQeque-阻塞队列"><a href="#BlockingQeque-阻塞队列" class="headerlink" title="BlockingQeque 阻塞队列"></a>BlockingQeque 阻塞队列</h2><h2 id="ArrayBlockingQueue"><a href="#ArrayBlockingQueue" class="headerlink" title="ArrayBlockingQueue"></a>ArrayBlockingQueue</h2><h2 id="ConcurrentHashMap"><a href="#ConcurrentHashMap" class="headerlink" title="ConcurrentHashMap"></a>ConcurrentHashMap</h2><h2 id="ConcurrentLinkedDeque"><a href="#ConcurrentLinkedDeque" class="headerlink" title="ConcurrentLinkedDeque"></a>ConcurrentLinkedDeque</h2><h2 id="ConcurrentLinkedQueue"><a href="#ConcurrentLinkedQueue" class="headerlink" title="ConcurrentLinkedQueue"></a>ConcurrentLinkedQueue</h2><h2 id="CopyOnWriteArrayList"><a href="#CopyOnWriteArrayList" class="headerlink" title="CopyOnWriteArrayList"></a>CopyOnWriteArrayList</h2><h2 id="CopyOnWriteArraySet"><a href="#CopyOnWriteArraySet" class="headerlink" title="CopyOnWriteArraySet"></a>CopyOnWriteArraySet</h2><h2 id="DelayQueue"><a href="#DelayQueue" class="headerlink" title="DelayQueue"></a>DelayQueue</h2>]]></content>
  </entry>
  <entry>
    <title>java内存模型</title>
    <url>/2022/03/30/java/javaSE/jvm/JMM-java%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B/</url>
    <content><![CDATA[<p>[toc]</p>
<h2 id="痛点-转载"><a href="#痛点-转载" class="headerlink" title="痛点-转载"></a><a href="https://www.hollischuang.com/archives/2550">痛点-转载</a></h2><p>​    但是随着CPU技术的发展，CPU的执行速度越来越快。而由于内存的技术并没有太大的变化，所以从内存中读取和写入数据的过程和CPU的执行速度比起来差距就会越来越大,这就导致CPU每次操作内存都要耗费很多等待时间。</p>
<ul>
<li>所以，人们想出来了一个好的办法，就是在CPU和内存之间增加高速缓存。缓存的概念大家都知道，就是保存一份数据拷贝。他的特点是速度快，内存小，并且昂贵。</li>
<li><strong>当程序在运行过程中，会将运算需要的数据从主存复制一份到CPU的高速缓存当中，那么CPU进行计算时就可以直接从它的高速缓存读取数据和向其中写入数据，当运算结束之后，再将高速缓存中的数据刷新到主存当中。</strong></li>
<li>随着CPU能力的不断提升，一层缓存就慢慢的无法满足要求了，就逐渐的衍生出多级缓存。按照数据读取顺序和与CPU结合的紧密程度，CPU缓存可以分为一级缓存（L1），二级缓存（L3），部分高端CPU还具有三级缓存（L3），每一级缓存中所储存的全部数据都是下一级缓存的一部分</li>
<li>当CPU要读取一个数据时，首先从一级缓存中查找，如果没有找到再从二级缓存中查找，如果还是没有就从三级缓存或内存中查找。</li>
<li>单核CPU只含有一套L1，L2，L3缓存；如果CPU含有多个核心，即多核CPU，则每个核心都含有一套L1（甚至和L2）缓存，而共享L3（或者和L2）缓存。</li>
</ul>
<h4 id="计算机内存模型"><a href="#计算机内存模型" class="headerlink" title="计算机内存模型"></a>计算机内存模型</h4><p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20211214014833316.png" alt="image-20211214014833316"></p>
<h4 id="JMM"><a href="#JMM" class="headerlink" title="JMM"></a>JMM</h4><p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20220330140949648.png" alt="image-20220330140949648"></p>
<h2 id="二、并发编程的三个问题"><a href="#二、并发编程的三个问题" class="headerlink" title="二、并发编程的三个问题"></a>二、并发编程的三个问题</h2><h3 id="2-1-原子性"><a href="#2-1-原子性" class="headerlink" title="2.1 原子性"></a>2.1 原子性</h3><blockquote>
<p>和数据库的原子性一样，要么全成功，要么全失败</p>
</blockquote>
<p>jvm只保证了对8大基本类型(除了double,long)读、取操作时原子的</p>
<h3 id="2-2-有序性"><a href="#2-2-有序性" class="headerlink" title="2.2 有序性"></a>2.2 有序性</h3><blockquote>
<p>由于变量的读取经过 工作内存–&gt;缓存–&gt;主存 </p>
<p>各个存储点存储变量的地址不一样，可能变量a，b的地址会近一些，所以操作完a会优先操作b</p>
</blockquote>
<blockquote>
<p>指令重排不会影响单个线程的结果，但在多线程下就会变得不安全。</p>
</blockquote>
<p>例如</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//线程a:</span></span><br><span class="line">student = <span class="keyword">new</span> Student();   <span class="comment">//语句1</span></span><br><span class="line">inited = <span class="keyword">true</span>;             <span class="comment">//语句2</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//线程b:</span></span><br><span class="line"><span class="keyword">while</span>(!inited )&#123;</span><br><span class="line">  sleep()</span><br><span class="line">&#125;</span><br><span class="line">student.doWork();</span><br></pre></td></tr></table></figure>

<ul>
<li>如果线程a按照1、2顺序执行，那么线程b将永远不会在student初始化之前就doWork</li>
</ul>
<h3 id="2-3-可见性"><a href="#2-3-可见性" class="headerlink" title="2.3 可见性"></a>2.3 可见性</h3><blockquote>
<p>该特性可以理解为值时直接访问主存的到的，大家看到的都一样</p>
</blockquote>
<h2 id="三、关键字"><a href="#三、关键字" class="headerlink" title="三、关键字"></a>三、关键字</h2><h3 id="3-1-关键字volatile"><a href="#3-1-关键字volatile" class="headerlink" title="3.1 关键字volatile"></a>3.1 关键字volatile</h3><blockquote>
<p>易见的，易变的</p>
</blockquote>
<h4 id="解决两个问题"><a href="#解决两个问题" class="headerlink" title="解决两个问题"></a>解决两个问题</h4><ol>
<li><p>可见性</p>
<p>原理：面向主存读写</p>
</li>
<li><p>有序性</p>
</li>
</ol>
]]></content>
      <categories>
        <category>java</category>
        <category>JVM</category>
      </categories>
  </entry>
  <entry>
    <title>垃圾回收</title>
    <url>/2022/04/07/java/javaSE/jvm/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/</url>
    <content><![CDATA[<h3 id="垃圾回收器类别"><a href="#垃圾回收器类别" class="headerlink" title="垃圾回收器类别"></a>垃圾回收器类别</h3><p>`</p>
<h3 id="一、圾回收器类别"><a href="#一、圾回收器类别" class="headerlink" title="一、圾回收器类别"></a>一、圾回收器类别</h3><ol>
<li>串行垃圾回收器<ol>
<li>单线程，cpu少</li>
<li>堆内存小</li>
</ol>
</li>
<li>吞吐量优先器<ol>
<li>多线程，堆内存大</li>
<li>单位时间内，SWT最短</li>
</ol>
</li>
<li>响应占比优先<ol>
<li>多线程，堆内存大</li>
<li>单次SWT最短</li>
</ol>
</li>
</ol>
<h3 id="二、判断算法"><a href="#二、判断算法" class="headerlink" title="二、判断算法"></a>二、判断算法</h3><h4 id="引用计数法"><a href="#引用计数法" class="headerlink" title="引用计数法"></a>引用计数法</h4><h4 id="可达性分析算法"><a href="#可达性分析算法" class="headerlink" title="可达性分析算法"></a>可达性分析算法</h4><blockquote>
<p>与根对象不相关的对象将被回收</p>
</blockquote>
<h3 id="回收算法"><a href="#回收算法" class="headerlink" title="回收算法"></a>回收算法</h3><ol>
<li>标记清除</li>
<li>标记整理</li>
<li>复制</li>
</ol>
<h3 id="年代"><a href="#年代" class="headerlink" title="年代"></a>年代</h3><ol>
<li>新生代用复制算法(三块区域：8：1：1)</li>
<li>老年代用标记清除或标记整理</li>
</ol>
<h2 id="四种引用"><a href="#四种引用" class="headerlink" title="四种引用"></a>四种引用</h2><h3 id="强引用"><a href="#强引用" class="headerlink" title="强引用"></a>强引用</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Object obj = <span class="keyword">new</span> Object();</span><br></pre></td></tr></table></figure>

<h3 id="软引用"><a href="#软引用" class="headerlink" title="软引用"></a>软引用</h3><blockquote>
<p>被软引用关联的对象只有在内存不够的情况下才会被回收。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Object obj = <span class="keyword">new</span> Object();</span><br><span class="line">SoftReference&lt;Object&gt; sf = <span class="keyword">new</span> SoftReference&lt;Object&gt;(obj);<span class="comment">//SoftReference</span></span><br><span class="line">obj = <span class="keyword">null</span>;  <span class="comment">// 使对象只被软引用关联</span></span><br></pre></td></tr></table></figure>



<h3 id="弱引用"><a href="#弱引用" class="headerlink" title="弱引用"></a>弱引用</h3><blockquote>
<p>被弱引用关联的对象一定会被回收，也就是说它只能存活到下一次垃圾回收发生之前</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Object obj = <span class="keyword">new</span> Object();</span><br><span class="line">WeakReference&lt;Object&gt; wf = <span class="keyword">new</span> WeakReference&lt;Object&gt;(obj);<span class="comment">//WeakReference 类来实现弱引用</span></span><br><span class="line">obj = <span class="keyword">null</span>;</span><br></pre></td></tr></table></figure>



<h3 id="虚引用"><a href="#虚引用" class="headerlink" title="虚引用"></a>虚引用</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Object obj = <span class="keyword">new</span> Object();</span><br><span class="line">PhantomReference&lt;Object&gt; pf = <span class="keyword">new</span> PhantomReference&lt;Object&gt;(obj);<span class="comment">//PhantomReference </span></span><br><span class="line">obj = <span class="keyword">null</span>;</span><br></pre></td></tr></table></figure>



<h2 id="收集器种类"><a href="#收集器种类" class="headerlink" title="收集器种类"></a>收集器种类</h2><h3 id="分代收集器"><a href="#分代收集器" class="headerlink" title="分代收集器"></a>分代收集器</h3><h3 id="PreNew"><a href="#PreNew" class="headerlink" title="PreNew"></a>PreNew</h3><blockquote>
<p>多线程回收器，对serise扩展，工作在young</p>
</blockquote>
<h3 id="CMS收集器-标记清除算法"><a href="#CMS收集器-标记清除算法" class="headerlink" title="CMS收集器 标记清除算法"></a>CMS收集器 标记清除算法</h3><blockquote>
<p>Concurrent mark sweep，以获取<strong>最短回收停顿时间为目标</strong></p>
</blockquote>
<h4 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h4><ol>
<li>初始标记 （先找到一些）</li>
<li>并发标记(再根据找到的 –&gt;找到更多)</li>
<li>重新标记(用户可能改变了一些)</li>
<li>并发清除</li>
</ol>
<h3 id="分区回收"><a href="#分区回收" class="headerlink" title="分区回收"></a>分区回收</h3><h4 id="G1收集器"><a href="#G1收集器" class="headerlink" title="G1收集器"></a>G1收集器</h4><blockquote>
<p>面向服务端，在多 CPU 和大内存的场景下有很好的性能,尽可能地<strong>满足垃圾收集暂停时间的要求</strong></p>
</blockquote>
<p>G1 把堆划分成多个大小相等的独立区域(Region)，新生代和老年代不再物理隔离。从而将原来的一整块内存空间划分成多个的小空间，使得每个小空间可以单独进行垃圾回收。这种划分方法带来了很大的灵活性</p>
<h4 id="ZGC"><a href="#ZGC" class="headerlink" title="ZGC"></a>ZGC</h4><blockquote>
<p>JDK11 低延迟垃圾回收器,适用于<strong>大内存低延迟服务的内存管理和回回收</strong></p>
</blockquote>
]]></content>
  </entry>
  <entry>
    <title>JVM内存模型</title>
    <url>/2022/04/07/java/javaSE/jvm/JVM%E5%86%85%E5%AD%98%E7%BB%93%E6%9E%84/</url>
    <content><![CDATA[<p>[toc]</p>
<h2 id="一、JVM内存结构"><a href="#一、JVM内存结构" class="headerlink" title="一、JVM内存结构"></a>一、JVM内存结构</h2><p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20211214035039329.png" alt="image-20211214035039329"></p>
<blockquote>
<p>包括：栈、堆、程序计数器、本地方法栈、方法区</p>
</blockquote>
<h3 id="1-1-JVM栈"><a href="#1-1-JVM栈" class="headerlink" title="1.1 JVM栈 "></a>1.1 <a href="https://blog.csdn.net/heart_mine/article/details/79495032">JVM栈 </a></h3><blockquote>
<p>每个线程对应一个栈</p>
<p>栈：方法栈</p>
<p>栈帧：某个方法所需的内存 ：参数，局部变量，返回值(返回地址)</p>
</blockquote>
<blockquote>
<p>默认1024KB，影响递归的深度</p>
</blockquote>
<ul>
<li>每深入一个方法，以栈帧为单位的压栈或者出栈</li>
<li>每退出一个方法，退栈</li>
</ul>
<h4 id="1-1-1-存储内容"><a href="#1-1-1-存储内容" class="headerlink" title="1.1.1 存储内容"></a>1.1.1 存储内容</h4><p>​    栈中只保存基础数据类型的对象和自定义对象的引用(不是整个对象)，对象都存放在堆区中 每个栈中的数据(原始类型和对象引用)都是私有的，其他栈不能访问。</p>
<p>​     栈分为3个部分：基本类型变量区、执行环境上下文、操作指令区(存放操作指令)。</p>
<h4 id="1-1-2-特殊"><a href="#1-1-2-特殊" class="headerlink" title="1.1.2 特殊"></a>1.1.2 特殊</h4><ol>
<li><p>Java方法本身没有线程安不安全，全都依赖它的变量的作用范围</p>
</li>
<li><p>synchronized修饰方法，意思是锁住调用者</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">changeStudent</span><span class="params">(Student s)</span></span>&#123;</span><br><span class="line">	s.setName(<span class="string">&quot;小明&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>当普通方法</p>
</li>
</ol>
<h3 id="1-2-堆内存"><a href="#1-2-堆内存" class="headerlink" title="1.2 堆内存"></a>1.2 堆内存</h3><h4 id="1-2-1-存储内容"><a href="#1-2-1-存储内容" class="headerlink" title="1.2.1 存储内容"></a>1.2.1 存储内容</h4><ol>
<li><p>全部是对象，每个对象包含一个与之对应的class信息–class的目的是得到操作指令。</p>
</li>
<li><p>JDK7之后存储静态变量、字符常量池，JDK7之前存在方法区</p>
</li>
</ol>
<h4 id="1-2-2-堆内存特点"><a href="#1-2-2-堆内存特点" class="headerlink" title="1.2.2 堆内存特点"></a>1.2.2 堆内存特点</h4><p>jvm只有一个堆区（heap）被所有线程共享，堆区中不存放基本类型和对象引用，只存放对象本身。  </p>
<ul>
<li>堆的优势是可以动态地分配内存大小，生存期也不必事先告诉编译器，因为它是在运行时动态分配内存的，Java的垃圾收集器会自动收走这些不再使用的数据。 </li>
<li>缺点是，由于要在运行时动态分配内存，存取速度较慢。</li>
</ul>
<p><a href="https://www.cnblogs.com/shamo89/p/9775122.html">Java堆完全是自动化管理</a>，通过垃圾收集机制，垃圾对象会自动清理，不需自己去释放</p>
<p>Java堆分为新生代(Young Gen)和老年代(Tenured Gen)</p>
<h3 id="1-3-方法区"><a href="#1-3-方法区" class="headerlink" title="1.3 方法区"></a>1.3 方法区</h3><blockquote>
<p>方法区看作是一块独立于Java堆的内存空间，属于共享内存</p>
</blockquote>
<h4 id="1-3-1-存储内容"><a href="#1-3-1-存储内容" class="headerlink" title="1.3.1 存储内容"></a>1.3.1 存储内容</h4><ol>
<li>类头信息<ol>
<li>名称</li>
<li>父类</li>
<li>修饰符</li>
<li>接口</li>
</ol>
</li>
<li>类域信息：字段信息</li>
<li>类方法信息<ol>
<li>名称</li>
<li>参数数量、类型</li>
<li>修饰符</li>
<li>方法字节码(操作+局部变量)</li>
<li>异常表</li>
</ol>
</li>
<li>运行时常量，它是每一个类或接口的常量池的运行时表示形式，在类和接口被加载到JVM后，对应的运行时常量池就被创建出来。在运行期间也可将新的常量放入运行时常量池中，比如String的intern方法。虽然JVM规范把方法区描述为堆的一个逻辑部分， 但它却有个别名non-heap（非堆）。<strong>方法区的大小决定了系统可以加载多少个类</strong>， 如果系统定义的类太多，可能会产生OOM</li>
</ol>
<h4 id="1-3-2-常量池"><a href="#1-3-2-常量池" class="headerlink" title="1.3.2 常量池"></a>1.3.2 常量池</h4><p> 运行时常量池与常量池的区别</p>
<ol>
<li>存放内容：存放编译期间生成的<ol>
<li>各种字面量（字符串和final常量）</li>
<li>字段表、方法表、属性表</li>
<li>符号引用（类和接口的全限定名、字段的名称和描述符、方法句柄和方法类型、方法的名称和描述符 ）</li>
</ol>
</li>
<li>区别<ul>
<li>常量池：存放在.class文件中</li>
<li>运行时常量池：内存中</li>
</ul>
</li>
<li>运行时常量池是常量池表在运行时的表现形式，通过ClassLoader将字节码文件的常量池中的信息加载到内存中，存储在了方法区的运行时常量池中。</li>
</ol>
<h4 id="1-3-3-方法区的演进"><a href="#1-3-3-方法区的演进" class="headerlink" title="1.3.3 方法区的演进"></a>1.3.3 方法区的演进</h4><p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20211214042049855.png" alt="image-20211214042049855"></p>
<p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20211214042305858.png" alt="image-20211214042305858"></p>
<p><a href="https://blog.csdn.net/weixin_43232955/article/details/107411378">图片来源</a></p>
<h4 id="1-3-4-元空间与永久代"><a href="#1-3-4-元空间与永久代" class="headerlink" title="1.3.4 元空间与永久代"></a>1.3.4 元空间与永久代</h4><p>​    元空间不在虚拟机设置的内存中，而是使用本地内存，相对于虚拟机的内存，本地内存空间更大,元空间的大小仅受本地内存限制，更不容易出现OOM</p>
<h4 id="1-3-5-新生代与老年代"><a href="#1-3-5-新生代与老年代" class="headerlink" title="1.3.5 新生代与老年代"></a>1.3.5 <a href="https://www.cnblogs.com/shamo89/p/9775122.html">新生代与老年代</a></h4><blockquote>
<p>新生代存放新生的对象或者年龄不大的对象，老年代则存放老年对象。</p>
</blockquote>
<p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20211214110956494.png" alt="image-20211214110956494"></p>
<ol>
<li><p>新生代分为edn区，s0区，s1区</p>
<p>s0和s1也被称为from和to区域，他们是两块大小相等，并且可以互相转换的空间。</p>
</li>
<li><p>绝大多数情况下，对象首先分配在edn区，在新生代回收后，如果对象还存活，则进入s0或s1区，之后每经过一次新生代回收，如果对象存活则他的年龄就加1，对象达到一定的年龄后，则进入老年代。</p>
</li>
</ol>
<p>举例：A a=new A()；首先把对象存放到堆内存当中，发现这个A只用了一次，首先会进入新生代里边去，存放到edn区域里面，因为Java堆自动化管理，垃圾收集机制，发现这个a只用了一次，如果a又被一段代码引用，垃圾回收机制有算法，每引用一次记录一次，就会马上进入到s0或者是s1区域，一旦a这个对象引用次数非常多了，就会存放到老年代里去。</p>
<h3 id="1-4-本地方法栈"><a href="#1-4-本地方法栈" class="headerlink" title="1.4 本地方法栈"></a>1.4 本地方法栈</h3><p>和java栈的作用差不多，只不过是为JVM使用到的native方法服务的。</p>
<p>Java官方对于本地方法的定义为methods written in a language other than the Java programming language，就是使用非Java语言实现的方法，但是通常我们指的一般为C或者C++，因此这个栈也有着C栈这一称号。一个不支持本地方法执行的JVM没有必要实现这个数据区域。本地方法栈基本和JVM栈一样，其大小也是可以设置为固定值或者动态增加，因此也会对应抛出StackOverflowError和OutOfMemoryError错误。 </p>
<p>在HotSopt虚拟机中直接就把本地方法栈和Java栈合二为一。</p>
<h3 id="1-5-程序计数器"><a href="#1-5-程序计数器" class="headerlink" title="1.5 程序计数器"></a>1.5 程序计数器</h3><blockquote>
<p>用于保存下一条指令的内存地址。</p>
</blockquote>
<p>​    由于JVM程序是多线程执行的（线程轮流切换），所以为了保证线程切换回来后，还能恢复到原先状态，就需要一个独立的计数器，记录之前中断的地方，可见程序计数器也是线程私有的。</p>
<p><strong>注意这个区域是唯一一个不抛出OutOfMemoryError的运行时数据区。</strong></p>
<h3 id="1-6-直接内存"><a href="#1-6-直接内存" class="headerlink" title="1.6 直接内存"></a>1.6 直接内存</h3><blockquote>
<p>常见与IO操作</p>
<p>效率高</p>
<p>不受垃圾回收影响，基于Unsafe释放内存</p>
<ol>
<li>手动Unsafe</li>
<li>自动回收：bf=null，虚引用对象触发unsafe垃圾回收</li>
</ol>
</blockquote>
<h2 id="二、Java内存模型"><a href="#二、Java内存模型" class="headerlink" title="二、Java内存模型"></a>二、Java内存模型</h2><blockquote>
<p>JMM，只是一个抽象的概念，是和多线程相关的，他描述了一组规则或规范，这个规范定义了一个线程对共享变量的写入时对另一个线程是可见的。</p>
</blockquote>
<p>Java堆和方法区的区域是多个线程共享的数据区域，多个线程可能可以操作保存在堆或者方法区中的同一个数据。这也就是我们常说的“Java的线程间通过共享内存进行通信”。<br>在通信过程中会存在一系列如可见性、原子性、顺序性等问题，而JMM就是围绕着多线程通信以及与其相关的一系列特性而建立的模型，JMM定义了一些语法集，这些语法集映射到Java语言中就是volatile、synchronized等关键字。</p>
<p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20211214040257190.png" alt="image-20211214040257190"></p>
<h2 id="三、Java对象模型"><a href="#三、Java对象模型" class="headerlink" title="三、Java对象模型"></a>三、Java对象模型</h2><ol>
<li>每一个Java类在被JVM加载的时候，JVM会给这个类创建一个<code>instanceKlass</code>，保存在方法区</li>
<li>new一个对象的时候，JVM会创建一个<code>instanceOopDesc</code>对象，这个对象中包含了对象头以及实例数据。报保存在堆内</li>
</ol>
<p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20211214040801845.png" alt="image-20211214040801845"></p>
<p><a href="https://www.hollischuang.com/archives/2509">图片来源</a></p>
<h2 id="四、疑惑"><a href="#四、疑惑" class="headerlink" title="四、疑惑"></a>四、疑惑</h2><h3 id="4-1-为什么分栈、堆、方法区的区别"><a href="#4-1-为什么分栈、堆、方法区的区别" class="headerlink" title="4.1 为什么分栈、堆、方法区的区别"></a>4.1 <a href="https://blog.csdn.net/JustKian/article/details/104559654?utm_medium=distribute.pc_aggpage_search_result.none-task-blog-2~aggregatepage~first_rank_ecpm_v1~rank_v31_ecpm-1-104559654.pc_agg_new_rank&utm_term=jvm%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E7%94%A8%E6%A0%88&spm=1000.2123.3001.4430">为什么分栈、堆、方法区的区别</a></h3><blockquote>
<p>堆，栈，方法区等都有自己特有的内存管理方式，都有自己合适存储的内容，方便jvm去调用和进行内存管理</p>
</blockquote>
<p>​    人们发现 变量主要是两种形式</p>
<ul>
<li><p>一种内容短小（比如一个int整数），需要频繁访问，但是生命周期很短，通常只在一个方法内存活</p>
</li>
<li><p>而另一种内容可能很多（比如很长一个字符串），可能不需要太频繁的访问，但生命周期较长，通常很多个方法中可能都要用到</p>
<p>那么自然将这两类变量分开就显得比较理性，一类存储在栈区，通常是局部变量、操作符栈、函数参数传递和返回值，另一类存储在堆区，通常是较大的结构体（或者OOP中的对象）、需要反复访问的全局变量。堆区就是各种慢，申请内存慢，访问慢，修改慢，释放慢，整理慢（或者说GC垃圾回收），但优点也不言而喻，访问随机灵活，空间超大，在不超可用内存的情况下你要多大就给多大</p>
</li>
</ul>
<h3 id="4-2-栈内存"><a href="#4-2-栈内存" class="headerlink" title="4.2 栈内存"></a>4.2 栈内存</h3><blockquote>
<p>栈内存实际上就是满足先进后出的性质的数学或数据结构。</p>
</blockquote>
<h4 id="4-2-1-存储内容"><a href="#4-2-1-存储内容" class="headerlink" title="4.2.1 存储内容"></a>4.2.1 存储内容</h4><p>​    栈内存在函数中定义的一些基本类型的变量和对象的引用变量都在函数的栈内存中分配。当在一段代码块定义一个变量时，Java就在栈中为这个变量分配内存空间，当超过变量的作用域后，Java会自动释放掉为该变量所分配的内存空间，该内存空间可以立即被另作他用。栈中主要存放一些基本类型的变量（,int, short, long, byte, float, double, boolean, char）和对象句柄。栈有一个很重要的特殊性，就是存在栈中的数据可以共享。</p>
<h4 id="4-2-2-特点"><a href="#4-2-2-特点" class="headerlink" title="4.2.2 特点"></a>4.2.2 特点</h4><ul>
<li><p>优点</p>
<p>存取速度比堆要快，仅次于寄存器，栈数据可以共享。</p>
</li>
<li><p>缺点</p>
<p>存在栈中的数据大小与生存期必须是确定的，缺乏灵活性。</p>
</li>
</ul>
<h3 id="4-3-堆内存"><a href="#4-3-堆内存" class="headerlink" title="4.3 堆内存"></a>4.3 堆内存</h3><h4 id="4-3-1-存储内容"><a href="#4-3-1-存储内容" class="headerlink" title="4.3.1 存储内容"></a>4.3.1 存储内容</h4><ol>
<li>方法区</li>
<li>运行时常量池</li>
<li>类实例</li>
</ol>
<h4 id="4-3-2-特点"><a href="#4-3-2-特点" class="headerlink" title="4.3.2 特点"></a>4.3.2 特点</h4><p>允许程序在运行时动态地申请某个大小的内存空间</p>
<h2 id="五、JVM内存"><a href="#五、JVM内存" class="headerlink" title="五、JVM内存"></a>五、JVM内存</h2><h3 id="5-1-变量"><a href="#5-1-变量" class="headerlink" title="5.1 变量"></a>5.1 变量</h3><p>java有三种变量</p>
<ul>
<li>类变量–static—方法区</li>
<li>成员变量–private int age– 堆内存</li>
<li>局部变量—栈</li>
</ul>
<h3 id="5-2-运行时常量池"><a href="#5-2-运行时常量池" class="headerlink" title="5.2 运行时常量池"></a>5.2 运行时常量池</h3><ol>
<li><p>二进制字节码：</p>
<ol>
<li><p>类基本信息：修改实践，版本，创建时间，父类，访问权限</p>
</li>
<li><p>常量池(常量表)</p>
<blockquote>
<p>方法，Class，Field，f</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">#<span class="number">1</span> = Methodref #<span class="number">6.</span>#<span class="number">20</span></span><br><span class="line">#<span class="number">2</span> = Fieldref #<span class="number">3.</span>#<span class="number">4</span> <span class="comment">//java.lang.System.out</span></span><br><span class="line">#<span class="number">3</span> = Class #<span class="number">28</span> <span class="comment">//java.lang.System</span></span><br><span class="line">#<span class="number">4</span> = Utf8 out</span><br></pre></td></tr></table></figure></li>
<li><p><strong>类方法信息</strong></p>
<ol>
<li>方法信息：描述-&gt;返回值.参数.地址</li>
<li>虚拟机指令</li>
</ol>
</li>
</ol>
</li>
</ol>
<h3 id="5-3-StringTable"><a href="#5-3-StringTable" class="headerlink" title="5.3 StringTable"></a>5.3 StringTable</h3><blockquote>
<p>属于运行时常量池，存的是<code>符号</code>，而不是String对象。</p>
<p>字符串常量池：StringTable(HashTable[String,Index])</p>
</blockquote>
<h4 id="5-3-0注意"><a href="#5-3-0注意" class="headerlink" title="5.3.0注意"></a>5.3.0注意</h4><ol>
<li>jdk1.7开始，ST被放在堆中</li>
</ol>
<h4 id="5-3-1-字符串拼接"><a href="#5-3-1-字符串拼接" class="headerlink" title="5.3.1 字符串拼接"></a>5.3.1 字符串拼接</h4><p>单一原则：”a”+”b”—&gt;字符串对象”ab”—&gt;存到StringTable(如果ST已经有了,那么会直接用)</p>
<ul>
<li><p>常量拼接</p>
<p>“ab”==”a”+”b”  常量字符串拼接的javac优化，”a”与”b”都不会变了，javac直接判为”ab”</p>
</li>
<li><p>变量拼接</p>
<p>“ab”!=a+b  因为后者通过StringBuffer的  toString():return new String()</p>
</li>
</ul>
<h4 id="5-3-2-intern"><a href="#5-3-2-intern" class="headerlink" title="5.3.2 intern"></a>5.3.2 intern</h4><blockquote>
<p>将String变量ab的符号放入ST中,但不会改变ab的地址</p>
</blockquote>
<ul>
<li>如果ST中已有，那么就返回这个地址，ab地址不变，即ab!=”ab”</li>
<li>如果ST中没有，那么就把ab的地址直接放入ST中，以后就会有ab==”ab”</li>
</ul>
<ol>
<li><p>new的String在堆中，不在StringTable中</p>
<p>比如String s=new String(“ab”) 那么StringTable中没有”ab”</p>
</li>
<li><p>将s放入ST的方法时intern</p>
<p>String s2=s.intern()</p>
</li>
</ol>
<h4 id="5-3-3-StringTable调优"><a href="#5-3-3-StringTable调优" class="headerlink" title="5.3.3 StringTable调优"></a>5.3.3 StringTable调优</h4><ol>
<li>会存在垃圾回收</li>
<li>建议常用intern()</li>
</ol>
<h4 id="5-4-直接内存"><a href="#5-4-直接内存" class="headerlink" title="5.4 直接内存"></a>5.4 直接内存</h4><ol>
<li>常用于NIO操作(属于操作系统内存，而非JVM内存)</li>
<li>分配回收消耗大</li>
<li>读写性能高</li>
<li>不受JVM内存管理</li>
</ol>
]]></content>
      <categories>
        <category>java</category>
        <category>JVM</category>
      </categories>
  </entry>
  <entry>
    <title>classLoader</title>
    <url>/2022/03/13/java/javaSE/jvm/%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8/</url>
    <content><![CDATA[<p>[toc]</p>
<h2 id="一、类加载器"><a href="#一、类加载器" class="headerlink" title="一、类加载器"></a>一、类加载器</h2><h3 id="1-1-BootStrapClassLoader"><a href="#1-1-BootStrapClassLoader" class="headerlink" title="1.1 BootStrapClassLoader"></a>1.1 BootStrapClassLoader</h3><ol>
<li><p>这是一个c++写的类加载器，在java中显示为null</p>
</li>
<li><p>负责加载JRE_HOME下的lib目录和其他c++写的jar</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>rt.jar</td>
<td>运行环境包，rt即runtime，J2SE 的类定义都在这个包内</td>
</tr>
<tr>
<td>charsets.jar</td>
<td>字符集支持包</td>
</tr>
<tr>
<td>jce.jar</td>
<td>是一组包，它们提供用于加密、密钥生成和协商以及 Message Authentication Code（MAC）算法的框架和实现</td>
</tr>
<tr>
<td>jsse.jar</td>
<td>安全套接字拓展包Java(TM) Secure Socket Extension</td>
</tr>
<tr>
<td>classlist</td>
<td>该文件内表示是引导类加载器应该加载的类的清单</td>
</tr>
<tr>
<td>net.properties</td>
<td>JVM网络配置信息</td>
</tr>
</tbody></table>
</li>
</ol>
<h3 id="1-2-URLClassLoader"><a href="#1-2-URLClassLoader" class="headerlink" title="1.2 URLClassLoader"></a>1.2 URLClassLoader</h3><h2 id="二、类加载机制"><a href="#二、类加载机制" class="headerlink" title="二、类加载机制"></a>二、类加载机制</h2><h3 id="2-1-获得类加载器"><a href="#2-1-获得类加载器" class="headerlink" title="2.1 获得类加载器"></a>2.1 获得类加载器</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Thread.currentThread().getContextClassLoader();<span class="comment">//当前线程的，一般为appClassLoader</span></span><br><span class="line">Student.class.getClassLoader();<span class="comment">//appClassLoader</span></span><br><span class="line">appClassLoader.getParent();<span class="comment">//extClassLoader</span></span><br><span class="line">extClassLoader.getParent();<span class="comment">//null</span></span><br><span class="line">ClassLoader.getSystemClassLoader();<span class="comment">//appClassLoader</span></span><br></pre></td></tr></table></figure>

<h3 id="2-2-类加载的双亲委派"><a href="#2-2-类加载的双亲委派" class="headerlink" title="2.2 类加载的双亲委派"></a>2.2 类加载的双亲委派</h3><h4 id="2-2-1-步骤"><a href="#2-2-1-步骤" class="headerlink" title="2.2.1 步骤"></a>2.2.1 步骤</h4><ol>
<li>MyClassLoader要加载Student.class</li>
<li>委派给parent.parent.parent</li>
<li>parentClassLoader从缓存中找，没有，再去自己的Floder找还没有</li>
<li>委派给child</li>
</ol>
<h4 id="2-2-2-优点"><a href="#2-2-2-优点" class="headerlink" title="2.2.2 优点"></a>2.2.2 优点</h4><ol>
<li><p>能保证类的唯一性</p>
<p>但是这只是Java官方使用并建议的方式，用户自定义加载器可能会创建出多个名字相同的类，所以还需要判断他们的类加载器是否一样。</p>
</li>
</ol>
<h2 id="三、常见类"><a href="#三、常见类" class="headerlink" title="三、常见类"></a>三、常见类</h2><h3 id="3-1-Launcher"><a href="#3-1-Launcher" class="headerlink" title="3.1 Launcher"></a>3.1 Launcher</h3><blockquote>
<p>java入口类，由jvm创建，用来初始化Ext和AppClassLoader，放进主线程的ContextClassLoader中，也就是单例</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Launcher</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Launcher launcher = <span class="keyword">new</span> Launcher();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String bootClassPath =</span><br><span class="line">        System.getProperty(<span class="string">&quot;sun.boot.class.path&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Launcher <span class="title">getLauncher</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> launcher;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ClassLoader loader;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Launcher</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Create the extension class loader</span></span><br><span class="line">        ClassLoader extcl;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            extcl = ExtClassLoader.getExtClassLoader();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> InternalError(</span><br><span class="line">                <span class="string">&quot;Could not create extension class loader&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Now create the class loader to use to launch the application</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            loader = AppClassLoader.getAppClassLoader(extcl);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> InternalError(</span><br><span class="line">                <span class="string">&quot;Could not create application class loader&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//设置AppClassLoader为线程上下文类加载器，这个文章后面部分讲解</span></span><br><span class="line">        Thread.currentThread().setContextClassLoader(loader);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * Returns the class loader used to launch the main application.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ClassLoader <span class="title">getClassLoader</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> loader;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * The class loader used for loading installed extensions.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ExtClassLoader</span> <span class="keyword">extends</span> <span class="title">URLClassLoader</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The class loader used for loading from java.class.path.</span></span><br><span class="line"><span class="comment">     * runs in a restricted security context.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">AppClassLoader</span> <span class="keyword">extends</span> <span class="title">URLClassLoader</span> </span>&#123;&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="3-2-ClassLoader"><a href="#3-2-ClassLoader" class="headerlink" title="3.2 ClassLoader"></a>3.2 ClassLoader</h3><h4 id="loadClass"><a href="#loadClass" class="headerlink" title="loadClass"></a>loadClass</h4><p>此方法负责加载指定名字的类，ClassLoader的实现方法为先从已经加载的类中寻找，如没有则继续从parent ClassLoader中寻找，如仍然没找到，则从System ClassLoader中寻找，最后再调用findClass方法来寻找，如要改变类的加载顺序，则可覆盖此方法</p>
<h4 id="findLoadedClass"><a href="#findLoadedClass" class="headerlink" title="findLoadedClass"></a>findLoadedClass</h4><p>此方法负责从当前ClassLoader实例对象的缓存中寻找已加载的类，调用的为native的方法。</p>
<h4 id="findClass"><a href="#findClass" class="headerlink" title="findClass"></a>findClass</h4><p>此方法直接抛出ClassNotFoundException，因此需要通过覆盖loadClass或此方法来以自定义的方式加载相应的类。</p>
<h4 id="findSystemClass"><a href="#findSystemClass" class="headerlink" title="findSystemClass"></a>findSystemClass</h4><p>此方法负责从System ClassLoader中寻找类，如未找到，则继续从Bootstrap ClassLoader中寻找，如仍然未找到，则返回null。</p>
<h4 id="defineClass"><a href="#defineClass" class="headerlink" title="defineClass"></a>defineClass</h4><p>此方法负责将二进制的字节码转换为Class对象</p>
<h4 id="resolveClass"><a href="#resolveClass" class="headerlink" title="resolveClass"></a>resolveClass</h4><p>此方法负责完成Class对象的链接，如已链接过，则会直接返回。</p>
<h4 id="getSystemResources"><a href="#getSystemResources" class="headerlink" title="getSystemResources"></a>getSystemResources</h4><p>获得classpath路径下的资源路径</p>
<h4 id="getResources"><a href="#getResources" class="headerlink" title="getResources"></a>getResources</h4><p>获得该类下的资源路径</p>
<h2 id="四、其他"><a href="#四、其他" class="headerlink" title="四、其他"></a>四、其他</h2><h3 id="4-1"><a href="#4-1" class="headerlink" title="4.1"></a>4.1</h3><h3 id="类加载的异常"><a href="#类加载的异常" class="headerlink" title="类加载的异常"></a>类加载的异常</h3><h4 id="ClassNotFoundException"><a href="#ClassNotFoundException" class="headerlink" title="ClassNotFoundException"></a>ClassNotFoundException</h4><ul>
<li>Class.forName()</li>
<li>ClassLoader.getSystemClassLoader().loadClass()</li>
</ul>
]]></content>
  </entry>
  <entry>
    <title>Objects</title>
    <url>/2021/12/20/java/java%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB/JUtil/Objects/</url>
    <content><![CDATA[<p>[toc]</p>
<h2 id="一、属性"><a href="#一、属性" class="headerlink" title="一、属性"></a>一、属性</h2><p>1</p>
<h2 id="二、方法"><a href="#二、方法" class="headerlink" title="二、方法"></a>二、方法</h2><blockquote>
<p>私有构造，工具方法类</p>
</blockquote>
<h3 id="2-1-equals"><a href="#2-1-equals" class="headerlink" title="2.1 equals"></a>2.1 equals</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object a, Object b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (a == b) || (a != <span class="keyword">null</span> &amp;&amp; a.equals(b));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-2-deepEquals"><a href="#2-2-deepEquals" class="headerlink" title="2.2 deepEquals"></a>2.2 deepEquals</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">deepEquals</span><span class="params">(Object a, Object b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (a == b)</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (a == <span class="keyword">null</span> || b == <span class="keyword">null</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> Arrays.deepEquals0(a, b);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-3-hashCode"><a href="#2-3-hashCode" class="headerlink" title="2.3 hashCode"></a>2.3 hashCode</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> o != <span class="keyword">null</span> ? o.hashCode() : <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-4-hash"><a href="#2-4-hash" class="headerlink" title="2.4 hash"></a>2.4 hash</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">hash</span><span class="params">(Object... values)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Arrays.hashCode(values);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> java.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.function.Supplier;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Objects</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Objects</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> AssertionError(<span class="string">&quot;No java.util.Objects instances for you!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">toString</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> String.valueOf(o);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">toString</span><span class="params">(Object o, String nullDefault)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (o != <span class="keyword">null</span>) ? o.toString() : nullDefault;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function"><span class="keyword">int</span> <span class="title">compare</span><span class="params">(T a, T b, Comparator&lt;? <span class="keyword">super</span> T&gt; c)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (a == b) ? <span class="number">0</span> :  c.compare(a, b);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">T <span class="title">requireNonNull</span><span class="params">(T obj)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (obj == <span class="keyword">null</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">        <span class="keyword">return</span> obj;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">T <span class="title">requireNonNull</span><span class="params">(T obj, String message)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (obj == <span class="keyword">null</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException(message);</span><br><span class="line">        <span class="keyword">return</span> obj;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isNull</span><span class="params">(Object obj)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> obj == <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">nonNull</span><span class="params">(Object obj)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> obj != <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">   </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">T <span class="title">requireNonNull</span><span class="params">(T obj, Supplier&lt;String&gt; messageSupplier)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (obj == <span class="keyword">null</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException(messageSupplier.get());</span><br><span class="line">        <span class="keyword">return</span> obj;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>java</category>
      </categories>
  </entry>
  <entry>
    <title>springAOP</title>
    <url>/2021/11/18/spring/spring%E6%A0%B8%E5%BF%83/aop/springAOP/</url>
    <content><![CDATA[<p>[toc]</p>
<h2 id="一、AOP术语"><a href="#一、AOP术语" class="headerlink" title="一、AOP术语"></a>一、AOP术语</h2><p><a href="https://mrbird.cc/AOP%E6%9C%AF%E8%AF%AD.html">参考</a></p>
<h3 id="1-通知"><a href="#1-通知" class="headerlink" title="1. 通知"></a>1. 通知</h3><ol>
<li><code>Before</code> —— 在方法被调用之前调用通知。</li>
<li><code>After</code> —— 在方法完成之后调用通知，无论方法是否执行成功。</li>
<li><code>After-returning</code> —— 在方法成功执行之后调用通知。</li>
<li><code>After-throwing</code> —— 在方法抛出异常以后调用通知。</li>
<li><code>Around</code> —— 通知包裹了被通知的方法，在被通知的方法调用之前和调用之后执行自定义的行为。</li>
</ol>
<h3 id="2-连接点-Joinpoint"><a href="#2-连接点-Joinpoint" class="headerlink" title="2. 连接点(Joinpoint)"></a>2. 连接点(Joinpoint)</h3><blockquote>
<p>​    连接点是在应用执行过程中能够插入切面的一个点。这个点可以是调用方法时，抛出异常时，甚至是修改一个字段时。切面代码可以利用这些点插入到应用的正常流程之中，并添加新的行为。</p>
</blockquote>
<h3 id="3-切点-Pointcut"><a href="#3-切点-Pointcut" class="headerlink" title="3. 切点(Pointcut)"></a>3. 切点(Pointcut)</h3><blockquote>
<p>​    切点的定义会匹配通知所要织入的一个或多个连接点。我们通常使用明确的类和方法名称来指定这些切点，或是利用正则表达式定义匹配的类和方法名称模式来指定这些切点。</p>
</blockquote>
<h3 id="4-切面-Aspect"><a href="#4-切面-Aspect" class="headerlink" title="4. 切面(Aspect)"></a>4. 切面(Aspect)</h3><blockquote>
<p>​    切面是通知和切点的结合。通知和切点共同定义了关于切面的全部内容 —— 它是什么，在何时和何处完成其功能。</p>
</blockquote>
<h3 id="5-引入-Introduction"><a href="#5-引入-Introduction" class="headerlink" title="5. 引入(Introduction)"></a>5. 引入(Introduction)</h3><blockquote>
<p>​    引入允许我们向现有的类添加新的方法和属性。</p>
</blockquote>
<h3 id="6-织入-Weaving"><a href="#6-织入-Weaving" class="headerlink" title="6. 织入(Weaving)"></a>6. 织入(Weaving)</h3><blockquote>
<p>​    织入是将切面应用到目标对象来创建新的代理对象的过程。切面在指定的连接点被织入到目标对象中。在目标对象的生命周期里有多个点可以进行织入：</p>
</blockquote>
<ul>
<li>编译器 —— 切面在目标类编译时被织入。</li>
<li>类加载期 —— 切面在目标类加载到JVM时被织入。</li>
<li>运行期 —— 切面在应用运行的某个时候被织入。Spring AOP就是以这种方式织入切面的。</li>
</ul>
<h2 id="二、springAop关键对象"><a href="#二、springAop关键对象" class="headerlink" title="二、springAop关键对象"></a>二、springAop关键对象</h2><table>
<thead>
<tr>
<th align="left">Aspect</th>
<th>一个模块具有一组提供横切需求的 APIs。例如，一个日志模块为了记录日志将被 AOP 方面调用。应用程序可以拥有任意数量的方面，这取决于需求。</th>
<th>切面</th>
<th>@Aspect</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Join point</td>
<td>在你的应用程序中它代表一个点，你可以在插件 AOP 方面。你也能说，它是在实际的应用程序中，其中一个操作将使用 Spring AOP 框架。</td>
<td>连接点</td>
<td>ProceedingJoinPoint</td>
</tr>
<tr>
<td align="left">Advice</td>
<td>这是实际行动之前或之后执行的方法。这是在程序执行期间通过 Spring AOP 框架实际被调用的代码。</td>
<td>通知</td>
<td>@before,after</td>
</tr>
<tr>
<td align="left">Pointcut</td>
<td>这是一组一个或多个连接点，通知应该被执行。你可以使用表达式或模式指定切入点正如我们将在 AOP 的例子中看到的。</td>
<td>切点</td>
<td>@Pointcut</td>
</tr>
<tr>
<td align="left">Introduction</td>
<td>引用允许你添加新方法或属性到现有的类中。</td>
<td></td>
<td></td>
</tr>
<tr>
<td align="left">Target object</td>
<td>被一个或者多个方面所通知的对象，这个对象永远是一个被代理对象。也称为被通知对象。</td>
<td></td>
<td></td>
</tr>
<tr>
<td align="left">Weaving</td>
<td>Weaving 把方面连接到其它的应用程序类型或者对象上，并创建一个被通知的对象。这些可以在编译时，类加载时和运行时完成。</td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h2 id="切入点表达式"><a href="#切入点表达式" class="headerlink" title="切入点表达式"></a>切入点表达式</h2><h3 id="execution-标准式"><a href="#execution-标准式" class="headerlink" title="@execution 标准式"></a>@execution 标准式</h3><h3 id="within-包、类的所有方法"><a href="#within-包、类的所有方法" class="headerlink" title="within 包、类的所有方法"></a>within 包、类的所有方法</h3><h3 id="annotation-注解"><a href="#annotation-注解" class="headerlink" title="@annotation 注解"></a>@annotation 注解</h3><h2 id="三、AOP使用"><a href="#三、AOP使用" class="headerlink" title="三、AOP使用"></a>三、AOP使用</h2><h3 id="3-1-日志"><a href="#3-1-日志" class="headerlink" title="3.1 日志"></a>3.1 日志</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="string">``</span><span class="string">`</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#### 2.1.1 基于注解</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">1. 设置注解</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">   `</span><span class="string">``</span>java</span><br><span class="line">   <span class="keyword">public</span> <span class="meta">@interface</span> Log &#123;</span><br><span class="line">   	<span class="built_in">String</span> value() <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p>加入切入点</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Pointcut(&quot;@annotation(com.wyg.myAnnotation.Log)&quot;)</span><span class="comment">//任意有这个注解的切入</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pointcut</span><span class="params">()</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>加入环绕方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Around(&quot;pointcut()&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">around</span><span class="params">(ProceedingJoinPoint point)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">long</span> beginTime = System.currentTimeMillis();</span><br><span class="line">    point.proceed();			<span class="comment">// 执行方法</span></span><br><span class="line">    <span class="comment">// 执行时长(毫秒)</span></span><br><span class="line">    <span class="keyword">long</span> time = System.currentTimeMillis() - beginTime;</span><br><span class="line">    <span class="comment">// 保存日志</span></span><br><span class="line">    saveLog(point, time);</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="2-1-2-基于方法名称"><a href="#2-1-2-基于方法名称" class="headerlink" title="2.1.2 基于方法名称"></a>2.1.2 基于方法名称</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Pointcut(&quot;@execution(com.springboot.controller.TestController.methodTwo)&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pointcut</span><span class="params">()</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="三、execution语法"><a href="#三、execution语法" class="headerlink" title="三、execution语法"></a>三、execution语法</h2><h3 id="3-1-基本格式"><a href="#3-1-基本格式" class="headerlink" title="3.1 基本格式"></a>3.1 基本格式</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">execution(A com.<span class="keyword">package</span>..B.C(..))</span><br></pre></td></tr></table></figure>

<p>A 返回类型</p>
<p>B 类名</p>
<p>C 方法名</p>
<p>第一个 .. 当前包和子包，还可以写. 表示当前包</p>
<p>第二个.. 表示任意参数 </p>
<h2 id="四、JointPoint-获取连接点信息"><a href="#四、JointPoint-获取连接点信息" class="headerlink" title="四、JointPoint  获取连接点信息"></a>四、JointPoint  获取连接点信息</h2><p><strong>ProceedingJoinPoint只支持around</strong></p>
<table>
<thead>
<tr>
<th>方法名</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>Signature getSignature();</td>
<td>获取封装了署名信息的对象,在该对象中可以获取到目标方法名,所属类的Class等信息</td>
</tr>
<tr>
<td>Object[] getArgs();</td>
<td>获取传入目标方法的参数对象</td>
</tr>
<tr>
<td>Object getTarget();</td>
<td>获取被代理的对象</td>
</tr>
<tr>
<td>Object getThis();</td>
<td>获取代理对象</td>
</tr>
</tbody></table>
<h3 id="Signature"><a href="#Signature" class="headerlink" title="Signature"></a>Signature</h3><ol>
<li>name   String方法名</li>
<li>declareType  Class 这个方法所在的类</li>
</ol>
<h3 id="MethodSignature"><a href="#MethodSignature" class="headerlink" title="MethodSignature"></a>MethodSignature</h3><p>​    ((MethodSignature)joinPoint.getSignature()).getMethod()</p>
<ol>
<li>getMethod 获得目标方法</li>
</ol>
<h2 id="五、ProceedingJoinPoint"><a href="#五、ProceedingJoinPoint" class="headerlink" title="五、ProceedingJoinPoint"></a>五、ProceedingJoinPoint</h2>]]></content>
      <categories>
        <category>spring</category>
      </categories>
  </entry>
  <entry>
    <title>类加载</title>
    <url>/2022/03/22/java/javaSE/jvm/%E7%B1%BB%E5%8A%A0%E8%BD%BD%E8%BF%87%E7%A8%8B/</url>
    <content><![CDATA[<p>[toc]</p>
<h2 id="一、生命周期"><a href="#一、生命周期" class="headerlink" title="一、生命周期"></a>一、生命周期</h2><blockquote>
<p>  JVM把class文件加载的内存，并对数据进行校验、转换解析和初始化，最终形成JVM可以直接使用的Java类型的过程就是加载机制。</p>
</blockquote>
<h3 id="1-1-加载-参考"><a href="#1-1-加载-参考" class="headerlink" title="1.1 加载-参考"></a>1.1 <a href="https://my.oschina.net/winHerson/blog/114180?p=%7B%7BtotalPage%7D%7D">加载-参考</a></h3><ol>
<li>通过一个类的权限定名从文件(.class、.jar、网络)中来获取定义此类的二进制字节流</li>
<li>将这个字节流所代表的静态存储结构转化为方法去的运行时数据结构</li>
<li>在java堆中生成一个代表这个类的java.lang.Class对象，作为方法去这些数据的访问入口。</li>
</ol>
<h3 id="1-2-连接"><a href="#1-2-连接" class="headerlink" title="1.2 连接"></a>1.2 连接</h3><h4 id="1-2-1-验证"><a href="#1-2-1-验证" class="headerlink" title="1.2.1 验证"></a>1.2.1 验证</h4><ol>
<li><p>文件格式验证</p>
<p>验证class文件格式规范，例如： class文件是否已魔术0xCAFEBABE开头 ， 主、次版本号是否在当前虚拟机处理范围之内等</p>
</li>
<li><p>元数据验证</p>
<p>这个阶段是对字节码描述的信息进行语义分析，以保证起描述的信息符合java语言规范要求。验证点可能包括：这个类是否有父类(除了java.lang.Object之外，所有的类都应当有父类)、这个类是否继承了不允许被继承的类(被final修饰的)、如果这个类的父类是抽象类，是否实现了起父类或接口中要求实现的所有方法。</p>
</li>
<li><p>字节码验证</p>
<p>进行数据流和控制流分析，这个阶段对类的方法体进行校验分析，这个阶段的任务是保证被校验类的方法在运行时不会做出危害虚拟机安全的行为.如：保证访法体中的类型转换有效，例如可以把一个子类对象赋值给父类数据类型，这是安全的，但不能把一个父类对象赋值给子类数据类型、保证跳转命令不会跳转到方法体以外的字节码命令上。</p>
</li>
<li><p>符号引用验证</p>
<p>符号引用中通过字符串描述的全限定名是否能找到对应的类、符号引用类中的类，字段和方法的访问性(private、protected、public、default)是否可被当前类访问。</p>
</li>
</ol>
<h4 id="1-2-1-准备"><a href="#1-2-1-准备" class="headerlink" title="1.2.1 准备"></a>1.2.1 准备</h4><blockquote>
<p>为类变量分配内存并设置变量初始值(零值)的阶段，这些内存都将在方法去中进行分配。</p>
</blockquote>
<ol>
<li><p>进行内存分配的仅包括类变量（被static修饰的变量），而不包括实例变量，实例变量将会在对象实例化时随着对象一起分配在java堆中</p>
</li>
<li><p>初始值是指数据类型为零值，主要是为了初始化内存，并不做逻辑代码</p>
<ul>
<li><p>public static int value = 123</p>
<p>那么变量value在准备阶段过后的值是0，而不是123，因为这时候尚未开始执行任何java方法。</p>
</li>
<li><p>public static final int value = 123</p>
<p>final修饰的字段，子啊准备阶段虚拟机就会根据赋值，value的值为123.</p>
</li>
</ul>
</li>
</ol>
<h4 id="1-2-3-解析"><a href="#1-2-3-解析" class="headerlink" title="1.2.3 解析"></a>1.2.3 解析</h4><blockquote>
<p> 虚拟机将常量池内的符号引用替换为直接引用的过程</p>
</blockquote>
<h5 id="1-2-3-1-符号、直接引用"><a href="#1-2-3-1-符号、直接引用" class="headerlink" title="1.2.3.1 符号、直接引用"></a>1.2.3.1 符号、直接引用</h5><ul>
<li>符号引用：描述所引用的目标对象的符号，可以是任何形式的字面量，只要使用时能无歧义地定位到目标即可。引用的目标对象并不一定已经加载到内存中。</li>
<li>直接引用：指向目标对象的指针、相对偏移量、一个能间接定位到目标的句柄。直接引用的目标必定已经在内存中存在。</li>
<li>例如 String a=”str”; 这个a在解析阶段之前就是符号引用，解析之后就是直接引用</li>
</ul>
<h5 id="1-2-3-2-解析内容"><a href="#1-2-3-2-解析内容" class="headerlink" title="1.2.3.2 解析内容"></a>1.2.3.2 解析内容</h5><ol>
<li><p>类或接口的解析</p>
</li>
<li><p>字段解析：解析出类的方法表的class_index项中索引的字段所属的类或接口的符号引用</p>
</li>
<li><p>类方法解析：首先解析出类的方法表的class_index项中索引的方法所属的类或接口的符号引用</p>
</li>
<li><p>接口方法解析：首先解析出类的方法表的class_index项中索引的方法所属的类或接口的符号引用。</p>
</li>
</ol>
<h3 id="1-3-初始化"><a href="#1-3-初始化" class="headerlink" title="1.3 初始化"></a>1.3 初始化</h3><blockquote>
<p>执行类中定义的java程序逻辑代码</p>
</blockquote>
<h4 id="1-3-1-触发条件"><a href="#1-3-1-触发条件" class="headerlink" title="1.3.1 触发条件"></a>1.3.1 触发条件</h4><p>以下四种情况触发执行类构造器clinit()方法</p>
<ol>
<li>new关键字实例化对象</li>
<li>访问一个类的静态字段(被final修饰、已在编译器把结果放入常量池的静态字段除外)</li>
<li>调用类的静态方法</li>
<li>使用java.lang.reflect包的方法对类进行反射调用的时候</li>
<li>jvm启动时，用户指定一个执行的主类(包含main方法的那个类)，虚拟机会先初始化这个类</li>
<li>当初始化一个类的时候，如果发现其父类还没有进行过初始化、则需要先出发其父类的初始化</li>
</ol>
<h3 id="1-4-使用"><a href="#1-4-使用" class="headerlink" title="1.4 使用"></a>1.4 使用</h3><h3 id="1-5-卸载"><a href="#1-5-卸载" class="headerlink" title="1.5 卸载"></a>1.5 卸载</h3><h2 id="二、其他"><a href="#二、其他" class="headerlink" title="二、其他"></a>二、其他</h2><h3 id="2-1-双亲委派机制"><a href="#2-1-双亲委派机制" class="headerlink" title="2.1 双亲委派机制"></a>2.1 双亲委派机制</h3><h3 id="2-2-实例化对象的方式"><a href="#2-2-实例化对象的方式" class="headerlink" title="2.2 实例化对象的方式"></a>2.2 实例化对象的方式</h3><ol>
<li>创建<ol>
<li>new</li>
<li>newInstance(要求有无参构造)</li>
<li>clone</li>
</ol>
</li>
<li>序列化<ol>
<li>加载文件</li>
<li>反序列化</li>
<li>网络请求</li>
</ol>
</li>
</ol>
<h3 id="2-3-newInstance与new"><a href="#2-3-newInstance与new" class="headerlink" title="2.3 newInstance与new"></a>2.3 <a href="https://www.cnblogs.com/zouxiangzhongyan/p/10722118.html">newInstance与new</a></h3><blockquote>
<p>spring中有很多的newInstance</p>
</blockquote>
<ol>
<li>newInstance要求<ol>
<li>这个类已经加载</li>
<li>这个类已经连接了</li>
<li>这两步可用Class.forname完成</li>
</ol>
</li>
<li>newInstance是通过反射创建对象的，在创建一个类的对象的时候，你可以对该类一无所知，一些开源框架比如Spring内部大都是通过反射来创建实例的，当然这种方法创建对象的时候必须拥有该类的句柄，甚至必要的时候还要有相关的权限设置（比如无参构造函数是私有的），而句柄是可以动态载入的，实际上JVM内部也是这样加载类的。该方法创建对象的时候，只会调用该类的无参数构造函数，不会调用其他的有参构造函数。</li>
<li>new  后面接类名参数，是最常见的创建实例的方式。这是必须要知道一个明确的类才能使用</li>
</ol>
<h4 id="2-3-2-解耦"><a href="#2-3-2-解耦" class="headerlink" title="2.3.2 解耦"></a>2.3.2 解耦</h4><blockquote>
<p>newInstance实际上是把new方式分解为两步</p>
</blockquote>
<ol>
<li>首先调用Class加载方法加载某个类</li>
<li>然后实例化。</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> Class a1 = Class.forName(<span class="string">&quot;A&quot;</span>);</span><br><span class="line">BeanFactory a2 =  (BeanFactory) a1.newInstance();</span><br><span class="line">System.out.println(a2);</span><br><span class="line">Class b1 = Class.forName(<span class="string">&quot;B&quot;</span>);</span><br><span class="line">BeanFactory b2 =  (BeanFactory) b1.newInstance();</span><br><span class="line">System.out.println(b2); <span class="comment">//两个l</span></span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String className = readfromXMlConfig;<span class="comment">//从xml 配置文件中获需要加载的类</span></span><br><span class="line">Class c = Class.forName（className）；</span><br><span class="line">factory = （AInterface）c.newInstance（）；<span class="comment">//这样，在不知道是实现类的类名的情况下创建到了实现类</span></span><br></pre></td></tr></table></figure>

<p>可以在调用class.forName时获得更好的灵活性（获得更宽泛的类名），提供给了一种降耦(降低耦合度)的手段。</p>
<h4 id="2-3-3-区别总结"><a href="#2-3-3-区别总结" class="headerlink" title="2.3.3  区别总结"></a>2.3.3  区别总结</h4><ul>
<li>newInstance: 方法级别，弱类型。低效率。只能调用无参构造。</li>
<li>new: 关键字级别，强类型。相对高效。能调用任何public构造。</li>
</ul>
<h4 id="2-3-4-newInstance用途"><a href="#2-3-4-newInstance用途" class="headerlink" title="2.3.4 newInstance用途"></a>2.3.4 newInstance用途</h4><p>是实现IOC、反射、依赖倒置 等技术方法的必然选择，new 只能实现具体类的实例化，不适合于接口编程。类里面就是经过这个类的默认构造函数构建了一个对象，若是没有默认构造函数就抛出InstantiationException, 若是没有访问默认构造函数的权限就抛出IllegalAccessException xml</p>
<h2 id="三、类加载器"><a href="#三、类加载器" class="headerlink" title="三、类加载器"></a>三、类加载器</h2><h3 id="3-1-三级"><a href="#3-1-三级" class="headerlink" title="3.1 三级"></a>3.1 三级</h3><h4 id="3-1-1-Bootstrap类加载器"><a href="#3-1-1-Bootstrap类加载器" class="headerlink" title="3.1.1 Bootstrap类加载器"></a>3.1.1 Bootstrap类加载器</h4><ul>
<li>作用：加载java.lib下面的核心类库<ul>
<li>rt.jar</li>
<li>resources.jar</li>
</ul>
</li>
<li>获取：System.getProperty(“sun.boot.class.path”)</li>
</ul>
<h4 id="3-1-2-Extension类加载器"><a href="#3-1-2-Extension类加载器" class="headerlink" title="3.1.2 Extension类加载器"></a>3.1.2 Extension类加载器</h4><ul>
<li>作用：加载java.lib.ext下的类</li>
<li>System.getProperty(“java.ext.dirs”)</li>
</ul>
<h4 id="3-1-3-System类加载器"><a href="#3-1-3-System类加载器" class="headerlink" title="3.1.3 System类加载器"></a>3.1.3 System类加载器</h4><ul>
<li>作用：加载javaclasspath下的类</li>
</ul>
<h3 id="3-2-双亲委派机制"><a href="#3-2-双亲委派机制" class="headerlink" title="3.2 双亲委派机制"></a>3.2 双亲委派机制</h3>]]></content>
      <categories>
        <category>java</category>
        <category>JVM</category>
      </categories>
  </entry>
  <entry>
    <title>pom常用依赖</title>
    <url>/2021/12/11/spring/%E9%85%8D%E7%BD%AE/pom/pom%E5%B8%B8%E7%94%A8%E4%BE%9D%E8%B5%96/</url>
    <content><![CDATA[<h3 id="1-简略版"><a href="#1-简略版" class="headerlink" title="1. 简略版"></a>1. 简略版</h3><ol>
<li>spring<ol>
<li>spring-boot-starter</li>
<li>spring-boot-starter-test</li>
<li>spring-boot-starter-web</li>
<li>spring-boot-devtools</li>
<li>spring-boot-starter-security</li>
<li>spring-security-test</li>
<li>spring-boot-configuration-processor</li>
</ol>
</li>
<li>mysql<ol>
<li>mysql-connector-java</li>
<li>druid</li>
<li>mybatis<ol>
<li>mybatis-spring-boot-starter</li>
<li>mybatis-plus-boot-starter</li>
<li>mybatis-plus-generator</li>
</ol>
</li>
<li>velocity-engine-core</li>
</ol>
</li>
<li>util<ol>
<li>lombok</li>
<li>commons-lang</li>
<li>fastjson</li>
<li>easyexcel</li>
<li>httpclient</li>
<li>swagger<ol>
<li>springfox-swagger2</li>
<li>springfox-swagger-ui<h3 id="2-完整版"><a href="#2-完整版" class="headerlink" title="2. 完整版"></a>2. 完整版</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--json--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.vaadin.external.google<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>android-json<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.20131108.vaadin1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--http请求类--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.httpcomponents<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>httpclient<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.5.13<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--日志--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-logging<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--web--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--mybatis-plus--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-generator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 模板引擎 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.velocity<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>velocity-engine-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--连接池--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.junit.vintage<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit-vintage-engine<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-freemarker<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.vdurmont<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>emoji-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.56<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--swagger--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.xiaoymin<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>swagger-bootstrap-ui<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.9.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger-ui<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--热部署--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--linux--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ch.ethz.ganymed<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ganymed-ssh2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>build210<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-lang<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-lang<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ol>
</li>
</ol>
]]></content>
      <categories>
        <category>spring</category>
      </categories>
  </entry>
  <entry>
    <title>pom配置</title>
    <url>/2021/12/11/spring/%E9%85%8D%E7%BD%AE/pom/pom%E6%A0%BC%E5%BC%8F/</url>
    <content><![CDATA[<h3 id="基本依赖"><a href="#基本依赖" class="headerlink" title="基本依赖"></a>基本依赖</h3><ol>
<li></li>
</ol>
<h3 id="格式说明参考"><a href="#格式说明参考" class="headerlink" title="格式说明参考"></a>格式说明<a href="https://www.cnblogs.com/q1359720840/p/10465933.html">参考</a></h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--指定了当前pom的版本，4.0.0是固定的 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 主项目标识，用来定义当前maven属于哪个实际的项目 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>反写的公司网址 + 项目名<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 模块名，maven项目和实际的项目不是一一对应的关系，maven项目提现的是模块化的概念，一个实际项目往往会被划分为很多个模块 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>项目名 + 模块名<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 当前项目版本号，一般有三个数字组成 第一个数字：大版本号 第二个数字：分支版本号 第三个数字：先版本号 snapshot: 快照 alpha： </span></span><br><span class="line"><span class="comment">        内测版本 beta： 公测版本 Release： 稳定版本 GA： 正式发布版本 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1snapshot<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- maven项目打包方式，默认情况为jar，还可打包为war，zip，pom等 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span><span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 项目描述名 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span><span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 项目地址 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url</span>&gt;</span><span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 项目描述 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span><span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 开发人员列表 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">developers</span>&gt;</span><span class="tag">&lt;/<span class="name">developers</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 许可证信息 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">licenses</span>&gt;</span><span class="tag">&lt;/<span class="name">licenses</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 组织信息 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">organization</span>&gt;</span><span class="tag">&lt;/<span class="name">organization</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- 依赖列表 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 依赖项目 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.8.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">type</span>&gt;</span><span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 依赖范围，控制依赖与三种依赖范围的关系 --&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 开发中要使用某一个jar，就要将该jar包引入到项目的classpath中 --&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- maven提供了三种classpath： 1.编译 2.测试 3.运行 --&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 下面的test表明junit只存在于测试的classpath中 --&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- maven为scope提供了六个属性：</span></span><br><span class="line"><span class="comment">                                    compile（默认，编译测试运行都有效）， </span></span><br><span class="line"><span class="comment">                                    provided（编译和测试）servlet, </span></span><br><span class="line"><span class="comment">                                    runtime（测试和运行）jdbc, </span></span><br><span class="line"><span class="comment">                                    test（测试）junit, </span></span><br><span class="line"><span class="comment">                                    system（编译和测试，与本机系统相关联，可移植性差）, </span></span><br><span class="line"><span class="comment">                                    import（导入的范围，只使用在dependencyManagerment中，表示从其他的pom中导入dependency的配置） --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 设置依赖是否可选 --&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 有两个值，true和false，默认是false，继承，若为true，子项目必须显式的引用该依赖 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span><span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 排除依赖传递的列表 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- 依赖管理 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 这里定义的依赖不会被运行，即不会被引用为实际的依赖，主要是供子模块集成用 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- 为构建行为提供相应的支持 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 插件列表 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 插件 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span><span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span><span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span><span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- 用于子模块中对于父模块的继承 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 聚合运行多个maven项目 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modules</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span><span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">modules</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>spring</category>
        <category>配置</category>
      </categories>
  </entry>
  <entry>
    <title>pom配置文件</title>
    <url>/2021/12/11/spring/%E9%85%8D%E7%BD%AE/pom/pom%E7%9F%A5%E8%AF%86/</url>
    <content><![CDATA[<p>[toc]</p>
<h2 id="一、POM"><a href="#一、POM" class="headerlink" title="一、POM"></a>一、POM</h2><h3 id="1-1-转载-pom节点说明1"><a href="#1-1-转载-pom节点说明1" class="headerlink" title="1.1 转载-pom节点说明1"></a>1.1 <a href="https://blog.csdn.net/jiangyu1013/article/details/52424726">转载-pom节点说明1</a></h3><ol>
<li><p>modelVersion：声明项目描述符遵循哪一个POM模型版本。<br>模型本身的版本很少改变，虽然如此，但它仍然是必不可少的.<br>这是为了当Maven引入了新的特性或者其他模型变更的时候，确保稳定性。</p>
</li>
<li><p>parent：引入父级pom文件。</p>
</li>
<li><p>groupId：公司名称、组织名称、项目开发者，配置时生成路径也是由此生成（包名，如com.XXX）。</p>
</li>
<li><p>artifactId：项目通用名称。</p>
</li>
<li><p>version：对应项目版本号。</p>
<span id="more"></span></li>
<li><p>packaging：打包后的类型。如war、jar、maven-plugin、ejb、pom、ear、par、rar</p>
</li>
<li><p>name:用户描述项目的名称，可选。</p>
</li>
<li><p>url:项目主页的URL, Maven产生文档时用。</p>
</li>
</ol>
<h3 id="1-2-pom说明2"><a href="#1-2-pom说明2" class="headerlink" title="1.2 pom说明2"></a>1.2 pom说明2</h3><ol>
<li>exclusions：排除管理（写在dependency中）。</li>
<li>exclusion：具体要排除的依赖项</li>
<li>repositories:仓库管理。</li>
<li>repository：具体仓库（有id、name、url子元素）。</li>
<li>properties：自定义标签管理（可在其内自定义标签名、值，<br>用法同于el表达式：${标签名}得到其值），常用于集中定义依赖版本号。</li>
<li>scope：管理部署（可以使用5个值：<ol>
<li>compile，缺省值，适用于所有阶段，会随着项目一起发布。</li>
<li>provided，类似compile，期望JDK、容器或使用者会提供这个依赖。如servlet.jar。</li>
<li>runtime，只在运行时使用，如JDBC驱动，适用运行和测试阶段。</li>
<li>test，只在测试时使用，用于编译和运行测试代码。不会随项目发布。</li>
<li>system，类似provided，需要显式提供包含依赖的jar，Maven不会在Repository中查找它。</li>
</ol>
</li>
</ol>
<h3 id="1-3-pom说明3"><a href="#1-3-pom说明3" class="headerlink" title="1.3 pom说明3"></a>1.3 pom说明3</h3><ol>
<li>dependencies:依赖,jar包管理。</li>
<li>dependency：具体的依赖项。</li>
<li>dependencyManagement：依赖、jar包管理。</li>
</ol>
<h2 id="二、Maven内置了三大特性"><a href="#二、Maven内置了三大特性" class="headerlink" title="二、Maven内置了三大特性"></a>二、<a href="https://blog.csdn.net/bao19901210/article/details/52415402">Maven内置了三大特性</a></h2><h3 id="2-1-Maven六大属性类型"><a href="#2-1-Maven六大属性类型" class="headerlink" title="2.1 Maven六大属性类型"></a>2.1 Maven六大属性类型</h3><ol>
<li><p>内置属性：主要有两个常用内置属性——${basedir}表示项目根目录，即包含pom.xml文件的目录;${version}表示项目版本。</p>
</li>
<li><p>xml的$符号，用法同于el表达式</p>
</li>
<li><p>POM属性：pom中对应元素的值。例如                </p>
<ol>
<li><p>${project.build.sourceDirectory}:项目的主源码目录，默认为src/main/java/.                                                      </p>
</li>
<li><p>${project.build.testSourceDirectory}:项目的测试源码目录，默认为/src/test/java/.                                                 </p>
</li>
<li><p>${project.build.directory}:项目构建输出目录，默认为target/.                                                                 </p>
</li>
<li><p>${project.build.outputDirectory}:项目主代码编译输出目录，默认为target/classes/.                                                </p>
</li>
<li><p>${project.build.testOutputDirectory}:项目测试代码编译输出目录，默认为target/testclasses/.                                         </p>
</li>
<li><p>${project.groupId}:项目的groupId.                                                                                     </p>
</li>
<li><p>${project.artifactId}:项目的artifactId.                                                                                    ${project.version}:项目的version,于</p>
</li>
<li><p>${version}等价                                                                         </p>
</li>
<li><p>${project.build.finalName}:项目打包输出文件的名称，默认为</p>
</li>
<li><p>${project.artifactId}${project.version}.</p>
<p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20211009003422541.png" alt="image-20211009003422541"></p>
</li>
</ol>
</li>
<li><p>自定义属性：在pom中&lt;properties&gt;元素下自定义的Maven属性。</p>
<p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20211009002825691.png" alt="image-20211009002825691"></p>
</li>
<li><p>Settings属性：与POM属性同理。如${settings.localRepository}指向用户本地仓库的地址。</p>
</li>
<li><p>Java系统属性：所有Java系统属性都可以使用Maven属性引用，例如${user.home}指向了用户目录。可以通过命令行mvn help:system查看所有的Java系统属性</p>
</li>
<li><p>环境变量属性：所有环境变量都可以使用以env.开头的Maven属性引用。例如${env.JAVA_HOME}指代了JAVA_HOME环境变量的值。也可以通过命令行mvn help:system查看所有环境变量</p>
</li>
</ol>
<h3 id="2-2-profile"><a href="#2-2-profile" class="headerlink" title="2.2 profile"></a>2.2 profile</h3><blockquote>
<p> 前言,类似于application-prod.properties</p>
</blockquote>
<h3 id="2-3-资源过滤"><a href="#2-3-资源过滤" class="headerlink" title="2.3 资源过滤"></a>2.3 资源过滤</h3><blockquote>
<p>引入resources文件夹意外的资源</p>
</blockquote>
<ol>
<li><p>pom.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/java<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.properties<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>true<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/resources<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.properties<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>true<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>spring</category>
        <category>配置</category>
      </categories>
  </entry>
  <entry>
    <title>redis使用</title>
    <url>/2022/01/10/%E6%95%B0%E6%8D%AE%E5%BA%93/nosql/redis/redis/</url>
    <content><![CDATA[<p>[toc]</p>
<h2 id="一、介绍"><a href="#一、介绍" class="headerlink" title="一、介绍"></a>一、介绍</h2><h3 id="1-1-特点"><a href="#1-1-特点" class="headerlink" title="1.1 特点"></a>1.1 特点</h3><ol>
<li>redis<ol>
<li>特点<ol>
<li><a href="https://www.jianshu.com/p/f42d5f5c495b">原子性</a></li>
<li><a href="https://www.cnblogs.com/myseries/p/11733861.html">单线程</a>，避免了线程切换</li>
<li>多路IO复用</li>
<li><a href="https://blog.csdn.net/xlgen157387/article/details/79470556">为什么说Redis是单线程的以及Redis为什么这么快</a></li>
</ol>
</li>
<li>支持分布式，内置各种数据类型，可持久化，基于内存，支持多种语言</li>
</ol>
</li>
<li>技术分类<ol>
<li><p>功能性: java jsp tomcat html jdbc linux</p>
</li>
<li><p>性能: nosql java线程 hadoop nginx mq elasticSearch</p>
</li>
<li><p>扩展 struts mybtis  spring springBoot </p>
<span id="more"></span></li>
</ol>
</li>
</ol>
<h3 id="解决问题"><a href="#解决问题" class="headerlink" title="解决问题"></a>解决问题</h3><ol>
<li><p>问题</p>
<ol>
<li><p>分布式服务器session共享问题</p>
<ol>
<li><p>放入到cookie，安全性差</p>
</li>
<li><p>session复制，数据冗余</p>
</li>
<li><p>jwt+共享远程nosql，直接放在内存，读取快</p>
</li>
</ol>
</li>
<li><p>数据库大</p>
<ol>
<li>分库分表，读写分离，破坏了业务逻辑</li>
<li>缓存，内存处理，减少IO操作</li>
</ol>
</li>
</ol>
</li>
<li><p>NoSQL(not only sql) 非关系型数据库   k—v</p>
<ol>
<li>特点<ol>
<li>不支持ACID</li>
<li>性能高</li>
<li>原子性</li>
</ol>
</li>
</ol>
</li>
</ol>
<h3 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h3><h4 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h4><ol>
<li>适: 高并发，海量数据，扩展性数据 </li>
<li>不适：事务支持，结构支持</li>
<li>常见NoSQL</li>
<li>Redis<pre><code>1. 支持持久化
    2. 多数据结构
</code></pre>
</li>
<li>MongoDB<pre><code>1. 文档型数据库
    2. json友好型
    3. 支持二进制
</code></pre>
</li>
<li>行数据库 </li>
<li>列数据库 avg ，mean,sum,方便</li>
<li>图数据库</li>
</ol>
<h4 id="实际场景"><a href="#实际场景" class="headerlink" title="实际场景"></a>实际场景</h4><ol>
<li>去最新n个数据的操作</li>
<li>排行榜，取top n个数据 //最佳人气前10条</li>
<li>精确的设置过期时间</li>
<li>计数器</li>
<li>实时系统， 反垃圾系统</li>
<li>pub， sub发布订阅构建实时消息系统</li>
<li>构建消息队列</li>
<li>缓存</li>
</ol>
<h4 id="各个机构的场景"><a href="#各个机构的场景" class="headerlink" title="各个机构的场景"></a>各个机构的场景</h4><ol>
<li>string: 缓存，限流，分布式锁，分布式sesson,计数器</li>
<li>hash:  用户信息，用户访问量</li>
<li>List：简单队列</li>
<li>set ：赞，菜，标签</li>
<li>zset ：排行榜</li>
</ol>
<h4 id="持久化"><a href="#持久化" class="headerlink" title="持久化"></a>持久化</h4><ol>
<li>RDB快照，压缩后的二进制文件</li>
<li>AOF日志持久化，</li>
</ol>
<h4 id="一致性"><a href="#一致性" class="headerlink" title="一致性"></a>一致性</h4><ol>
<li><p>先改缓存，再改数据库   可能存在数据库更新失败，缓存不一致</p>
</li>
<li><p>先数据库，再缓存，可能缓存更新失败，缓存不一致</p>
</li>
<li><p>删除缓存，再更新数据库，再更新缓存，</p>
<blockquote>
<p>先删缓存会造成BAAB问题</p>
</blockquote>
<ol>
<li>可能多线程间缓存乱序问题</li>
<li>一开始 Key: a</li>
<li>A更新Key：b</li>
<li>A删除了Key，B访问key，没有就直接去数据库，发现是Key:a</li>
<li>现在A也更新完了key:b 但是这时候b也更新了缓存</li>
<li>最终缓存为key: a   数据 key: b</li>
</ol>
</li>
<li><p>延时双闪，</p>
<ol>
<li>先删除缓存；</li>
<li>再写数据库；</li>
<li>休眠100毫秒；</li>
<li>再次删除缓存</li>
</ol>
</li>
<li><p>先更新DB，再删除缓存</p>
<blockquote>
<p>可能导致删除缓存失败而导致错误</p>
</blockquote>
<ol>
<li>问题：一开始缓存就没有</li>
<li>线程A  更新数据库   线程B查询</li>
</ol>
</li>
</ol>
<h4 id="缓存穿透"><a href="#缓存穿透" class="headerlink" title="缓存穿透"></a>缓存穿透</h4><blockquote>
<p>一般来自于攻击，大量无效请求(如查询id==-1，id==-2的情况)，缓存种没有，直接访问数据库导致数据库崩掉</p>
</blockquote>
<ol>
<li>过滤请求</li>
<li>构建null缓存，存(id=-1，null)</li>
<li>布隆过滤器</li>
</ol>
<h4 id="缓存雪崩"><a href="#缓存雪崩" class="headerlink" title="缓存雪崩"></a>缓存雪崩</h4><blockquote>
<p>某时间点大面积失效(redis重启)，缓存预热，重启之前先加入一些缓存</p>
</blockquote>
<blockquote>
<p>互斥锁，请求id=1 就把id::1锁起来</p>
</blockquote>
<h4 id="缓存击穿"><a href="#缓存击穿" class="headerlink" title="缓存击穿"></a>缓存击穿</h4><blockquote>
<p>100w个用户同时访问id=2，这redis没有这条数据(或者数据过期)，那么就得访问100w次数据库</p>
<p>解决方案：设置用不过期</p>
<p>互斥锁</p>
</blockquote>
<h4 id="redis-主从复制，主从部署"><a href="#redis-主从复制，主从部署" class="headerlink" title="redis 主从复制，主从部署"></a>redis 主从复制，主从部署</h4><ol>
<li>一主多从  树状结构    </li>
</ol>
<h4 id="哨兵机制"><a href="#哨兵机制" class="headerlink" title="哨兵机制"></a>哨兵机制</h4><p>Master挂了，故障发现，转移主节点</p>
<h4 id="过期策略"><a href="#过期策略" class="headerlink" title="过期策略"></a>过期策略</h4><blockquote>
<p>redis同时使用了惰性过期和定期删除</p>
</blockquote>
<ol>
<li><p>惰性删除</p>
<p>访问到的时候发现过期了才delete，对内存不友好，对cpu友好</p>
</li>
<li><p>定时删除 给每个key 设置一个定时器，cpu每时每刻都扫描</p>
</li>
<li><p>折中：定期删除</p>
</li>
</ol>
<h3 id="更新策略"><a href="#更新策略" class="headerlink" title="更新策略"></a>更新策略</h3><ol>
<li>内存淘汰(被动删除)  <ol>
<li>redis自身内存的容量不足时删除部分数据</li>
<li>低一致性，高性能</li>
</ol>
</li>
<li>过期删除  exparie</li>
<li>主动更新(每次更新mysql,都要更新或者删除redis)<ol>
<li>高一致性，</li>
</ol>
</li>
</ol>
<h2 id="二、reids–linux"><a href="#二、reids–linux" class="headerlink" title="二、reids–linux"></a>二、reids–linux</h2><ol>
<li>各个文件<ol>
<li>benchmark 性能测试</li>
<li>check-aof  修复aof</li>
<li>sentinel  集群</li>
<li>server  启动</li>
<li>cli 客户端</li>
<li>redis.conf 配置文件</li>
</ol>
</li>
</ol>
<h3 id="2-1-下载"><a href="#2-1-下载" class="headerlink" title="2.1 下载"></a>2.1 下载</h3><figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">wget</span> http://download.redis.io/releases/redis-<span class="number">6</span>.<span class="number">0</span>.<span class="number">8</span>.tar.gz</span><br><span class="line"><span class="attribute">tar</span> xzf redis-<span class="number">6</span>.<span class="number">0</span>.<span class="number">8</span>.tar.gz</span><br><span class="line"><span class="attribute">cd</span> redis-<span class="number">6</span>.<span class="number">0</span>.<span class="number">8</span></span><br><span class="line"><span class="attribute">make</span></span><br></pre></td></tr></table></figure>

<h2 id="四、五大类型"><a href="#四、五大类型" class="headerlink" title="四、五大类型"></a>四、五大类型</h2><h3 id="4-1-String字符串"><a href="#4-1-String字符串" class="headerlink" title="4.1 String字符串"></a>4.1 String字符串</h3><blockquote>
<p>类似于ArrayList</p>
</blockquote>
<blockquote>
<p>缓存，计数器，session</p>
<p>限速：短信获取60s</p>
</blockquote>
<h4 id="4-11-说明"><a href="#4-11-说明" class="headerlink" title="4.11 说明"></a>4.11 说明</h4><ol>
<li><p>string是redis最基本的类型，一个key对应一个value。</p>
</li>
<li><p>string也可以是int,float</p>
</li>
<li><p>string类型是二进制安全的。意思是redis的string可以包含任何数据。比如jpg图片或者序列化的对象 。</p>
</li>
<li><p>string类型是Redis最基本的数据类型，一个键最大能存储512MB。</p>
</li>
<li><p>动态String,ArrryList-&gt;扩容，每次1倍，大于1M则每次1M</p>
</li>
</ol>
<h3 id="4-2-链表"><a href="#4-2-链表" class="headerlink" title="4.2 链表"></a>4.2 链表</h3><blockquote>
<p>类似于ArrayDeque，栈-队列-双端队列</p>
</blockquote>
<blockquote>
<p>生产者消费者，消息队列，最新消息</p>
</blockquote>
<h4 id="4-21-说明"><a href="#4-21-说明" class="headerlink" title="4.21 说明"></a>4.21 说明</h4><ol>
<li>多值，排序，双向链表，索引差，两头性能高</li>
<li>redis列表是简单的字符串列表，排序为插入的顺序。列表的最大长度为2^32-1。</li>
<li>redis的列表是使用链表实现的，这意味着，即使列表中有上百万个元素，增加一个元素到列表的头部或尾部的操作都是在常量的时间完成。</li>
<li>可以用列表获取最新的内容（像帖子，微博等），用ltrim很容易就会获取最新的内容，并移除旧的内容。</li>
<li>用列表可以实现生产者消费者模式，生产者调用lpush添加项到列表中，消费者调用rpop从列表中提取，如果没有元素，则轮询去获取，或者使用brpop等待生产者添加项到列表中。</li>
</ol>
<h3 id="4-3-集合"><a href="#4-3-集合" class="headerlink" title="4.3 集合"></a>4.3 集合</h3><blockquote>
<p>HashSet</p>
</blockquote>
<blockquote>
<p>交集，并集，差集，</p>
<p>文章/用户 标签</p>
</blockquote>
<h4 id="4-31-说明"><a href="#4-31-说明" class="headerlink" title="4.31 说明"></a>4.31 说明</h4><ol>
<li>redis集合是无序的字符串集合，集合中的值是唯一的，无序的。可以对集合执行很多操作，例如，测试元素是否存在，对多个集合执行交集、并集和差集等等。</li>
<li>我们通常可以用集合存储一些无关顺序的，表达对象间关系的数据，例如用户的角色，可以用sismember很容易就判断用户是否拥有某个角色。</li>
<li>在一些用到随机值的场合是非常适合的，可以用 srandmember/spop 获取/弹出一个随机元素。<br>同时，使用@EnableCaching开启声明式缓存支持，这样就可以使用基于注解的缓存技术。注解缓存是一个对缓存使用的抽象，过在代码中添加下面的一些注解，达到缓存的效果。</li>
</ol>
<h4 id="4-32-操作"><a href="#4-32-操作" class="headerlink" title="4.32 操作"></a>4.32 操作</h4><h3 id="4-4-ZSet有序集合"><a href="#4-4-ZSet有序集合" class="headerlink" title="4.4 ZSet有序集合"></a>4.4 ZSet有序集合</h3><blockquote>
<p>有序集合</p>
</blockquote>
<blockquote>
<p>排行榜</p>
</blockquote>
<h4 id="4-41-说明"><a href="#4-41-说明" class="headerlink" title="4.41 说明"></a>4.41 说明</h4><ol>
<li>有序集合由唯一的，不重复的字符串元素组成。有序集合中的每个元素都关联了一个浮点值，称为分数。可以把有序看成hash和集合的混合体，分数即为hash的key。</li>
<li>set 底层hash 无序 不重复</li>
<li>有序集合中的元素是按序存储的，不是请求时才排序的。</li>
</ol>
<h3 id="4-5-Hash-哈希"><a href="#4-5-Hash-哈希" class="headerlink" title="4.5 Hash-哈希"></a>4.5 Hash-哈希</h3><blockquote>
<p>HashMap,数组+链表+渐进式rehash</p>
</blockquote>
<blockquote>
<p>直接存储用户信息 set user::id name wang age 20</p>
</blockquote>
<h4 id="4-51-说明"><a href="#4-51-说明" class="headerlink" title="4.51 说明"></a>4.51 说明</h4><ol>
<li>redis的哈希值是字符串字段和字符串之间的映射，是表示对象的完美数据类型。</li>
<li>哈希中的字段数量没有限制，所以可以在你的应用程序以不同的方式来使用哈</li>
</ol>
<h3 id="4-6-BitMap"><a href="#4-6-BitMap" class="headerlink" title="4.6 BitMap"></a>4.6 BitMap</h3><blockquote>
<p>实际为字符串.可以想象成byte[]</p>
</blockquote>
<blockquote>
<p>用户签到，用户活跃，去重，布隆过滤器</p>
</blockquote>
<h2 id="六、原理"><a href="#六、原理" class="headerlink" title="六、原理"></a>六、原理</h2><ol>
<li>单线程+多路IO复用 NIO</li>
<li>list<ol>
<li>quickList<ol>
<li>数据少的时候是连续内存  ziplist</li>
<li>数据多将多个ziplist用链表连接起来</li>
</ol>
</li>
</ol>
</li>
</ol>
<h2 id="七、远程连接"><a href="#七、远程连接" class="headerlink" title="七、远程连接"></a>七、远程连接</h2><h3 id="7-1-配置"><a href="#7-1-配置" class="headerlink" title="7.1 配置"></a>7.1 配置</h3><ol>
<li><p>修改.conf配置文件</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">bind 0.0.0.0 </span><br><span class="line">protected-mode no</span><br></pre></td></tr></table></figure></li>
<li><p>增加密码</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">&gt;redis <span class="built_in"> config </span><span class="builtin-name">set</span> requirepass root1</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="7-2-连接"><a href="#7-2-连接" class="headerlink" title="7.2 连接"></a>7.2 连接</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">redis-cli -h 192.168.100.1 </span><br><span class="line"><span class="meta">&gt;</span><span class="bash">redis auth root1</span></span><br></pre></td></tr></table></figure>





<h3 id="7-3-操作"><a href="#7-3-操作" class="headerlink" title="7.3 操作"></a>7.3 操作</h3><h2 id="八、安装"><a href="#八、安装" class="headerlink" title="八、安装"></a>八、安装</h2><h3 id="Redis6"><a href="#Redis6" class="headerlink" title="Redis6"></a>Redis6</h3><h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ol>
<li><a href="https://blog.csdn.net/xlgen157387/article/details/79470556">https://blog.csdn.net/xlgen157387/article/details/79470556</a></li>
</ol>
<h3 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h3><ol>
<li>不用keys</li>
</ol>
<h4 id="新的数据类型"><a href="#新的数据类型" class="headerlink" title="新的数据类型"></a>新的数据类型</h4><h4 id="redis新事务"><a href="#redis新事务" class="headerlink" title="redis新事务"></a>redis新事务</h4><h4 id="主从复制"><a href="#主从复制" class="headerlink" title="主从复制"></a>主从复制</h4><h4 id="雪崩"><a href="#雪崩" class="headerlink" title="雪崩"></a>雪崩</h4>]]></content>
      <categories>
        <category>数据库</category>
      </categories>
  </entry>
  <entry>
    <title>redis命令</title>
    <url>/2022/01/30/%E6%95%B0%E6%8D%AE%E5%BA%93/nosql/redis/reids%E5%91%BD%E4%BB%A4/</url>
    <content><![CDATA[<blockquote>
<p>1.基于内存的key-value数据库<br>2.基于c语言编写的，可以支持多种语言的api //set每秒11万次，取get 81000次<br>3.支持数据持久化<br>4.value可以是string，hash， list， set, sorted set</p>
<p>使用场景</p>
<ol>
<li>去最新n个数据的操作</li>
<li>排行榜，取top n个数据 //最佳人气前10条</li>
<li>精确的设置过期时间</li>
<li>计数器</li>
<li>实时系统， 反垃圾系统</li>
<li>pub， sub发布订阅构建实时消息系统</li>
<li>构建消息队列</li>
<li>缓存</li>
</ol>
</blockquote>
<h2 id="一、命令"><a href="#一、命令" class="headerlink" title="一、命令"></a>一、命令</h2><h3 id="1-1-启动-连接-停止"><a href="#1-1-启动-连接-停止" class="headerlink" title="1.1      启动 连接 停止"></a>1.1      启动 连接 停止</h3><p>启动</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line"><span class="keyword">cd</span> src</span><br><span class="line"><span class="string">./redis-servie</span></span><br></pre></td></tr></table></figure>

<p>连接客户端</p>
<figure class="highlight x86asm"><table><tr><td class="code"><pre><span class="line">./redis-<span class="keyword">cli</span></span><br><span class="line">./redis-<span class="keyword">cli</span> -h <span class="built_in">ip</span>地址 -p 端口</span><br></pre></td></tr></table></figure>

<p>停止/kill</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line"><span class="string">./redis-cli</span> <span class="keyword">shutdown</span></span><br></pre></td></tr></table></figure>



<h2 id="二、操作"><a href="#二、操作" class="headerlink" title="二、操作"></a>二、操作</h2><h3 id="2-0-配置命令"><a href="#2-0-配置命令" class="headerlink" title="2.0 配置命令"></a>2.0 配置命令</h3><ol>
<li><p>获得配置信息</p>
<p>config get key</p>
</li>
</ol>
<h3 id="2-1-全局"><a href="#2-1-全局" class="headerlink" title="2.1 全局"></a>2.1 全局</h3><h4 id="2-1-1-库操作"><a href="#2-1-1-库操作" class="headerlink" title="2.1.1  库操作"></a>2.1.1  库操作</h4><ol>
<li>切换库 select 1</li>
<li>dbsize数据库大小</li>
<li>flushdb 清空库</li>
</ol>
<h4 id="2-1-2-key操作"><a href="#2-1-2-key操作" class="headerlink" title="2.1.2 key操作"></a>2.1.2 key操作</h4><blockquote>
<p>注意每个单词要有空格分开</p>
</blockquote>
<ol>
<li>查看所有 keys *   keys nam*  查看所有 nam开头的* </li>
<li> 赋值 set k v </li>
<li> 多赋值 mset k1 k2 v1 v2</li>
<li> 获取值  get k</li>
<li> 多取值 mget k1 k2</li>
<li>检查是否存在  exists key</li>
<li>key类型 type key </li>
<li>删除key del key</li>
<li>删除所有key flushdb</li>
<li>设置过期时间秒 expire key  10  </li>
<li>persist key 删除过期时间</li>
<li>ttl  key 查看多少秒过期  -2 已经过期   -1 永不过期</li>
</ol>
<h3 id="2-2-string"><a href="#2-2-string" class="headerlink" title="2.2 string"></a>2.2 string</h3><ol>
<li>set k str  get k</li>
<li>append k 追加</li>
<li>strlen k</li>
<li>setnx  不存在则设置   返回0表示已经存在</li>
<li>incr/decr k  增加/减少1 </li>
<li>incrby/decrby k n  增加/减少n   原子性操作</li>
<li>mset mget msetnx(都不存在才成功)</li>
<li>getrange k begin end    —-&gt;substring</li>
<li>setrange k begin  str       —-&gt;替换覆盖</li>
<li>setex k 100 v  同时设置</li>
<li>getset 取了就换 </li>
</ol>
<h4 id="2-3-list"><a href="#2-3-list" class="headerlink" title="2.3 list"></a>2.3 list</h4><ol>
<li>push k v1 v2  左是头-头插法  v2 v1</li>
<li>rpush k v1 v2 右是头头插法 v1 v2</li>
<li>lrange k begin end 从左开始取</li>
<li>lpop/rpop  从左/右吐出一个</li>
<li>rpoplpush  右边吐一个放在左边 </li>
<li>index k 0  按下标取</li>
<li>llen</li>
<li>linsert k before/after “str3”  “strn” 在str3 前面插入strn</li>
<li>lrem k before/after “str3”  …</li>
<li>lset k 0 “wang” 把第一个设置为”wang”</li>
</ol>
<h3 id="2-4-hash"><a href="#2-4-hash" class="headerlink" title="2.4 hash"></a>2.4 hash</h3><table>
<thead>
<tr>
<th>1</th>
<th>hdel hs key field1 [field2]        删除一个或多个哈希表字段</th>
</tr>
</thead>
<tbody><tr>
<td>2</td>
<td>hexisit hs key field 查看哈希表 key 中，指定的字段是否存在。</td>
</tr>
<tr>
<td>3</td>
<td>hget key field 获取存储在哈希表中指定字段的值。</td>
</tr>
<tr>
<td>4</td>
<td>hgetall hs  key 获取在哈希表中指定 key 的所有字段和值</td>
</tr>
<tr>
<td>5</td>
<td><a href="https://www.runoob.com/redis/hashes-hincrby.html">HINCRBY key field increment</a> 为哈希表 key 中的指定字段的整数值加上增量 increment 。</td>
</tr>
<tr>
<td>6</td>
<td><a href="https://www.runoob.com/redis/hashes-hincrbyfloat.html">HINCRBYFLOAT key field increment</a> 为哈希表 key 中的指定字段的浮点数值加上增量 increment 。</td>
</tr>
<tr>
<td>7</td>
<td><a href="https://www.runoob.com/redis/hashes-hkeys.html">HKEYS key</a> 获取所有哈希表中的字段</td>
</tr>
<tr>
<td>8</td>
<td><a href="https://www.runoob.com/redis/hashes-hlen.html">HLEN key</a> 获取哈希表中字段的数量</td>
</tr>
<tr>
<td>9</td>
<td>[HMGET key field1 <a href="https://www.runoob.com/redis/hashes-hmget.html">field2]</a> 获取所有给定字段的值</td>
</tr>
<tr>
<td>10</td>
<td>[HMSET key field1 value1 <a href="https://www.runoob.com/redis/hashes-hmset.html">field2 value2 ]</a> 同时将多个 field-value (域-值)对设置到哈希表 key 中。</td>
</tr>
<tr>
<td>11</td>
<td><a href="https://www.runoob.com/redis/hashes-hset.html">HSET key field value</a> 将哈希表 key 中的字段 field 的值设为 value 。</td>
</tr>
<tr>
<td>12</td>
<td><a href="https://www.runoob.com/redis/hashes-hsetnx.html">HSETNX key field value</a> 只有在字段 field 不存在时，设置哈希表字段的值。</td>
</tr>
<tr>
<td>13</td>
<td><a href="https://www.runoob.com/redis/hashes-hvals.html">HVALS key</a> 获取哈希表中所有值。</td>
</tr>
<tr>
<td>14</td>
<td>[HSCAN key cursor <a href="https://www.runoob.com/redis/hashes-hscan.html">MATCH pattern] [COUNT count]</a> 迭代哈希表中的键值对。</td>
</tr>
</tbody></table>
<h3 id="2-5-set"><a href="#2-5-set" class="headerlink" title="2.5 set"></a>2.5 set</h3><ol>
<li>sadd k v1 v2</li>
<li>smembers k</li>
<li>sismember k v v是否存在 1true</li>
<li>scard k   返回个数</li>
<li>spop 随机吐出一个</li>
<li>srandmenber k  n随机取出n个</li>
<li>smove k v k2   迁移</li>
<li>交集</li>
<li>并集</li>
</ol>
<h3 id="2-6-zset"><a href="#2-6-zset" class="headerlink" title="2.6 zset"></a>2.6 zset</h3>]]></content>
  </entry>
  <entry>
    <title>mybatis-TypeHandler</title>
    <url>/2022/04/23/%E7%BB%84%E4%BB%B6/ORM/mybatis/TypeHandler/</url>
    <content><![CDATA[<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">/</span><br><span class="line"><span class="comment">// 该注解限定了只对jdbctype=tinyint类型起作用</span></span><br><span class="line"><span class="meta">@MappedJdbcTypes(JdbcType.TINYINT)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SexHandler</span> <span class="keyword">extends</span> <span class="title">BaseTypeHandler</span>&lt;<span class="title">String</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setNonNullParameter</span><span class="params">(PreparedStatement ps, <span class="keyword">int</span> i, String parameter, JdbcType jdbcType)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;女&quot;</span>.equals(parameter)) &#123;</span><br><span class="line">            ps.setInt(i, <span class="number">2</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span>  &#123;</span><br><span class="line">            ps.setInt(i, <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getNullableResult</span><span class="params">(ResultSet rs, String columnName)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> tansSex(rs.getInt(columnName));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">tansSex</span><span class="params">(<span class="keyword">int</span> sex)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (sex == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;男&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;女&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getNullableResult</span><span class="params">(ResultSet rs, <span class="keyword">int</span> columnIndex)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> tansSex(rs.getInt(columnIndex));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getNullableResult</span><span class="params">(CallableStatement cs, <span class="keyword">int</span> columnIndex)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> tansSex(cs.getInt(columnIndex));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="string">//配置</span></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="attr">default-enum-type-handler:</span> <span class="string">com.wyg.e.SexHandler</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">//使用</span><br><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;single.mybatis.mapper.dao.MybatisUserinfoMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;single.mybatis.mapper.entity.MybatisUserinfoModel&quot;</span> <span class="attr">id</span>=<span class="string">&quot;MybatisUserinfoMap&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;username&quot;</span> <span class="attr">column</span>=<span class="string">&quot;username&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;age&quot;</span> <span class="attr">column</span>=<span class="string">&quot;age&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;sex&quot;</span> <span class="attr">column</span>=<span class="string">&quot;sex&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;TINYINT&quot;</span> <span class="attr">typeHandler</span>=<span class="string">&quot;single.mybatis.mapper.typehandle.SexHandler&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;createTime&quot;</span> <span class="attr">column</span>=<span class="string">&quot;create_time&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;TIMESTAMP&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;updateTime&quot;</span> <span class="attr">column</span>=<span class="string">&quot;update_time&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;TIMESTAMP&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectList&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;MybatisUserinfoMap&quot;</span>&gt;</span></span><br><span class="line">        select * from mybatis_userinfo</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insert&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;single.mybatis.mapper.entity.MybatisUserinfoModel&quot;</span>&gt;</span></span><br><span class="line">        INSERT INTO</span><br><span class="line">        mybatis_userinfo(`username`, `age`, `sex`, `create_time`, `update_time`)</span><br><span class="line">        VALUES</span><br><span class="line">        (#&#123;username&#125;, #&#123;age&#125;, #&#123;sex,typeHandler=single.mybatis.mapper.typehandle.SexHandler&#125;, #&#123;createTime&#125;, #&#123;updateTime&#125;);</span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

]]></content>
  </entry>
  <entry>
    <title>mybatis-plus使用</title>
    <url>/2022/03/06/%E7%BB%84%E4%BB%B6/ORM/mybatis/mybatis-plus/</url>
    <content><![CDATA[<p>[toc]</p>
<h3 id="使用步骤"><a href="#使用步骤" class="headerlink" title="使用步骤"></a>使用步骤</h3><ol>
<li><p>依赖</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>创建mapper继承Base,这里的@Mapper可不加，plus已封装</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> <span class="keyword">extends</span> <span class="title">BaseMapper</span>&lt;<span class="title">User</span>&gt; </span>&#123; &#125;</span><br></pre></td></tr></table></figure></li>
<li><p>entity—table对应</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@TableName(&quot;article&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Article</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>注入mapper</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">UserMapper userMapper;</span><br></pre></td></tr></table></figure></li>
<li><p>调用QueryWrapper</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//通过数据库获取用户名和密码</span></span><br><span class="line">QueryWrapper&lt;Users&gt;wrapper=<span class="keyword">new</span> QueryWrapper&lt;&gt;();</span><br><span class="line">wrapper.eq(<span class="string">&quot;name&quot;</span>,name);</span><br><span class="line">Users users = userMapper.selectOne(wrapper);</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="基本Component"><a href="#基本Component" class="headerlink" title="基本Component"></a>基本Component</h3><ol>
<li>Mapper extends BaseMapper&lt;Student&gt;</li>
<li>Service extends Iservice&lt;Student&gt;</li>
<li>ServiceImpl extends ServiceImpl&lt;Mapper,Student&gt; implements Service </li>
<li>其他<ol>
<li>所有要用到的方法都需要在接口service上定义或者已经被定义</li>
<li>甚至对于需要写mapper.xml的方法需要在xml,mapper,servcie,serviceImpl都要有</li>
</ol>
</li>
</ol>
<h3 id="wrapper"><a href="#wrapper" class="headerlink" title="wrapper"></a>wrapper</h3><p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20211009144556147.png" alt="image-20211009144556147"></p>
<span id="more"></span>

<p> <a href="https://mp.baomidou.com/guide/wrapper.html">wrapper官方文档</a></p>
<ol>
<li><p>全等map：allEq(map,bool)</p>
</li>
<li><p>不相等 ne</p>
</li>
<li><p>allEq(filter)  筛选key</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//key有a才算条件</span></span><br><span class="line">allEq((k,v) -&gt; k.indexOf(<span class="string">&quot;a&quot;</span>) &gt;= <span class="number">0</span>, &#123;id:<span class="number">1</span>,name:<span class="string">&quot;老王&quot;</span>,age:<span class="keyword">null</span>&#125;)---&gt;name = <span class="string">&#x27;老王&#x27;</span> and age is <span class="keyword">null</span></span><br></pre></td></tr></table></figure></li>
<li><p>范围 between</p>
<p>between(“age”, 18, 30)<code>---&gt;</code>age between 18 and 30</p>
</li>
<li><p>模糊查询</p>
<p>like(“name”, “王”)<code>---&gt;</code>name like ‘%王%’</p>
<p>likeLeft 左  这个不走索引</p>
</li>
<li><p>insql 纯sql的in</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">inSql(<span class="string">&quot;id&quot;</span>, <span class="string">&quot;select id from table where id &lt; 3&quot;</span>)`---&gt;`<span class="function">id <span class="title">in</span> <span class="params">(select id from table where id &lt; <span class="number">3</span>)</span></span></span><br></pre></td></tr></table></figure></li>
<li><p>groupBy</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">groupBy(<span class="string">&quot;id&quot;</span>, <span class="string">&quot;name&quot;</span>)`---&gt;`group by id,name</span><br></pre></td></tr></table></figure></li>
<li><p>having   sql</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">having(<span class="string">&quot;sum(age) &gt; &#123;0&#125;&quot;</span>, <span class="number">11</span>)---&gt;<span class="function">having <span class="title">sum</span><span class="params">(age)</span> &gt; 11</span></span><br></pre></td></tr></table></figure></li>
<li><p>order asc desc</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">orderByAsc(<span class="string">&quot;id&quot;</span>, <span class="string">&quot;name&quot;</span>)---&gt;order by id ASC,name ASC</span><br></pre></td></tr></table></figure></li>
<li><p>func</p>
</li>
<li><p>apply –拼接sql</p>
<p>该方法可用于数据库<strong>函数</strong> 动态入参的<code>params</code>对应前面<code>applySql</code>内部的<code>&#123;index&#125;</code>部分.这样是不会有sql注入风险的,反之会有!</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">apply(<span class="string">&quot;date_format(dateColumn,&#x27;%Y-%m-%d&#x27;) = &#123;0&#125;&quot;</span>, <span class="string">&quot;2008-08-08&quot;</span>)</span><br><span class="line">    ---&gt; date_format(dateColumn,<span class="string">&#x27;%Y-%m-%d&#x27;</span>) = <span class="string">&#x27;2008-08-08&#x27;</span><span class="string">&quot;)</span></span><br></pre></td></tr></table></figure></li>
<li><p>last –最后拼接</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">last(<span class="string">&quot;limit 1&quot;</span>)</span><br></pre></td></tr></table></figure></li>
<li><p>exists 拼接exists语句</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">exists(<span class="string">&quot;select id from table where age = 1&quot;</span>)---&gt;exists (select id from table where age = <span class="number">1</span>)</span><br></pre></td></tr></table></figure></li>
<li><p>LambdaQuerryWrapper</p>
</li>
</ol>
<h3 id="CURD"><a href="#CURD" class="headerlink" title="CURD"></a>CURD</h3><ol>
<li>BaseMapper<ol>
<li>select<ol>
<li>selectById</li>
<li>selectOne 条件查询唯一条的，有多个符合条件会报错</li>
<li>selectByMap({“name”:”wang”,”age”:12})   map的k是数据库的下划线形式</li>
<li>selectByPage(new Page&lt;Object&gt;(2,10))  </li>
</ol>
</li>
<li>update <ol>
<li>byId(obj) 自动跳过空值  </li>
<li>AllColumnsById</li>
</ol>
</li>
</ol>
</li>
</ol>
<h3 id="method"><a href="#method" class="headerlink" title="method"></a>method</h3><ol>
<li>seleteByMap</li>
</ol>
<h3 id="entity"><a href="#entity" class="headerlink" title="entity"></a>entity</h3><ol>
<li>@TableField</li>
<li></li>
</ol>
<h3 id="自动insert填充"><a href="#自动insert填充" class="headerlink" title="自动insert填充"></a>自动insert填充</h3><ol>
<li><p>创建配置器</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//交给spring管理</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyMetaObjectHandler</span> <span class="keyword">implements</span> <span class="title">MetaObjectHandler</span> </span>&#123;</span><br><span class="line">    <span class="comment">//使用mp实现添加操作,这个方法会执行,metaObject元数据(表中的名字,表中的字段)</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertFill</span><span class="params">(MetaObject metaObject)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//根据名称设置属性值</span></span><br><span class="line">        <span class="keyword">this</span>.setFieldValByName(<span class="string">&quot;createTime&quot;</span>,<span class="keyword">new</span> Date(),metaObject);</span><br><span class="line">        <span class="keyword">this</span>.setFieldValByName(<span class="string">&quot;updateTime&quot;</span>,<span class="keyword">new</span> Date(),metaObject);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//使用mp实现修改操作,这个方法会执行</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateFill</span><span class="params">(MetaObject metaObject)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.setFieldValByName(<span class="string">&quot;updateTime&quot;</span>,<span class="keyword">new</span> Date(),metaObject);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>实体类插入创建时间</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//自动创建时间</span></span><br><span class="line"><span class="meta">@TableField(value = &quot;create_time&quot;, fill = FieldFill.INSERT)</span></span><br><span class="line"> java.util.Date dateT</span><br></pre></td></tr></table></figure>

<ol>
<li>注意这个Date是java.util</li>
</ol>
</li>
</ol>
<h3 id="分页查询"><a href="#分页查询" class="headerlink" title="分页查询"></a>分页查询</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span><span class="comment">//注入分页插件bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> PaginationInterceptor <span class="title">paginationInterceptor</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">new</span> PaginationInterceptor();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//使用Page&lt;T&gt;对象</span></span><br><span class="line">Page page=<span class="keyword">new</span> Page&lt;&gt;(current,size);</span><br><span class="line">baseMapper.page(page,wrapper);</span><br></pre></td></tr></table></figure>



<h3 id="乐观锁"><a href="#乐观锁" class="headerlink" title="乐观锁"></a>乐观锁</h3><ol>
<li><p>entity注解</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Version</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> version;</span><br></pre></td></tr></table></figure></li>
<li><p>乐观锁插件</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> OptimisticLockerInnerInterceptor <span class="title">optimisticLockerInnerInterceptor</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> OptimisticLockerInnerInterceptor();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="Id生成"><a href="#Id生成" class="headerlink" title="Id生成"></a>Id生成</h3><ol>
<li><p>代码</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//保存/新建  如果没有id就是新建，就创建id，然后插入</span></span><br><span class="line">String id = reqDTO.getId();</span><br><span class="line"><span class="keyword">if</span>(StringUtils.isBlank(id))&#123;</span><br><span class="line">    id = IdWorker.getIdStr();</span><br><span class="line">    <span class="keyword">long</span> id = IdWorker.getId();</span><br><span class="line">    String uuid = IdWorker.get32UUID();</span><br><span class="line">    String idStr = IdWorker.getIdStr();</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@TableId(type = IdType.ASSIGN_ID)</span></span><br></pre></td></tr></table></figure></li>
<li><p>UUID(Universally Unique Dentifer)的标准型式包含32个16进制数字,以连字号分为五段,形式为8-4-4-4-12的32个字符,示例:550e8400-e29b-41d4-a716-446655440000</p>
</li>
<li><p><a href="https://blog.csdn.net/qq_40950903/article/details/108589837">各个id对与分布式的应用</a></p>
</li>
<li><p>id生成策略</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">AUTO 数据库ID自增</span><br><span class="line"><span class="keyword">INPUT</span> 用户输入ID</span><br><span class="line"><span class="type">UUID</span> 全局唯一ID，<span class="type">UUID</span>类型的主键</span><br><span class="line"><span class="keyword">NONE</span> 该类型为未设置主键类</span><br><span class="line">ASSIGN_ID <span class="number">19</span> 雪花算法</span><br><span class="line">ASSIGN_UUID <span class="number">19</span></span><br></pre></td></tr></table></figure></li>
<li><p>雪花算法</p>
<p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20211013014035492.png" alt="image-20211013014035492"></p>
</li>
</ol>
]]></content>
      <categories>
        <category>组件</category>
      </categories>
  </entry>
  <entry>
    <title>mybatis之动态sql</title>
    <url>/2022/02/21/%E7%BB%84%E4%BB%B6/ORM/mybatis/mybatis-%E5%8A%A8%E6%80%81sql/</url>
    <content><![CDATA[<h1 id="mybatis之动态sql"><a href="#mybatis之动态sql" class="headerlink" title="mybatis之动态sql"></a>mybatis之动态sql</h1><p>动态sql是Mybatis增加mapper.xml的sql语句的灵活性而设计的。</p>
<p>[toc]</p>
<h3 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h3><ol>
<li><p>date-string转换函数</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateInventory&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.docc.model.Inventory&quot;</span>&gt;</span></span><br><span class="line">update BUS_INVENTORY</span><br><span class="line">set orgcode = #&#123;orgcode,jdbcType=VARCHAR&#125;,</span><br><span class="line">    reportdate = #&#123;reportdate,jdbcType=CHAR&#125;,</span><br><span class="line">    checkname = &#x27;$&#123;checkname&#125;&#x27;,</span><br><span class="line">    archivetime = to_date(#&#123;archivetime,jdbcType=DATE&#125;,&#x27;yyyy-mm-dd&#x27;)      </span><br><span class="line">where id = #&#123;id,jdbcType=DECIMAL&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="条件"><a href="#条件" class="headerlink" title="条件"></a>条件</h3><ol>
<li><p>条件if</p>
<p> 一定要注意多if于单if下where,and所在位置，但条件的话where就要在if里面，且不需要and，下面用trim解决</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findActiveBlogWithTitleLike&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Blog&quot;</span>&gt;</span></span><br><span class="line">  SELECT * FROM BLOG</span><br><span class="line">  WHERE state = ‘ACTIVE’</span><br><span class="line">  <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;title != null&quot;</span>&gt;</span></span><br><span class="line">    AND title like #&#123;title&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>优先条件 choose-when-otherwise</p>
<p>优先条件查询：繁杂的when&lt;—-&gt;繁杂的if-else</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findActiveBlogLike&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Blog&quot;</span>&gt;</span></span><br><span class="line">  SELECT * FROM BLOG WHERE state = ‘ACTIVE’</span><br><span class="line">  <span class="tag">&lt;<span class="name">choose</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;title != null&quot;</span>&gt;</span></span><br><span class="line">      AND title like #&#123;title&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;author != null and author.name != null&quot;</span>&gt;</span></span><br><span class="line">      AND author_name like #&#123;author.name&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">otherwise</span>&gt;</span></span><br><span class="line">      AND featured = 1</span><br><span class="line">    <span class="tag">&lt;/<span class="name">otherwise</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">choose</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>为null条件trim-where-set</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findActiveBlogLike&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Blog&quot;</span>&gt;</span></span><br><span class="line">  SELECT * FROM BLOG WHERE</span><br><span class="line">  <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;state != null&quot;</span>&gt;</span></span><br><span class="line">    state = #&#123;state&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;title != null&quot;</span>&gt;</span></span><br><span class="line">    AND title like #&#123;title&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;author != null and author.name != null&quot;</span>&gt;</span></span><br><span class="line">    AND author_name like #&#123;author.name&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>集合遍历—foreach  (in)</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectPostIn&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;domain.blog.Post&quot;</span>&gt;</span></span><br><span class="line">  SELECT * FROM POST P</span><br><span class="line">  WHERE ID in</span><br><span class="line">  <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">item</span>=<span class="string">&quot;item&quot;</span> <span class="attr">index</span>=<span class="string">&quot;index&quot;</span> <span class="attr">collection</span>=<span class="string">&quot;list&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">open</span>=<span class="string">&quot;(&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span> <span class="attr">close</span>=<span class="string">&quot;)&quot;</span>&gt;</span></span><br><span class="line">        #&#123;item&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li></li>
</ol>
<h3 id=""><a href="#" class="headerlink" title=""></a></h3><h3 id="传参"><a href="#传参" class="headerlink" title="传参"></a>传参</h3><h2 id="映射"><a href="#映射" class="headerlink" title="映射"></a>映射</h2><blockquote>
<p>找到小明的学校信息</p>
</blockquote>
<h3 id="一对一"><a href="#一对一" class="headerlink" title="一对一"></a>一对一</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;com.wyg.entity.Student&quot;</span> <span class="attr">id</span>=<span class="string">&quot;resMap&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;school&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> </span></span><br><span class="line"><span class="tag">                 <span class="attr">select</span>=<span class="string">&quot;com.wyg.mapper.SchoolMapper.getSchoolById&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>property：java类属性</p>
<p>column：mysql字段</p>
<p>association：联系</p>
<p>select：get—sql方法</p>
<h3 id="一对多"><a href="#一对多" class="headerlink" title="一对多"></a>一对多</h3><blockquote>
<p>找到小明的老师们的信息</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;com.wyg.entity.Student&quot;</span> <span class="attr">id</span>=<span class="string">&quot;resMap&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;teachers&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;ArrayList&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">ofType</span>=<span class="string">&quot;com.wyg.entity.teacher&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">select</span>=<span class="string">&quot;com.wyg.mapper.TeacherMapper.getTeacherById&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">fetchType</span>=<span class="string">&quot;lazy&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;tId&quot;</span> <span class="attr">column</span>=<span class="string">&quot;t_id&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;tName&quot;</span> <span class="attr">column</span>=<span class="string">&quot;t_name&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="多对多"><a href="#多对多" class="headerlink" title="多对多"></a>多对多</h3><h3 id="注入攻击"><a href="#注入攻击" class="headerlink" title="注入攻击"></a>注入攻击</h3>]]></content>
      <categories>
        <category>组件</category>
      </categories>
  </entry>
  <entry>
    <title>Mybatis杂记</title>
    <url>/2022/04/24/%E7%BB%84%E4%BB%B6/ORM/mybatis/mybatis/</url>
    <content><![CDATA[<h3 id="大致步骤"><a href="#大致步骤" class="headerlink" title="大致步骤"></a>大致步骤</h3><ol>
<li>sqlSessionFactoryBuilder   &lt;- sqlMapConfig</li>
<li>sqlSessionFactory –&gt;sqlSession（Connection的封装，有增删改查功能）</li>
<li>①生成代理对象          ② 定义通用的sql语句</li>
<li>这地方没听会</li>
<li>封装结果集</li>
</ol>
<h3 id="特别的"><a href="#特别的" class="headerlink" title="特别的"></a>特别的</h3><ol>
<li><p>插入后对象会自动生成id</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Repo entity = <span class="keyword">new</span> Repo();</span><br><span class="line">BeanMapper.copy(reqDTO, entity);</span><br><span class="line"><span class="keyword">this</span>.saveOrUpdate(entity);</span><br><span class="line">RepoCategories repoCategories = <span class="keyword">new</span> RepoCategories();</span><br><span class="line">BeanMapper.copy(reqDTO, repoCategories);</span><br><span class="line"><span class="comment">//已经自动copy parentId</span></span><br><span class="line"><span class="comment">//插入entity已经自动形成id</span></span><br><span class="line">repoCategories.setId(entity.getId());</span><br></pre></td></tr></table></figure></li>
<li><p>xml可以 arg0  param1 但是不能写参数类型</p>
</li>
<li><p>模糊查询</p>
<ol>
<li>传入前加入%%</li>
<li>在mapper.xml中写    ‘%${arg0}%’</li>
<li>like concat(‘%’,#{arg0},’%’)</li>
</ol>
</li>
</ol>
<h3 id="tree-查询-树形查询"><a href="#tree-查询-树形查询" class="headerlink" title="tree 查询  树形查询"></a>tree 查询  树形查询</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppInfo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> parentid;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> List&lt;AppInfo&gt; childList;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;appsTree&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.lg.business.common.ws.AppInfo&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;int&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;parentid&quot;</span> <span class="attr">property</span>=<span class="string">&quot;parentid&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;int&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;String&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">collection</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;childList&quot;</span> <span class="attr">select</span>=<span class="string">&quot;getAppsByPid&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getAllWsAppList&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;appsTree&quot;</span>&gt;</span></span><br><span class="line">        select id,parentid,name from flow_app_info where parentid=0</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getAppsByPid&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;appsTree&quot;</span>&gt;</span></span><br><span class="line">        select id,parentid,name from flow_app_info where parentid=#&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.example.learn.mapper.TreeMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;deptTree&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.example.learn.tree.Dep&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;parentId&quot;</span> <span class="attr">property</span>=<span class="string">&quot;parentId&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--id作为参数递归调用getDeptTree，查询子节点--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- property:java pojo属性，column: 查出来字段 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;children&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">select</span>=<span class="string">&quot;getDeptTree&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;com.example.learn.tree.Dep&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--根据父id获取子节点--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getDeptTree&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;deptTree&quot;</span>&gt;</span></span><br><span class="line">        select * from dep where parentId = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>





<ol>
<li>sqlSessionFactory</li>
<li>sqlSession   自定义mybatis和数据库交互的核心类   </li>
<li>IuerDao<br> @select(“select * from name”)<br> List<user> findAll(); </li>
</ol>
<h3 id="二、类"><a href="#二、类" class="headerlink" title="二、类"></a>二、类</h3><ol>
<li>class Resource  使用类加载器读取配置文件的类 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> inputstream <span class="title">getResourceStream</span><span class="params">(filePath)</span></span></span><br><span class="line"><span class="function">    return Resource.Class.getClassloader.<span class="title">getResourceAsStream</span><span class="params">(filePath)</span> <span class="comment">//获取字节码     获取字节码类加载器   根据类加载器读取配置</span></span></span><br></pre></td></tr></table></figure>
</li>
<li>class sqlSessionFactoryBuilder    //用于创建工厂对象  <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> sqlSessionFactory <span class="title">build</span><span class="params">(Inputstream config)</span></span></span><br><span class="line"><span class="function">    configration cfg </span>=XMLConfigBuider.loadConfigration(config)</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> factory(config) </span><br></pre></td></tr></table></figure>
</li>
<li>class DefalutsqlSession impl sqlSession  创建代理对象，释放资源 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line">pri configration cfg</span><br><span class="line">pri conn</span><br><span class="line"><span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">getMapper</span><span class="params">(class&lt;T&gt; daoInterClass)</span></span></span><br><span class="line"><span class="function">    proxy.<span class="title">newProxyInstace</span><span class="params">(daoInterClass.getClassloader()</span>,new Class[]</span>&#123;daoInterClass&#125;,<span class="keyword">new</span> MapperProxy(cfg.getmappers(),conn))          </span><br><span class="line">        <span class="comment">//proxy代理  ---&gt;  加载类   </span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    <span class="title">if</span><span class="params">(conn!=<span class="keyword">null</span>)</span></span></span><br></pre></td></tr></table></figure></li>
</ol>
<ol start="4">
<li><p>class configration       </p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function">pri driver</span></span><br><span class="line"><span class="function">pri url</span></span><br><span class="line"><span class="function">pri username</span></span><br><span class="line"><span class="function">pri password</span></span><br><span class="line"><span class="function">pri Map&lt;String,Mapper&gt; mappers</span></span><br><span class="line"><span class="function">getter and <span class="title">setter</span><span class="params">(mappers)</span></span></span><br><span class="line"><span class="function">setMapper</span></span><br><span class="line"><span class="function">    <span class="keyword">this</span>.mappers.<span class="title">putAll</span><span class="params">(mappers)</span>  追加放入</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>class Mapper    用于封装sql语句和全限定类名resultType<br> pri resultType<br> pri sql</p>
</li>
<li><p>class factory implements sqlSessionFactory<br> pri configration cfg<br> openSession</p>
</li>
<li><p>class MapperProxy impl InvocationHandler   增强seletelist方法    —&gt; DefalutsqlSession</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line">pri Map&lt;string,map&gt; mappers;</span><br><span class="line"><span class="function">pri conn</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy,Method method,Object []args)</span></span></span><br><span class="line"><span class="function">    methodname </span>=method.getname                  获取方法名</span><br><span class="line">    classname=method.getdeclaringClass().getname(); 获取方法所在类名</span><br><span class="line">    key =classname+<span class="string">&#x27;.&#x27;</span>+methodname</span><br><span class="line">    mapper=mapper.get(key)</span><br><span class="line">    <span class="keyword">if</span>(mapper==<span class="keyword">null</span>) <span class="keyword">throw</span> <span class="function">out</span></span><br><span class="line"><span class="function">    return new <span class="title">Execute</span><span class="params">()</span>.<span class="title">selectlist</span><span class="params">(mapper,conn)</span></span></span><br></pre></td></tr></table></figure>
</li>
<li><p>class DatasourceUtil   创建数据源的类</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> conn <span class="title">getconnection</span><span class="params">(configration cfg)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">try</span> class.<span class="title">forname</span><span class="params">(daoInterClass.getClassloader()</span>)</span></span><br><span class="line"><span class="function">    return DriverMpper.<span class="title">getconnection</span><span class="params">(cfg.geturl,cfg,getusername,cfg.getpassword)</span></span></span><br></pre></td></tr></table></figure>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line">    </span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="三、配置文件"><a href="#三、配置文件" class="headerlink" title="三、配置文件"></a>三、配置文件</h3><h4 id="4-1-sqlMapConfig-xml"><a href="#4-1-sqlMapConfig-xml" class="headerlink" title="4.1 sqlMapConfig.xml"></a>4.1 sqlMapConfig.xml</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">conf</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">envs</span> <span class="attr">default</span>=<span class="string">&quot;mysql&quot;</span>&gt;</span>  <span class="comment">&lt;!--配置环境--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">env</span> <span class="attr">id</span>=<span class="string">&quot;mysql&quot;</span>&gt;</span>    <span class="comment">&lt;!--配置mysql环境--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionmanger</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>&gt;</span><span class="comment">&lt;!--配置事物类型--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span> <span class="comment">&lt;!--配置数据源--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span> =<span class="string">&quot;driver&quot;</span> <span class="attr">value</span> <span class="attr">com.driver....</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">url</span> &gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">username</span> &gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">password</span>&gt;</span></span><br><span class="line">             /&gt;   </span><br><span class="line">        /&gt;</span><br><span class="line">    /&gt;</span><br><span class="line">    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span>   <span class="comment">&lt;!--指定映射文件--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span> =<span class="string">&quot;iuserdao.xml&quot;</span>&gt;</span> <span class="comment">&lt;!--xml型--&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span> =<span class="string">&quot;com.wyg.dao.IuerDao&quot;</span>&gt;</span><span class="comment">&lt;!--注解型--&gt;</span></span><br><span class="line">    /&gt;</span><br><span class="line">/&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="4-2-mapper-xml"><a href="#4-2-mapper-xml" class="headerlink" title="4.2 mapper.xml"></a>4.2 mapper.xml</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;&quot;</span>&gt;</span>   <span class="comment">&lt;!--id 方法名  --&gt;</span></span><br><span class="line">    /&gt;</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure>



<ol start="2">
<li></li>
</ol>
]]></content>
  </entry>
  <entry>
    <title>mybatis缓存</title>
    <url>/2022/04/23/%E7%BB%84%E4%BB%B6/ORM/mybatis/%E7%BC%93%E5%AD%98/</url>
    <content><![CDATA[<h3 id="一级缓存"><a href="#一级缓存" class="headerlink" title="一级缓存"></a>一级缓存</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Configuration</span> </span>&#123;</span><br><span class="line">  <span class="comment">//protected boolean cacheEnabled = true;//开启缓存</span></span><br><span class="line">  <span class="keyword">protected</span> LocalCacheScope localCacheScope = LocalCacheScope.SESSION;<span class="comment">//范围</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//交予BaseExecutor保存localCache</span></span><br></pre></td></tr></table></figure>

<h4 id="一级缓存失效"><a href="#一级缓存失效" class="headerlink" title="一级缓存失效"></a>一级缓存失效</h4><ol>
<li>不同session</li>
<li></li>
</ol>
<h3 id="二级缓存"><a href="#二级缓存" class="headerlink" title="二级缓存"></a>二级缓存</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Configuration</span> </span>&#123;</span><br><span class="line">  <span class="keyword">protected</span> <span class="keyword">boolean</span> cacheEnabled = <span class="keyword">true</span>;<span class="comment">//开启缓存</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//mapper.xml中、mapperStateMent级别</span></span><br><span class="line"><span class="comment">//&lt;select userCache=&quot;true&quot;   flushCache=&quot;false&quot;  /&gt;</span></span><br><span class="line"><span class="comment">//表示这个select使用二级缓存并且删除这个缓存。</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//原理</span></span><br><span class="line"><span class="comment">/* 1:1:1  session:Executor</span></span><br><span class="line"><span class="comment">1. cacheExecutor:	TransactionalCacheManager,(Executor)delegate</span></span><br><span class="line"><span class="comment">2. TransactionalCacheManager:	HashMap&lt;Cache,TransactionalCache&gt;</span></span><br><span class="line"><span class="comment">3. TransactionalCache: (cache)delegate，(Map)entriesToAddOnCommit，(Set)entriesMissedInCache</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">SqlSession.close()会将tcm放到二级缓存ms.cache中</span></span><br><span class="line"><span class="comment">SqlSession.commit()会将tcm放到二级缓存ms.cache中,并清空tcm</span></span><br><span class="line"><span class="comment">当对SqlSession执行更新操作（update、delete、insert）时，只会清空其自身的一级缓存，不影响二级缓存</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//查询</span></span><br><span class="line">cacheExecutor.query()</span><br><span class="line">    -&gt;ms.getCache; <span class="keyword">return</span> tcm.getObject(cache, key);</span><br><span class="line">TransactionalCacheManager.getObject(Cache cache, CacheKey key)</span><br><span class="line">    -&gt;<span class="keyword">return</span> getTransactionalCache(cache).getObject(key);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//put</span></span><br><span class="line">cache=ms.getCache();</span><br><span class="line">tcm.putObject(cache, key, list);</span><br><span class="line">	-&gt;getTransactionalCache(cache).putObject(key, value);</span><br><span class="line">getTransactionalCache(cache)</span><br><span class="line">	-&gt;txCache = <span class="keyword">new</span> TransactionalCache(cache::<span class="meta">@ms</span>.getCache::delegate::forCommit);<span class="comment">//关键</span></span><br><span class="line">	-&gt;transactionalCaches.put(cache, txCache);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//commit</span></span><br><span class="line">cacheExecutor.commit()</span><br><span class="line">    -&gt; delegate.commit(required);tcm.commit();</span><br><span class="line">tcm.commit()</span><br><span class="line">    -&gt;<span class="keyword">for</span> (TransactionalCache txCache : transactionalCaches.values()) </span><br><span class="line">    	  txCache.commit();</span><br><span class="line">txCache.commit()</span><br><span class="line">    -&gt;flushPendingEntries();reset();</span><br><span class="line">txCache.flushPendingEntries()</span><br><span class="line">    -&gt;<span class="keyword">for</span> (Map.Entry&lt;Object, Object&gt; entry : entriesToAddOnCommit.entrySet()) </span><br><span class="line">     	 delegate.putObject(entry.getKey(), entry.getValue());</span><br><span class="line">    </span><br></pre></td></tr></table></figure>



<h4 id="二级缓存失效"><a href="#二级缓存失效" class="headerlink" title="二级缓存失效"></a>二级缓存失效</h4><ol>
<li>sqlSession没有close</li>
<li>cacheKey不同</li>
<li>select –&gt; update –&gt; select</li>
</ol>
<h4 id="SerializedCache"><a href="#SerializedCache" class="headerlink" title="SerializedCache"></a>SerializedCache</h4><blockquote>
<p>如果readOnly=false,可读写的缓存 会返回缓存对象的拷贝(通过序列化) 。这会慢一些,但是安全,因此默认是 false。</p>
</blockquote>
<h4 id="SynchronizedCache"><a href="#SynchronizedCache" class="headerlink" title="SynchronizedCache"></a>SynchronizedCache</h4><blockquote>
<p>同步缓存, 3.2.6以后这个类已经没用了，考虑到Hazelcast, EhCache已经有锁机制了，所以这个锁就画蛇添足了。</p>
</blockquote>
]]></content>
  </entry>
  <entry>
    <title>mybatis源码分析</title>
    <url>/2022/04/23/%E7%BB%84%E4%BB%B6/ORM/mybatis/%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/</url>
    <content><![CDATA[<p>前置</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">session.selectOne(String statement, Object parameter); <span class="comment">//调用session</span></span><br><span class="line">MappedStatement ms = configuration.getMappedStatement(statement);<span class="comment">//获得mapperStatement</span></span><br><span class="line">executor.query(ms, wrapCollection(parameter), rowBounds, Executor.NO_RESULT_HANDLER);<span class="comment">//调用executor(baseExecutor or cacheExecutor)</span></span><br></pre></td></tr></table></figure>

<p>baseExcutor</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//baseExecutor中</span></span><br><span class="line">BoundSql boundSql = ms.getBoundSql(parameter);<span class="comment">//得到绑定sql</span></span><br><span class="line">CacheKey key = createCacheKey(ms, parameter, rowBounds, boundSql);<span class="comment">//创建缓存Key</span></span><br><span class="line">list = resultHandler == <span class="keyword">null</span> ? (List&lt;E&gt;) localCache.getObject(key) : <span class="keyword">null</span>;<span class="comment">//一级缓存</span></span><br><span class="line"><span class="keyword">else</span>  list = queryFromDatabase(ms, parameter, rowBounds, resultHandler, key, boundSql);<span class="comment">//数据库查询</span></span><br><span class="line">list = doQuery(ms, parameter, rowBounds, resultHandler, boundSql);</span><br><span class="line"><span class="comment">//simpleExecutor中</span></span><br><span class="line">stmt = prepareStatement(handler, ms.getStatementLog());<span class="comment">//获得jdbc.stateMent</span></span><br><span class="line"><span class="comment">//simpleStateMentHandler中</span></span><br><span class="line">statement.execute(sql);</span><br><span class="line"><span class="comment">//defaultResultSetHandler中</span></span><br><span class="line"><span class="keyword">final</span> List&lt;Object&gt; multipleResults = <span class="keyword">new</span> ArrayList&lt;Object&gt;();</span><br><span class="line">rsw = getNextResultSet(stmt);</span><br><span class="line">handleResultSet(rsw, resultMap, multipleResults, <span class="keyword">null</span>);</span><br><span class="line">RETURN multipleResults</span><br></pre></td></tr></table></figure>

<p>cacheExcutor</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//cacheExecutor.query1中</span></span><br><span class="line">BoundSql boundSql = ms.getBoundSql(parameterObject);</span><br><span class="line">CacheKey key = createCacheKey(ms, parameterObject, rowBounds, boundSql);<span class="comment">//query时传入一个cachekey参数</span></span><br><span class="line"><span class="keyword">return</span> query(ms, parameterObject, rowBounds, resultHandler, key, boundSql);</span><br><span class="line"><span class="comment">//cacheExecutor.query2中</span></span><br><span class="line">Cache cache = ms.getCache();</span><br><span class="line">  </span><br></pre></td></tr></table></figure>



<h3 id="session-selectOne"><a href="#session-selectOne" class="headerlink" title="session.selectOne"></a>session.selectOne</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> &lt;E&gt; <span class="function">List&lt;E&gt; <span class="title">selectList</span><span class="params">(String statement, Object parameter, RowBounds rowBounds)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="comment">//根据statement id找到对应的MappedStatement</span></span><br><span class="line">      MappedStatement ms = configuration.getMappedStatement(statement);</span><br><span class="line">      <span class="comment">//转而用执行器来查询结果,注意这里传入的ResultHandler是null</span></span><br><span class="line">      <span class="keyword">return</span> executor.query(ms, wrapCollection(parameter), rowBounds, Executor.NO_RESULT_HANDLER);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">      <span class="keyword">throw</span> ExceptionFactory.wrapException(<span class="string">&quot;Error querying database.  Cause: &quot;</span> + e, e);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      ErrorContext.instance().reset();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h3 id="session-doQuery"><a href="#session-doQuery" class="headerlink" title="session.doQuery()"></a>session.doQuery()</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> &lt;E&gt; <span class="function">List&lt;E&gt; <span class="title">doQuery</span><span class="params">(MappedStatement ms, Object parameter, RowBounds rowBounds, ResultHandler resultHandler, BoundSql boundSql)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">  Statement stmt = <span class="keyword">null</span>;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    Configuration configuration = ms.getConfiguration();</span><br><span class="line">    <span class="comment">//新建一个StatementHandler</span></span><br><span class="line">    <span class="comment">//这里看到ResultHandler传入了</span></span><br><span class="line">    StatementHandler handler = configuration.newStatementHandler(wrapper, ms, parameter, rowBounds, resultHandler, boundSql);</span><br><span class="line">    <span class="comment">//准备语句</span></span><br><span class="line">    stmt = prepareStatement(handler, ms.getStatementLog());</span><br><span class="line">    <span class="comment">//StatementHandler.query</span></span><br><span class="line">    <span class="keyword">return</span> handler.&lt;E&gt;query(stmt, resultHandler);</span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    closeStatement(stmt);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="BaseExcutor-query"><a href="#BaseExcutor-query" class="headerlink" title="BaseExcutor.query"></a>BaseExcutor.query</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> &lt;E&gt; <span class="function">List&lt;E&gt; <span class="title">query</span><span class="params">(MappedStatement ms, Object parameter, RowBounds rowBounds, ResultHandler resultHandler)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">    <span class="comment">//得到绑定sql</span></span><br><span class="line">    BoundSql boundSql = ms.getBoundSql(parameter);</span><br><span class="line">    <span class="comment">//创建缓存Key</span></span><br><span class="line">    CacheKey key = createCacheKey(ms, parameter, rowBounds, boundSql);</span><br><span class="line">    <span class="comment">//查询</span></span><br><span class="line">    <span class="keyword">return</span> query(ms, parameter, rowBounds, resultHandler, key, boundSql);</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> &lt;E&gt; <span class="function">List&lt;E&gt; <span class="title">query</span><span class="params">(MappedStatement ms, Object parameter, RowBounds rowBounds, ResultHandler resultHandler, CacheKey key, BoundSql boundSql)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">    ErrorContext.instance().resource(ms.getResource()).activity(<span class="string">&quot;executing a query&quot;</span>).object(ms.getId());</span><br><span class="line">    <span class="comment">//如果已经关闭，报错</span></span><br><span class="line">    <span class="keyword">if</span> (closed) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> ExecutorException(<span class="string">&quot;Executor was closed.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//先清局部缓存，再查询.但仅查询堆栈为0，才清。为了处理递归调用</span></span><br><span class="line">    <span class="keyword">if</span> (queryStack == <span class="number">0</span> &amp;&amp; ms.isFlushCacheRequired()) &#123;</span><br><span class="line">      clearLocalCache();</span><br><span class="line">    &#125;</span><br><span class="line">    List&lt;E&gt; list;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="comment">//加一,这样递归调用到上面的时候就不会再清局部缓存了</span></span><br><span class="line">      queryStack++;</span><br><span class="line">      <span class="comment">//先根据cachekey从localCache去查</span></span><br><span class="line">      list = resultHandler == <span class="keyword">null</span> ? (List&lt;E&gt;) localCache.getObject(key) : <span class="keyword">null</span>;</span><br><span class="line">      <span class="keyword">if</span> (list != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="comment">//若查到localCache缓存，处理localOutputParameterCache</span></span><br><span class="line">        handleLocallyCachedOutputParameters(ms, key, parameter, boundSql);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//从数据库查</span></span><br><span class="line">        list = queryFromDatabase(ms, parameter, rowBounds, resultHandler, key, boundSql);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      <span class="comment">//清空堆栈</span></span><br><span class="line">      queryStack--;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (queryStack == <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="comment">//延迟加载队列中所有元素</span></span><br><span class="line">      <span class="keyword">for</span> (DeferredLoad deferredLoad : deferredLoads) &#123;</span><br><span class="line">        deferredLoad.load();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// issue #601</span></span><br><span class="line">      <span class="comment">//清空延迟加载队列</span></span><br><span class="line">      deferredLoads.clear();</span><br><span class="line">      <span class="keyword">if</span> (configuration.getLocalCacheScope() == LocalCacheScope.STATEMENT) &#123;</span><br><span class="line">        <span class="comment">// issue #482</span></span><br><span class="line">    	<span class="comment">//如果是STATEMENT，清本地缓存</span></span><br><span class="line">        clearLocalCache();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> list;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h3 id="baseExecutor-queryFromDatabase"><a href="#baseExecutor-queryFromDatabase" class="headerlink" title="baseExecutor.queryFromDatabase"></a>baseExecutor.queryFromDatabase</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> &lt;E&gt; <span class="function">List&lt;E&gt; <span class="title">queryFromDatabase</span><span class="params">(MappedStatement ms, Object parameter, RowBounds rowBounds, ResultHandler resultHandler, CacheKey key, BoundSql boundSql)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">    List&lt;E&gt; list;</span><br><span class="line">    <span class="comment">//先向缓存中放入占位符？？？</span></span><br><span class="line">    localCache.putObject(key, EXECUTION_PLACEHOLDER);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      list = doQuery(ms, parameter, rowBounds, resultHandler, boundSql);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      <span class="comment">//最后删除占位符</span></span><br><span class="line">      localCache.removeObject(key);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//加入缓存</span></span><br><span class="line">    localCache.putObject(key, list);</span><br><span class="line">    <span class="comment">//如果是存储过程，OUT参数也加入缓存</span></span><br><span class="line">    <span class="keyword">if</span> (ms.getStatementType() == StatementType.CALLABLE) &#123;</span><br><span class="line">      localOutputParameterCache.putObject(key, parameter);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> list;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h3 id="baseExecutor-doquery"><a href="#baseExecutor-doquery" class="headerlink" title="baseExecutor.doquery"></a>baseExecutor.doquery</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Configuration configuration = ms.getConfiguration();</span><br><span class="line"><span class="comment">//新建一个StatementHandler</span></span><br><span class="line"><span class="comment">//这里看到ResultHandler传入了</span></span><br><span class="line">StatementHandler handler = configuration.newStatementHandler(wrapper, ms, parameter, rowBounds, resultHandler, boundSql);</span><br><span class="line"><span class="comment">//准备语句</span></span><br><span class="line">stmt = prepareStatement(handler, ms.getStatementLog());</span><br><span class="line"><span class="comment">//StatementHandler.query</span></span><br><span class="line"><span class="keyword">return</span> handler.&lt;E&gt;query(stmt, resultHandler);</span><br></pre></td></tr></table></figure>

<h3 id="statementHandler"><a href="#statementHandler" class="headerlink" title="statementHandler"></a>statementHandler</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> &lt;E&gt; <span class="function">List&lt;E&gt; <span class="title">query</span><span class="params">(Statement statement, ResultHandler resultHandler)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">  String sql = boundSql.getSql();</span><br><span class="line">  statement.execute(sql);<span class="comment">//关键</span></span><br><span class="line">  <span class="comment">//先执行Statement.execute，然后交给ResultSetHandler.handleResultSets</span></span><br><span class="line">  <span class="keyword">return</span> resultSetHandler.&lt;E&gt;handleResultSets(statement);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="resultSetHandler"><a href="#resultSetHandler" class="headerlink" title="resultSetHandler"></a>resultSetHandler</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Object&gt; <span class="title">handleResultSets</span><span class="params">(Statement stmt)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> List&lt;Object&gt; multipleResults = <span class="keyword">new</span> ArrayList&lt;Object&gt;();</span><br><span class="line">    <span class="keyword">int</span> resultSetCount = <span class="number">0</span>;</span><br><span class="line">    ResultSetWrapper rsw = getFirstResultSet(stmt);</span><br><span class="line"></span><br><span class="line">    List&lt;ResultMap&gt; resultMaps = mappedStatement.getResultMaps();</span><br><span class="line">    <span class="comment">//一般resultMaps里只有一个元素</span></span><br><span class="line">    <span class="keyword">int</span> resultMapCount = resultMaps.size();</span><br><span class="line">    validateResultMapsCount(rsw, resultMapCount);</span><br><span class="line">    <span class="keyword">while</span> (rsw != <span class="keyword">null</span> &amp;&amp; resultMapCount &gt; resultSetCount) &#123;</span><br><span class="line">      ResultMap resultMap = resultMaps.get(resultSetCount);</span><br><span class="line">      handleResultSet(rsw, resultMap, multipleResults, <span class="keyword">null</span>);</span><br><span class="line">      rsw = getNextResultSet(stmt);</span><br><span class="line">      cleanUpAfterHandlingResultSet();</span><br><span class="line">      resultSetCount++;</span><br><span class="line">    &#125;</span><br><span class="line">   String[] resultSets = mappedStatement.getResulSets();</span><br><span class="line">    <span class="keyword">if</span> (resultSets != <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">while</span> (rsw != <span class="keyword">null</span> &amp;&amp; resultSetCount &lt; resultSets.length) &#123;</span><br><span class="line">        ResultMapping parentMapping = nextResultMaps.get(resultSets[resultSetCount]);</span><br><span class="line">        <span class="keyword">if</span> (parentMapping != <span class="keyword">null</span>) &#123;</span><br><span class="line">          String nestedResultMapId = parentMapping.getNestedResultMapId();</span><br><span class="line">          ResultMap resultMap = configuration.getResultMap(nestedResultMapId);</span><br><span class="line">          handleResultSet(rsw, resultMap, <span class="keyword">null</span>, parentMapping);</span><br><span class="line">        &#125;</span><br><span class="line">        rsw = getNextResultSet(stmt);</span><br><span class="line">        cleanUpAfterHandlingResultSet();</span><br><span class="line">        resultSetCount++;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> collapseSingleResultList(multipleResults);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h3 id="CacheExecuty"><a href="#CacheExecuty" class="headerlink" title="CacheExecuty"></a>CacheExecuty</h3><h4 id="query1"><a href="#query1" class="headerlink" title="query1"></a>query1</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> &lt;E&gt; <span class="function">List&lt;E&gt; <span class="title">query</span><span class="params">(MappedStatement ms, Object parameterObject, RowBounds rowBounds, ResultHandler resultHandler)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">      BoundSql boundSql = ms.getBoundSql(parameterObject);</span><br><span class="line">      <span class="comment">//query时传入一个cachekey参数</span></span><br><span class="line">      CacheKey key = createCacheKey(ms, parameterObject, rowBounds, boundSql);</span><br><span class="line">      <span class="keyword">return</span> query(ms, parameterObject, rowBounds, resultHandler, key, boundSql);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="query2"><a href="#query2" class="headerlink" title="query2"></a>query2</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> &lt;E&gt; <span class="function">List&lt;E&gt; <span class="title">query</span><span class="params">(MappedStatement ms, Object parameterObject, RowBounds rowBounds, ResultHandler resultHandler, CacheKey key, BoundSql boundSql)</span></span></span><br><span class="line"><span class="function">      <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">    Cache cache = ms.getCache();</span><br><span class="line">    <span class="comment">//默认情况下是没有开启缓存的(二级缓存).要开启二级缓存,你需要在你的 SQL 映射文件中添加一行: &lt;cache/&gt;</span></span><br><span class="line">    <span class="comment">//简单的说，就是先查CacheKey，查不到再委托给实际的执行器去查</span></span><br><span class="line">    <span class="keyword">if</span> (cache != <span class="keyword">null</span>) &#123;</span><br><span class="line">      flushCacheIfRequired(ms);</span><br><span class="line">      <span class="keyword">if</span> (ms.isUseCache() &amp;&amp; resultHandler == <span class="keyword">null</span>) &#123;</span><br><span class="line">        ensureNoOutParams(ms, parameterObject, boundSql);</span><br><span class="line">        <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">        List&lt;E&gt; list = (List&lt;E&gt;) tcm.getObject(cache, key);</span><br><span class="line">        <span class="keyword">if</span> (list == <span class="keyword">null</span>) &#123;</span><br><span class="line">          list = delegate.&lt;E&gt; query(ms, parameterObject, rowBounds, resultHandler, key, boundSql);</span><br><span class="line">          tcm.putObject(cache, key, list); <span class="comment">// issue #578 and #116</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> delegate.&lt;E&gt; query(ms, parameterObject, rowBounds, resultHandler, key, boundSql);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="AddMapper"><a href="#AddMapper" class="headerlink" title="AddMapper"></a>AddMapper</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//XMLConfigBuilder中</span></span><br><span class="line">parseConfiguration(parser.evalNode(<span class="string">&quot;/configuration&quot;</span>));<span class="comment">//找到configuration节点</span></span><br><span class="line">mapperElement(root.evalNode(<span class="string">&quot;mappers&quot;</span>));<span class="comment">//找到mappers节点</span></span><br><span class="line">String mapperPackage = child.getStringAttribute(<span class="string">&quot;name&quot;</span>);<span class="comment">//找到package，不重要</span></span><br><span class="line">configuration.addMappers(mapperPackage);<span class="comment">//开始加入</span></span><br><span class="line"><span class="comment">//mapperRegistry中</span></span><br><span class="line">addMappers(packageName, Object.class);<span class="comment">//找到mapper.class</span></span><br><span class="line">addMapper(mapperClass);</span><br><span class="line">    knownMappers.put(type, <span class="keyword">new</span> MapperProxyFactory&lt;T&gt;(type));<span class="comment">//临时加入代理，先加入再解析</span></span><br><span class="line">    MapperAnnotationBuilder parser = <span class="keyword">new</span> MapperAnnotationBuilder(config, type);</span><br><span class="line">    parser.parse();<span class="comment">//关键是里面的type</span></span><br><span class="line">    loadCompleted = <span class="keyword">true</span>;</span><br><span class="line"><span class="comment">//MapperAnnotationBuilder中</span></span><br><span class="line">parse();<span class="comment">//解析</span></span><br><span class="line">	parseCache();</span><br><span class="line">		CacheNamespace cacheDomain = type.getAnnotation(CacheNamespace.class);</span><br><span class="line">		assistant.useNewCache(eviction(), flushInterval , readWrite(),<span class="keyword">null</span>);</span><br><span class="line">			 Cache cache=<span class="keyword">new</span> Cache(上面的参数);</span><br><span class="line">		  	 configuration.addCache(cache);<span class="comment">//保存到configuration.caches  </span></span><br><span class="line">			 currentCache = cache;<span class="comment">//并且保存到当前的MapperAnnotationBuilder中</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="Add-ms"><a href="#Add-ms" class="headerlink" title="Add  ms"></a>Add  ms</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//MapperAnnotationBuilder中</span></span><br><span class="line">parseStatement(method);</span><br><span class="line">	<span class="keyword">boolean</span> isSelect = sqlCommandType == SqlCommandType.SELECT;</span><br><span class="line">     <span class="keyword">boolean</span> flushCache = !isSelect;</span><br><span class="line">    <span class="keyword">boolean</span> useCache = isSelect;</span><br><span class="line">	assistant.addMappedStatement(一众参数);</span><br><span class="line"><span class="comment">//assistant中</span></span><br><span class="line">addMappedStatement();</span><br><span class="line">setStatementCache(isSelect, flushCache, useCache, currentCache, statementBuilder);<span class="comment">//这个currentCache就是之前在AddMapper里面的mapper缓存，现在将引用赋予m</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h4 id="configuation-getCache-id"><a href="#configuation-getCache-id" class="headerlink" title="configuation.getCache(id)"></a>configuation.getCache(id)</h4><figure class="highlight"><table><tr><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>

]]></content>
  </entry>
  <entry>
    <title>AQS</title>
    <url>/2022/04/10/java/javaSE/JUC/JUC%E7%9A%84%E5%9F%BA%E7%A1%80/AQS/</url>
    <content><![CDATA[<p>[toc]</p>
<blockquote>
<p>AbstractQueuedSynchonizer，抽象队列同步器，是JUC锁的base，是JUC的base</p>
</blockquote>
<blockquote>
<p>提供了一个基于FIFO队列，可以用于构建锁或者其他相关同步装置的基础框架。</p>
</blockquote>
<h2 id="理解AQS"><a href="#理解AQS" class="headerlink" title="理解AQS"></a>理解AQS</h2><blockquote>
<p>基于 共享变量（信号量）+ CSA + volatile +队列+ LockSupport</p>
</blockquote>
<ol>
<li>共享变量  各个线程之间</li>
<li>CSA 各线程更改争取资源</li>
<li>volatile</li>
<li>线程排队</li>
<li>locksupport 基本的阻塞与唤醒</li>
</ol>
<h2 id="组件"><a href="#组件" class="headerlink" title="组件"></a>组件</h2><h3 id="基于AQS的组件"><a href="#基于AQS的组件" class="headerlink" title="基于AQS的组件"></a>基于AQS的组件</h3><ol>
<li><p>Exclusive(独占)：只有一个线程能执行，如ReentrantLock。又可分为公平锁和非公平锁：</p>
<ul>
<li><p>公平锁：按照线程在队列中的排队顺序，先到者先拿到锁</p>
</li>
<li><p>非公平锁：当线程要获取锁时，无视队列顺序直接去抢锁，谁抢到就是谁的</p>
</li>
</ul>
</li>
<li><p>Share(共享)：多个线程可同时执行</p>
<ol>
<li>CountDownLatch</li>
<li>Semaphore</li>
<li>CyclicBarrier</li>
<li>ReadWriteLock </li>
</ol>
</li>
</ol>
<h3 id="State"><a href="#State" class="headerlink" title="State"></a>State</h3><h3 id="Condition"><a href="#Condition" class="headerlink" title="Condition"></a>Condition</h3><ol>
<li>记录头节点和尾节点</li>
<li>添加Thread.currentThread()到队列中</li>
<li>唤醒</li>
</ol>
<h3 id="队列Node"><a href="#队列Node" class="headerlink" title="队列Node"></a>队列Node</h3><p><code>CLH(Craig,Landin,and Hagersten)队列</code>是一个虚拟的双向队列(虚拟的双向队列即不存在队列实例，仅存在结点之间的关联关系)。AQS是将每条请求共享资源的线程封装成一个CLH锁队列的一个结点(Node)来实现锁的分配。其中Sync queue，即同步队列，是双向链表，包括head结点和tail结点，head结点主要用作后续的调度。而Condition queue不是必须的，其是一个单向链表，只有当使用Condition时，才会存在此单向链表。并且可能会有多个Condition queue。</p>
<h4 id="node状态"><a href="#node状态" class="headerlink" title="node状态"></a>node状态</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 结点状态</span></span><br><span class="line"><span class="comment">// CANCELLED，值为1，表示当前的线程被取消</span></span><br><span class="line"><span class="comment">// SIGNAL，值为-1，表示当前节点的后继节点包含的线程需要运行，也就是unpark</span></span><br><span class="line"><span class="comment">// CONDITION，值为-2，表示当前节点在等待condition，也就是在condition队列中</span></span><br><span class="line"><span class="comment">// PROPAGATE，值为-3，表示当前场景下后续的acquireShared能够得以执行</span></span><br><span class="line"><span class="comment">// 值为0，表示当前节点在sync队列中，等待着获取锁</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> CANCELLED =  <span class="number">1</span>;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SIGNAL    = -<span class="number">1</span>;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> CONDITION = -<span class="number">2</span>;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> PROPAGATE = -<span class="number">3</span>;     </span><br></pre></td></tr></table></figure>



<h2 id="六个操作"><a href="#六个操作" class="headerlink" title="六个操作"></a>六个操作</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">isHeldExclusively()<span class="comment">//该线程是否正在独占资源。只有用到condition才需要去实现它。</span></span><br><span class="line">tryAcquire(<span class="keyword">int</span>)<span class="comment">//独占方式。尝试获取资源，成功则返回true，失败则返回false。</span></span><br><span class="line">tryRelease(<span class="keyword">int</span>)<span class="comment">//独占方式。尝试释放资源，成功则返回true，失败则返回false。</span></span><br><span class="line">tryAcquireShared(<span class="keyword">int</span>)<span class="comment">//共享方式。尝试获取资源。负数表示失败；0表示成功，但没有剩余可用资源；正数表示成功，且有剩余资源。</span></span><br><span class="line">tryReleaseShared(<span class="keyword">int</span>)<span class="comment">//共享方式。尝试释放资源，成功则返回true，失败则返回false。</span></span><br></pre></td></tr></table></figure>

<h3 id="其他操作"><a href="#其他操作" class="headerlink" title="其他操作"></a>其他操作</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">addWaiter(Node node)&#123;</span><br><span class="line">  flag=csa(node);<span class="comment">//先csa快速插入到尾节点  </span></span><br><span class="line">  <span class="keyword">if</span>(!flag)</span><br><span class="line">      enq(node);<span class="comment">//csa循环防止</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//h</span></span><br><span class="line">acquire(<span class="keyword">int</span> arg)&#123;</span><br><span class="line">    <span class="keyword">if</span>(!tryAcquire(arg)&amp;&amp;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="抢锁-acquire"><a href="#抢锁-acquire" class="headerlink" title="抢锁 acquire"></a>抢锁 acquire</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//基于CSA更改state，失败后放到队列</span></span><br></pre></td></tr></table></figure>

<h4 id="释放锁-release"><a href="#释放锁-release" class="headerlink" title="释放锁 release"></a>释放锁 release</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//基于CAS更改state,然后取出头节点并唤醒</span></span><br></pre></td></tr></table></figure>

<h4 id="入队"><a href="#入队" class="headerlink" title="入队"></a>入队</h4><h4 id="出队"><a href="#出队" class="headerlink" title="出队"></a>出队</h4><h4 id="阻塞"><a href="#阻塞" class="headerlink" title="阻塞"></a>阻塞</h4><h4 id="唤醒"><a href="#唤醒" class="headerlink" title="唤醒"></a>唤醒</h4>]]></content>
  </entry>
  <entry>
    <title>Arrays</title>
    <url>/2021/12/24/java/java%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB/JUtil/%E9%9B%86%E5%90%88/Arrays/</url>
    <content><![CDATA[<h2 id=""><a href="#" class="headerlink" title=""></a></h2><h2 id="-1"><a href="#-1" class="headerlink" title=""></a></h2><h2 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h2><h3 id="内置对象ArrayList"><a href="#内置对象ArrayList" class="headerlink" title="内置对象ArrayList"></a>内置对象ArrayList</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ArrayList</span>&lt;<span class="title">E</span>&gt; <span class="keyword">extends</span> <span class="title">AbstractList</span>&lt;<span class="title">E</span>&gt;</span></span><br><span class="line"><span class="class">        <span class="keyword">implements</span> <span class="title">RandomAccess</span>, <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = -<span class="number">2764017481108945198L</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> E[] a;</span><br><span class="line"></span><br><span class="line">        ArrayList(E[] array) &#123;</span><br><span class="line">            a = Objects.requireNonNull(array);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> a.length;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> Object[] toArray() &#123;</span><br><span class="line">            <span class="keyword">return</span> a.clone();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">        <span class="keyword">public</span> &lt;T&gt; T[] toArray(T[] a) &#123;</span><br><span class="line">            <span class="keyword">int</span> size = size();</span><br><span class="line">            <span class="keyword">if</span> (a.length &lt; size)</span><br><span class="line">                <span class="keyword">return</span> Arrays.copyOf(<span class="keyword">this</span>.a, size,</span><br><span class="line">                                     (Class&lt;? extends T[]&gt;) a.getClass());</span><br><span class="line">            System.arraycopy(<span class="keyword">this</span>.a, <span class="number">0</span>, a, <span class="number">0</span>, size);</span><br><span class="line">            <span class="keyword">if</span> (a.length &gt; size)</span><br><span class="line">                a[size] = <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">return</span> a;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> E <span class="title">get</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> a[index];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> E <span class="title">set</span><span class="params">(<span class="keyword">int</span> index, E element)</span> </span>&#123;</span><br><span class="line">            E oldValue = a[index];</span><br><span class="line">            a[index] = element;</span><br><span class="line">            <span class="keyword">return</span> oldValue;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">indexOf</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">            E[] a = <span class="keyword">this</span>.a;</span><br><span class="line">            <span class="keyword">if</span> (o == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; a.length; i++)</span><br><span class="line">                    <span class="keyword">if</span> (a[i] == <span class="keyword">null</span>)</span><br><span class="line">                        <span class="keyword">return</span> i;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; a.length; i++)</span><br><span class="line">                    <span class="keyword">if</span> (o.equals(a[i]))</span><br><span class="line">                        <span class="keyword">return</span> i;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> indexOf(o) != -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Spliterator&lt;E&gt; <span class="title">spliterator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> Spliterators.spliterator(a, Spliterator.ORDERED);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">forEach</span><span class="params">(Consumer&lt;? <span class="keyword">super</span> E&gt; action)</span> </span>&#123;</span><br><span class="line">            Objects.requireNonNull(action);</span><br><span class="line">            <span class="keyword">for</span> (E e : a) &#123;</span><br><span class="line">                action.accept(e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">replaceAll</span><span class="params">(UnaryOperator&lt;E&gt; operator)</span> </span>&#123;</span><br><span class="line">            Objects.requireNonNull(operator);</span><br><span class="line">            E[] a = <span class="keyword">this</span>.a;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; a.length; i++) &#123;</span><br><span class="line">                a[i] = operator.apply(a[i]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sort</span><span class="params">(Comparator&lt;? <span class="keyword">super</span> E&gt; c)</span> </span>&#123;</span><br><span class="line">            Arrays.sort(a, c);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



]]></content>
  </entry>
  <entry>
    <title>hashmap</title>
    <url>/2022/04/10/java/java%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB/JUtil/%E9%9B%86%E5%90%88/HashMap/</url>
    <content><![CDATA[<h2 id="一、原理"><a href="#一、原理" class="headerlink" title="一、原理"></a>一、原理</h2><p>基于哈希表的实现的<code>Map</code>接口。此实现提供了所有可选的map操作，并允许<code>null的</code>值和<code>null</code>键。（  <code>HashMap</code>类大致相当于<code>Hashtable</code> ，除了它是不同步的，并允许null）。这个类不能保证map的。</p>
<p>假设哈希函数在这些存储桶之间正确分散元素，这个实现为基本操作（ <code>get</code>和<code>put</code>  ）提供了恒定的时间性能。 收集视图的迭代需要与<code>HashMap</code>实例（桶数）加上其大小（键值映射数）的“容量”  <code>成正比</code> 。 因此，如果迭代性能很重要，不要将初始容量设置得太高（或负载因子太低）是非常重要的。 </p>
<p><code>HashMap的</code>一个实例有两个影响其性能的参数： <em>初始容量</em>和<em>负载因子</em> 。  <em>容量</em>是哈希表中的桶数，初始容量只是创建哈希表时的容量。  <em>负载因子</em>是在容量自动增加之前允许哈希表得到满足的度量。  当在散列表中的条目的数量超过了负载因数和电流容量的乘积，哈希表被<em>重新散列</em>  （即，内部数据结构被重建），使得哈希表具有桶的大约两倍。 </p>
<p>作为一般规则，默认负载因子（.75）提供了时间和空间成本之间的良好折中。  更高的值会降低空间开销，但会增加查找成本（反映在<code>HashMap</code>类的大部分操作中，包括<code>get</code>和<code>put</code>  ）。 在设置其初始容量时，应考虑map中预期的条目数及其负载因子，以便最小化重新组播操作的数量。  如果初始容量大于最大条目数除以负载因子，则不会发生重新排列操作。 </p>
<p>如果许多映射要存储在<code>HashMap</code>实例中，则以足够大的容量创建映射将允许映射的存储效率高于使其根据需要执行自动重新排序以增长表。  请注意，使用同一个<code>hashCode()</code>多个密钥是降低任何哈希表的<code>hashCode()</code>的一种方法。  为了改善影响，当按键是<a href="../../java/lang/Comparable.html"><code>Comparable</code></a>时，这个类可以使用键之间的比较顺序来帮助打破关系。 </p>
<p>当链表大于 8 并且容量大于 64 时，链表结构会转换成红黑树结构，大体结构如下图：</p>
<ol>
<li>基于equals</li>
</ol>
<h2 id="二、属性"><a href="#二、属性" class="headerlink" title="二、属性"></a>二、属性</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEFAULT_INITIAL_CAPACITY = <span class="number">1</span> &lt;&lt; <span class="number">4</span>; <span class="comment">// 默认容量 16</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MAXIMUM_CAPACITY = <span class="number">1</span> &lt;&lt; <span class="number">30</span>; <span class="comment">//最大容量</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">float</span> DEFAULT_LOAD_FACTOR = <span class="number">0.75f</span>;<span class="comment">//默认负载因子</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TREEIFY_THRESHOLD = <span class="number">8</span>;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> UNTREEIFY_THRESHOLD = <span class="number">6</span>;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MIN_TREEIFY_CAPACITY = <span class="number">64</span>;</span><br><span class="line"><span class="keyword">transient</span> Node&lt;K,V&gt;[] table;<span class="comment">//表.分配时，长度始终为2的幂。</span></span><br><span class="line"><span class="keyword">transient</span> Set&lt;Map.Entry&lt;K,V&gt;&gt; entrySet;<span class="comment">//保存缓存的entrySet</span></span><br><span class="line"><span class="keyword">transient</span> <span class="keyword">int</span> size;<span class="comment">//现在容量</span></span><br><span class="line"><span class="keyword">transient</span> <span class="keyword">int</span> modCount;<span class="comment">//Fail-Fast机制</span></span><br><span class="line"><span class="keyword">int</span> threshold; <span class="comment">//要调整大小的下一个大小值（容量*负载系数）。</span></span><br><span class="line"><span class="keyword">final</span> <span class="keyword">float</span> loadFactor;<span class="comment">//f</span></span><br></pre></td></tr></table></figure>

<h2 id="三、-方法"><a href="#三、-方法" class="headerlink" title="三、 方法"></a>三、 方法</h2><h3 id="2-1-hash-key"><a href="#2-1-hash-key" class="headerlink" title="2.1 hash(key)"></a>2.1 hash(key)</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">hash</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">int</span> h;</span><br><span class="line">       <span class="keyword">return</span> (key == <span class="keyword">null</span>) ? <span class="number">0</span> : (h = key.hashCode()) ^ (h &gt;&gt;&gt; <span class="number">16</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-2-put"><a href="#2-2-put" class="headerlink" title="2.2 put"></a>2.2 put</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">put</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> putVal(hash(key), key, value, <span class="keyword">false</span>, <span class="keyword">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">final</span> V <span class="title">putVal</span><span class="params">(<span class="keyword">int</span> hash, K key, V value, <span class="keyword">boolean</span> onlyIfAbsent,</span></span></span><br><span class="line"><span class="params"><span class="function">               <span class="keyword">boolean</span> evict)</span> </span>&#123;</span><br><span class="line">    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; <span class="keyword">int</span> n, i;</span><br><span class="line">   </span><br><span class="line">    <span class="keyword">if</span> ((tab = table) == <span class="keyword">null</span> || (n = tab.length) == <span class="number">0</span>)</span><br><span class="line">        n = (tab = resize()).length;</span><br><span class="line">   <span class="comment">//n 为长度</span></span><br><span class="line">    <span class="comment">// p 为这个位置的Node</span></span><br><span class="line">    <span class="keyword">if</span> ((p = tab[i = (n - <span class="number">1</span>) &amp; hash]) == <span class="keyword">null</span>)</span><br><span class="line">        <span class="comment">//如果这个位置为null，就newNode</span></span><br><span class="line">        tab[i] = newNode(hash, key, value, <span class="keyword">null</span>);</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        Node&lt;K,V&gt; e; K k;</span><br><span class="line">        <span class="keyword">if</span> (p.hash == hash &amp;&amp;</span><br><span class="line">            <span class="comment">//  p.key==key||p.key.equal(key)</span></span><br><span class="line">            ((k = p.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">            e = p;<span class="comment">//e 就是找到了这个key</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (p <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">            e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(<span class="keyword">this</span>, tab, hash, key, value);</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//对于链表形式，迭代，binCount是为了防止链表超过8</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> binCount = <span class="number">0</span>; ; ++binCount) &#123;</span><br><span class="line">                <span class="comment">//第一种情况   e到链表结尾，那么直接尾插法  ① e==null</span></span><br><span class="line">                <span class="keyword">if</span> ((e = p.next) == <span class="keyword">null</span>) &#123;，</span><br><span class="line">                    p.next = newNode(hash, key, value, <span class="keyword">null</span>);</span><br><span class="line">                    <span class="keyword">if</span> (binCount &gt;= TREEIFY_THRESHOLD - <span class="number">1</span>) <span class="comment">// -1 for 1st</span></span><br><span class="line">                        treeifyBin(tab, hash);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//第二种 找到了Key 那么就赋值给p，等待后续操作. ②e!=null</span></span><br><span class="line">                <span class="keyword">if</span> (e.hash == hash &amp;&amp;</span><br><span class="line">                    ((k = e.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                p = e;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 第②种情况，更新</span></span><br><span class="line">        <span class="keyword">if</span> (e != <span class="keyword">null</span>) &#123; <span class="comment">// existing mapping for key</span></span><br><span class="line">            V oldValue = e.value;</span><br><span class="line">            <span class="keyword">if</span> (!onlyIfAbsent || oldValue == <span class="keyword">null</span>)</span><br><span class="line">                e.value = value;</span><br><span class="line">            afterNodeAccess(e);</span><br><span class="line">            <span class="keyword">return</span> oldValue;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ++modCount;</span><br><span class="line">    <span class="keyword">if</span> (++size &gt; threshold)</span><br><span class="line">        resize();</span><br><span class="line">    afterNodeInsertion(evict);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/b7b55fbaeb2948b5a50496d7a2f67c88.png" alt="b7b55fbaeb2948b5a50496d7a2f67c88"></p>
<h3 id="2-3-resize"><a href="#2-3-resize" class="headerlink" title="2.3 resize"></a>2.3 resize</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">final</span> Node&lt;K,V&gt;[] resize() &#123;</span><br><span class="line">    Node&lt;K,V&gt;[] oldTab = table;</span><br><span class="line">    <span class="keyword">int</span> oldCap = (oldTab == <span class="keyword">null</span>) ? <span class="number">0</span> : oldTab.length;</span><br><span class="line">    <span class="keyword">int</span> oldThr = threshold;</span><br><span class="line">    <span class="keyword">int</span> newCap, newThr = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (oldCap &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (oldCap &gt;= MAXIMUM_CAPACITY) &#123;</span><br><span class="line">            threshold = Integer.MAX_VALUE;</span><br><span class="line">            <span class="keyword">return</span> oldTab;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ((newCap = oldCap &lt;&lt; <span class="number">1</span>) &lt; MAXIMUM_CAPACITY &amp;&amp;</span><br><span class="line">                 oldCap &gt;= DEFAULT_INITIAL_CAPACITY)</span><br><span class="line">            newThr = oldThr &lt;&lt; <span class="number">1</span>; <span class="comment">// double threshold</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (oldThr &gt; <span class="number">0</span>) <span class="comment">// initial capacity was placed in threshold</span></span><br><span class="line">        newCap = oldThr;</span><br><span class="line">    <span class="keyword">else</span> &#123;               <span class="comment">// zero initial threshold signifies using defaults</span></span><br><span class="line">        newCap = DEFAULT_INITIAL_CAPACITY;</span><br><span class="line">        newThr = (<span class="keyword">int</span>)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (newThr == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">float</span> ft = (<span class="keyword">float</span>)newCap * loadFactor;</span><br><span class="line">        newThr = (newCap &lt; MAXIMUM_CAPACITY &amp;&amp; ft &lt; (<span class="keyword">float</span>)MAXIMUM_CAPACITY ?</span><br><span class="line">                  (<span class="keyword">int</span>)ft : Integer.MAX_VALUE);</span><br><span class="line">    &#125;</span><br><span class="line">    threshold = newThr;</span><br><span class="line">    Node&lt;K,V&gt;[] newTab = (Node&lt;K,V&gt;[])<span class="keyword">new</span> Node[newCap];</span><br><span class="line">    table = newTab;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; oldCap; ++j) &#123;</span><br><span class="line">        Node&lt;K,V&gt; e;</span><br><span class="line">        <span class="keyword">if</span> ((e = oldTab[j]) != <span class="keyword">null</span>) &#123;</span><br><span class="line">            oldTab[j] = <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">if</span> (e.next == <span class="keyword">null</span>)</span><br><span class="line">                newTab[e.hash &amp; (newCap - <span class="number">1</span>)] = e;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (e <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">                ((TreeNode&lt;K,V&gt;)e).split(<span class="keyword">this</span>, newTab, j, oldCap);</span><br><span class="line">            <span class="keyword">else</span> &#123; <span class="comment">// preserve order</span></span><br><span class="line">                Node&lt;K,V&gt; loHead = <span class="keyword">null</span>, loTail = <span class="keyword">null</span>;</span><br><span class="line">                Node&lt;K,V&gt; hiHead = <span class="keyword">null</span>, hiTail = <span class="keyword">null</span>;</span><br><span class="line">                Node&lt;K,V&gt; next;</span><br><span class="line">                <span class="keyword">do</span> &#123;</span><br><span class="line">                    next = e.next;</span><br><span class="line">                    <span class="keyword">if</span> ((e.hash &amp; oldCap) == <span class="number">0</span>) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (loTail == <span class="keyword">null</span>)</span><br><span class="line">                            loHead = e;</span><br><span class="line">                        <span class="keyword">else</span></span><br><span class="line">                            loTail.next = e;</span><br><span class="line">                        loTail = e;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="keyword">if</span> (hiTail == <span class="keyword">null</span>)</span><br><span class="line">                            hiHead = e;</span><br><span class="line">                        <span class="keyword">else</span></span><br><span class="line">                            hiTail.next = e;</span><br><span class="line">                        hiTail = e;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">while</span> ((e = next) != <span class="keyword">null</span>);</span><br><span class="line">                <span class="keyword">if</span> (loTail != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    loTail.next = <span class="keyword">null</span>;</span><br><span class="line">                    newTab[j] = loHead;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (hiTail != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    hiTail.next = <span class="keyword">null</span>;</span><br><span class="line">                    newTab[j + oldCap] = hiHead;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> newTab;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="四、类"><a href="#四、类" class="headerlink" title="四、类"></a>四、类</h2><h3 id="4-1-Node"><a href="#4-1-Node" class="headerlink" title="4.1 Node"></a>4.1 Node</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//hash: 移位16的结果 </span></span><br><span class="line">tab[i] = newNode(hash, key, value, <span class="keyword">null</span>);</span><br><span class="line">Node(<span class="keyword">int</span> hash, K key, V value, Node&lt;K,V&gt; next) &#123;</span><br><span class="line">    <span class="keyword">this</span>.hash = hash;</span><br><span class="line">    <span class="keyword">this</span>.key = key;</span><br><span class="line">    <span class="keyword">this</span>.value = value;</span><br><span class="line">    <span class="keyword">this</span>.next = next;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="五、细节"><a href="#五、细节" class="headerlink" title="五、细节"></a>五、细节</h2><ol>
<li>在散列表中的条目的数量超过了负载因数和电流容量的乘积，哈希表被<em>重新散列</em> （即，内部数据结构被重建），使得哈希表具有桶的大约两倍。</li>
<li>如果许多映射要存储在<code>HashMap</code>实例中，则以足够大的容量创建映射将允许映射的存储效率高于使其根据需要执行自动重新排序以增长表。  请注意，使用同一个<code>hashCode()</code>多个密钥是降低任何哈希表的<code>hashCode()</code>的一种方法。  为了改善影响，当按键是<a href="../../java/lang/Comparable.html"><code>Comparable</code></a>时，这个类可以使用键之间的比较顺序来帮助打破关系</li>
</ol>
<h3 id="HashMap和HashTable区别"><a href="#HashMap和HashTable区别" class="headerlink" title="HashMap和HashTable区别"></a>HashMap和HashTable区别</h3><ol>
<li>hashmap线程不安全</li>
<li>hashmap的key可以为null</li>
</ol>
<h3 id="HashMap、LinkedHashMap、TreeMap-区别"><a href="#HashMap、LinkedHashMap、TreeMap-区别" class="headerlink" title="HashMap、LinkedHashMap、TreeMap 区别"></a>HashMap、LinkedHashMap、TreeMap 区别</h3><ol>
<li>LinkedHashMap底层双向链表，有序</li>
<li>TreeMap 可以用于排序</li>
<li>HashMap</li>
</ol>
<h4 id="红黑树排序"><a href="#红黑树排序" class="headerlink" title="红黑树排序"></a>红黑树排序</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//首先判断是否能比较 comparableClassFor</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">tieBreakOrder</span><span class="params">(Object a, Object b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> d;</span><br><span class="line">    <span class="keyword">if</span> (a == <span class="keyword">null</span> || b == <span class="keyword">null</span> ||</span><br><span class="line">        (d = a.getClass().getName().</span><br><span class="line">         compareTo(b.getClass().getName())) == <span class="number">0</span>)</span><br><span class="line">        d = (System.identityHashCode(a) &lt;= System.identityHashCode(b) ?</span><br><span class="line">             -<span class="number">1</span> : <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> d;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>java</category>
      </categories>
  </entry>
  <entry>
    <title>nginx</title>
    <url>/2022/04/26/%E7%BB%84%E4%BB%B6/nginx/</url>
    <content><![CDATA[<p>[toc]</p>
<h2 id="一、概述"><a href="#一、概述" class="headerlink" title="一、概述"></a>一、概述</h2><ol>
<li><p>nginxweb反向代理服务器</p>
<ul>
<li>开源</li>
<li>高性能</li>
<li>支持热部署</li>
<li>24小数无间断</li>
<li>支持高并发(5w)</li>
</ul>
</li>
<li><p>用途</p>
<ol>
<li>静态资源服务器</li>
<li>反向代理服务器</li>
<li>正向代理服务器</li>
<li>动静分离</li>
<li>负载均衡</li>
</ol>
</li>
<li><p>代理</p>
<ol>
<li><p>正向代理</p>
<ol>
<li><p>代理服务器：：访问国外网站，使用中间人服务器，</p>
<p>中间人可以访问外国网站</p>
<p>我可以访问中间人网站</p>
</li>
</ol>
</li>
<li><p>反向代理</p>
<p>1. </p>
</li>
<li></li>
</ol>
</li>
</ol>
<h2 id="二、安装"><a href="#二、安装" class="headerlink" title="二、安装"></a>二、安装</h2><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum <span class="keyword">install</span> gcc-c++</span><br><span class="line">yum <span class="keyword">install</span> -y pcre pcre-devel</span><br><span class="line">yum <span class="keyword">install</span> -y zlib zlib-devel</span><br><span class="line">yum <span class="keyword">install</span> -y openssl openssl-devel</span><br></pre></td></tr></table></figure>

<p><a href="https://nginx.org/en/download.html">下载官网</a></p>
<p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20220308211818104.png" alt="image-20220308211818104"></p>
<p>复制链接  <a href="https://nginx.org/download/nginx-1.6.3.tar.gz">https://nginx.org/download/nginx-1.6.3.tar.gz</a></p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">方式一 wget自己安装</span><br><span class="line">wget https:<span class="regexp">//</span>nginx.org<span class="regexp">/download/</span>nginx-<span class="number">1.6</span>.<span class="number">3</span>.tar.gz</span><br><span class="line">tar -zxvf nginx-<span class="number">1.6</span>.<span class="number">3</span>.tar.gz</span><br><span class="line">方式二 yum 一步安装</span><br></pre></td></tr></table></figure>

<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line"><span class="keyword">cd</span> nginx-<span class="number">1.6</span>.<span class="number">3</span>.tar.gz</span><br><span class="line">./configure  编译配置环境</span><br><span class="line"><span class="keyword">make</span></span><br><span class="line"><span class="keyword">make</span> install</span><br></pre></td></tr></table></figure>

<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">whereis</span> nginx 找到nginx执行文件</span><br></pre></td></tr></table></figure>

<h3 id="2-1-nginx文件结构"><a href="#2-1-nginx文件结构" class="headerlink" title="2.1 nginx文件结构"></a>2.1 nginx文件结构</h3><ol>
<li>配置文件：/usr/local/nginx/conf/nginx.conf</li>
<li>启动脚本 ：/usr/local/nginx/sbin/nginx</li>
<li>log文件：/usr/local/nginx/logs/*.log</li>
<li>pid文件: /usr/local/nginx/logs/nginx.pid</li>
</ol>
<h3 id="2-2-常用命令"><a href="#2-2-常用命令" class="headerlink" title="2.2 常用命令"></a>2.2 常用命令</h3><ol>
<li><p>指定配置文件</p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line">nginx -h</span><br><span class="line">nginx -c <span class="keyword">a</span>.conf 指定配置文件</span><br><span class="line"><span class="built_in">kill</span> -quid pid  平和的结束，信号量机制</span><br><span class="line"><span class="built_in">kill</span> -term pid 立即停止</span><br><span class="line"><span class="built_in">kill</span> <span class="number">-9</span> pid 强制结束，子进程可能不会被<span class="built_in">kill</span>掉</span><br></pre></td></tr></table></figure></li>
<li><p>启动、暂停，重新加载</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line"><span class="keyword">cd</span> <span class="string">/usr/local/nginx/sbin/</span></span><br><span class="line"><span class="string">./nginx</span> </span><br><span class="line"><span class="string">./nginx</span> -s stop</span><br><span class="line"><span class="string">./nginx</span> -s <span class="keyword">quit</span></span><br><span class="line"><span class="string">./nginx</span> -s <span class="keyword">reload</span></span><br><span class="line">-s 表示signal 发送一个信号</span><br></pre></td></tr></table></figure></li>
<li><p>windows下杀死</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line">taskkill <span class="string">/fi</span> <span class="string">&quot;imagename eq nginx.EXE&quot;</span> <span class="string">/f</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="三、nginx配置文件"><a href="#三、nginx配置文件" class="headerlink" title="三、nginx配置文件"></a>三、nginx配置文件</h2><h3 id="3-1-原始配置"><a href="#3-1-原始配置" class="headerlink" title="3.1 原始配置"></a>3.1 原始配置</h3><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="comment">#user  nobody;</span></span><br><span class="line"><span class="attribute">worker_processes</span>  <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">#error_log  logs/error.log;</span></span><br><span class="line"><span class="comment">#error_log  logs/error.log  notice;</span></span><br><span class="line"><span class="comment">#error_log  logs/error.log  info;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#pid        logs/nginx.pid;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="section">events</span> &#123;</span><br><span class="line">    <span class="attribute">worker_connections</span>  <span class="number">1024</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    <span class="attribute">include</span>       mime.types;</span><br><span class="line">    <span class="attribute">default_type</span>  application/octet-stream;</span><br><span class="line"></span><br><span class="line">    <span class="comment">#log_format  main  &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span></span><br><span class="line">    <span class="comment">#                  &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span></span><br><span class="line">    <span class="comment">#                  &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#access_log  logs/access.log  main;</span></span><br><span class="line"></span><br><span class="line">    <span class="attribute">sendfile</span>        <span class="literal">on</span>;</span><br><span class="line">    <span class="comment">#tcp_nopush     on;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#keepalive_timeout  0;</span></span><br><span class="line">    <span class="attribute">keepalive_timeout</span>  <span class="number">65</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">#gzip  on;</span></span><br><span class="line"></span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span>       <span class="number">80</span>;</span><br><span class="line">        <span class="attribute">server_name</span>  localhost;</span><br><span class="line"></span><br><span class="line">        <span class="comment">#charset koi8-r;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#access_log  logs/host.access.log  main;</span></span><br><span class="line"></span><br><span class="line">        <span class="attribute">location</span> / &#123;</span><br><span class="line">            <span class="attribute">root</span>   html;</span><br><span class="line">            <span class="attribute">index</span>  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">#error_page  404              /404.html;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># redirect server error pages to the static page /50x.html</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="attribute">error_page</span>   <span class="number">500</span> <span class="number">502</span> <span class="number">503</span> <span class="number">504</span>  /50x.html;</span><br><span class="line">        <span class="attribute">location</span> = /50x.html &#123;</span><br><span class="line">            <span class="attribute">root</span>   html;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># proxy the PHP scripts to Apache listening on 127.0.0.1:80</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="comment">#location ~ \.php$ &#123;</span></span><br><span class="line">        <span class="comment">#    proxy_pass   http://127.0.0.1;</span></span><br><span class="line">        <span class="comment">#&#125;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="comment">#location ~ \.php$ &#123;</span></span><br><span class="line">        <span class="comment">#    root           html;</span></span><br><span class="line">        <span class="comment">#    fastcgi_pass   127.0.0.1:9000;</span></span><br><span class="line">        <span class="comment">#    fastcgi_index  index.php;</span></span><br><span class="line">        <span class="comment">#    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;</span></span><br><span class="line">        <span class="comment">#    include        fastcgi_params;</span></span><br><span class="line">        <span class="comment">#&#125;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># deny access to .htaccess files, if Apache&#x27;s document root</span></span><br><span class="line">        <span class="comment"># concurs with nginx&#x27;s one</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="comment">#location ~ /\.ht &#123;</span></span><br><span class="line">        <span class="comment">#    deny  all;</span></span><br><span class="line">        <span class="comment">#&#125;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># another virtual host using mix of IP-, name-, and port-based configuration</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment">#server &#123;</span></span><br><span class="line">    <span class="comment">#    listen       8000;</span></span><br><span class="line">    <span class="comment">#    listen       somename:8080;</span></span><br><span class="line">    <span class="comment">#    server_name  somename  alias  another.alias;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#    location / &#123;</span></span><br><span class="line">    <span class="comment">#        root   html;</span></span><br><span class="line">    <span class="comment">#        index  index.html index.htm;</span></span><br><span class="line">    <span class="comment">#    &#125;</span></span><br><span class="line">    <span class="comment">#&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># HTTPS server</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment">#server &#123;</span></span><br><span class="line">    <span class="comment">#    listen       443 ssl;</span></span><br><span class="line">    <span class="comment">#    server_name  localhost;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#    ssl_certificate      cert.pem;</span></span><br><span class="line">    <span class="comment">#    ssl_certificate_key  cert.key;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#    ssl_session_cache    shared:SSL:1m;</span></span><br><span class="line">    <span class="comment">#    ssl_session_timeout  5m;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#    ssl_ciphers  HIGH:!aNULL:!MD5;</span></span><br><span class="line">    <span class="comment">#    ssl_prefer_server_ciphers  on;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#    location / &#123;</span></span><br><span class="line">    <span class="comment">#        root   html;</span></span><br><span class="line">    <span class="comment">#        index  index.html index.htm;</span></span><br><span class="line">    <span class="comment">#    &#125;</span></span><br><span class="line">    <span class="comment">#&#125;</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-2-文件结构"><a href="#3-2-文件结构" class="headerlink" title="3.2 文件结构"></a>3.2 文件结构</h3><figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line"><span class="string">...</span>              <span class="comment">#1.全局块</span></span><br><span class="line"></span><br><span class="line">events &#123;         <span class="comment">#events块</span></span><br><span class="line">   <span class="string">...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http      <span class="comment">#2.http块</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">...</span>   <span class="comment">#http全局块 </span></span><br><span class="line">    server        <span class="comment">#server块</span></span><br><span class="line">    &#123; </span><br><span class="line">        <span class="string">...</span>       <span class="comment">#server全局块</span></span><br><span class="line">        location [PATTERN]   <span class="comment">#location块</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">...</span></span><br><span class="line">        &#125;</span><br><span class="line">        location [PATTERN] </span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">...</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    server</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">...</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="string">...</span>     <span class="comment">#http全局块</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-3-结构说明"><a href="#3-3-结构说明" class="headerlink" title="3.3 结构说明"></a>3.3 结构说明</h3><ol>
<li>全局块：配置影响nginx全局的指令<ol>
<li>运行nginx服务器的用户组</li>
<li>nginx进程pid存放路径</li>
<li>日志存放路径</li>
<li>配置文件引入</li>
<li>允许生成worker process数等。</li>
</ol>
</li>
<li>events块：配置影响nginx服务器或与用户的网络连接。<ol>
<li>每个进程的最大连接数</li>
<li>选取哪种事件驱动模型处理连接请求</li>
<li>是否允许同时接受多个网路连接</li>
<li>开启多个网络连接序列化等。</li>
</ol>
</li>
<li>http块：可以嵌套多个server，配置代理，缓存，日志定义等绝大多数功能和第三方模块的配置。如文件引入，mime-type定义，日志自定义，是否使用sendfile传输文件，连接超时时间，单连接请求数等。</li>
<li>server块：配置虚拟主机的相关参数，一个http中可以有多个server。</li>
<li>location块：配置请求的路由，以及各种页面的处理情况。</li>
<li>upstream块：配置集群，内网服务</li>
</ol>
<h3 id="3-4-配置参考"><a href="#3-4-配置参考" class="headerlink" title="3.4 配置参考"></a>3.4 配置参考</h3><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="comment">########### 每个指令必须有分号结束。#################</span></span><br><span class="line"><span class="comment">#user administrator administrators;  #设置worker进程的用户,默认为nobody nobody。</span></span><br><span class="line"><span class="comment">#worker_processes 2;  #指定woker进程的数量，默认为1，一般=核数*cpu个数</span></span><br><span class="line"><span class="comment">#pid /nginx/pid/nginx.pid;   #指定nginx进程id文件运行文件存放地址</span></span><br><span class="line"><span class="attribute">error_log</span> log/error.log <span class="literal">debug</span>;  <span class="comment">#制定日志路径，级别。这个设置可以放入全局块，http块，server块，级别以此为：debug|info|notice|warn|error|crit|alert|emerg</span></span><br><span class="line"><span class="section">events</span> &#123;</span><br><span class="line">    <span class="attribute">accept_mutex</span> <span class="literal">on</span>;   <span class="comment">#设置网路连接序列化，防止惊群现象发生，默认为on</span></span><br><span class="line">    <span class="attribute">multi_accept</span> <span class="literal">on</span>;  <span class="comment">#设置一个进程是否同时接受多个网络连接，默认为off</span></span><br><span class="line">    <span class="comment">#use epoll;      #事件驱动模型，select|poll|kqueue|epoll|resig|/dev/poll|eventport</span></span><br><span class="line">    <span class="attribute">worker_connections</span>  <span class="number">1024</span>;    <span class="comment">#单个进程的最大连接数，默认为512</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    <span class="attribute">include</span>       mime.types;   <span class="comment">#文件扩展名与文件类型映射表</span></span><br><span class="line">    <span class="attribute">default_type</span>  application/octet-stream; <span class="comment">#默认文件类型，默认为text/plain</span></span><br><span class="line">    <span class="comment">#access_log off; #取消服务日志    </span></span><br><span class="line">    <span class="attribute">log_format</span> myFormat <span class="string">&#x27;$remote_addr–$remote_user [$time_local] $request $status $body_bytes_sent $http_referer $http_user_agent $http_x_forwarded_for&#x27;</span>; <span class="comment">#自定义格式</span></span><br><span class="line">    <span class="attribute">access_log</span> log/access.log myFormat;  <span class="comment">#combined为日志格式的默认值</span></span><br><span class="line">    <span class="attribute">sendfile</span> <span class="literal">on</span>;   <span class="comment">#允许sendfile方式传输文件，默认为off，可以在http块，server块，location块。</span></span><br><span class="line">    <span class="attribute">sendfile_max_chunk</span> <span class="number">100k</span>;  <span class="comment">#每个进程每次调用传输数量不能大于设定的值，默认为0，即不设上限。</span></span><br><span class="line">    <span class="attribute">keepalive_timeout</span> <span class="number">65</span>;  <span class="comment">#连接超时时间，默认为75s，可以在http，server，location块。</span></span><br><span class="line"></span><br><span class="line">    <span class="attribute">upstream</span> mysvr &#123;   </span><br><span class="line">      <span class="attribute">server</span> <span class="number">127.0.0.1:7878</span>;</span><br><span class="line">      <span class="attribute">server</span> <span class="number">192.168.10.121:3333</span> backup;  <span class="comment">#热备</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="attribute">error_page</span> <span class="number">404</span> https://www.baidu.com; <span class="comment">#错误页</span></span><br><span class="line">    <span class="section">server</span> &#123; <span class="comment">#一个server就是一个服务</span></span><br><span class="line">        <span class="attribute">keepalive_requests</span> <span class="number">120</span>; <span class="comment">#单连接请求上限次数。</span></span><br><span class="line">        <span class="attribute">listen</span>       <span class="number">4545</span>;   <span class="comment">#监听端口</span></span><br><span class="line">        <span class="attribute">server_name</span>  <span class="number">127.0.0.1</span>;   <span class="comment">#服务名称，监听地址，域名 server_name:listen/root/uri       </span></span><br><span class="line">        <span class="attribute">location</span>  ~*^.+$ &#123;       <span class="comment">#请求的url过滤，正则匹配，~为区分大小写，~*为不区分大小写。</span></span><br><span class="line">           <span class="comment">#root path;  #资源目录</span></span><br><span class="line">           <span class="comment">#index index.html;  #设置默认页</span></span><br><span class="line">           <span class="attribute">proxy_pass</span>  http://mysvr;  <span class="comment">#请求转向mysvr 定义的服务器列表</span></span><br><span class="line">           <span class="attribute">deny</span> <span class="number">127.0.0.1</span>;  <span class="comment">#拒绝的ip</span></span><br><span class="line">           <span class="attribute">allow</span> <span class="number">172.18.5.54</span>; <span class="comment">#允许的ip           </span></span><br><span class="line">        &#125; </span><br><span class="line">        <span class="comment">#error_page 404		/404.html;</span></span><br><span class="line">        <span class="comment">#error_page 500 502 503  /50.html</span></span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-4-简易配置"><a href="#3-4-简易配置" class="headerlink" title="3.4_简易配置"></a>3.4_简易配置</h3><figure class="highlight abnf"><table><tr><td class="code"><pre><span class="line">worker_processes auto<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections <span class="number">1024</span><span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    sendfile            on<span class="comment">;</span></span><br><span class="line">    tcp_nopush          on<span class="comment">;</span></span><br><span class="line">    tcp_nodelay         on<span class="comment">;</span></span><br><span class="line">    keepalive_timeout   <span class="number">65</span><span class="comment">;</span></span><br><span class="line">    types_hash_max_size <span class="number">2048</span><span class="comment">;</span></span><br><span class="line">    server&#123;</span><br><span class="line">        listen <span class="number">80</span><span class="comment">;</span></span><br><span class="line">        location / &#123;</span><br><span class="line">            root html<span class="comment">;</span></span><br><span class="line">            index index.html index.htm<span class="comment">;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h3 id="3-5-结构参数"><a href="#3-5-结构参数" class="headerlink" title="3.5 结构参数"></a>3.5 结构参数</h3><h4 id="3-5-0-全局块"><a href="#3-5-0-全局块" class="headerlink" title="3.5.0 全局块"></a>3.5.0 全局块</h4><blockquote>
<p>线程数，pid存放位置，用户组，配置文件引入</p>
</blockquote>
<h4 id="3-5-1-event块"><a href="#3-5-1-event块" class="headerlink" title="3.5.1 event块"></a>3.5.1 event块</h4><blockquote>
<p>连接配置，影响性能的主要地方</p>
<p>最连接数，驱动模型、惊群串行排队</p>
</blockquote>
<h4 id="3-5-2-http块"><a href="#3-5-2-http块" class="headerlink" title="3.5.2 http块"></a>3.5.2 http块</h4><figure class="highlight css"><table><tr><td class="code"><pre><span class="line">代理、缓存、日志</span><br><span class="line">sendfile on; 开启静态资源快速传输，传送过程 磁盘-&gt;核心内存-&gt;用户内存-&gt;核心内存-&gt;tcp，省略了<span class="number">3</span>,<span class="number">4</span>步</span><br><span class="line">keepalive_timeout; 处理长连接，一般tcp连接经过三次挥手，浪费极大，而开启长连接就能复用上一次的连接</span><br><span class="line">keepalive_requests <span class="number">20</span>; 长连接次数  <span class="number">20</span>次连接后，就需要重新建立连接 </span><br><span class="line">listen <span class="number">80</span> <span class="selector-attr">[defalut_server]</span>; 监听的端口</span><br><span class="line">server_name localhost;虚拟主机的名称,值：localhost,ip,域名，正则，通配符星号</span><br></pre></td></tr></table></figure>

<h5 id="3-5-2-1-defalut-server"><a href="#3-5-2-1-defalut-server" class="headerlink" title="3.5.2.1 defalut_server"></a>3.5.2.1 defalut_server</h5><figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">server</span>&#123;</span><br><span class="line">	<span class="keyword">listen</span> <span class="number">888</span>;</span><br><span class="line">	server_name abc.com;</span><br><span class="line">	<span class="keyword">location</span>&#123;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">server</span>&#123;</span><br><span class="line">	<span class="keyword">listen</span> <span class="number">888</span>;</span><br><span class="line">	server_name xxxx.com;</span><br><span class="line">	<span class="keyword">location</span>&#123;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">第一个<span class="keyword">server</span>:abc.com就是默认<span class="keyword">server</span>,对于访问<span class="number">888</span>端口如果没有匹配到，就是转到abc.c</span><br></pre></td></tr></table></figure>

<h5 id="3-5-2-2-server-name"><a href="#3-5-2-2-server-name" class="headerlink" title="3.5.2.2 server_name"></a>3.5.2.2 server_name</h5><ol>
<li>通配符：*.wyg.com  *只能在首尾 *</li>
<li>正则：server_name ~^www.\w+.com     <code>www.*.com</code>  其中.是防转义字符</li>
<li>server_name匹配顺序<ol>
<li>精确匹配</li>
<li>通配符在首部的   <code>*.abc.com</code></li>
<li>通配符*在结尾的  <code>www.wyg.*</code></li>
<li>正则匹配</li>
<li>default_server</li>
</ol>
</li>
</ol>
<h4 id="3-5-3-server块"><a href="#3-5-3-server块" class="headerlink" title="3.5.3 server块"></a>3.5.3 server块</h4><blockquote>
<p>虚拟主机、对外好像是一台提供http、ftp、email网络服务的主机</p>
</blockquote>
<h4 id="3-5-4-location块"><a href="#3-5-4-location块" class="headerlink" title="3.5.4 location块"></a>3.5.4 location块</h4><ol>
<li>路由转发，缓存，指定文件地址</li>
</ol>
<h3 id="3-6-特殊"><a href="#3-6-特殊" class="headerlink" title="3.6 特殊"></a>3.6 特殊</h3><h4 id="3-6-1-多种块都存在的参数"><a href="#3-6-1-多种块都存在的参数" class="headerlink" title="3.6.1 多种块都存在的参数"></a>3.6.1 多种块都存在的参数</h4><p>例如: access.log</p>
<p><strong>就近原则</strong></p>
<ol>
<li><p>在http中</p>
</li>
<li><p>在server中</p>
</li>
<li><p>在location中</p>
</li>
</ol>
<h2 id="二、使用"><a href="#二、使用" class="headerlink" title="二、使用"></a>二、使用</h2><h3 id="4-1-nginx虚拟主机配置"><a href="#4-1-nginx虚拟主机配置" class="headerlink" title="4.1 nginx虚拟主机配置"></a>4.1 nginx虚拟主机配置</h3><h4 id="4-1-1-步骤"><a href="#4-1-1-步骤" class="headerlink" title="4.1.1 步骤"></a>4.1.1 步骤</h4><ol>
<li><p>创建三个文件夹</p>
<figure class="highlight stata"><table><tr><td class="code"><pre><span class="line"><span class="keyword">mkdir</span> aa bb <span class="keyword">cc</span></span><br></pre></td></tr></table></figure></li>
<li><p>将index.html放进aa bb cc</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line"><span class="keyword">vim</span> <span class="built_in">index</span>.html</span><br><span class="line"><span class="keyword">cp</span> <span class="built_in">index</span>.html aa</span><br><span class="line"><span class="keyword">cp</span> <span class="built_in">index</span>.html bb</span><br><span class="line"><span class="keyword">cp</span> <span class="built_in">index</span>.html <span class="keyword">cc</span></span><br></pre></td></tr></table></figure></li>
<li><p>修改nginx.conf</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">   </span><br></pre></td></tr></table></figure></li>
<li><p>更改hosts文件或者购买域名</p>
<figure class="highlight accesslog"><table><tr><td class="code"><pre><span class="line"><span class="number">114.55.253.244</span> aa bb cc</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="4-2-反向代理"><a href="#4-2-反向代理" class="headerlink" title="4.2 反向代理"></a>4.2 反向代理</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">server &#123; #一个server就是一个服务</span><br><span class="line">    keepalive_requests <span class="number">120</span>; #单连接请求上限次数。</span><br><span class="line">    listen       <span class="number">80</span>;   #监听端口</span><br><span class="line">    server_name  wyg.aa.com;   #监听地址</span><br><span class="line">    root /usr/local/nginx/test/aa;  #资源目录</span><br><span class="line">    location  / &#123;       #请求的url过滤，正则匹配，~为区分大小写，~*为不区分大小写。</span><br><span class="line">        proxy_pass http:<span class="comment">//127.0.0.1:8003;d</span></span><br><span class="line">        index index.html;  #设置默认页</span><br><span class="line">    &#125;</span><br><span class="line">    #error_page <span class="number">404</span>         /<span class="number">404.</span>html;</span><br><span class="line">    #error_page <span class="number">500</span> <span class="number">502</span> <span class="number">503</span>  /<span class="number">50.</span>html</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//关键</span></span><br><span class="line"><span class="comment">//  location / 用于代理前端html,直接转发</span></span><br><span class="line"><span class="comment">//   location /api  用于代理后端,rewrite后转发</span></span><br><span class="line">server &#123; #一个server就是一个服务</span><br><span class="line">        keepalive_requests <span class="number">120</span>; #单连接请求上限次数。</span><br><span class="line">        listen       <span class="number">80</span>;   #监听端口</span><br><span class="line">        server_name  localhost;   #监听地址</span><br><span class="line">        location  / &#123;        # 代理</span><br><span class="line">           proxy_pass http:<span class="comment">//127.0.0.1:8888;</span></span><br><span class="line">         #  root     /home/admin/html;  #资源目录</span><br><span class="line">          # index a.html;  #设置默认页</span><br><span class="line">        &#125;</span><br><span class="line">        location /api &#123;</span><br><span class="line">                proxy_pass http:<span class="comment">//abc.com;</span></span><br><span class="line">                rewrite ^/api/(.*)$ /$<span class="number">1</span> <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"><span class="comment">// 原理</span></span><br><span class="line"><span class="comment">// 访问 /api/a   转发到   http://abc.com/a</span></span><br></pre></td></tr></table></figure>





<h3 id="4-3-静态资源"><a href="#4-3-静态资源" class="headerlink" title="4.3 静态资源"></a>4.3 静态资源</h3><figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">location /uri &#123;  </span><br><span class="line">    root <span class="regexp">/data/</span>w3;</span><br><span class="line">&#125;</span><br><span class="line">访问   server:port<span class="regexp">/uri/</span>a.png</span><br><span class="line">真实路径  root+uri+a.png</span><br></pre></td></tr></table></figure>

<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">location /uri &#123;  </span><br><span class="line">    alias <span class="regexp">/data/</span>w3;</span><br><span class="line">&#125;</span><br><span class="line">访问   server:port<span class="regexp">/uri/</span>a.png</span><br><span class="line">真实路径  alias+uri</span><br></pre></td></tr></table></figure>

<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">location</span>  /&#123;<span class="attribute">undefined</span></span><br><span class="line">            alias /usr/local/download/;</span><br><span class="line">            <span class="comment">#Nginx日志目录</span></span><br><span class="line">            <span class="attribute">autoindex</span> <span class="literal">on</span>;<span class="comment">#注意。不能有Index，如果有，请加入一句话 index abc123.html</span></span><br><span class="line">            <span class="comment">#打开目录浏览功能</span></span><br><span class="line">            <span class="attribute">autoindex_exact_size</span> <span class="literal">off</span>;</span><br><span class="line">            <span class="comment">#默认为on，显示出文件的确切大小，单位是bytes</span></span><br><span class="line">            <span class="comment">#显示出文件的大概大小，单位是kB或者MB或者GB</span></span><br><span class="line">            <span class="attribute">autoindex_localtime</span> <span class="literal">on</span>;</span><br><span class="line">            <span class="comment">#默认为off，显示的文件时间为GMT时间。</span></span><br><span class="line">            <span class="comment">#改为on后，显示的文件时间为文件的服务器时间</span></span><br><span class="line">            <span class="attribute">add_header</span> Cache-Control <span class="literal">no</span>-store;</span><br><span class="line">           &#125;</span><br></pre></td></tr></table></figure>

<p>关键字：</p>
<ol>
<li>location </li>
<li>root  有点像根前缀</li>
<li>alias  前缀+中缀</li>
<li>uri  有点像中缀</li>
<li>path</li>
<li>img.png  是真是资源后缀</li>
<li>autoindex 打开目录</li>
</ol>
<h3 id="4-4-负载均衡"><a href="#4-4-负载均衡" class="headerlink" title="4.4 负载均衡"></a>4.4 负载均衡</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 负载均衡池</span></span><br><span class="line">upstream backend  &#123;</span><br><span class="line">  server backend1.example.com weight=<span class="number">5</span>;</span><br><span class="line">  server backend2.example.com:<span class="number">8080</span>;</span><br><span class="line">  server unix:/tmp/backend3;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">  location / &#123;</span><br><span class="line">    proxy_pass  http://backend;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="系统扩展的方式"><a href="#系统扩展的方式" class="headerlink" title="系统扩展的方式"></a>系统扩展的方式</h4><ul>
<li>横向扩展：增加机器数量，负载均衡</li>
<li>纵向扩展：提高硬件性能</li>
</ul>
<h4 id="负载均衡算法"><a href="#负载均衡算法" class="headerlink" title="负载均衡算法"></a>负载均衡算法</h4><ol>
<li>ip  hash  <ol>
<li>这种不需要做session共享</li>
</ol>
</li>
</ol>
<h4 id="负载均衡作用"><a href="#负载均衡作用" class="headerlink" title="负载均衡作用"></a>负载均衡作用</h4><ol>
<li>提高高并发能力</li>
<li>在负载均衡上过滤，提高系统安全性</li>
<li>故障转移，实现高可用</li>
</ol>
<h4 id="负载均衡方式"><a href="#负载均衡方式" class="headerlink" title="负载均衡方式"></a>负载均衡方式</h4><ul>
<li><p>用户手动下载</p>
<p>比如：联通下载，电信下载</p>
</li>
<li><p>DNS轮询：DNS服务商可以让一个域名对应不同的ip</p>
</li>
<li><p>四层、七层负载均衡</p>
</li>
</ul>
<h3 id="4-5-跨域"><a href="#4-5-跨域" class="headerlink" title="4.5 跨域"></a>4.5 跨域</h3><h4 id="nginx-conf"><a href="#nginx-conf" class="headerlink" title="nginx.conf"></a>nginx.conf</h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">server &#123; <span class="comment">#一个server就是一个服务</span></span><br><span class="line">      keepalive_requests 120; <span class="comment">#单连接请求上限次数。</span></span><br><span class="line">      listen       80;   <span class="comment">#监听端口</span></span><br><span class="line">      server_name  localhost;   <span class="comment">#监听地址</span></span><br><span class="line">      location  / &#123;        <span class="comment">#请求的url过滤，正则匹配，~为区分大小写，~*为不区分大小写。</span></span><br><span class="line">         proxy_pass http://127.0.0.1:8080;</span><br><span class="line">       <span class="comment">#  root     /home/admin/html;  #资源目录</span></span><br><span class="line">        <span class="comment"># index a.html;  #设置默认页</span></span><br><span class="line">      &#125;</span><br><span class="line">      location /api &#123;</span><br><span class="line">              proxy_pass http://localhost:8001;</span><br><span class="line">              rewrite ^/api/(.*)$ /<span class="variable">$1</span> <span class="built_in">break</span>;</span><br><span class="line"></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h4 id="前端"><a href="#前端" class="headerlink" title="前端"></a>前端</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">bp=<span class="string">&quot;/api/&quot;</span></span><br><span class="line"><span class="function"><span class="title">login</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    that=<span class="built_in">this</span></span><br><span class="line">    axios.post(bp+<span class="string">&quot;user/login&quot;</span>, <span class="built_in">this</span>.user).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(res);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>



<h4 id="rewrite"><a href="#rewrite" class="headerlink" title="rewrite"></a>rewrite</h4><blockquote>
<p>重定向，支持正则表达式</p>
</blockquote>
<p>rewrite regex to</p>
<h3 id="4-6-访问控制"><a href="#4-6-访问控制" class="headerlink" title="4.6 访问控制"></a>4.6 访问控制</h3><figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line"><span class="keyword">location</span> <span class="title">/ &#123;</span></span><br><span class="line"><span class="title">  deny</span> <span class="number">192.168</span>.<span class="number">1.1</span>;   <span class="comment"># 禁止Ip</span></span><br><span class="line">  allow   <span class="number">192.168</span>.<span class="number">1.0</span>/<span class="number">24</span>; <span class="comment"># 允许ip</span></span><br><span class="line">  allow   <span class="number">10.1</span>.<span class="number">1.0</span>/<span class="number">16</span>;</span><br><span class="line">  denyall; <span class="comment"># 禁止所有ip</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="认证模块http-auth-basic-module"><a href="#认证模块http-auth-basic-module" class="headerlink" title="认证模块http_auth_basic_module"></a>认证模块<strong>http_auth_basic_module</strong></h4><h2 id="五、其他"><a href="#五、其他" class="headerlink" title="五、其他"></a>五、其他</h2><h3 id="5-0-nginx正则匹配"><a href="#5-0-nginx正则匹配" class="headerlink" title="5.0 nginx正则匹配"></a>5.0 nginx正则匹配</h3><h3 id="5-1-注意"><a href="#5-1-注意" class="headerlink" title="5.1 注意"></a>5.1 注意</h3><ol>
<li><p>尽量不写结尾的”/“符号，不然很难匹配</p>
<p>​    有以下规则</p>
<ol>
<li>如果在配置路径写了结尾”/“，那么在浏览器也必须写结尾的”/“</li>
<li>如果配置路径没写结尾”/“，那么在浏览器可写可不写”/ “</li>
<li>所以，**配置里面不要写结尾的/  **</li>
</ol>
</li>
<li><p>更新资源不需要reload，更新配置文件才需要reload</p>
</li>
</ol>
<h4 id="5-1-2-目录权限问题-403错误"><a href="#5-1-2-目录权限问题-403错误" class="headerlink" title="5.1.2 目录权限问题 403错误"></a>5.1.2 目录权限问题 403错误</h4><ol>
<li><p>如果是root的启动，那么nginx不能代理其他用户权限的文件夹，获取权限方式</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">chown -R wyg <span class="regexp">/home/</span>testUser</span><br></pre></td></tr></table></figure></li>
<li><p>不能访问 /root下的文件问题</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">配置文件第一行指定用户</span><br><span class="line"><span class="keyword">user</span> <span class="title">root</span>;</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="5-2-高级配置"><a href="#5-2-高级配置" class="headerlink" title="5.2 高级配置"></a>5.2 高级配置</h3><blockquote>
<p>nginx keepalive</p>
</blockquote>
<h2 id="六、linux相关"><a href="#六、linux相关" class="headerlink" title="六、linux相关"></a>六、linux相关</h2><h3 id="6-1-做成操作系统服务"><a href="#6-1-做成操作系统服务" class="headerlink" title="6.1 做成操作系统服务"></a>6.1 做成操作系统服务</h3><ol>
<li><p>linux服务默认位置：/usr/lib/systemd/system</p>
</li>
<li><p>在该文件夹下创建nginx.service</p>
</li>
<li><p>添加内容</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line"><span class="string">....</span>百度查询nginx.servie</span><br></pre></td></tr></table></figure></li>
<li><p>修改权限</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">chmod</span> <span class="number">755</span> nginx.service</span><br></pre></td></tr></table></figure></li>
<li><p>启动</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">systemctl <span class="literal">start</span> nginx</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="六、原理-暂无"><a href="#六、原理-暂无" class="headerlink" title="六、原理-暂无"></a>六、原理-暂无</h2><p>下载tomcat</p>
<p>wget <a href="https://archive.apache.org/dist/tomcat/tomcat-8/v8.0.23/bin/apache-tomcat-8.0.23.tar.gz">https://archive.apache.org/dist/tomcat/tomcat-8/v8.0.23/bin/apache-tomcat-8.0.23.tar.gz</a></p>
<p>tar -zxvf …</p>
<p>./tomcat/bin/startup.sh</p>
]]></content>
      <categories>
        <category>组件</category>
      </categories>
  </entry>
  <entry>
    <title>Quartz</title>
    <url>/2022/05/06/%E7%BB%84%E4%BB%B6/quartz%20/</url>
    <content><![CDATA[<h2 id="一、Quartz介绍"><a href="#一、Quartz介绍" class="headerlink" title="一、Quartz介绍"></a>一、Quartz介绍</h2><ol>
<li><p>优点</p>
<p>quartz支持JTA事务、集群的支持。</p>
</li>
<li><p>Quartz运行环境</p>
</li>
</ol>
<ul>
<li>Quartz 可以运行嵌入在另一个独立式应用程序</li>
<li>Quartz 可以在应用程序服务器(或servlet容器)内被实例化，并且参与事务</li>
<li>Quartz 可以作为一个独立的程序运行(其自己的Java虚拟机内)，可以通过RMI使用</li>
<li>Quartz 可以被实例化，作为独立的项目集群(负载平衡和故障转移功能)，用于作业的执行</li>
</ul>
<ol start="3">
<li>Quartz设计模式</li>
</ol>
<ul>
<li>Builder模式</li>
<li>Factory模式</li>
<li>组件模式</li>
<li>链式编程</li>
</ul>
<p>官网：<a href="http://www.quartz-scheduler.org/">http://www.quartz-scheduler.org/</a> </p>
<h2 id="二、Quartz体系"><a href="#二、Quartz体系" class="headerlink" title="二、Quartz体系"></a>二、Quartz体系</h2><p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/1.png" alt="0"></p>
<h3 id="2-1-任务Job"><a href="#2-1-任务Job" class="headerlink" title="2.1 任务Job"></a>2.1 任务Job</h3><blockquote>
<p>类似于线程</p>
</blockquote>
<p>Job就是你想要实现的任务类，每一个Job必须实现org.quartz.job接口，且只需实现接口定义的execute()方法。</p>
<h3 id="2-2-触发器Trigger"><a href="#2-2-触发器Trigger" class="headerlink" title="2.2 触发器Trigger"></a>2.2 触发器Trigger</h3><p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/6.png" alt="2"></p>
<blockquote>
<p>定时器</p>
</blockquote>
<p>Trigger为你执行任务的触发器，比如你想每天定时3点发送一份统计邮件，Trigger将会设置3点进行执行该任务。Trigger主要包含两种SimpleTrigger和CronTrigger两种。关于二者的区别的使用场景，后续的课程会进行讨论。</p>
<h3 id="2-3-调度器Scheduler"><a href="#2-3-调度器Scheduler" class="headerlink" title="2.3 调度器Scheduler"></a>2.3 调度器Scheduler</h3><blockquote>
<p>管家</p>
</blockquote>
<p>Scheduler为任务的调度器，它会将任务job及触发器Trigger整合起来，负责基于Trigger设定的时间来执行Job。</p>
<h2 id="三、类"><a href="#三、类" class="headerlink" title="三、类"></a>三、类</h2><h3 id="3-1-JobExecutionContext"><a href="#3-1-JobExecutionContext" class="headerlink" title="3.1 JobExecutionContext"></a>3.1 JobExecutionContext</h3><blockquote>
<p>Job能通过JobExecutionContext对象访问到Quartz运行时候的环境以及Job本身的明细数据</p>
</blockquote>
<p>可用获得</p>
<ol>
<li><p>JobDetail信息</p>
</li>
<li><p>执行信息：当前执行时间，下一次执行时间，</p>
</li>
<li><p>触发器信息</p>
</li>
</ol>
<h3 id="3-2-JobDetail"><a href="#3-2-JobDetail" class="headerlink" title="3.2 JobDetail"></a>3.2 JobDetail</h3><blockquote>
<p>内容：name，group，JobDataMap</p>
</blockquote>
<p>​    JobDetail为Job实例提供了许多设置属性，以及JobDataMap成员变量属性，它用来存储特定Job实例的状态信息，调度器需要借助JobDetail对象来添加Job实例。</p>
<h3 id="3-3-JobDataMap"><a href="#3-3-JobDataMap" class="headerlink" title="3.3 JobDataMap"></a>3.3 JobDataMap</h3><ol>
<li><p>无状态：每个任务在执行前都创建一个新的JobDataMap</p>
</li>
<li><p>有状态：@PersistJobDataAfterExecution</p>
<p>每个任务都有一个全局的JobDataMap</p>
</li>
</ol>
<h3 id="3-4-监听器"><a href="#3-4-监听器" class="headerlink" title="3.4 监听器"></a>3.4 监听器</h3><blockquote>
<p>JobListener、TriggerListener、SchedulerListener三种监听器</p>
<p>且有全局/非全局之分</p>
<ol>
<li>全局：全部的Job</li>
<li>非全局：注册到该监听器的job</li>
</ol>
</blockquote>
<h4 id="3-4-1-JobListener"><a href="#3-4-1-JobListener" class="headerlink" title="3.4.1 JobListener"></a>3.4.1 JobListener</h4><blockquote>
<p>job开始要执行的提示; job执行完成的提示</p>
</blockquote>
<ol>
<li><p>getName方法：用于获取该JobListener的名称。</p>
</li>
<li><p>jobToBeExecuted方法：Scheduler在JobDetail将要被执行时调用这个方法。</p>
</li>
<li><p>jobExecutionVetoed方法：Scheduler在JobDetail即将被执行，但又被TriggerListerner否决时会调用该方法</p>
</li>
<li><p>jobWasExecuted方法：Scheduler在JobDetail被执行之后调用这个方法</p>
</li>
</ol>
<h4 id="3-4-2-TriggerListener"><a href="#3-4-2-TriggerListener" class="headerlink" title="3.4.2 TriggerListener"></a>3.4.2 TriggerListener</h4><blockquote>
<p>触发器触发、触发器未正常触发、触发器完成等</p>
</blockquote>
<ol>
<li>getName方法：用于获取触发器的名称</li>
<li>triggerFired方法：当与监听器相关联的Trigger被触发，Job上的execute()方法将被执行时，Scheduler就调用该方法。</li>
<li>vetoJobExecution方法：在 Trigger 触发后，Job 将要被执行时由 Scheduler 调用这个方法。TriggerListener 给了一个选择去否决 Job 的执行。假如这个方法返回 true，这个 Job 将不会为此次 Trigger 触发而得到执行。</li>
<li>triggerMisfired方法：Scheduler 调用这个方法是在 Trigger 错过触发时。你应该关注此方法中持续时间长的逻辑：在出现许多错过触发的 Trigger 时，长逻辑会导致骨牌效应。你应当保持这上方法尽量的小。</li>
<li>triggerComplete方法：Trigger 被触发并且完成了 Job 的执行时，Scheduler 调用这个方法。</li>
</ol>
<h4 id="3-4-3-SchedulerListener"><a href="#3-4-3-SchedulerListener" class="headerlink" title="3.4.3 SchedulerListener"></a>3.4.3 SchedulerListener</h4><blockquote>
<p>增加一个job/trigger，删除一个job/trigger，scheduler发生严重错误，关闭scheduler等。</p>
</blockquote>
<ol>
<li><p>jobScheduled方法：用于部署JobDetail时调用</p>
</li>
<li><p>jobUnscheduled方法：用于卸载JobDetail时调用</p>
</li>
<li><p>triggerFinalized方法：当一个 Trigger 来到了再也不会触发的状态时调用这个方法。除非这个 Job 已设置成了持久性，否则它就会从 Scheduler 中移除。</p>
</li>
<li><p>triggersPaused方法：Scheduler 调用这个方法是发生在一个 Trigger 或 Trigger 组被暂停时。假如是 Trigger 组的话，triggerName 参数将为 null。</p>
</li>
<li><p>triggersResumed方法：Scheduler 调用这个方法是发生成一个 Trigger 或 Trigger 组从暂停中恢复时。假如是 Trigger 组的话，假如是 Trigger 组的话，triggerName 参数将为 null。参数将为 null。</p>
</li>
<li><p>jobsPaused方法：当一个或一组 JobDetail 暂停时调用这个方法。</p>
</li>
<li><p>jobsResumed方法：当一个或一组 Job 从暂停上恢复时调用这个方法。假如是一个 Job 组，jobName 参数将为 null。</p>
</li>
<li><p>schedulerError方法：在 Scheduler 的正常运行期间产生一个严重错误时调用这个方法。</p>
</li>
<li><p>schedulerStarted方法：当Scheduler 开启时，调用该方法</p>
</li>
<li><p>schedulerInStandbyMode方法： 当Scheduler处于StandBy模式时，调用该方法</p>
</li>
<li><p>schedulerShutdown方法：当Scheduler停止时，调用该方法</p>
</li>
<li><p>schedulingDataCleared方法：当Scheduler中的数据被清除时，调用该方法。</p>
</li>
</ol>
<h2 id="四、常用API"><a href="#四、常用API" class="headerlink" title="四、常用API"></a>四、常用API</h2><h3 id="4-1-Scheduler"><a href="#4-1-Scheduler" class="headerlink" title="4.1 Scheduler"></a>4.1 Scheduler</h3><ol>
<li><p>启动：scheduler.start()</p>
</li>
<li><p>挂起：scheduler.standby();</p>
</li>
<li><p>关闭：scheduler..shutdown()</p>
</li>
<li><p>全局监听器</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">scheduler.getListenerManager().addJobListener(<span class="keyword">new</span> MyJobListener(), EverythingMatcher.allJobs());</span><br></pre></td></tr></table></figure></li>
<li><p>局部监听器</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">scheduler.getListenerManager().addJobListener(</span><br><span class="line">    newMyJobListener(),KeyMatcher.keyEquals(JobKey.jobKey(<span class="string">&quot;job1&quot;</span>, <span class="string">&quot;group1&quot;</span>)))；</span><br></pre></td></tr></table></figure></li>
</ol>
<ul>
<li>Scheduler 用于与调度程序交互的主程序接口。<br>Scheduler 调度程序-任务执行计划表，只有安排进执行计划的任务Job（通过scheduler.scheduleJob方法安排进执行计划），当它预先定义的执行时间到了的时候（任务触发trigger），该任务才会执行。</li>
<li>Job 我们预先定义的希望在未来时间能被调度程序执行的任务类，我们可以自定义。</li>
<li>JobDetail 使用JobDetail来定义定时任务的实例，JobDetail实例是通过JobBuilder类创建的。</li>
<li>JobDataMap 可以包含不限量的（序列化的）数据对象，在job实例执行的时候，可以使用<br>其中的数据；JobDataMap是Java Map接口的一个实现，额外增加了一些便于存取基本类型的数<br>据的方法。</li>
<li>Trigger 触发器，Trigger对象是用来触发执行Job的。当调度一个job时，我们实例一个触发器然后调整它的属性来满足job执行的条件。表明任务在什么时候会执行。定义了一个已经被安排的任务将会在什么时候执行的时间条件，比如每2秒就执行一次。</li>
<li>JobBuilder -用于声明一个任务实例，也可以定义关于该任务的详情比如任务名、组名等，这个声明的实例将会作为一个实际执行的任务。</li>
<li>TriggerBuilder 触发器创建器，用于创建触发器trigger实例。</li>
<li>JobListener、TriggerListener、SchedulerListener监听器，用于对组件的监听。</li>
</ul>
<h2 id="五、使用"><a href="#五、使用" class="headerlink" title="五、使用"></a>五、使用</h2><h3 id="5-1-Hello-World"><a href="#5-1-Hello-World" class="headerlink" title="5.1 Hello World"></a>5.1 Hello World</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.quartz-scheduler<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>quartz<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyJob</span> <span class="keyword">implements</span> <span class="title">Job</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(JobExecutionContext jobExecutionContext)</span> <span class="keyword">throws</span> JobExecutionException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;完成任务&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// 1：从工厂中获取任务调度的实例</span></span><br><span class="line">        Scheduler scheduler = StdSchedulerFactory.getDefaultScheduler();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2：定义一个任务调度实例，将该实例与HelloJob绑定，任务类需要实现Job接口</span></span><br><span class="line">        JobDetail job = JobBuilder.newJob(MyJob.class)</span><br><span class="line">                .withIdentity(<span class="string">&quot;job1&quot;</span>, <span class="string">&quot;group1&quot;</span>) <span class="comment">// 定义该实例唯一标识</span></span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3：定义触发器 ，马上执行, 然后每5秒重复执行一次</span></span><br><span class="line">        Trigger trigger = TriggerBuilder.newTrigger()</span><br><span class="line">                .withIdentity(<span class="string">&quot;trigger1&quot;</span>, <span class="string">&quot;group2&quot;</span>) <span class="comment">// 定义该实例唯一标识</span></span><br><span class="line">                .startNow()  <span class="comment">// 马上执行</span></span><br><span class="line">                .withSchedule(SimpleScheduleBuilder</span><br><span class="line">                        .repeatSecondlyForever(<span class="number">2</span>)) <span class="comment">// 每5秒执行一次</span></span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4：使用触发器调度任务的执行</span></span><br><span class="line">        scheduler.scheduleJob(job, trigger);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5：开启</span></span><br><span class="line">        scheduler.start();</span><br><span class="line">        <span class="comment">// 关闭</span></span><br><span class="line">        <span class="comment">// scheduler.shutdown();</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">JobKey jobKey = context.getJobDetail().getKey();</span><br><span class="line">System.out.println(<span class="string">&quot;工作任务名称：&quot;</span>+jobKey.getName()+<span class="string">&quot;;工作任务组：&quot;</span>+jobKey.getGroup());</span><br><span class="line">System.out.println(<span class="string">&quot;任务类名称（带包名）：&quot;</span>+context.getJobDetail().getJobClass().getName());</span><br><span class="line">System.out.println(<span class="string">&quot;任务类名称：&quot;</span>+context.getJobDetail().getJobClass().getSimpleName());</span><br><span class="line">System.out.println(<span class="string">&quot;当前任务执行时间：&quot;</span>+context.getFireTime());</span><br><span class="line">System.out.println(<span class="string">&quot;下一任务执行时间：&quot;</span>+context.getNextFireTime());</span><br><span class="line">TriggerKey triggerKey = context.getTrigger().getKey();</span><br><span class="line">System.out.println(<span class="string">&quot;触发器名称：&quot;</span>+triggerKey.getName()+<span class="string">&quot;;触发器组：&quot;</span>+triggerKey.getGroup());</span><br><span class="line"></span><br><span class="line">JobDataMap jobDataMap = context.getJobDetail().getJobDataMap();</span><br><span class="line">String jobMessage = jobDataMap.getString(<span class="string">&quot;message&quot;</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;任务参数消息值：&quot;</span>+jobMessage);</span><br><span class="line"></span><br><span class="line">JobDataMap triggerDataMap = context.getTrigger().getJobDataMap();</span><br><span class="line">String triggerMessage = triggerDataMap.getString(<span class="string">&quot;message&quot;</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;触发器参数消息值：&quot;</span>+triggerMessage);</span><br></pre></td></tr></table></figure>

<h3 id="5-2-SimpleTrigger触发器"><a href="#5-2-SimpleTrigger触发器" class="headerlink" title="5.2 SimpleTrigger触发器"></a>5.2 SimpleTrigger触发器</h3><p>SimpleTrigger对于设置和使用是最为简单的一种 QuartzTrigger。</p>
<p>它是为那种需要在特定的日期/时间启动，且以一个可能的间隔时间重复执行 n 次的 Job 所设计的。</p>
<p>案例一：表示在一个指定的时间段内，执行一次作业任务；</p>
<p>HelloJobSimpleTrigger.java</p>
<pre><code>// 定义任务类
public class HelloJobSimpleTrigger implements Job &#123;


    @Override
    public void execute(JobExecutionContext context) throws JobExecutionException &#123;
        // 定义时间
        Date date = new Date();
        SimpleDateFormat dateFormat = new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;);
        String dateString = dateFormat.format(date);
        
        // 定义工作任务内容
        System.out.println(&quot;进行数据库备份操作。当前任务执行的时间：&quot;+dateString);
    &#125;
&#125;
</code></pre>
<p>HelloSchedulerDemoSimpleTrigger.java</p>
<pre><code>public class HelloSchedulerDemoSimpleTrigger &#123;

    public static void main(String[] args) throws Exception &#123;
        // 1：从工厂中获取任务调度的实例
        Scheduler scheduler = StdSchedulerFactory.getDefaultScheduler();
        
        // 定义日期
        Date startDate = new Date();
        // 启动任务，任务在当前时间3秒后执行
        startDate.setTime(startDate.getTime()+3000);

        // 2：定义一个任务调度实例，将该实例与HelloJob绑定，任务类需要实现Job接口
        JobDetail job = JobBuilder.newJob(HelloJobSimpleTrigger.class)
                .withIdentity(&quot;job1&quot;, &quot;group1&quot;) // 定义该实例唯一标识
                .build();

        // 3：定义触发器 ，马上执行, 然后每5秒重复执行一次
        Trigger trigger = TriggerBuilder.newTrigger()
                .withIdentity(&quot;trigger1&quot;, &quot;group1&quot;) // 定义该实例唯一标识
                .startAt(startDate)
                .build();

        // 4：使用触发器调度任务的执行
        scheduler.scheduleJob(job, trigger);
        
        // 5：开启
        scheduler.start();
        // 关闭
        // scheduler.shutdown();
    &#125;
&#125;
</code></pre>
<p>案例二：或在指定的时间间隔内多次执行作业任务。</p>
<p>修改HelloSchedulerDemoSimpleTrigger.java</p>
<pre><code>    // 3：定义触发器 ，马上执行, 然后每5秒重复执行一次
    Trigger trigger = TriggerBuilder.newTrigger()
            .withIdentity(&quot;trigger1&quot;, &quot;group1&quot;) // 定义该实例唯一标识
            .startAt(startDate)
            .withSchedule(SimpleScheduleBuilder.simpleSchedule().repeatSecondlyForever(5)
                    .withRepeatCount(2)) // 每5秒执行一次，连续执行3次后停止，默认值是0
            .build();
</code></pre>
<p>案例三：指定任务的结束时间。</p>
<p>修改HelloSchedulerDemoSimpleTrigger.java</p>
<pre><code>// 定义日期
Date endDate = new Date();
// 启动结束，任务在当前时间10秒后停止
endDate.setTime(endDate.getTime()+10000);

// 2：定义一个任务调度实例，将该实例与HelloJob绑定，任务类需要实现Job接口
JobDetail job = JobBuilder.newJob(HelloJobSimpleTrigger.class)
        .withIdentity(&quot;job1&quot;, &quot;group1&quot;) // 定义该实例唯一标识
        .build();

// 3：定义触发器 ，马上执行, 然后每5秒重复执行一次
Trigger trigger = TriggerBuilder.newTrigger()
        .withIdentity(&quot;trigger1&quot;, &quot;group1&quot;) // 定义该实例唯一标识
        .startAt(startDate)
        .endAt(endDate)
        .withSchedule(SimpleScheduleBuilder.simpleSchedule().repeatSecondlyForever(5)
                .withRepeatCount(3)) // 每5秒执行一次，连续执行3次后停止
        .build();    
</code></pre>
<p>需要注意的点</p>
<ul>
<li>SimpleTrigger的属性有：开始时间、结束时间、重复次数和重复的时间间隔。</li>
<li>重复次数属性的值可以为0、正整数、或常量 SimpleTrigger.REPEAT_INDEFINITELY。</li>
<li>重复的时间间隔属性值必须为大于0或长整型的正整数，以毫秒作为时间单位，当重复的时间间隔为0时，意味着与Trigger同时触发执行。</li>
<li>如果有指定结束时间属性值，则结束时间属性优先于重复次数属性，这样的好处在于：当我们需要创建一个每间隔10秒钟触发一次直到指定的结束时间的 Trigger，而无需去计算从开始到结束的所重复的次数，我们只需简单的指定结束时间和使用REPEAT_INDEFINITELY作为重复次数的属性 值即可。</li>
</ul>
<h3 id="5-3-CronTrigger触发器"><a href="#5-3-CronTrigger触发器" class="headerlink" title="5.3 CronTrigger触发器"></a>5.3 CronTrigger触发器</h3><p>如果你需要像日历那样按日程来触发任务，而不是像SimpleTrigger 那样每隔特定的间隔时间触发，CronTriggers通常比SimpleTrigger更有用,因为它是基于日历的作业调度器。</p>
<p>使用CronTrigger，你可以指定诸如“每个周五中午”，或者“每个工作日的9:30”或者“从每个周一、周三、周五的上午9：00到上午10：00之间每隔五分钟”这样日程安排来触发。甚至，象SimpleTrigger一样，CronTrigger也有一个startTime以指定日程从什么时候开始，也有一个（可选的）endTime以指定何时日程不再继续。</p>
<p>（1）Cron Expressions——Cron 表达式</p>
<p>Cron表达式被用来配置CronTrigger实例。Cron表达式是一个由7个子表达式组成的字符串。每个子表达式都描述了一个单独的日程细节。这些子表达式用空格分隔，分别表示：</p>
<ol>
<li>Seconds 秒</li>
<li>Minutes 分钟</li>
<li>Hours 小时</li>
<li>Day-of-Month 月中的天</li>
<li>Month 月</li>
<li>Day-of-Week 周中的天</li>
<li>Year (optional field) 年（可选的域）</li>
</ol>
<p>取值：<br><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/7.png" alt="2"></p>
<p>单个子表达式可以包含范围或者列表。例如：前面例子中的周中的天这个域（这里是”WED”）可以被替换为”MON-FRI”, “MON, WED, FRI”或者甚至”MON-WED,SAT”。</p>
<p>所有的域中的值都有特定的合法范围，这些值的合法范围相当明显，例如：秒和分域的合法值为0到59，小时的合法范围是0到23，Day-of-Month中值得合法凡范围是1到31，但是需要注意不同的月份中的天数不同。月份的合法值是1到12。或者用字符串JAN,FEB MAR, APR, MAY, JUN, JUL, AUG, SEP, OCT, NOV 及DEC来表示。Days-of-Week可以用1到7来表示（1=星期日）或者用字符串SUN, MON, TUE, WED, THU, FRI 和SAT来表示.</p>
<p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/08.jpg" alt="img"></p>
<p>练习一下：</p>
<pre><code>&quot;0 0 10,14,16 * * ?&quot; 每天上午10点，下午2点，4点
&quot;0 0/30 9-17 * * ?&quot;   朝九晚五工作时间内每半小时，从0分开始每隔30分钟发送一次
&quot;0 0 12 ? * WED&quot; 表示每个星期三中午12点 
&quot;0 0 12 * * ?&quot; 每天中午12点触发 
&quot;0 15 10 ? * *&quot; 每天上午10:15触发 
&quot;0 15 10 * * ?&quot; 每天上午10:15触发 
&quot;0 15 10 * * ? *&quot; 每天上午10:15触发 
&quot;0 15 10 * * ? 2005&quot; 2005年的每天上午10:15触发 
&quot;0 * 14 * * ?&quot; 在每天下午2点到下午2:59期间的每1分钟触发 
&quot;0 0/55 14 * * ?&quot; 在每天下午2点到下午2:55期间，从0开始到55分钟触发 
&quot;0 0/55 14,18 * * ?&quot; 在每天下午2点到2:55期间和下午6点到6:55期间的，从0开始到55分钟触发 
&quot;0 0-5 14 * * ?&quot; 在每天下午2点到下午2:05期间的每1分钟触发 
&quot;0 10,44 14 ? 3 WED&quot; 每年三月的星期三的下午2:10和2:44触发 
&quot;0 15 10 ? * MON-FRI&quot; 周一至周五的上午10:15触发 
&quot;0 15 10 15 * ?&quot; 每月15日上午10:15触发 
&quot;0 15 10 L * ?&quot; 每月最后一日的上午10:15触发 
&quot;0 15 10 ? * 6L&quot; 每月的最后一个星期五上午10:15触发 
&quot;0 15 10 ? * 6L 2002-2005&quot; 2002年至2005年的每月的最后一个星期五上午10:15触发 
&quot;0 15 10 ? * 6#3&quot; 每月的第三个星期五上午10:15触发 
</code></pre>
<p>案例：</p>
<p>HelloJobCronTrigger.java</p>
<pre><code>// 定义任务类
public class HelloJobCronTrigger implements Job &#123;


    @Override
    public void execute(JobExecutionContext context) throws JobExecutionException &#123;
        // 定义时间
        Date date = new Date();
        SimpleDateFormat dateFormat = new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;);
        String dateString = dateFormat.format(date);
        
        // 定义工作任务内容
        System.out.println(&quot;进行数据库备份操作。当前任务执行的时间：&quot;+dateString);
    &#125;
&#125;
</code></pre>
<p>HelloSchedulerDemoCronTrigger.java</p>
<pre><code>public class HelloSchedulerDemoCronTrigger &#123;

    public static void main(String[] args) throws Exception &#123;
        // 1：从工厂中获取任务调度的实例
        Scheduler scheduler = StdSchedulerFactory.getDefaultScheduler();

        // 2：定义一个任务调度实例，将该实例与HelloJob绑定，任务类需要实现Job接口
        JobDetail job = JobBuilder.newJob(HelloJobCronTrigger.class)
                .withIdentity(&quot;job1&quot;, &quot;group1&quot;) // 定义该实例唯一标识
                .build();

        // 3：定义触发器 ，马上执行, 然后每5秒重复执行一次
        Trigger trigger = TriggerBuilder.newTrigger()
                .withIdentity(&quot;trigger1&quot;, &quot;group1&quot;) // 定义该实例唯一标识
                .withSchedule(CronScheduleBuilder.cronSchedule(&quot;0/5 * * 6 4 ?&quot;))// 定义表达式
                .build();

        // 4：使用触发器调度任务的执行
        scheduler.scheduleJob(job, trigger);
        
        // 5：开启
        scheduler.start();
        // 关闭
        // scheduler.shutdown();
    &#125;
&#125;
</code></pre>
<p>小提示：</p>
<ul>
<li>‘L’和‘W’可以一起使用。（企业可用在工资计算）</li>
<li>‘#’可表示月中第几个周几。（企业可用在计算母亲节和父亲节）</li>
<li>周字段英文字母不区分大小写，例如MON==mon。</li>
<li>利用工具，在线生成。</li>
</ul>
<h2 id="六、配置"><a href="#六、配置" class="headerlink" title="六、配置"></a>六、配置</h2><figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment">#1.调度器属性</span></span><br><span class="line"><span class="comment">#调度器的实例名     </span></span><br><span class="line"><span class="meta">org.quartz.scheduler.instanceName</span> = <span class="string">QuartzScheduler     </span></span><br><span class="line"><span class="comment">#调度器的实例ID，大多数情况设置为auto即可  </span></span><br><span class="line"><span class="meta">org.quartz.scheduler.instanceId</span> = <span class="string">AUTO     </span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#2. 线程池属性</span></span><br><span class="line"><span class="comment">#处理Job的线程个数，至少为1，但最多的话最好不要超过100，在多数机器上设置该值超过100的话就会显得相当不实用了，特别是在你的 Job 执行时间较长的情况下</span></span><br><span class="line"><span class="meta">org.quartz.threadPool.threadCount</span> =  <span class="string">5     </span></span><br><span class="line"><span class="comment">#线程的优先级，优先级别高的线程比级别低的线程优先得到执行。最小为1，最大为10，默认为5</span></span><br><span class="line"><span class="meta">org.quartz.threadPool.threadPriority</span> = <span class="string">5 </span></span><br><span class="line"><span class="comment">#一个实现了 org.quartz.spi.ThreadPool 接口的类，Quartz 自带的线程池实现类是 org.quartz.smpl.SimpleThreadPool      </span></span><br><span class="line"><span class="meta">org.quartz.threadPool.class</span> = <span class="string">org.quartz.simpl.SimpleThreadPool     </span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">#3. Configure JobStore 作业存储设置 </span></span><br><span class="line"><span class="comment">#要使 Job 存储在内存中需通过设置  org.quartz.jobStrore.class 属性为 org.quartz.simpl.RAMJobStore </span></span><br><span class="line"><span class="meta">org.quartz.jobStore.class</span> = <span class="string">org.quartz.simpl.RAMJobStore     </span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">#4. Configure Plugins    插件配置 </span></span><br><span class="line"><span class="meta">org.quartz.plugin.jobInitializer.class</span> =       <span class="string"></span></span><br><span class="line"><span class="meta">org.quartz.plugins.xml.JobInitializationPlugin</span>       <span class="string"></span></span><br><span class="line">      </span><br><span class="line"><span class="meta">org.quartz.plugin.jobInitializer.overWriteExistingJobs</span> = <span class="string">true      </span></span><br><span class="line"><span class="meta">org.quartz.plugin.jobInitializer.failOnFileNotFound</span> = <span class="string">true      </span></span><br><span class="line"><span class="meta">org.quartz.plugin.jobInitializer.validating</span>=<span class="string">false  </span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>组件</category>
      </categories>
  </entry>
  <entry>
    <title>多线程CSA</title>
    <url>/2022/03/27/java/javaSE/JUC/JUC%E7%9A%84%E5%9F%BA%E7%A1%80/CSA/</url>
    <content><![CDATA[<p><a href="https://www.cnblogs.com/upcwanghaibo/p/8626802.html">转载1-多线程之CSA</a></p>
<p><a href="https://www.jianshu.com/p/fb6e91b013cc">转载2-深入浅出CSA</a></p>
<p>一、什么是CAS</p>
<p>CAS,compare and swap的缩写，比较后交换。</p>
<p>我们都知道，在java语言之前，并发就已经广泛存在并在服务器领域得到了大量的应用。所以硬件厂商老早就在芯片中加入了大量直至并发操作的原语，从而在硬件层面提升效率。在intel的CPU中，使用cmpxchg指令。</p>
<p>在Java发展初期，java语言是不能够利用硬件提供的这些便利来提升系统的性能的。而随着java不断的发展,Java本地方法(JNI)的出现，使得java程序越过JVM直接调用本地方法提供了一种便捷的方式，因而java在并发的手段上也多了起来。而在Doug Lea提供的cucurenct包中，CAS理论是它实现整个java包的基石。</p>
<p>CAS 操作包含三个操作数 —— 内存位置（V）、预期原值（A）和新值(B)。 如果内存位置的值与预期原值相匹配，那么处理器会自动将该位置值更新为新值 。否则，处理器不做任何操作。无论哪种情况，它都会在 CAS 指令之前返回该 位置的值。（在 CAS 的一些特殊情况下将仅返回 CAS 是否成功，而不提取当前 值。）CAS 有效地说明了“我认为位置 V 应该包含值 A；如果包含该值，则将 B 放到这个位置；否则，不要更改该位置，只告诉我这个位置现在的值即可。”</p>
<p>通常将 CAS 用于同步的方式是从地址 V 读取值 A，执行多步计算来获得新 值 B，然后使用 CAS 将 V 的值从 A 改为 B。如果 V 处的值尚未同时更改，则 CAS 操作成功。</p>
<p>类似于 CAS 的指令允许算法执行读-修改-写操作，而无需害怕其他线程同时 修改变量，因为如果其他线程修改变量，那么 CAS 会检测它（并失败），算法 可以对该操作重新计算。</p>
<p>二、CAS的目的</p>
<p>利用CPU的CAS指令，同时借助JNI来完成Java的非阻塞算法。其它原子操作都是利用类似的特性完成的。而整个J.U.C都是建立在CAS之上的，因此对于synchronized阻塞算法，J.U.C在性能上有了很大的提升。</p>
<p>三、CAS存在的问题</p>
<p>CAS虽然很高效的解决原子操作，但是CAS仍然存在三大问题。ABA问题，循环时间长开销大和只能保证一个共享变量的原子操作</p>
<p>\1.  ABA问题。因为CAS需要在操作值的时候检查下值有没有发生变化，如果没有发生变化则更新，但是如果一个值原来是A，变成了B，又变成了A，那么使用CAS进行检查时会发现它的值没有发生变化，但是实际上却变化了。ABA问题的解决思路就是使用版本号。在变量前面追加上版本号，每次变量更新的时候把版本号加一，那么A－B－A 就会变成1A-2B－3A。</p>
<p>从Java1.5开始JDK的atomic包里提供了一个类AtomicStampedReference来解决ABA问题。这个类的compareAndSet方法作用是首先检查当前引用是否等于预期引用，并且当前标志是否等于预期标志，如果全部相等，则以原子方式将该引用和该标志的值设置为给定的更新值。</p>
<p>关于ABA问题参考文档: <a href="http://blog.hesey.net/2011/09/resolve-aba-by-atomicstampedreference.html">http://blog.hesey.net/2011/09/resolve-aba-by-atomicstampedreference.html</a></p>
<p>\2. 循环时间长开销大。自旋CAS如果长时间不成功，会给CPU带来非常大的执行开销。如果JVM能支持处理器提供的pause指令那么效率会有一定的提升，pause指令有两个作用，第一它可以延迟流水线执行指令（de-pipeline）,使CPU不会消耗过多的执行资源，延迟的时间取决于具体实现的版本，在一些处理器上延迟时间是零。第二它可以避免在退出循环的时候因内存顺序冲突（memory order violation）而引起CPU流水线被清空（CPU pipeline flush），从而提高CPU的执行效率。</p>
<p>\3. 只能保证一个共享变量的原子操作。当对一个共享变量执行操作时，我们可以使用循环CAS的方式来保证原子操作，但是对多个共享变量操作时，循环CAS就无法保证操作的原子性，这个时候就可以用锁，或者有一个取巧的办法，就是把多个共享变量合并成一个共享变量来操作。比如有两个共享变量i＝2,j=a，合并一下ij=2a，然后用CAS来操作ij。从Java1.5开始JDK提供了AtomicReference类来保证引用对象之间的原子性，你可以把多个变量放在一个对象里来进行CAS操作。</p>
<p>四、concurrent包的实现</p>
<p>由于java的CAS同时具有 volatile 读和volatile写的内存语义，因此Java线程之间的通信现在有了下面四种方式：</p>
<ol>
<li>A线程写volatile变量，随后B线程读这个volatile变量。</li>
<li>A线程写volatile变量，随后B线程用CAS更新这个volatile变量。</li>
<li>A线程用CAS更新一个volatile变量，随后B线程用CAS更新这个volatile变量。</li>
<li>A线程用CAS更新一个volatile变量，随后B线程读这个volatile变量。</li>
</ol>
<p>Java的CAS会使用现代处理器上提供的高效机器级别原子指令，这些原子指令以原子方式对内存执行读-改-写操作，这是在多处理器中实现同步的关键（从本质上来说，能够支持原子性读-改-写指令的计算机器，是顺序计算图灵机的异步等价机器，因此任何现代的多处理器都会去支持某种能对内存执行原子性读-改-写操作的原子指令）。同时，volatile变量的读/写和CAS可以实现线程之间的通信。把这些特性整合在一起，就形成了整个concurrent包得以实现的基石。如果我们仔细分析concurrent包的源代码实现，会发现一个通用化的实现模式：</p>
<ol>
<li>首先，声明共享变量为volatile；</li>
<li>然后，使用CAS的原子条件更新来实现线程之间的同步；</li>
<li>同时，配合以volatile的读/写和CAS所具有的volatile读和写的内存语义来实现线程之间的通信。</li>
</ol>
<p>AQS，非阻塞数据结构和原子变量类（java.util.concurrent.atomic包中的类），这些concurrent包中的基础类都是使用这种模式来实现的，而concurrent包中的高层类又是依赖于这些基础类来实现的。从整体来看，concurrent包的实现示意图如下：</p>
<h2 id="二、"><a href="#二、" class="headerlink" title="二、"></a>二、</h2><h1 id="乐观锁和悲观锁？"><a href="#乐观锁和悲观锁？" class="headerlink" title="乐观锁和悲观锁？"></a>乐观锁和悲观锁？</h1><p>关于乐观锁和悲观锁的定义和使用场景，本质都是一样的，这里就不再赘述。</p>
<p>关于悲观锁，下面再进行介绍，synchronized和Lock都属于悲观锁，下面我们来具体看看乐观锁。</p>
<h1 id="乐观锁的实现-CAS"><a href="#乐观锁的实现-CAS" class="headerlink" title="乐观锁的实现-CAS"></a>乐观锁的实现-CAS</h1><p>乐观锁的核心就是CAS（Compare And Swap-比较与交换，是一种不抢占的同步方式），是一种无锁算法。CAS算法涉及三个操作数：</p>
<ul>
<li>需要读写的内存值V。</li>
<li>进行比较的值A。</li>
<li>要写入的新值B。</li>
</ul>
<p>当前仅当当前内存值V等于值A时，才进行写入新值B，有人会问我在比较相等后的同时更新了值V咋办？写入的新值B不是覆盖了别人刚写入的值吗？是的比较和写入需要保证是一个原子操作，这里通过CPU的cmpxchg指令，去比较寄存器中的A和内存中的值V，如果相等的话就写入B，如果不等的话就值V赋值给寄存器中的值A，如果想继续自旋就继续不想继续可以抛出相应错误。</p>
<p>下面我们来看看常见的AtomicInteger是如何自旋的。</p>
<h1 id="AtomicInteger"><a href="#AtomicInteger" class="headerlink" title="AtomicInteger"></a>AtomicInteger</h1><p>一个可以被原子更新的int值，关于原子变量属性描述具体可以参考{@link java.util.concurrent.automic}包。AutomicInteger用于原子递增计数器等应用程序中，不能被使用替代Integer。然而这个类扩展了Number允许被一些处理数值的工具或者公共代码统一访问。</p>
<h1 id="字段和构造函数"><a href="#字段和构造函数" class="headerlink" title="字段和构造函数"></a>字段和构造函数</h1><figure class="highlight smali"><table><tr><td class="code"><pre><span class="line">package java.util.concurrent.atomic;public class AtomicInteger extends Number implements java.io.Serializable &#123;   <span class="keyword"> private</span><span class="keyword"> static</span><span class="keyword"> final</span><span class="built_in"> long </span>serialVersionUID = 6214790243416807050<span class="class">L;</span>    // 设置使用Unsafe.compareAndSwapInt进行更新。   <span class="keyword"> private</span><span class="keyword"> static</span><span class="keyword"> final</span> Unsafe unsafe = Unsafe.getUnsafe();   <span class="keyword"> private</span><span class="keyword"> static</span><span class="keyword"> final</span><span class="built_in"> long </span>valueOffset;    // 获得value对象内存分布中的偏移量用于找到value   <span class="keyword"> static</span> &#123;        try &#123;            valueOffset = unsafe.objectFieldOffset                (AtomicInteger.class.getDeclaredField(<span class="string">&quot;value&quot;</span>));        &#125; catch (Exception ex) &#123;<span class="built_in"> throw </span>new Error(ex); &#125;    &#125;    // 保证内存可见效和禁止指令重排。   <span class="keyword"> private</span> volatile<span class="built_in"> int </span>value;   <span class="keyword"> public</span> AtomicInteger(int initialValue) &#123;        value = initialValue;    &#125;    /**     * 初始值为0     */   <span class="keyword"> public</span> AtomicInteger() &#123;    &#125;</span><br></pre></td></tr></table></figure>





<h1 id="incrementAndGet"><a href="#incrementAndGet" class="headerlink" title="incrementAndGet"></a>incrementAndGet</h1><figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**  * 以原子方式将当前值递增1  * @return 更新后的值  */</span><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">incrementAndGet</span><span class="params">()</span> </span>&#123;    <span class="keyword">return</span> unsafe.<span class="built_in">getAndAddInt</span>(<span class="keyword">this</span>, valueOffset, <span class="number">1</span>) + <span class="number">1</span>;&#125;</span><br></pre></td></tr></table></figure>





<p>var1：为AtomicInteger对象，用于unsafe结合valueOffset获得对象中的最新的value。<br>var2：value值在AtomicInteger对象中偏移量。<br>var4：增加的值为1。</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">package</span> sun.misc;public final int getAndAddInt(Object var<span class="number">1</span>, long var<span class="number">2</span>, int var<span class="number">4</span>) &#123;    int var<span class="number">5</span>;    do &#123;        //获得AutomicInteger的value值        var<span class="number">5</span> = this.getIntVolatile(var<span class="number">1</span>, var<span class="number">2</span>);    &#125; while(!this.compareAndSwapInt(var<span class="number">1</span>, var<span class="number">2</span>, var<span class="number">5</span>, var<span class="number">5</span> + var<span class="number">4</span>));    return var<span class="number">5</span>;&#125;</span><br></pre></td></tr></table></figure>





<h1 id="乐观锁的缺点"><a href="#乐观锁的缺点" class="headerlink" title="乐观锁的缺点"></a>乐观锁的缺点</h1><ul>
<li>如果并发比较高，CAS一直比较自旋，将会一直占用CPU，如果自旋的线程多了CPU就会飙升。</li>
<li>只能保证一个共享变量的原子操作。对一个共享变量执行操作时，CAS能保证原子操作，但是对多个共享变量操作时，CAS时无法保证操作的原子性的。 java从1.5开始JDK提供了AtomicReference类来保证引用之间的原子性，可以把多个变量放在一个对象中来进行CAS操作。</li>
</ul>
<h1 id="synchronized的底层是怎么实现的？"><a href="#synchronized的底层是怎么实现的？" class="headerlink" title="synchronized的底层是怎么实现的？"></a>synchronized的底层是怎么实现的？</h1><p>sychronized是通过对象头部的Mark Word中的锁标识+monitor实现的。</p>
<h1 id="java对象头"><a href="#java对象头" class="headerlink" title="java对象头"></a>java对象头</h1><p><img src="https://pics2.baidu.com/feed/d0c8a786c9177f3e968abff920a73ecd9e3d567e.jpeg?token=a570314ffc55c706e4713b297fdabeed" alt="img"></p>
<p>对象头由Mark Word和Klass组成，在没有压缩指针的时候都占8个字节。</p>
<ul>
<li><p>Mark Word：标记字段-运行时数据，如哈希码、GC信息以及锁信息。</p>
<ul>
<li><code>mark word</code>的位长度为JVM的一个Word大小，也就是说32位JVM的<code>Mark word</code>为32位，64位JVM为64位。   </li>
</ul>
</li>
<li><p>Klass：对象锁代表的类的元数据指针。(32 bits) </p>
</li>
</ul>
<p><img src="https://job-wyg.oss-cn-beijing.aliyuncs.com/image-20220327115958164.png" alt="image-20220327115958164"></p>
<p>锁标志位+是否是偏向锁（biased_lock）共同表示对象的几种状态</p>
<p><img src="https://pics7.baidu.com/feed/4bed2e738bd4b31c107584cad6be22759f2ff8ec.jpeg?token=a91c9763fdb54859f443d07d4f105a8d" alt="img"></p>
<h1 id="monitor"><a href="#monitor" class="headerlink" title="monitor"></a>monitor</h1><p>synchronized通过Monitor来实现线程同步和协作。</p>
<ul>
<li>同步依赖的是操作系统的Mutex（互斥锁量）只有拥有互斥量的线程才能进入临界区，不拥有的只能阻塞等待，会维护一个阻塞的队列。</li>
</ul>
<p><img src="https://pics1.baidu.com/feed/574e9258d109b3de207742529ed7698b810a4cb6.jpeg?token=6a0b50854d5ac5cb3751d6c976324a0e" alt="img"></p>
<ul>
<li>协作依赖的是synchronized持有的对象，对象可以让多个线程方便同步，还可以通过对象调用wait方法释放锁让线程进入等待队列，等其他线程调用对象的notify和notifyAll方法进行唤醒可以重新获取锁。</li>
</ul>
<p><img src="https://pics6.baidu.com/feed/8601a18b87d6277fedfb40a87f501a3ae824fc23.jpeg?token=9c5602cb9d020cf8db32c1a8502f4935" alt="img"></p>
<p>Monitor用来进行监听锁的持有和调度锁的持有的。持有的对象可以理解为锁的一个媒介，可以使用它方便操作同步和协作。</p>
<p>具体例子可以参考《Thread源码阅读及相关问题》中的例子。</p>
<p>monitor这套监听锁和调度锁包括使用的互斥量其实都是比较消耗资源的，所以使用它的成为“重量级锁”。JDK 6中为了减少获得锁和释放锁带来的性能消耗，引入了“偏向锁”和“轻量级锁”，下面我们分别会进行分配介绍。</p>
<h1 id="无锁"><a href="#无锁" class="headerlink" title="无锁"></a>无锁</h1><p>当对象头中锁标志位为01，是否偏向锁为0时表示使无锁的状态。想要在无锁的时候实现同步可以使用上面乐观锁中实现-CAS。</p>
<h1 id="偏向锁"><a href="#偏向锁" class="headerlink" title="偏向锁"></a>偏向锁</h1><p>偏向锁是一个锁优化的产物，在对象头中进行标记，表示有线程进入了临界区，在只有一个线程访问的时候既不用使用CAS也不用引入较重的monitor。</p>
<p>线程不会主动释放偏向锁，只有遇到其他线程进尝试竞争偏向锁时，需要等待全局安全点（在这个时间点上没有执行的字节码），它会首先暂停拥有偏向锁的的线程，判断它是否还活着，如果死亡了就恢复到无锁状态其他线程就可以占用，如果还在临界区就对锁进行升级成”轻量锁”。</p>
<p><img src="https://pics5.baidu.com/feed/024f78f0f736afc3949dbe99e171eeceb645122f.jpeg?token=b9d61ce680a1c9d0babb6d04948013d0" alt="img"></p>
<p>每个线程进入临界区的时候都会查看对象头锁标识是否是偏向锁，是偏向锁的话，会判断当前线程和对象头中的线程id是同一个线程则直接进入，如果不是则进行CAS看是不是能比较替换成功（防止马上就释放了），如果没成功就会暂停持有偏向锁的线程，看线程是否已经不再用锁了，如果没用就释放，给新进来的线程占用，如果在用就进行锁升级生成轻量锁”。</p>
<p>可以通过JVM参数关闭偏向锁：-XX:-UseBiasedLocking=false，那么程序会默认进入轻量级锁状态。 <strong>笔者思考</strong></p>
<p>可以发现在只有一个线程进入临界区的时候确实能避免使用互斥量带来的开销，但是可以发现线程不会主动释放偏向锁。为啥不当有偏向锁的时候离开临界区进行释放？还要等其他线程来的时候要等全局点的时候尝试对线程暂停之后再看该线程持有锁的状态？这些疑问我们考虑不全，可能是设计的问题，也可能是因为一些其他原因，我们对JVM源码不够熟悉的情况下会比较费解。或许后面迭代会进行优化。</p>
<p><strong>所以我们只需要明白一点：偏量锁是一种锁的优化，它本质上不是锁，只是对象头中进行了标记，如果没有多线程并发访问临界区的时候可以减少开销，如果出现多并发的时候会进行升级。</strong></p>
<h1 id="轻量级锁"><a href="#轻量级锁" class="headerlink" title="轻量级锁"></a>轻量级锁</h1><p>轻量锁发生在偏向锁升级或者-XX:-UseBiasedLocking=false的时候，线程在执行同步块之前，JVM会现在当前线程的栈帧中创建用于存储锁记录的空间，并将对象头中的Mark Word复制到锁记录中，官方称为Displaces Mark Word。然后线程尝试使用CAS将对头像中的Mark Word替换为之指向锁记录的指针。如果成功，当前线程获得锁，如果失败将通过自旋来进行同步。</p>
<h1 id="重量级锁"><a href="#重量级锁" class="headerlink" title="重量级锁"></a>重量级锁</h1><p>重量锁的锁标志位为10，就是上面介绍的monitor机制，开销最大。</p>
<p><img src="https://pics4.baidu.com/feed/32fa828ba61ea8d3bb69558dc4623544241f5865.jpeg?token=e752aa233669c05413dee5f9175f8174" alt="img"></p>
<h1 id="synchronized锁升级？"><a href="#synchronized锁升级？" class="headerlink" title="synchronized锁升级？"></a>synchronized锁升级？</h1><p>如上面的synchronized的底层实现章节。</p>
<h1 id="synchronized可重入是怎么实现的？"><a href="#synchronized可重入是怎么实现的？" class="headerlink" title="synchronized可重入是怎么实现的？"></a>synchronized可重入是怎么实现的？</h1><p>我们先用代码证明下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SynchronizedReentrantTest</span> <span class="keyword">extends</span> <span class="title">Father</span> </span>&#123;    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">doSomeThing1</span><span class="params">()</span> </span>&#123;        System.out.println(<span class="string">&quot;doSomeThing1&quot;</span>);        doSomeThing2();    &#125;    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">doSomeThing2</span><span class="params">()</span> </span>&#123;        System.out.println(<span class="string">&quot;doSomeThing2&quot;</span>);        <span class="keyword">super</span>.fatherDoSomeThing();    &#125;    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;        SynchronizedReentrantTest synchronizedReentrantTest = <span class="keyword">new</span> SynchronizedReentrantTest();        synchronizedReentrantTest.doSomeThing1();    &#125;&#125;<span class="class"><span class="keyword">class</span> <span class="title">Father</span> </span>&#123;    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">fatherDoSomeThing</span><span class="params">()</span> </span>&#123;        System.out.println(<span class="string">&quot;fatherDoSomeThing&quot;</span>);    &#125;&#125;</span><br></pre></td></tr></table></figure>





<p>输出：</p>
<figure class="highlight gcode"><table><tr><td class="code"><pre><span class="line">doSomeThi<span class="symbol">ng1</span>doSomeThi<span class="symbol">ng2</span>fatherDoSomeThi<span class="symbol">ng</span></span><br></pre></td></tr></table></figure>





<p>说明synchronized是可重入的。</p>
<p>重量级锁使用的是monitor对象中的计数字段来实现的，偏向锁应该没有只有表示当前被那个线程持有，轻量锁在每次进入的时候都会添加一个Lock Record来表示锁的重入次数。</p>
<p><strong>笔者思考</strong></p>
<p>为啥偏向锁不记录重入次数，重入的时候只需要看是否是当前线程，对象头中没有地方存放次数，所以偏向锁不会主动释放（应该是判断嵌套临界区比较麻烦），需要另外一个线程来判断当前线程是否活跃死亡了才释放还会尝试暂停持有的线程。这点其实不如轻量级锁和重量级锁。</p>
<h1 id="synchronized是公平锁还是非公平锁？"><a href="#synchronized是公平锁还是非公平锁？" class="headerlink" title="synchronized是公平锁还是非公平锁？"></a>synchronized是公平锁还是非公平锁？</h1><p>非公平的，直接下面打饭的例子：</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;<span class="built_in">public</span> <span class="keyword">class</span> SyncUnFairLockTest &#123;    //食堂    private static <span class="keyword">class</span> DiningRoom &#123;        //获取食物        @SneakyThrows        <span class="built_in">public</span> <span class="type">void</span> getFood() &#123;            <span class="keyword">System</span>.<span class="keyword">out</span>.println(Thread.currentThread().getName() + &quot;:排队中&quot;);            synchronized (this) &#123;                <span class="keyword">System</span>.<span class="keyword">out</span>.println(Thread.currentThread().getName() + &quot;:@@@@@@打饭中@@@@@@@&quot;);                Thread.sleep(<span class="number">200</span>);            &#125;        &#125;    &#125;    <span class="built_in">public</span> static <span class="type">void</span> main(String[] args) &#123;        DiningRoom diningRoom = <span class="built_in">new</span> DiningRoom();        //让<span class="number">5</span>个同学去打饭        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;            <span class="built_in">new</span> Thread(() -&gt; &#123;                diningRoom.getFood();            &#125;, &quot;同学编号:00&quot; + (i + <span class="number">1</span>)).<span class="keyword">start</span>();        &#125;    &#125;&#125;</span><br></pre></td></tr></table></figure>





<p>输出：</p>
<figure class="highlight mel"><table><tr><td class="code"><pre><span class="line">同学编号:<span class="number">001</span>:排队中同学编号:<span class="number">001</span>:@@@@@@打饭中@@@@@@@同学编号:<span class="number">005</span>:排队中同学编号:<span class="number">003</span>:排队中同学编号:<span class="number">004</span>:排队中同学编号:<span class="number">002</span>:排队中同学编号:<span class="number">002</span>:@@@@@@打饭中@@@@@@@同学编号:<span class="number">004</span>:@@@@@@打饭中@@@@@@@同学编号:<span class="number">003</span>:@@@@@@打饭中@@@@@@@同学编号:<span class="number">005</span>:@@@@@@打饭中@@@@@@@</span><br></pre></td></tr></table></figure>





<p>注意到这里我加了sleep，因为对于公平锁来说无所谓，先来的肯定先执行，但是非公平锁时后面来的线程会先进行尝试获得锁，获取不到再进入队列，这样就能避免同一进入队列再被CPU唤醒，能提高效率，但是非公平锁会出现饿死的情况。</p>
<h1 id="synchronized和volatile对比有什么区别？"><a href="#synchronized和volatile对比有什么区别？" class="headerlink" title="synchronized和volatile对比有什么区别？"></a>synchronized和volatile对比有什么区别？</h1><p>都能保证可见效，synchronized因为是锁所以能保证原子性。</p>
<p>可见效主要指的是线程共享时工作内存和主内存能否及时同步。</p>
<p><img src="https://pics1.baidu.com/feed/4d086e061d950a7b16bac8cf5fb967d3f3d3c9a4.jpeg?token=2e23c7e19378ed5bd70778eb0c6f866f" alt="img"></p>
<p>JMM关于synchronized的两个规定：</p>
<ul>
<li>线程解锁前，必须把共享变量的最新值刷新到主内存中。</li>
<li>线程加锁时，将清空工作内存中共享变量的值，从而使变量共享时，需要从主内存中重新读取最新的值。</li>
</ul>
]]></content>
      <categories>
        <category>java</category>
        <category>JUC</category>
      </categories>
  </entry>
  <entry>
    <title>文件组件</title>
    <url>/2021/12/15/java/java%E7%BB%84%E4%BB%B6/%E6%96%87%E4%BB%B6-%E8%B7%AF%E5%BE%84/</url>
    <content><![CDATA[<h2 id="File-api"><a href="#File-api" class="headerlink" title="File  api"></a>File  api</h2><p><a href="https://blog.csdn.net/m0_37989184/article/details/93025734">参考</a></p>
<p>File类的常见方法</p>
<ol>
<li><p>创建</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">createNewFile</span><span class="params">()</span></span>; <span class="comment">//创建文件</span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">mkdir</span><span class="params">()</span></span>;创建文件夹</span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">mkdirs</span><span class="params">()</span></span>;创建多级文件夹。	</span><br></pre></td></tr></table></figure></li>
<li><p>删除</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">delete</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">deleteOnExit</span><span class="params">()</span></span>;在程序退出时删除文件。</span><br></pre></td></tr></table></figure></li>
</ol>
<span id="more"></span>

<ol start="3">
<li><p>判断</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">canExcute</span><span class="params">()</span></span>; 判断是否可执行</span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">exists</span><span class="params">()</span></span>; 文件事是否存在。</span><br><span class="line">isFile();文件</span><br><span class="line">isDirectory();文件夹</span><br><span class="line">isHidden();<span class="comment">//java能得到文件中的隐藏文件但是对隐藏文件时不能访问的</span></span><br><span class="line">isAbsolute();<span class="comment">//绝对路径即时不存在也能得到。</span></span><br><span class="line"><span class="number">4.</span>获取信息。</span><br><span class="line">getName();</span><br><span class="line">getPath();</span><br><span class="line">getParent();</span><br></pre></td></tr></table></figure></li>
<li><p>三种文件创建方式</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">File file = <span class="keyword">new</span> File(<span class="string">&quot;E:/...&quot;</span>);<span class="comment">//文件/文件夹路径对象</span></span><br><span class="line">File file = <span class="keyword">new</span> File(<span class="string">&quot;...&quot;</span> ,<span class="string">&quot;&quot;</span>...);<span class="comment">//父目录绝对路径 + 子目录名称</span></span><br><span class="line">File file = <span class="keyword">new</span> File(<span class="string">&quot;...&quot;</span>,<span class="string">&quot;...&quot;</span>);<span class="comment">//父目录File对象 + 子目录名称</span></span><br><span class="line">file.exists():判断文件/文件夹是否存在</span><br><span class="line">file.delete():删除文件/文件夹</span><br><span class="line">file.isFile():判读是否为文件</span><br><span class="line">file.createNewFile():创建文件</span><br><span class="line">file.getAbsolutePath():得到文件/文件夹的绝对路径</span><br><span class="line">file.getName():得到文件/文件夹的名字</span><br></pre></td></tr></table></figure></li>
</ol>
<p>​            </p>
<h3 id="Dir"><a href="#Dir" class="headerlink" title="Dir"></a>Dir</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">file.mkdir():创建文件夹(仅限一级目录)</span><br><span class="line">file.mkdirs():创建多及目录文件夹(包括但不限一级目录)</span><br><span class="line">file.isDirectory():判读是否为目录</span><br><span class="line">String[] gdir.list():得到目录的子目录\文件的名称(不是绝对路径)</span><br><span class="line">File[] dir.listFiles():得到目录的子目录\文件事是否存在。</span><br><span class="line">file.getParent():得到父目录的绝对路径String 不可以调用可以调用mkdir()方法</span><br><span class="line">file.getParentFile()：得到父目录的绝对路径的返回值是File型可以调用mkdir()方法</span><br></pre></td></tr></table></figure>

<h3 id="Path，classLoader"><a href="#Path，classLoader" class="headerlink" title="Path，classLoader"></a>Path，classLoader</h3><ol>
<li><p>分隔符问题</p>
<blockquote>
<p>windows下路径分割符为\ </p>
<p>但是需要写成一对\防止转义，打印还是打印一个。使用/也能创建文件</p>
<p>linux下是/</p>
</blockquote>
</li>
<li><p>spring—properies的classpath使用</p>
</li>
<li><p>路径</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">System.getProperty(<span class="string">&quot;user.dir&quot;</span>)<span class="comment">//获取project路径，未编译阶段的路径</span></span><br><span class="line">Constant.class.getResource(<span class="string">&quot;/&quot;</span>)<span class="comment">//project根路径(classes路径) </span></span><br><span class="line"> <span class="comment">//注意，这个方法获取的path的分隔符是/.   </span></span><br><span class="line"><span class="comment">// linux: file:/root/   windows: file:/D:/project/get-words/target/classes/ </span></span><br><span class="line">PathUtils.class.getName() <span class="comment">//获取类名，包括package</span></span><br><span class="line">PathUtils.class.getClassLoader.getResource(<span class="string">&quot;&quot;</span>).getPath() <span class="comment">//当前ClassLoader绝对路径,父目录</span></span><br><span class="line">PathUtils.class.getClassLoader.getResource(<span class="string">&quot;&quot;</span>).getPath() <span class="comment">//当前Class绝对路径(父目录)</span></span><br></pre></td></tr></table></figure></li>
<li><p>spring通过路径读取自定义配置(为解决windows,linux绝对路径问题)</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String basePath=classesFilePath.substring(classesFilePath.contains(<span class="string">&quot;/&quot;</span>)?classesFilePath.indexOf(<span class="string">&quot;/&quot;</span>):classesFilePath.indexOf(<span class="string">&quot;\\&quot;</span>));</span><br></pre></td></tr></table></figure>

<p>或者</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String basePath=classesFilePath.substring(<span class="number">5</span>);</span><br></pre></td></tr></table></figure></li>
<li><p>rescource路径下的文件是项目编写阶段创建写出的，项目成jar包就没有rescource路径了。</p>
</li>
<li><p>rescource资源文件读取</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="module-access"><span class="module"><span class="identifier">Constant</span>.</span></span><span class="keyword">class</span>.get<span class="constructor">ClassLoader()</span>.get<span class="constructor">Resource(<span class="string">&quot;/txt/words.txt&quot;</span>)</span>;</span><br></pre></td></tr></table></figure></li>
<li><p>测试情况下还是用绝对路径，因为有时候<code>txt</code>文件不会被编译到<code>/target/class</code>文件夹</p>
</li>
</ol>
<h3 id="FileStream"><a href="#FileStream" class="headerlink" title="FileStream"></a>FileStream</h3><ol>
<li><p>input</p>
<ol>
<li><p>获得输出流</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">InputStream stream=<span class="keyword">new</span> FileInputStream(<span class="keyword">new</span> File(filePath));<span class="comment">//通过file</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>读取</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">byte</span>[]bytes=<span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">20</span>];</span><br><span class="line">stream.read(bytes);<span class="comment">//读文件</span></span><br><span class="line">String content =<span class="keyword">new</span> String(bytes);<span class="comment">//转换</span></span><br><span class="line">stream.close();<span class="comment">//关闭</span></span><br></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p>output</p>
<ol>
<li>获取</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">FileOutputStream outputStream=<span class="keyword">new</span> FileOutputStream(<span class="string">&quot;C:\\Users\\22453\\Desktop\\test.txt&quot;</span>); <span class="comment">//获得输出地址</span></span><br><span class="line">ObjectOutputStream outputStream1=<span class="keyword">new</span> ObjectOutputStream(outputStream);<span class="comment">//objectOut</span></span><br><span class="line">bf = <span class="keyword">new</span> BufferedWriter(<span class="keyword">new</span> FileWriter(<span class="string">&quot;C:\\Users\\22453\\Desktop\\test.txt&quot;</span>);</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p>写入</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">outputStream1.writeObject(s);<span class="comment">//写入obj</span></span><br><span class="line">bf.write(<span class="string">&quot;csa&quot;</span>);</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ol>
<h3 id="jar包资源文件读取问题"><a href="#jar包资源文件读取问题" class="headerlink" title="jar包资源文件读取问题"></a>jar包资源文件读取问题</h3><blockquote>
<p>基于inputstream的读取</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">BufferedReader br = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(getResources(<span class="string">&quot;txt/words&quot;</span>+i+<span class="string">&quot;.txt&quot;</span>), <span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> InputStream <span class="title">getResources</span><span class="params">(String path)</span> </span></span><br><span class="line"><span class="function">	return <span class="title">getClass</span><span class="params">()</span>.<span class="title">getClassLoader</span><span class="params">()</span>.<span class="title">getResourceAsStream</span><span class="params">(path)</span></span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="文件下载"><a href="#文件下载" class="headerlink" title="文件下载"></a>文件下载</h2><h3 id="response"><a href="#response" class="headerlink" title="response"></a>response</h3><ol>
<li><a href="https://blog.csdn.net/qq_37651267/article/details/91380351">content-type对应</a></li>
<li></li>
</ol>
<h3 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h3><ol>
<li>后端通过response下载文件，这个controller就得返回void</li>
<li>post请求不能下载文件，对于需要上传一个body的下载请求，需要拆分成一个post请求得到文件地址，然后在发送一个get请求。</li>
<li></li>
</ol>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAlgAAAGQCAYAAAByNR6YAAAAAXNSR0IArs4c6QAAIABJREFUeF7t3Q+cXFV99/HfuXdmd0J2NxAM/5HwxwdtNOzOndm4PBUXBVo1tiIioTVitWhL0SpRHv+gVcACogItSq1otaDRamstWFuLJZZqgJ07uwlNUf6G8kcQwc1uyM7uzD3nef32uZNnsu4uM9mb7MzuZ16vvirZM2fOfZ8zM98599xzjfBAAAEEEEAAAQQQSFTAJFoblSGAAAIIIIAAAggIAYtBgAACCCCAAAIIJCxAwEoYVKvr7+9PjY6OtoVhuGsvqzf5fP5Ya+2Tc6hjL196z6f19vYe/NrXvvZXH//4x20iFVIJAggggAACi0BgxoB1wgkntC9ZsuSAmQystc9t27ZtYurfzz77bP/ee+99QVtb23JjzBIR2VUul5898cQTn/nWt74VBUHwMhF5t3PO9zzvy4VC4ccLxVmP/f7771+TSqU+aq1daq1969DQ0PZGji8Ighc65zYaY3qMMe8qFAo39/b2royi6KDnqeencRgz3d3dx6RSqZWNvK5zrhJF0X8NDQ0NV5+3atWqjiVLlvzAOXeCtfYC3/fLU+u01t5njHlA/72zs9MfGRm5xRhzmjHmtYVC4fuNtIGyrSvgRMzmvr6DxsfGupI4ijZjnMlMjJ68eduzSdRHHQgggMD+FpgxYGWz2d/2PO9S51zbdI3yff/dd9999x01fzNBEPQaYz6iX8gislxEJgOWiOiH5E2dnZ2fHh0dfYWI/KOItDnn3lYsFr+5vw96X72eBqwHH3zwo8aYD2uANMbctGPHjnc98MAD4/W+5urVq5e2tbX9rXPujSJSFJG1InKJiLxltjqcc68oFotbRcQLgkDLf6Le14zLjYjIG8IwvL36vDVr1vxGpVK52zm3RUTu0cA3TZ2fds4d6nneUmPMB6Io+gIBq0H5BVD8R7nsn4i4dxkjnQkdjhMno+LJDdEBy248ddOmynT1BkFwuDFm/djY2LW1P/iy2ax+zkixWKz9jEqoaVSDAAIIPL/AbAHrHGPMV0QkM101tTMUOtvV1dX1VmPM1SKybIaXvVFELhCR35yvgPWyl73soPb29lOcc69zzv2kWCzq8SX6OPHEEzs7Ojr+SkTOFZlc43Z+GIZ/IyLRbC8UBMEHReStIvIzz/NuiqLo68aYdmPMxc6540Tk96Z5fkpEJmcZfd/vvvvuuzUIedls9oPGmP/T4IHt9Dzv9wYGBn4UP89ks9nzjTF6LJ8SEZ2J+6iIHC4i94vIE3E5DctvF5EDnXO/LSJ/QcBqUL6Fi+vM1X/kshcY467fF4dhRHY5537vlMLQd6erP5fLvUbHXqFQ2BgEwRuMMYeOjY19rb29/XQt39XVdcvIyMjFnud9v1AoDHZ3dx/oed73jDF6ynuP0GaM8fQHped5Zw4MDDy5L46HOhFAYPEI1BOwfOfctZ7n7XEqzxhzl34I6azNQw89pMHpyvjLXmdrNnqe9w/OudH43/qdc+0i8v75DFj5fP63rbX/rMHHOfeuYrH41/uiq4MgeIGIfF1E9EP+ZyLyujAMH5zttXK53FXOuYtFZEhEXuuc05mgirVW7R+fIbj+bw00UwKWnHTSSUemUqlDGzk2z/Os53kP3XXXXTqTJUEQaHC7WUTOcM6t6+rqum10dPSrIvJ6Y8xbC4XCt7WcfmH5vq+zXssJWI2IL4yyP+nrW14ulzYZI3rqfx89zD2nDBRXT6181apVbZlMRn+8/IaI/MIY8+n4fVK21npa3vO8nSLS6/v+X+rYJmDtoy6iWgQQ+DWBegKWzHYqL5fLneic+1cROUZEdjrnNnR1dX1505QpfQ1i8RqsU2tnsMbHx7+zZMmSY40xB4vIjqVLlz64adOmUm1L9bRZKpU63Pf9g6IoykRR9GylUnlk27Zt+uE5+QiCIO153mHlctlva2sbPeCAA3aMjo4e43leRut87rnnVojIadbaL8dP+XAURRuttbu2bt36tIg4XZw+PDx8lO/7h+ovWeecho0nBgcHf6l/b2T8BEEwOVPnnDvIGPPnYRj+mYjMuFC8NmBFUXSq7/vPhWH4a2ueatugv96dcxoYa2ewGmnmjGWDIDheRH4oIrr26w2lUmlLJpO5TUROFJEvicgj+mTn3KAx5jMErETYW66S27u7V/ppowG7oTV/jR7oKQODUz+r9EKQV+mp8Y6Ojsv18yZeM5iLx6W+/8QY02mtvau9vX3T5s2bn41/EOjM9ReNMc9NaUdaP+s8z9vADFajPUR5BBCYKjDngJXNZi80xlyrPxZFRL9oPzxbMAiCYHfA0jU91tpuY4yeTtOANWyMubVSqVxUXWydz+dPsdZ+Mv4A13VdOhP2rHOu4Pv+hQMDAw/pQfX09Bzj+/5G55yuyfiic+5XIqKn3X6ZSqXWVSoVPdX1UhE5JEZ4RkRGjTHfcs59pFQqdWYymaviWScto2vPdAbuW21tbX+6efPmsUaGj64B8TxPA5a2+VljzCsLhcJ/zVTH1IBVu9h8lufsEbCiKNKZrg9VTxs20t6asvfu2LHjCwceeOCbnXNfFBGdkXyDiPxcRP5NRI6qrdcY8w7n3LsJWHup3eJPm6+A1d/fnxkZGbnEGHO0iLwwnsH6inPuT6y11/i+P3lKXmeyPM/T9Yvf0osu9EfUjh07un3f75iBftfY2NjQdBfwtHhX0XwEENjPAvUELA1OVxoz+St18qG//JYuXTq4adMmm8vlvu6cO0dENND8ThiG/znbMdQELD0FdZ+unxARDTv6Ianrt3YZY86rnoLKZrNvjtd2/dw5V9J1SSKySi9a00XkHR0db9dfr/l8/jhrrbZR67ndObfKGKMfog/6vv+mKIpumClgjY2NXZLJZC7RoGWMKRtj7tGrJOPX+qmI/EmD2yV4uVzuCufcB+J1WGr218PDw++ZacF7EgGrXC4Pe553l4g0dHpwSmC6xfO8P4ii6Gsi8lsiMrn43RhzlLVWf/X/zDl3p66zEpHjNBw753S9F6cI9/Obtxlebr4CVvXYc7lcj3PuVWEYfqa3t/ekKIou1LWeNT/yJi/68Dxv0Fqrs+1nGmOOMcY86JzTGWU9na8PnaXWh6531B8T95RKpffVzpI3gzdtQACB1hGoJ2BNt8j9XhHpa2trm5iYmNDTg3rFzqP6QVcsFicv2Z/pUROwupxzA57nvd3zvJ9ba3Xh+edEpEPDSKFQmLxiTYOTXo2YSqUe2rx5c6mvry8zMTFxmYhsMMY8FUXRmsHBwUdqA1b8wflXzrmbfd8vpdPpn1YqFf0gnfYU4fLly3eNjIzcbozJGWN+EkXRGwYHB59+zWte0/6LX/xieRiGT812em/qsZ500kmrUqnUf8RXUlb//HNjzOt0oe10Ns0UsETkL621ut2ChtkRY8w655yus1urVzeOjIz887Jly3TR8W8ZY3SNli6CJ2C1zvs+sZY2YcD6vnNOtw6ZPKXvnDNxoLpAZ7Dy+fxh1trvGGMmpgtYzrkO3/fPqc6MJwZFRQggsOgE6glY+iWrv+5q1ys8lEqlznzqqacmDj744O+JyKtE5LEoil41NDSkV5jVE7A6nHPvKRaLGqomT/F5nqczUMfqIvkwDKtXzem+Tsv0Q1LXYFlr9fTdG40xOmu2e+3RlBmswbgtu/d00rK1a5ZqF7nrYtklS5Z82zn3+ngd2aejKPon/aDeunXr1HUasw6Svr6+JRMTE7rw/A+1Lr0Czzn3PmOMrmX66jPPPPNH27dv32ONWdy23YvcdQ3W3pwijK8irLZPf7kf2tnZ+bTO8OkaNRH5fNyuyYAchuEOPdUyOjoa1Z7WDYIgKyJ6ebv+wnfOuRuMMRuUW8OXBmDnnF49uMQY81vOuZsIWIvus2PygOcrYMWb+b5XPwd0naNeTOKc+7Yx5uTpZrCMMQM1Aesz8RXSZedcda3W5My77l3n+/7lBKzFOZ45agSSFKgnYOkvwPdXKpVbqy+cTqej173udY9v2rTJGxkZ+XtjzO/oAnWd3SgWi/9eZ8DaYx+s+JflpngR9e6AFQTBGfGeTrq4Wk8hTl4dVH1UtyeYMoN1fbFY1HVBezxmClhaSPf9MsboVXO6Fkwfw865ez3P+3ChUNCtC+pa5J7NZnVWZ2O8OPzGiYmJi9va2vRKp991zo0bYy4Mw1AX2u+x4D2JGazagKWL1J1zf6ubgFprP+Z5nm6rsEfAcs4d4XneVdbafy0Wi/q3yWPUqyCNMV9yzqn1K0Xkz0VEr3DUU676b/8jIkc7537s+/46a61uKMoMVpLvzBapa74CVpVnmlOEs85gxT+muqvrFKcJWKWurq6hqRfatEh30EwEEGgigXoC1qxXEQZB8DER0Svk9Iv3i52dne+Z7cOpdpF77dWJ0wWsl7/85SvL5bLOpOjC6k3OuasmJiYG29vbzxKRyZmv6QKWMeZThULh1/aBmi1g6VqpbDb7Mg1Uzjn9ANZTkzrrc38URWfUsyN7b2/vsVEU6akzvWR99ynBIAjWiIjO9Gl4e0jXgcSbgu4eCkkGrHi2Svcke0+8yevZIqK/0HcHrHK53J9Opz8clxlzzr3l+OOP/ye90jO+/L1XRN4mImd7nvfGKIqO9zzvPufcdfFaNh07n4qi6Eq2aWiid/R+bkqzBKxUKvVFvWDGWrt+phmsUqlUbG9v17WYtXdFmLoGqyr4h8+3tcp+publEECgxQTmHLB6e3tzURRpeDhEZ2h0X6ZKpfKJ2lNr+oXvnHvJ8ccfv+2hhx46ZbqNRqcLWNls9i26kF1NnXN9xWLxznjfLQ11+n97HbCMMRcVCgW9+nHqzNTkqTXdIFREPiIiY57n/W7NBpzTdvHJJ598yPj4uLZVZ9y0vVePj49fEl+NpIve3++cu1xEUs65zb7vn1V7KXiCAUuD4u/rabx4J/2/7OzsvFhPA06dwWpra/MnJia+EV85+ZDv+2+szoLFIUtD7Jt1kXtnZ+cdmzZtinp6el7ueZ6GSN0E9U2VSmWAgNVi7/oEmzvfAUuv1jXG6DjVU9a6xECXFuxe5K6nEnfu3Kl7yX0ziiLdlLRvyuHPFLAeYJF7ggOFqhBYhALPG7DinY3/0zn38BSfOzs7O2987LHH/K6uriv01Fc846PFHjLG6Bqmx5xzv2GM+V0R+c5sO7lPF7ByuZxeoaYbdurjSmutno7UK9d0jdPklXKNzGDl8/lXRlH077pjs4jolXCXxovzHxWRPxURPb2pVyuqiwaLjxljdG+vtRruZhofPT09KzzP07Cm203o40dRFJ1Zu45q9erVh6TT6X8QEd0cVAPYD40xbw/DUE+36fqwRNZgxfd61C+b4+KtLF6vQW6mNVi5XK7XOaftOtIY8y/OufVhGP6ypvxkwNJb6MT/prfg0dOFW8rl8muWLFlSKpfL3/A8T3fIflulUvkcO7kvnk+S+dxoVJXz+Xy3fkYVCoW7473bzuzs7Lx2fHy8a3x8/Np4G4dHyuXynzS6nnLx9CJHigAC+0LgeQPWTLfKEZHJW9/o4uj49jDvExE9LTfTDaJnvVXOdAFr9erVR6XTaQ09L4pvNaP3NdRF56Hujt5owIo3GdT1Qi+vwdR26d5RetWfbpaoC/rVRQOcniL8eiqV+uPqDudTOyFenK9rqnR/L33etKcA41OQeqrwn4wxuumpzijdGZ8mfWAvApbJ5XJv0XVWVQdjzMMadowxesuaZ3T7jOqaOA1Hetsb55ze1mb3Ivc4NOkC9iviBe2f7+rqen/NjNdkwDruuOP+4+GHH36b7uofX+n5R4VCQffJ0p3jD29ra9P1eMNLly79BwLWvnirNmed832rnOZUoVUIIIDA/wsE0z7itVK6Uee0N3vWNUX6S7Fmx3avu7s7SKVS77HW6izT0jhEaCD6qed51w0MDPx3LpfTX5yTp8p0Vqp6c+G+vr7lNb84fxiGoZbRBdd6RZvONB2pV+V5nne9tVZPReqMkz4m10roTV9FRL/8DzHGfKNQKHxhugPL5XIvdc5pmDjSOVcxxnyzXC7/VTqd1tOBekWRLuTW04Z6BeLfl0qlG2fadLCnp0cXievi/574tX6h9+ULw1B3V592UXxPT8+5nufppqdd8XO+u3PnzvWdnZ26D9fkrXKmu4ow3qVaN/+srh/RBf96GvMwESmlUqlgYmJCN2rVq/w0YF2RyWSuK5VKei9DnbHr0v3FdP8wERnMZDKv/PGPf6wbqYrW3d7e/ncistrzvL/o6Oj4i9qAZa1dp/d4M8Z81jm3zPO8b3V0dLxN19rpKZiRkRG9QEAvQtA1ZtovB+htc4rFom7hwWMRCMzXzZ4XAS2HiAACLSowY8Caw/GYVatWpdPp9AHt7e12yZIlu6beNqfRuuNLspeWSqWxJHZYjtdxdZTL5crWrVt1VmwyDFVfJ5VKuRe+8IXP6YLv2dqqWzKMj49/whjzXt1o1RjztkKhoKFixlvi6I2xly1bpjN9eqrtXyuVyju2bNny+PPNYMUBS3ed1/A09XFrZ2fn2Rp4tFwmkzm5VCr9ZNu2bc8FQaBrsXTLiOpDj/WaMAz1vpC7Q2B81WFbsVjUjVVd7SnCeLd2DU4aQEPP895ccxn75EaO8fFUX+OxdDr9ijvvvFNvEM1jEQjoTNbmvr6DxsfGqj8c5nTUbcY4k5kYPXnztmfnVBFPRgABBOZJYF8ErHk6lPl52fj06JXOub8vFou6yPZ5t3OIg9z5URTdVt03LAgC3chTF+jeXyqV3j11B+mPf/zj3i233KLr3PQUn+4Mr/tT6X5aelrwI1u3bp26Rm4SJJvNnmOMqW5ZoW0LS6XSpdu2zf7FFS8O1uCkN6zW0787rLU6G3apbuxaqx1vpTF50YGWE5FPV2cm56dXeFUEEEAAAQTmV4CAlYC/zvY8342Zp3kZtd8dxuJZNa+zs9PNNOOnM2Y7d+6c3Fnf9303PDxc2r59u54unS3U6QyTbhAqs9U9HYPOhqXT6VR84+lKf3+/P0Pbdr9GGIaVekJmAuxUgQACCCCAQNMKELCatmtoGAIIIIAAAgi0qgABq1V7jnYjgAACCCCAQNMKELCatmtoGAIIIIAAAgi0qgABq1V7jnYjgAACCCCAQNMKELCatmtoGAIIIIAAAgi0qgABq1V7jnYjgAACCCCAQNMKELCatmtoGAIIIIAAAgi0qgABq1V7jnYjgAACCCCAQNMKELCatmtoGAIIIIAAAgi0qgABq1V7jnYjgAACCCCAQNMKELCatmtoGAIIIIAAAgi0qgABq1V7jnYjgAACCCCAQNMKELCatmtoGAIIIIAAAgi0qgABq1V7jnYjgAACCCCAQNMKELCatmtoGAIIIIAAAgi0qgABq1V7jnYjgAACCCCAQNMKELCatmtoGAIIIIAAAgi0qgABq1V7jnYjgAACCCCAQNMKELCatmtoGAIIIIAAAgi0qgABq1V7jnYjgAACCCCAQNMKELCatmtoGAIIIIAAAgi0qgABq1V7jnYjgAACCCCAQNMKELCatmtoGAIIIIAAAgi0qgABq1V7jnYjgAACCCCAQNMKELCatmtoGAIIIIAAAgi0qgABq1V7jnYjgAACCCCAQNMKELCatmtoGAIIIIAAAgi0qgABq1V7jnYjgAACCCCAQNMKELCatmtoGAIIIIAAAgi0qgABq1V7jnYjgAACCCCAQNMKELCatmtoGAIIIIAAAgi0qgABq1V7jnYjgAACCCCAQNMKtETAyufzh1lrbxWRm8IwvE418/n80dbaq5xzR+h/G2MuCsNwUERc02rTMAQQQAABBBBYFAJNH7D6+/tTo6Ojl4nIB0XkvRqwVq1a1ZbJZK42xtxaKBRuC4KgV0SuqFQq67ds2fL4oug5DhIBBBBAAAEEmlag6QNWPp/PW2vfJyI7ROSnGrCy2exLjDHXW2vXDQ4OPh0HrptF5MYwDH/QtNo0DAEEEEAAAQQWhUBTB6zVq1cvTafTX/Q87xrn3Jucc09owAqC4DxjzFnOuXVhGO7Snsrlcp91zt0fhuENi6LnOEgEEEAAAQQQaFqBpg1Y8azUJcYY29HRcfnOnTs/WQ1Y2Wz2ncaYvIhcEIZhOQ5Yuh5rMoA1rTYNQwABBBBAAIFFIdC0ASuXy50rIqeNjY396bZt23bmcrndAUoDlud5Z6TT6fWbN28e057K5/OXOefuKxQKN83Wc0EQvH9iYuJL99xzz68WRQ9zkAgggAACCCCw3wWaMmDFs1dXiEi2RuR4ERkXkU26uN05d0GpVDpLw5eIeLlc7kpr7R3FYvEWfU53d/dK3/c3OucOq1Vdvnz5URs2bHhyxYoVlf2uzQsigAACCCCwSAVyudyxi+nQmzJgTdcBtTNYa9asObRSqWz0PO+8gYGBR4MgOFxEvmqtPX9wcPARfX5/f39meHh4j3Cl/97W1nbH6aeffu7atWsfW0wdzbEigAACCCAwnwJ9fX3b5/P19/drt2TAUqR8Pn+OtfY059xGY8wZInJvGIZ6etDOhpjNZh+21p46NDS0qDp6fw8sXg8BBBBAAIHFLNAyASufzx/ned7EXXfdNTnzpPtj7dixo9v3/Q5r7VPFYvHeejqSgFWPEmUQQAABBBBAYC4CLROw5nKQtc8lYCUlST0IIIAAAgggMJMAAYuxgQACCCCAAAIIJCxAwEoYlOoQQAABBBBAAAECFmMAAQQQQAABBBBIWICAlTAo1SGAAAIIIIAAAgQsxgACCCCAAAIIIJCwAAErYVCqQwABBBBAAAEECFiMAQQQQAABBBBAIGEBAlbCoFSHAAIIIIAAAggQsBgDCCCAAAIIIIBAwgIErIRBqQ4BBBBAAAEEECBgMQYQQAABBBBAAIGEBQhYCYNSHQIIIIAAAgggQMBiDCCAAAIIIIAAAgkLELASBqU6BBBAAAEEEECAgMUYQAABBBBAAAEEEhYgYCUMSnUIIIAAAggggAABizGAAAIIIIAAAggkLEDAShiU6hBAAAEEEEAAAQIWYwABBBBAAAEEEEhYgICVMCjVIYAAAggggAACBCzGAAIIIIAAAgggkLAAASthUKpDAAEEEEAAAQQIWIwBBBBAAAEEEEAgYQECVsKgVIcAAggggAACCBCwGAMIIIAAAggggEDCAgSshEGpDgEEEEAAAQQQIGAxBhBAAAEEEEAAgYQFCFgJg1IdAggggAACCCBAwGIMIIAAAggggAACCQsQsBIGpToEEEAAAQQQQICAxRhAAAEEEEAAAQQSFiBgJQxKdQgggAACCCCAAAGLMYAAAggggAACCCQsQMBKGJTqEEAAAQQQQAABAhZjAAEEEEAAAQQQSFiAgJUwKNUhgAACCCCAAAIELMYAAggggAACCCCQsAABK2FQqkMAAQQQQAABBAhYjAEEEEAAAQQQQCBhAQJWwqBUhwACCCCAAAIIELAYAwgggAACCCCAQMICBKyEQakOAQQQQAABBBAgYDEGEEAAAQQQQACBhAUIWAmDUh0CCCCAAAIIIEDAYgwggAACCCCAAAIJCxCwEgalOgQQQAABBBBAgIDFGEAAAQQQQAABBBIWIGAlDEp1CCCAAAIIIIAAAYsxgAACCCCAAAIIJCxAwEoYlOoQQAABBBBAAAECFmMAAQQQQAABBBBIWICAlTAo1SGAAAIIIIAAAgQsxgACCCCAAAIIIJCwAAErYVCqQwABBBBAAAEECFiMAQQQQAABBBBAIGEBAlbCoFSHAAIIIIAAAggQsBgDCCCAAAIIIIBAwgIErIRBqQ4BBBBAAAEEECBgMQYQQAABBBBAAIGEBZo5YPm5XC5wzn1YRJaJyLCIvD8MwwfVIJ/PH22tvco5d4T+tzHmojAMB0XEzWaUzWYfttaeOjQ0tD1hS6pDAAEEEEAAAQQmBZo6YPX09Bw1ODj4qIjYIAguEJEXh2H4nlWrVrVlMpmrjTG3FgqF24Ig6BWRKyqVyvotW7Y8TsBidCOAAAIIIIDAfAo0c8DawyUIgjNEZK0GrGw2+xJjzPXW2nWDg4NPx4HrZhG5MQzDHxCw5nNI8doIIIAAAggg0BIBa/Xq1UvT6fRfG2O+UigU/i0IgvOMMWc559aFYbhLuzGXy33WOXd/GIY3ELAY2AgggAACCCAwnwJNHbCCIDheZ6WMMZ4x5jrP8+6+6667Hstms+80xuRF5IIwDMtxwNL1WE+EYXgdAWs+hxSvjQACCCCAAAJNHbBqusfL5XJn6oxVuVx+WyqV+n3P885Ip9PrN2/ePKbl8vn8Zc65+wqFwk0ELAY2AggggAACCMynQKsELA1QhznnvhFF0XmpVOoEa+3FpVLprG3btu0UEQ1gV1pr7ygWi7coaHd390rf9zc65w6rBV6+fPlRGzZseHLFihWV+YTntRFAAAEEEFhMArlc7tjFdLytFLBWRVH0uVQqdZYxJlWpVDZ6nnfewMDAo0EQHC4iX7XWnj84OPiIdmB/f39meHh4j3Cl/97W1nbH6aeffu7atWsfW0wdzbEigAACCCAwnwJ9fX2Lanukpg1Y3d3dL0qlUq8QkYd0QDjn3mKM+ZdCofDt+JTgOdba05xzG40xeoXhvWEY6ulByynC+XwL8doIIIAAAggg0LQBS/fo6u7uPiaVSq3UbqpUKtuHhoZ0dmpyI9H+/v7Ujh07un3f77DWPlUsFu+tpzvZaLQeJcoggAACCCCAwFwEmjlgzeW4ZnwuAWufsFIpAggggAACCNQIELAYDggggAACCCCAQMICBKyEQakOAQQQQAABBBAgYDEGEEAAAQQQQACBhAUIWAmDUh0CCCCAAAIIIEDAYgwggAACCCCAAAIJCxCwEgalOgQQQAABBBBAgIDFGEAAAQQQQAABBBIWIGAlDEp1CCCAAAIIIIAAAYsxgAACCCCAAAIIJCxAwEoYlOoQQAABBBBAAAECFmMAAQQQQAB6F1A6AAAgAElEQVQBBBBIWICAlTAo1SGAAAIIIIAAAgQsxgACCCCAAAIIIJCwAAErYVCqQwABBBBAAAEECFiMAQQQQAABBBBAIGEBAlbCoFSHAAIIIIAAAggQsBgDCCCAAAIIIIBAwgIErIRBqQ4BBBBAAAEEECBgMQYQQAABBBBAAIGEBQhYCYNSHQIIIIAAAgggQMBiDCCAAAIIIIAAAgkLELASBqU6BBBAAAEEEECAgMUYQAABBBBAAAEEEhYgYCUMSnUIIIAAAggggAABizGAAAIIIIAAAggkLEDAShiU6hBAAAEEEEAAAQIWYwABBBBAAAEEEEhYgICVMCjVIYAAAggggAACBCzGAAIIIIAAAgggkLAAASthUKpDAAEEEEAAAQQIWIwBBBBAAAEEEEAgYQECVsKgVIcAAggggAACCBCwGAMIIIAAAggggEDCAgSshEGpDgEEEEAAAQQQIGAxBhBAAAEEEEAAgYQFCFgJg1IdAggggAACCCBAwGIMIIAAAggggAACCQsQsBIGpToEEEAAAQQQQICAxRhAAAEEEEAAAQQSFiBgJQxKdQgggAACCCCAAAGLMYAAAggggAACCCQsQMBKGJTqEEAAAQQQQAABAhZjAAEEEEAAAQQQSFiAgJUwKNUhgAACCCCAAAIELMYAAggggAACCCCQsAABK2FQqkMAAQQQQAABBAhYjAEEEEAAAQQQQCBhAQJWwqBUhwACCCCAAAIIELAYAwgggAACCCCAQMICBKyEQakOAQQQQAABBBAgYDEGEEAAAQQQQACBhAUIWAmDUh0CCCCAAAIIIEDAYgwggAACCCCAAAIJCxCwEgalOgQQQAABBBBAgIDFGEAAAQQQQAABBBIWIGAlDEp1CCCAAAIIIIAAAYsxgAACCCCAAAIIJCxAwEoYlOoQQAABBBBAAAECFmMAAQQQQAABBBBIWKBpA1Z/f3/queeeW2+tfbuIVETEeZ73fwYGBgbUIJ/PH22tvco5d4T+tzHmojAMB7XcbEbZbPZha+2pQ0ND2xO2pDoEEEAAAQQQQGBSoJkDVmZkZGRVV1fXlk2bNlWCIPhNY8wnS6XSm51zv8pkMlcbY24tFAq3BUHQKyJXVCqV9Vu2bHmcgMXoRgABBBBAAIH5FGjagDUVJZ/PH+ac+0YURecZYw4wxlxvrV03ODj49KpVq9oymczNInJjGIY/IGDN55DitRFAAAEEEECglQLWqiiKPpdKpc6KomitMeYs59y6MAx3aTfmcrnPOufuD8PwBgIWAxsBBBBAAAEE5lOgFQKW6e7uPsbzvM8bY34YhuFnstnsO40xeRG5IAzDchywdD3WE2EYXkfAms8hxWsjgAACCCCAQNMHrGw2+ypjjM5K/UOpVPrktm3bdmrA8jzvjHQ6vX7z5s1j2o35fP4y59x9hULhJgIWAxsBBBBAAAEE5lOgmQOWHwTB63VdlXPugmKx+HdVqHw+/2pr7cWlUuksDVwi4uVyuSuttXcUi8VbtFx3d/dK3/c3OucOqwVevnz5URs2bHhyxYoVemUiDwQQQAABBBDYDwK5XO7Y/fAyTfMSTRuw1qxZc1SlUvmGtfbjg4ODt4tIVFVbs2bNoZVKZaPneecNDAw8GgTB4SLyVWvt+YODg49ouf7+/szw8PAe4Ur/va2t7Y7TTz/93LVr1z7WNL1AQxBAAAEEEFjgAn19fYtqe6SmDVj5fD5vrb3MGPMZEZlcZ6UP59zPwjD8eT6fP8dae5pzbqMx5gwRuTcMQz09aGcbo+yDtcDfwRweAggggAACTSDQtAGru7v7QN/3X2qMSdU6VQOWbkS6Y8eObt/3O6y1TxWLxXvr8SRg1aNEGQQQQAABBBCYi0DTBqy5HBQzWPtKj3oRQAABBBBAoB4BAlY9SpRBAAEEEEAAAQQaECBgNYBFUQQQQAABBBBAoB4BAlY9SpRBAAEEEEAAAQQaECBgNYBFUQQQQAABBBBAoB4BAlY9SpRBAAEEEEAAAQQaECBgNYBFUQQQQAABBBBAoB4BAlY9SpRBAAEEEEAAAQQaECBgNYBFUQQQQAABBBBAoB4BAlY9SpRBAAEEEEAAAQQaECBgNYBFUQQQQAABBBBAoB4BAlY9SpRBAAEEEEAAAQQaECBgNYBFUQQQQAABBBBAoB4BAlY9SpRBAAEEEEAAAQQaECBgNYBFUQQQQAABBBBAoB4BAlY9SpRBAAEEEEAAAQQaECBgNYBFUQQQQAABBBBAoB4BAlY9SpRBAAEEEEAAAQQaECBgNYBFUQQQQAABBBBAoB4BAlY9SpRBAAEEEEAAAQQaECBgNYBFUQQQQAABBBBAoB4BAlY9SpRBAAEEEEAAAQQaECBgNYBFUQQQQAABBBBAoB4BAlY9SpRBAAEEEEAAAQQaECBgNYBFUQQQQAABBBBAoB4BAlY9SpRBAAEEEEAAAQQaECBgNYBFUQQQQAABBBBAoB4BAlY9SpRBAAEEEEAAAQQaECBgNYBFUQQQQAABBBBAoB4BAlY9SpRBAAEEEEAAAQQaECBgNYBFUQQQQAABBBBAoB4BAlY9SpRBAAEEEEAAAQQaECBgNYBFUQQQQAABBBBAoB4BAlY9SpRBAAEEEEAAAQQaECBgNYBFUQQQQAABBBBAoB4BAlY9SpRBAAEEEEAAAQQaECBgNYBFUQQQQAABBBBAoB4BAlY9SpRBAAEEEEAAAQQaECBgNYBFUQQQQAABBBBAoB4BAlY9SpRBAAEEEEAAAQQaECBgNYBFUQQQQAABBBBAoB4BAlY9SpRBAAEEEEAAAQQaECBgNYBFUQQQQAABBBBAoB4BAlY9SpRBAAEEEEAAAQQaECBgNYBFUQQQQAABBBBAoB4BAlY9SpRBAAEEEEAAAQQaECBgNYBFUQQQQAABBBBAoB4BAlY9SpRBAAEEEEAAAQQaECBgNYBFUQQQQAABBBBAoB4BAlY9SpRBAAEEEEAAAQQaECBgNYBFUQQQQAABBBBAoB4BAlY9SpRBAAEEEEAAAQQaECBgNYBFUQQQQAABBBBAoB4BAlY9SpRBAAEEEEAAAQQaECBgNYBFUQQQQAABBBBAoB4BAlY9SpRBAAEEEEAAAQQaECBgNYBFUQQQQAABBBBAoB4BAlY9SpRBAAEEEEAAAQQaECBgNYBFUQQQQAABBBBAoB4BAlY9SpRBAAEEEEAAAQQaEGj6gJXNZl9ijHmHiIyEYXi5iFg9vnw+f7S19irn3BH638aYi8IwHBQRN9vxZ7PZh621pw4NDW1vwImiCCCAAAIIIIBA3QJNG7BWrlyZOfjggz/mnBuIA9bd1YC1atWqtkwmc7Ux5tZCoXBbEAS9InJFpVJZv2XLlscJWHX3PwURQAABBBBAYB8ING3Aqh5rEARpEfm8iDxaDVjxrNb11tp1g4ODT8eB62YRuTEMwx8QsPbBSKFKBBBAAAEEEKhboCUDVhAE5xljznLOrQvDcJcebS6X+6xz7v4wDG8gYNXd/xREAAEEEEAAgX0g0JIBK5vNvtMYkxeRC8IwLMcBS9djPRGG4XUErH0wUqgSAQQQQAABBOoWaNmA5XneGel0ev3mzZvH9Gjz+fxlzrn7CoXCTQSsuvufgggggAACCCCwDwRaMmDl8/lXW2svLpVKZ23btm2niHi5XO5Ka+0dxWLxFnXq7u5e6fv+RufcYbVuy5cvP2rDhg1PrlixorIPPKkSAQQQQAABBKYRyOVyxy4mmJYMWGvWrDm0Uqls9DzvvIGBgUeDIDhcRL5qrT1/cHDwEe3A/v7+zPDw8B7hSv+9ra3tjtNPP/3ctWvXPraYOppjRQABBBBAYD4F+vr6FtX2SC0ZsHSA5PP5c6y1pznnNhpjzhCRe8Mw1NODk/tkzfRgH6z5fHvx2ggggAACCCwOgaYPWLqHaC6X+1+VSmV8aGhIZ6cmNxLt7+9P7dixo9v3/Q5r7VPFYvHeerqMgFWPEmUQQAABBBBAYC4CrRCw5nJ8v/ZcAlainFSGAAIIIIAAAtMIELAYFggggAACCCCAQMICBKyEQakOAQQQQAABBBAgYDEGEEAAAQQQQACBhAUIWAmDUh0CCCCAAAIIIEDAYgwggAACCCCAAAIJCxCwEgalOgQQQAABBBBAgIDFGEAAAQQQQAABBBIWIGAlDEp1CCCAAAIIIIAAAYsxgAACCCCAAAIIJCxAwEoYlOoQQAABBBBAAAECFmMAAQQQQAABBBBIWICAlTAo1SGAAAIIIIAAAgQsxgACCCCAAAIIIJCwAAErYVCqQwABBBBAAAEECFiMAQQQQAABBBBAIGEBAlbCoFSHAAIIIIAAAggQsBgDCCCAAAIIIIBAwgIErIRBqQ4BBBBAAAEEECBgMQYQQAABBBBAAIGEBQhYCYNSHQIIIIAAAgggQMBiDCCAAAIIIIAAAgkLELASBqU6BBBAAAEEEECAgMUYQAABBBBAAAEEEhYgYCUMSnUIIIAAAggggAABizGAAAIIIIAAAggkLEDAShiU6hBAAAEEEEAAAQIWYwABBBBAAAEEEEhYgICVMCjVIYAAAggggAACBCzGAAIIIIAAAgggkLAAASthUKpDAAEEEEAAAQQIWIwBBBBAAAEEEEAgYQECVsKgVIcAAggggAACCBCwGAMIIIAAAggggEDCAgSshEGpDgEEEEAAAQQQIGAxBhBAAAEEEEAAgYQFCFgJg1IdAggggAACCCBAwGIMIIAAAggggAACCQsQsBIGpToEEEAAAQQQQICAxRhAAAEEEEAAAQQSFiBgJQxKdQgggAACCCCAAAGLMYAAAggggAACCCQsQMBKGJTqEEAAAQQQQAABAhZjAAEEEEAAAQQQSFiAgJUwKNUhgAACCCCAAAIELMYAAggggAACCCCQsAABK2FQqkMAAQQQQAABBAhYjAEEEEAAAQQQQCBhAQJWwqBUhwACCCCAAAIIELAYAwgggAACCCCAQMICBKyEQakOAQQQQAABBBAgYDEGEEAAAQQQQACBhAUIWAmDUh0CCCCAAAIIIEDAYgwggAACCCCAAAIJCxCwEgalOgQQQAABBBBAgIDFGEAAAQQQQAABBBIWIGAlDEp1CCCAAAIIIIAAAYsxgAACCCCAAAIIJCxAwEoYlOoQQAABBBBAAAECFmMAAQQQQAABBBBIWKBlA1Y+nz/aWnuVc+4INTHGXBSG4aCIuNmMstnsw9baU4eGhrYnbEl1CCCAAAIIIIDApEBLBqxVq1a1ZTKZq40xtxYKhduCIOgVkSsqlcr6LVu2PE7AYnQjgAACCCCAwHwKtGTAymazLzHGXG+tXTc4OPh0HLhuFpEbwzD8AQFrPocUr40AAggggAACLRmwgiA4zxhzlnNuXRiGu7Qbc7ncZ51z94dheAMBi4GNAAIIIIAAAvMp0JIBK5vNvtMYkxeRC8IwLMcBS9djPRGG4XUErPkcUrw2AggggAACCLRswPI874x0Or1+8+bNY9qN+Xz+MufcfYVC4SYCFgMbAQQQQAABBOZToCUDVj6ff7W19uJSqXTWtm3bdoqIl8vlrrTW3lEsFm9R0O7u7pW+7290zh1WBTbGZIwxh7S3t+/0PM/OJ3yrvvbY2FgXfnvfe/jtvZ0+Ez/85iYwt2cz/ubm99xzzw0vpqv4WzJgrVmz5tBKpbLR87zzBgYGHg2C4HAR+aq19vzBwcFHdAj09/dnhoeHd4cr/Tff9zVg/fDII488/5BDDnlibkNlcT57cHDwe/jtfd/jt/d2+kz88JubwNyezfibm18Yht8hYM3NcL88O5/Pn2OtPc05t9EYc4aI3BuGoZ4enHVmin2w5tY9+OE3N4G5PZvxh9/cBOb2bMYffo0ItOQMVjxDldqxY0e37/sd1tqnisXivfUcOG+QepRmLoMffnMTmNuzGX/4zU1gbs9m/OHXiEDLBqxGDrK2bBAEm6MoOped3PdOEL+9c6s+Cz/85iYwt2cz/vCbm8Dcnr3Yxt+iC1i6+P3AAw98ctOmTaW5DZXF+Wz85tbv+OE3N4G5PZvxh9/cBOb27MU2/hZdwJrb8ODZCCCAAAIIIIDA8wsQsJ7faM4lgiBYIyKv6OzsvHbTpk2V2gr7+/tTo6Oj7xWR74Rh+KD+LQiC40XkzOnK69/11kAHHHDAoXoF5Zwb12QV5PP546IoOqhYLIa1Tevp6enzPG9nGIb3zNbk7u7uF/m+f5WIHBSX+0r14ofF7DqTWS6XWy8i/1UoFPRG6dLX17e8XC6vKRQK35/6nMXop+/PkZGR9ZVK5e+2bt36XI2JFwTBeufcM8Vi8dYmexvNe3NWrlyZOfjggz8mIl+qfq7NpVFxfeeXy+Uvp9NpvTr8N6vv6/hWae8olUo3xdv2zOWlmu25k+NMRH4ahuFdtY3LZrNr9b8Zf83WZf+/PQSs/dQ38e7zt4Rh+PPalwyCIC0in/d9//q77757i/5t9erVS9va2nRn+k+FYfg/1fLxh8wpzrk/M8b86Jlnnrl0+/btC+pU5+rVqw9Jp9OfM8bcEm8a6/X09Jzqed57jTEbCoXCz+KQ2ZHJZK4RkRNiH19EXiQiX3/mmWc+Mp3LAnetfhC/rWZ8HRH/791bkjjnPlP9QI63O/nL+I4Iv9Syvb29B0dR9CW9eXoYhneLiKvWt8D9ZvwkyOVyb7LWHlUsFq9bs2bNkVEUTY45a+2hIrJBRC7V8B9fbPOz+Auxth9q6z5QRF5mjLm8o6Pj8qk/uPbTx1HiL6P3h/U8Tz12P5xzGgBebK29xvf9qPoHdfJ9/1fW2u8YYyZE5ABr7VZjjI7T3xWRZ+KyGRH5eRRFb0+lUn9mrT3bGPOw7mfonHuBiFzred6Ac26piLzDWnuz7/vP7tq1a+tCClpr1qx5UaVSubxUKr2j9rj0OyUOWH89NfiLyKIaf4kP6IQqJGAlBDlTNblc7l16z8T4778yxuiO8x8UkUP035xzxhjzv4wxjzvnvmuMeTouf4CI6G2ANugvl7gefdPc7py7qd6rJvfx4SVWfe3MkzGmwzl3pO7Mb4zxROQ34g9d/QDeZYy5pDrjUm1AEATqdYO19mPVvdBqG1fTDwvSNZfL9TjnLtcvq9kCVo3fliAI/sgYs1ODbC6Xe6eOu3g8HhOPzUeMMRqwiiKis6tnx/UvmnGpDvEPmyPDMHwom83+oYgs9TxvaOrgf76rmXUGMN5W5pZSqXTNQgoB0wWsmT4cqgHLOXfJ8PDwhuXLl7+4Uqm8RwOWMeYn1dnTnp6eYzzPu1RE/jiu60oR+ajv+yujKNIg9mnP87oXcsAKguASY8zpzrljReQ/nHO3GWPOiz32+AFljLm+UCj8/UzuC3n8JfZFlHBFBKyEQWeqrqen5yTP8/6gVCpdvG3bNv3VNvmYbgZL/33NmjVHRVH0NWPMBdba3xcRPW343uoMmM70bN269enaGYb9dCj77WVyudxrnHP5MAw1OOyxv5meuqlu06ENsta2i8iHjDH6/2tn9R4olUrvq36ZLVTXIAh0lk+/eO7UmYQoivRuBb2xzd26nUkURb/yfT/nnHvI87x7nXOfGBsb25BOp19QLpd/mclkdBbwhiiKLhgaGhqerqMXql8dP5AON8ZcbYyx1trtYRhuCoLgIv1hVCgUvvE8bwqdXXylzrgYY77W0dHx2YUyczX1uLPZ7JeNMfqDaPIWZtWHc67N87xnhoeHz37ggQfG8/n8YdbazxhjviIiL7TWnjzTDJaIvCWuR8u+VERSInJz9XPhhBNOaF+2bNnlURR9cqZxu98+tPbRC033/THDDNZ0LVg0428f8e91tQSsvaar/4nxGoE/11+vurYoXssyuYYgCAL9UtvjFGEcvC51zm0rFovfrH2l6potY8yrnXPrwzCcPLWzEB+NBixjzIXW2gunm8Gq+gRBsCBdu7u7D0yn0xldvzZbwBIRnSHd5fv+uZ7nPaYzBtbaSzKZzKVjY2MaYmcNWAvVb7b3T/z+/YSI3Oh53ilRFOmdI86omXnW23WJMeYbhULhC1Pr6u3t7Yui6G+cc+8tFos/eL7NkFv5vdxowBKRh0Rk3DmnMy/neJ5313QzWGEYjmez2WONMS91zpWstT8dGhrSu3a4hR6wpn5/VMdHvQFrMY2/ZnvvELD2cY9oINq5c6eeJvxDz/POsta+IZVKfS2KokuNMbquQNcb7A5YeoufkZGRjxpjzvI8b10URe+OouhjBx100FM6Y+N53rtEZEm5XH7XlEW3+/hI9n31umhT11nVvNLBItLpnKueqtI/7V60Xtui+BThF51z/+R53lO1f/N9/4ElS5b8cjG46ikFEXm1iDygt4VSB+ec/reuGyqWSqUP6QxqfMpUZwaWi4gG9WIQBMucc/9sjNH1Mvp/k2tgdAahs7PTLga/aUa5HwTBHzjncsYY3cz4YGvtj3zfX2GtHfd9/8B4Rut2fe4Ma5EmL3KZuhZJZxQHBwf1oo2Wvy9q/Lmln086ZmZ86JorXSOlBXzfPyCVSv1v/d/FYvG78dgdN8ZMLubWNW7GmN8RkfM9z8tba3Ume5mI6IVCu+LTZTozuMfj+U6V7ftPsuReoeb7Q4/zQ1EURalUSpeXHBCvcdNgf6u1ttTV1TU0MjJy7DRr4Rb8+EtOPNmaCFjJev5abXpLnyiKftMYc6ox5lFdazA0NHR/Pp9/vbVWP4z+sTZgZbPZT+rCUGPMS4wxw1EU6XqtAz3P+4BeSWKt/cKyZcuGFuophlrA2Waw9JSYiKhNW/wcnQk8zDn30ekCVrlc1nUcC9a15qqtvucZ0tWAqmHgDb7v/2xgYOC/NYeddNJJR/q+r8H/3WEY7qpdA+Oc+8hC9pvJrKen5zTP8/42PuV1ted545VK5RnP864QkVF9b8Z/+4WIXOmce3IxfsHFV/9eElvNOASdc28wxnw1LnCic06DvJ7a1zVtv3TOacDqc85d45zrqAYs59zq+Dkv0M9FY8xRIvIzXYu5kK8i7O3tPTOKoteJyLkisjGKoss1YFlrDzHG6EU+7TozKiJPELD28Zf5XlRPwNoLtEaeksvl1pXL5TvS6fRnROROEXmJc+59bW1tmYmJidfrVW+1Aau3t/ek8fHxX6ZSKb2SS0//Vcrl8ifa29srNdsyePl8/hXOuQOmu5y+kfY1S1n9gHbOvbC2Pc65NcaYE/XqIM/zdv/Kn24x8UyL3PXDN51OH9HW1rZsMbrOFFjz+fzLrbW6dkhPszw9Pj7+x5lMRhe3v7Wjo+O9GuDjU9m6yPh83/dftBj9NOQbYw7WL3hr7XPOuXbP8zZWtwvJ5/N/UDuDNd37Kf6h8Mb4ak29QGDBPfT9a619ZxiGH45not5UvRowvmhFA9QFIqKL2f+9GrB0FlD/d3UGy/O8Qedc4Jx7TETu8TxPA8btvu/racGpM1gf8jxPf1jpldgL8irCeFZfT+triNKxc0VXV9f9O3bseJPO6umMnnNuU7FY1O+RaWdCF8P4a9Y3FAFrP/SMnnrRtS1tbW0Xjo2NHVwulx+pLnSfbpF7XP5vUqnUe6IoOnBsbOy+avlVq1Z1tLe3X2eM0UWiHxgcHNTZh5Z/7KuApTsH+75f/eDXfliwrtOcYp06LvSU67d1cfDq1atfkEqlju7q6toSz4Z6uVzuT3Wh8cDAwN/pjJaG/SiKLiqVSufr+FuM41IBqzOpnZ2dnxodHb2qUql8asuWLY/r3whY/2+ITQ1YxpiB6o+/eBxdWE/A0ueNjY3dkclkdPuQu4wxt4+NjT3c0dExeeqxXC6fojNY5XL5vvb2ds859+KFHLD0mKt+qVTqkrGxMZdOp9+uV7Faa/XKQv0OTzvnRorFos4M/lrIImDN39cjAWs/2FcD1nRXZ80WsDzPu2BgYOBJbaJeNdjW1qa/7HTzvu+HYagzCwv6MdspwqkH3tfXt2RiYuLzInJ57caG+Xz+ZOdcb6FQuLYaEBara61nPp9faa3VdVk6q2A9z7suiqK36inseG2fyefzr3LOnVkzozUZUBebX9XNWquL3HWNm64hOiceg7rgXa+Y06sud69xqx2f2Wz2TGPMaxfrDFZs8T3dOHl0dPT9IvI9Y8yxuq7NOaf7Wp1rjNEZKz1F+IxzTrcG2Swia51z/+h5nu4PeJkucdM1cPEarB3ViwoW+iL3asDauXPnRR0dHe/3PO+/BwYGvlld5D4+Pv4VvUgl3uJCN73dI2QthvHXrF+EBKz90DOzBazpgkFtECiXy526M7lz7mhjzM3GmH8pFAr3LeTtGapd0kjA0l9y8a7k73bOTV7VpQ9jjG7Z8IFCofBfC9lVZzanbLw63cjePYOlAatSqXTqIuuXvvSlK9rb268xxuiVrnrRxbXOOV1g3BmHgskNRxey32wfAzoOdecUtTHG7Ig3wJ3cgHWmGawpa+KOMMZ8svZ5++FjZ7++RM0M1oe6u7uPWbJkycjmzZufjX8cLtXNg0XkGGPMU5VK5Y88zztc16pVKpXtejVgf39/++jo6JeMMStF5EJdW6V3FRgfH3+HztAUi8U/17riWdrhMAz/s3qAiylgLV269Niurq7/1lnn2qsI4zMbRxeLRd2I2S628bdfB3sDL0bAagBrb4vqDtjpdPp9pVLp2up+TEEQ6C/fa3XD0amXd8flP9jW1nZNuVw+2zm3It7zZW+b0JLPi28x9OLqLTHmehCL3XU6z5pbNd0x9VYcU70Xq5+6Oee69erdSqXyxdqrd+Pw9eTUjW/nOlYX2/PjhepvKpfL353t6ujqLbNKpdLDs/yg+OFC+ryc6RZV3Cqn+d8lBKzm7yNaiAACCCCAAAItJkDAarEOo7kIIIAAAggg0PwCBKzm7yNaiAACCCCAAAItJkDAarEOo7kIIIAAAggg0PwCBKzm7yNaiAACCCCAAAItJkDAarEOo7kIIIAAAggg0O9AHTAAAAJKSURBVPwCBKzm7yNaiAACCCCAAAItJkDAarEOo7kIIIAAAggg0PwCBKzm7yNaiAACCCCAAAItJkDAarEOo7kIIIAAAggg0PwCBKzm7yNaiAACCCCAAAItJkDAarEOo7kIIIAAAggg0PwCBKzm7yNaiAACCCCAAAItJkDAarEOo7kIIIAAAggg0PwCBKzm7yNaiAACCCCAAAItJkDAarEOo7kIIIAAAggg0PwCBKzm7yNaiAACCCCAAAItJkDAarEOo7kIIIAAAggg0PwCBKzm7yNaiAACCCCAAAItJkDAarEOo7kIIIAAAggg0PwCBKzm7yNaiAACCCCAAAItJkDAarEOo7kIIIAAAggg0PwCBKzm7yNaiAACCCCAAAItJkDAarEOo7kIIIAAAggg0PwCBKzm7yNaiAACCCCAAAItJkDAarEOo7kIIIAAAggg0PwCBKzm7yNaiAACCCCAAAItJkDAarEOo7kIIIAAAggg0PwCBKzm7yNaiAACCCCAAAItJkDAarEOo7kIIIAAAggg0PwCBKzm7yNaiAACCCCAAAItJkDAarEOo7kIIIAAAggg0PwCBKzm7yNaiAACCCCAAAItJkDAarEOo7kIIIAAAggg0PwCBKzm7yNaiAACCCCAAAItJkDAarEOo7kIIIAAAggg0PwCBKzm7yNaiAACCCCAAAItJkDAarEOo7kIIIAAAggg0PwCBKzm7yNaiAACCCCAAAItJkDAarEOo7kIIIAAAggg0PwCBKzm7yNaiAACCCCAAAItJvB/ASEfTY+86bepAAAAAElFTkSuQmCC" alt="bb"></p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAlgAAAGQCAYAAAByNR6YAAAAAXNSR0IArs4c6QAAIABJREFUeF7t3QmYXFWZ//H33FvV3Vm6Q4gRHTeEuECg7e5blTbg0owLiqJs6QTcUBhRcF+Ycdzi6CjqiAuofxQFdRRIADdGxWXs8T9jJum61U0gOGpAcMFBDCHd0FvVPef/vP2/xdN00lmgG85JvvU884yhq2699Xmru351zrnnGuGGAAIIIIAAAgggMKsCZlaPxsEQQAABBBBAAAEEhIDFmwABBBBAAAEEEJhlAQLWLINyOAQQQAABBBBAYMaA5UTMhpUrF4+PjrbNBlOTMc60TAwfs2HL3bNxPI6BgCcC5thjj104NDRUmF7PkiVLRvv6+sZFxD2EWk1HR8eToig60xjTKyKPE5EPp2n6Lw/hmF4/tLu7u61Wq50YRdHrnXPtIrJpbGzs1C1bttw7i4U/oG+jo6MjW7du1V7df0uSZP7ExESz/oempqbxNE1Hpvz4AY9fsmTJcF9fX31v6uvs7CxFUfQmva9z7opqtXr93jxud/cpl8tPcM6dYIyZGBkZ+e6WLfydfaimPB6BhyowY8D6j1LXeSLuHGOk9aE+Sf54J06GJZIvZvMXXXrcXv4xmqXn5jAIzInAypUr542Pj3/CGPPsXTzBmIj8SkQ+kqbpLQ+mgCRJnuicu9oYU2483hjziUql8vcP5ni+P0Y9a7XaZ5xzrxWRYl6vGq5M03THbNWfJEnRGPNe59xJ+TE/kabpFY0wvHz58qZ58+Z92Dl3fP7zq1tbWy9ohKjly5cvbGlpuURElovIn+I4fvWmTZu27U19pVLpxc65H+QB65xqtfqlvXnc7u6TJMmnRORtImKNMW+oVCpfeajH5PEIIPDQBHYKWDpy9YtS17nGuIsf2qF3/WgjMuKcO+M5lcHv7uoenZ2dR0ZRpB8eT8x//oXW1tZv7+23wwdbc7lcPizLsiudc6sGBgZu391xVqxY8Ywsy37pnBvUb4z5fS9P0/Qb+gfuwdSgf/BF5Asi8oc0TT/yYI/zYJ6bxzx4AR3lMMbo++bE/MP5PhGJRGT+lKP+3hhzUqVSGdjXZ+rq6nq9Mabxu3i5tfYyERkZGBi4YV+PFcL9S6XSUc65H4vIY0Wk6px7bxRFY0uXLt3wwx/+8AEjTA/x9ZhSqfQ659yl+XH+j4i8JU3Tmv77qKOOOqS5ufnnInJE/vP/KyInNkKeBl8R+XcROVxE1h122GFnrF+/PtubmuYiYJVKpXOcc58UkXuNMWdVKpUfai2dnZ1LNfwbY15sjLm8Uqn8197UyH0QQOChC+wUsH65cuXBtdpYnzFy9EM//ExHMDc+p7+qQ/8PuOV/1C7VP6rVanWz/lCHvhcsWPBnDwPWVVEU9fT39//vLDnpH/yn1uv18cHBQQ14D2VaaZZK4jB7EpgWsHT6+9XGmLustY8WkfcYY47Jj3Hpjh073jR9GmpPxy+XyxdYa/ULx59E5Plpmv7Pnh4T8s9LpVKPc06/fLU453R05/K5ej3lcnm5tfa/RWShTkNmWXb84ODgPXkw0Wk8HWVamj+//k4+rzESWS6Xj8my7DpjjI7wvzVNU/1ytFe3uQhYPT09LcPDw0fqFz7n3K8bQbGrq6vXGPM1EdEvgielaaqhkRsCCDwMAjsFrJ93dBwaF43+Eh46l8//nP6BnZ47Hxn6poj0pGn61109f1dX1xFRFB1irR1ra2sb7Ovr02kY6e7ufnyWZcv0f8dxvHXjxo1/zAPaYdbaurV2sf57YGDgRh0dahxHRwNGR0cH58+fr4+/Msuy1zY1NS1yzjVNPc7UWvI6dxmwdCQsiqKJWq3WqnVmWXbvokWLtM7J9Rk6tTB//vx2PX69Xv9TsVhsqtVqfxocHNwxNWB1dHQsKhaLut5mW71ef2qhUKiPjIxsnrIOJU6SRP+gLtE/qnfddVf1tttum7Tg9vAJTAtYd1pruxsjoCtWrHh2lmW/yKtJ8w/oxjRX1NnZ+ZhCofA4fS8457a1trbe1ng/61TZ2NjYo+M4fo8GDRG5w1p7uojc3tLS8pcNGzaM6nFXrVoV33bbbX9jrdX/i5xzf63Vardv2bKlMbJq2tvbl0ZRpCNtLoqiO+I41jVOj29pafnDhg0bJtdEztZxZpLX1zMxMfGkLMsOzn9H725qarq98Tp6enoKo6Ojj8my7NnOOZ0y0ym8d9Xr9euampqGdzf9ptN5TU1Nj42iaIlzbkEcx8OFQuH3GzZs2L67Lyr5dOSPnHPPUdcoiv62v7//Vq0vSZJzReSzIqIjkvOdczp6dlpjvVRXV9drjTGXGGOGReRlU0aGzMqVKxfX6/UnZlnWaoy5p1Ao3L5x48ahhs30gNXW1vbVoaGhQ40xjzHG3BfH8S1T758/brKPxWLx8dZaDYS6HuyuZcuW/VFHzpIkWZRl2WLtsb4/JiYm6lEUPcY593LnnK7XqxljXl+v1zfEcbx9ynTrHut9+H6beCYE9i8BrwLWs571rMUjIyP6rXBwbGzs7VM+JFQ9SpLkVc655zrnvhlF0Qr9YKpWqx9KkkSH6V9gjNFv94/VKcjx8fGzb7rppjtLpdLHnXOnRVH07nq9fsvExMSvWlpa3uKcOzI/Tiwif46i6D5rrS42vUlEvphPUa4aHx9/tR5nbwNW/nynOOc+GkXR75xzb4ui6Ir+/v6r2tvbFxQKBT32Rl2bY4w5TkReJSK63uQ/p04RJknyXBHR6aCrdb1GFEUrrbWPGR8ff6e66DfTKIp03c81zrkXikjztm3b3kvIenh/QXcXsEqlkr5HtddijPnRxMTEaZs3b75v7dq10fe///036JSUiDxe11BrkBaR/7bWnjcwMHCHjpBYazVoPEFE9EQTDej6PrxHF3/39/f/Mp9W/gcReY2I/E0+NflXnWKz1r5DR2PytUb/rFPfInK3c+7dIvIBY8wRxphzK5XKNbN1nBnkTZIkK3RhvsjkqPhkwNJaROTGer3+9htuuGFLe3v7o4vF4pUicmQ+aqR/m/RL1n3GmC9XKpWP7ur4+oXGWqtBSNdCacBamIceXbf17jRN9fdqxluSJFrX+9TVWvvygYGBX2jYvPXWW78lInpSgY6g6e+ifuH8QD59rwHscyLyZhH5tbX2b7VneTDT30U95tPykTEN1Fvz6cfJ98LUgCUi73LOabjStWCPyQOd/g16Y5qm+mVw8u3T1dWlJzm8XUSelB9XA9ZvrLUn6nOXSqWznHP6Ou7T94d+eYvj+ArnnH7pfFQeNO8SkVFjzEcaa7SSJNljvQ/vbxTPhsD+I+BVwMr/+HSKiC5yfbJz7ty77777pxoaNEQZYy4aGxt7rQaeY4455tHj4+N9xpgzK5XKpkZLdErRWvst59yF1Wr12xp4rLWLqtWqfqDpmgRd43XR+Pj4GVODU/6H+voois7u7+//Dz2TqV6v/9g593E9zi4C1vQ1WGfr9MH05+vq6jpZRE4+/PDDX3vrrbfqItSu1tbWs3Sk4thjj20dHx+/zjm3doaAdaGInJCm6Z87dGQxjq/J/+jXnHOXFIvFv9OROj3O6OjotXEc/2N/f3///vP29P+VTA9YInKsiPy+VqsdUiwWta9n6fSMtfbcgYGBryZJomcbvlMXvjvnNDTdGEWRrks8TMOWc+6H1tozisXikbsLWAsWLKgODQ19zBij7ykdZdEPY10/pB/sj3bOfUMXO+f/TaevztZQY4wZyEdshp1zb2xra/vebBynWq2u21W3urq6nmmM0d8fDQ86ivN7DQwi8uR8nZqOGL2kVqvd/WACVqlU6nTOXSUi+np0/ZGuf3uKiBwiIrrMQKf1djkarvWWy+UXWWvX6ciXBpg0TT/3jGc843GFQuG/nXN/E0XRaufc34nIC51zPxofH395W1tbPD4+/kNjzHN1/d3ChQtfq2eL5sFJF8rrtOHNOpqoo1LOuacYY7bGcfyiTZs2/W5awNIvhQtEREfbdJRdA7Xe/jOO45N05K5UKr3AWvt9Y4ye0fhb59wdxhj9YqjvpdVpmv4+SZK36t/N3Pgka+2tewhYX93bev3/LaRCBPwU8C5gKZNOozU3N79Qz5YyxmwYHR19Y3Nzs45QaeC4LafUPy4deur6xMTEL4rF4ufzb3e69uXp+uGhZ+fkI0p3pGmq33L126N+0zsyTVP9kLv/Nn2Re+OD01p73fSzfHY3RTj9+ZIk0VGqN2dZ9rpCoXCptbavWq1qrW7ZsmXNixYt0j/IF80QsN68Y8eO03XdTrlcfow+No7j1VmWdYiInjV0s4hk+qHinNNvtq9ljcXD+4s2LWDpNMwN1toJY4yOGmho0v58qlgsfkSnwzo6Op4Sx7FOS+mIyGfr9fr7N2/ePJokyYtF5F+1+izLTp43b97G3U0RWmuPrNfr/5Z/KH9gx44dn+ns7Kzfeuutr8xHQof0Az3LMn2PNAKWruv7lXPuH5xzf25qavqDhrrZOM7GjRsfMMqrryN/f+uolI7O6OjZuYVC4ae1Wi2K4/hlzrlP5+Hi4tbW1nc+mClCXcQdRdETCoWCLgsY7unpiYeGhlYbY9TSGWNeWqlUJs/YmyEALjPG/CwfsdYTVV6XJMnLReRanTYUEV1Dd6aI6Aja5BSwc87EcayjUfq3RhfGX6zTguPj4xqC9P4/KRQKr9q4ceNfkiQ5SkSu0+01dDS7Wq1ePC1g6Sj3a5qbm7dYa5fUarUvGGOeryNq+j446KCD/vPee+/9pD5WF7Dn6/A2rVq1Krr11lsfvWPHjrv178P0gKV/T3Y3RdjU1KQhca/qfXh/o3g2BPYfAS8DVoO3u7v7KfV6Xf8InG6t1Q+kk6vVqv6xu/9MPV27MTw8/DEReVE+5TI51eac699VwEqS5I3GmKdUKpV3BB6wzpiDvYH2n3f2w/RKpgWs6c+63Tn3hsMPP/yaxhlmSZKcISJfFZFx/dDUQKYP0tESY8yXnHOHGGPOS9NUz2rTLwQ6xX2+jvxEUXTclDVC+gVBzxrbZox5o3Nucu1QPlqiAX6eiLxCRDSENQKWTlW+plKp6NmukydRJEkyK8fZFXc+da8jqro26PvOuTWNvaRWrlx58MTEhJ4tmOjoW5Zlz8mnNPULyXd02tQ5d2a1WtXRqd3etAcakPTEgnxNok5J6tSpeux2G4Qpo8i6DutGa+3zoih6fz79N3l24O23364L2vWMQf1S91JjTME5pzWO6dR9f3//YFdXV2KM0TP3dApU/x5NjnrreqkoitR/uXPusmq1+rppa7DWvuxlL/vw2rVrJ/+mlctlHTG73DnXbIx5S6VS+UKSJPq3Snutt+ustZ9pamq6SQPclD4+YASr8UWrq6tLw6ZOcz5gkfu+1Lsnf36OAAK7FvA6YOkfv7GxsW/V6/V3RlFUiKJI953p1SmzxsuZMtKkf7y+nT/m35xz/7qrgKVrW5xz72+sh2kcZ65HsJqaml4xMTGhC2fvnyJMkkRPRddv1/oHdFdrsHY5glWv1yeiKPq6MeaU/v5+HYXg9ggJTAtY23UqMIqihboGzxizVIN+lmWvvOGGG36TB6a1zrkP5h+Muo5m8tR+51xkjNGgoFNcb5sy4jpTwNLtBXT6UT+Y9TiNLx2NLSL0bDJdt6MjMY2ApaMiKwYHB3875fdnVo6zK/5yufw8a+1P89f30cMPP/wDU4KmvlYNTy8VET0Ttzuf6tqngKUnqxhjdCTsGfnaLZ06u/+2p4Cl58SUSqX35z0Zt9YeH0WRjg7r8SbPDszDoJ6soCHpk8YYXfD+PufcL8fHx4/XE09KpZIuJtd1W/q69ASEye0e8ulQDbsazq5I0/SM3Z1FmI94a3jTdXeT74N8yvJqEXlmbqnPf4sG8hNPPPEiDWfTR7D2FLD2pd5H6FeLp0UgeAGvAlb+jfdkY0wllz3WOde6bds2XcsiS5YsWWuMeVyWZZfr2TLGmKfu2LHjsoMOOugVzjldS3FJFEVP1W+vzrl/3lXAOvTQQ1umHieKovsXuU/dB2svpgj1G7kuYG/sTP/nSqXym1KpdIGukWh8QDamCHWqr6Wl5aDm5uZLdU2KtfY2Y8wJembSbha57zJgbdq06YZSqaQf1I8zxuhZl/oBvWxsbOzKWd7tOvg3+Fy/gJkWuecjVfqFQM/4+npTU9MbdIqwVCrp5pa6z5l+AOsaIT0L7QE33fdKF5/ngWymgKUnS+gaK/2wHcw/1KceR0csLpgS3HUN1gPOctQ7J0kyK8eZIWCVrbU6lWZ0OrCtre38aRt1amjQjTz/YK19pi7WnhIw9jiClW9NoFs66ELt/zHG/NPExMR/R1H0qDiOJ9dl7kXA0nWZukeUnlyj4VRHn3SUvJhl2QmDg4M6AqcL9fWEAzVMjTH35ifbfLJareroojq+JA+MGqZ0XZWOLk2//UwXyU8LWG+oVqv6Ppm8lUqlE5xzup5Nz/p8c6VS0dFIWbFixRI9cUH/zuVrzHSdl04/v6pSqVyZJImeMHH/Gqw9Bax9qXeuf4c4PgL7q4BXAUuR9WyiOI6fHsdxlGXZ9sa2CnkD9NT2o+M41ikHvSTE5LYFOk1433336WLXBc65xr5UO3Skq7FtQmPbhunHaWzTsHTp0kj3kdm2bdvN+Zl4k9sg6JlMU0fM9PG6RmzevHmlaW+KyYBVLpefrNs0NJ6vo6PjIN1uob+/X89qso3Xp48tFAq/y7LsE3EcX9jf31/Z1TYNjcflO0t3jI6O3tx4zTt27OiI41g/wGV0dLRCuHr4f01nClhPe9rTWhcuXKi7aevZexp2dDTkS+Vy+TRrre5LpDtu63SdhowZb7uZInyrnshhjBkyxpxcqVT6dnWQKRvYzhSwZuU4u3ruzs5OXSSuAUvPlNzY1NR0QmNbiBUrVjw5yzId3TqssXhcz47dl4DV3d2t69B0+4uW3FfXMrquri6dxvv+3gas/AzGX+abhuq+WLpHn44MH9f43c+3ZdBpWx0t1OlV3afrFY0TYMrlckd+FrKuvftomqYfmGmLiGkB62JjzDt036r87FIdjdOzE4eNMadVKpWfTLXNT2jRxfVf16lXPdlFg5iI6Oj47gKWjpTqgnidMtapyL2u9+H/reIZEdg/BLzaaHT/IJ35VeRTDc35H+24s7PzOL0mWRzHZ+3tZTb2d6PQXt8etmnQXcl17Y5uVrlVR0SiKNKRV50W1jPd9IwwXSs0eeUA/eLgnDu8WCx+vbE/1EwBKz97Tj8sdVuS/iiKPmitnRw1yfdT0rPX9ENYb40pwp1GsGbrOLvqmwaG733vexfk2wtooPyytfZaHTW21p6jU9z63SCKotfpNiZ6jH0JWEmSPF1EdLRbz8L7jrVWv6zo9KyeDKOLy/dqBCuvU0fFdcuUyduUswMn95bLA8mP8rMT9T/9IY7j52/atGly6vfoo49e3NTUpKOOOsU5pJslO+d0NE2nbnXa8Kg4jtfnZwXef6kcPXvQGPMB59wWnSYVEV3/pffXXf91VEzPgHyjTgnq/+mXN2vtEbqeS6egjTGfXLhw4T8ODw+ft6uAVS6XT7TW6ok0aqRnS17inLulXq8P7W29of1OUi8Cvgh4d6kcX2Dmoo48YOnCY/1giXWBc71e/xQ7t8+F9sNzzN0FLF1PVSqVdM+1j2u/ReQS3d+tubl5la6fyT9IdWShcRHhebpQeupi8N2MYBWdc+cZY3QTST22bvkwufloflzdQ01HNXYbsHSEazaOM5O2rjPUoJefGberu32qVqt9UPcH29eAlU8RanjQsxQba9HqOiJmjFmztwFL75dfakYvSTR50e58avHLjVGofJRLN2DWUW29PeDSOZrJVqxYkWRZptN7ugVFox4d7dLtFX7XuPLDtLMIdYRP9webemmlIWvtqwYGBq5LkkR7qwFZ98rTfax0NHRJHph+bYx5eaVS+fVMa7Dy7V30ZAIN9I2bru363N7W+/D8JvEsCOx/Alzsef/rKa/oYRTI1/TpdNBKHY0YHx9/49T91fLLP+m0z2ONMVmWZW8ZGBi4OT+LSxdK6zo63WhUw5FefeALaZr+R2PRev7Br2FBR6f0g/H+EzzytUE9ulllPrKiZ7fpRpO36pqnNE0HdNuC4eFhPcVfR0N2qi+n0jVGs3GcXcrr9HZLS4uOwmgQWpRPj/7FWvuFarWqo3D3XxYqH1HTNWoadC7Y07YjegWHWq2mo2R6zUANmbqoX0cIdSNQDUqfqlaruk3Cbm96DUSd2tM1n9onDVhTL9Ctr6G5uVkvfaROeruutbX1s9Mv4aX78Om+ds453fhUpxH1hBQ90/ObIyMj6/JpUB2p0vVxepbhxVEU6RUbdJd+DWJ/stZ+aGBgYHIdaj5tqP0/yxjT5pwrGGNGnXMD9Xr9ozfccINeQkkD4qnOuTdpWDfGvG/KdS/1Ely6ObOeWHGQBjTn3AVTpjb3WO+e7Pg5AgjsWmDGgKUXfd6ge7uMjurZLA/51qSL0lsmho/ZsKWxKPwhH5MDIBC4QNTe3j5Pr0gwOjo6snXrVh2d2OdrUOqHcF9f3/x77rmnUKvVRrZs2aIL6B+x48zUk3xLlQWtra1ZT0/PSGNrglnoYdTd3a3bIdQaU6uzcMyHcgjT09OjV1bQEcmJzZs3N9ZtzXhMHY0bHR1teuITn3jfDBeNjpYvXz6/WCwW7r333tF9vaZlvhZvfq1Wq++inn2u96Hg8FgEDhSBGQPWgQLA60QAAQQQQAABBGZbgIA126IcDwEEEEAAAQQOeAEC1gH/FgAAAQQQQAABBGZbgIA126IcDwEEEEAAAQQOeAEC1gH/FgAAAQQQQAABBGZbgIA126IcDwEEEEAAAQQOeAEC1gH/FgAAAQQQQAABBGZbgIA126IcDwEEEEAAAQQOeIHdBSyz/PhVi4vjtVnZaNREkZsoxsNbrl/PRqMH/NsOAAQQQAABBPZvgRkDVscLTj3PiTlHxLXODoFxxsiwc+6Li2vbLp1+iYnZeQ6OggACCCCAAAIIPPICuwpYpuMFp57rxOiFT+fiNmKcnDH406u/O/3gy5Yta160aJH+90NE5J785zc4575RrVb16vK2cXFda+111WpVL5g7Gze9KO9TFi5ceHtfX9/YbByQYyCAAAIIIIDAgSuwU8BafvyqgwvW9eVXeJ8rmRtv+MnV7TMErCtE5KLGRV6TJHmic04vVntjtVr9Wn6BW72i/V+nXfj2QdeaJMljReRbURSd1d/ff+uDPhAPRAABBBBAAAEENKxMV+joOelQV4x/LmIOnUuhG35y9U7PnY9gPSBgaQ1HHXXUIS0tLZc5596cpultSZLcH7DK5fJh1tq6tXax3ndgYODGQw89tGnp0qVdehFd59y2NE1vFpFMf64XVR0aGuqIoqjFGPP7kZGRvzQ3N7/AGPNRY8w/iUi1Uqn85sFcLHcuvTg2Aj4K/OAHP2geGRnpqNVq8xr1xXE8vn379so555yjF53e6Xb11Vc/pVarLYrjeHNvb69e4Hqfb1dffXV7rVY7uPHAYrE4On/+/METTjhhfJ8PxgMQQACBORAIImDp606S5GPOuU3GmOuNMVc2pghLpdLHnXOnRVH07nq9fktTU9Pvsiz7vAYlzVsiclaWZV8bGBj4aXt7+4KmpqaLnHP9xphfWWsPNsboFGQ7AWsO3l0ccr8XWLdu3RNF5OfOuX+31n5TX/CeAta6desuEpFnFQqF40855ZS/PBikdevWXS8iE1mWfUofXygUnuuce6619l1r1qzR3/3d3tatW/cOEbm7t7f38j3dl58jgAACD0YgmICVB6k7ROTL0wOWtXZRtVp9gwJ0dXWdbIzpTtP0H/J/P1vD18TExOnFYlHvc9S2bdveeNttt92/1qqzs/NJxpj1cRyvYYrwwbyNeMyBKtAIWMaYS1etWvWxvXGYrYDlnLt99erVr28857p16840xrw9y7JT1qxZc8vualm3bt2gc+47q1evXrs3NXMfBBBAYF8FgglY5XL5w8653zjnrtnFCNYdaZp+Ng9UXzHGPFNEJr8ZG2MWOueKhULhpfV6/VvOuU9Xq9VvT4UiYO3r24b7I/D/BXYXsNavX/8KETlb72et3Vqv189/xStesX1qwNKfZVn2GWvtffrzefPmFfXfIvJYa+1IoVA459RTT/3jdG8dwZoesC655JLi4sWLv+mc27p69ep/XLdu3aL8C9lS59x4FEUfjKJIR7g/45w7Uddx5qPcbysUCmON582f6yOrVq36GX1GAAEEHqxAEAHrWc961uKxsbGvGWPeY6393e4CVqlUukRE/rNSqXxjKkp3d3dbvV7/sXPu4wSsB/t24XEIPFBgV1OEzc3Nd9Tr9TFjzCt0VCsPOv8eRdHXTjvttM81AlYcxyfV6/X3GWM64jg+eWxs7L5isfg9Y8yP77777gsWL178SRHRL0sn9vb23jX1mXcVsPTnV1111VpjzLO3b9/+ooMPPvhdWZZdr1OG69ate5OIvFFESr29vaPTR7CuvvpqHd3+2Wmnnfbb9evXf1CXHYjIi3p7e/9EzxFAAIEHI+B9wOrp6Snce++973POLW1tbX3n8PBwtIeAdZZz7hlpmr5lKogeZ3h4WNdxxW1tbedP3YdrxYoVS6y1VxljXs8U4YN5G/GYA1VgpoB1yimn6Ikik7f169c/T7daEZH+3t7el+cB67lRFG2y1h5jrT11zZo1v8qDzfGFQuHEU045Zdu11157VK1W+6mIvHL16tX6/++/7SFgndTb29sx9f7r169f55x7sXPuRatXr/6vmaYIv/nNby4uFApfjqKoJ8uy561Zs+aGA7W3vG4EEHhoAt4FrLa2tnW6aDaKosH8pb3MOXdPmqZ6hp8udp+/u4CVb7lwqYj8whiz0Vrbaoy5V7d90LMRm5ubL3HO/SSKoi26yH1iYuK/nHPbm5ubP6cL340xP+Km6Vc9AAAgAElEQVQswof2puLRB47ATFOEV1555RFRFOmedkuNMTc6554gIr/p7e09Pg9Y5+jsoHPu9NWrV39n3bp1TcaYbzjnXqj3b5z125jaO+200zbuZcC6MIqixy1YsODV9913n46A6aiVrreyxpgj6vX6yaeffvrPpgYsnVo8+OCD32ut/UdjzM3GmDHn3FOiKHr+aaedpifKcEMAAQT2WcCrgCUiUWdn59FxHE9uuZDf/jwt8MTTt2mIomhi48aN96/TWL58+cJ58+aV9PFZlt27aNGiwcaIlf5s/vz57bqFg27T0Bixam9vf3Qcx0+P4/hOAtY+v494wAEqMFPAWr9+/Sedc8+x1r4+iqKbnHPv15NPent7X5wHrOeJiJ60cpCInHLzzTf/8cgjj/yiiHTW6/UTzjjjDF0fNeNtVyNY11xzzeOzLPu5iLyvUChsybLsx9baC4wxX42i6PHW2uuzLHvd9IB1xRVXdMdxrGHwvbVa7drm5uZHZVn2sziOX07AOkDf2LxsBGZBwKuNRmfh9XAIBBB4GAX2ELAO3b59+xlLly5dXK/X/y3fFqExgvWsWq3WWywWv6JXbSgUCmfX6/UuDUPOudf09vb+REeWli5d+rR6va4jXw/YL2t6wLriiisOjeP4E865iXq9/uZ58+Y9Tp/TGHP6qlWrfpmvwfpnPcMwD1jfMcbcumrVqnfkAesqEenNR7verus9oyg6joD1ML6ZeCoE9jMBry6Vs5/Z8nIQ2O8F9jBFqKFlSETqxpg7dTuV1atXv2jqWYQTExNL8qnEv1hrXxNFkY4862jXXc45PQtYNxi+clcBS682YYz5tSI755qNMf/inPuhLmLXDVB1itA591JjzO26DEBEVmZZ9so8YL1ERHTErGKtfXccx690zq0SkW3OuUFjzKooil5CwNrv38K8QATmTICLPc8ZLQdGAAEEEEAAgQNVYMaApVtILT9+1eLieK1tNnBMFLmJYjy85fr1d8/G8TgGAggggAACCCDgq8DuApavNVMXAggggAACCCDgtQABy+v2UBwCCCCAAAIIhChAwAqxa9SMAAIIIIAAAl4LELC8bg/FIYAAAggggECIAgSsELtGzQgggAACCCDgtQABy+v2UBwCCCCAAAIIhChAwAqxa9SMAAIIIIAAAl4LELC8bg/FIYAAAggggECIAjMHLOfMWV9ZvziLs1nZaDTOrBMpDn/l7F42Gg3xnULNCCCAAAIIILDXAjMGrNdcfsV5kTPniJHWvT7abu7oRFwkMizOffHW2x9zad/a4+qzcVyOgQACCCCAAAII+Cawc8Byzrzma1eeG4m5eG6KNSNi3RmXvW7Nd6cff9myZc2LFi3S/36IiNyT/3zr2NjY27ds2XLvbNTT1dW1WkSOr1arryuVSi92zn00y7LjBgcHG883G0/DMRBAAAEEEEDgABbYKWCddem6g21s+8TI0XPnYm687MzV7TMErCtE5KI0TX8+F8/f3t7+6KampsWVSuXXBKy5EOaYCCCAAAIIILBTwDrzsisONcZouDl0LnkuO3PNTs+dj2DtMmB1dHQcVCwWHyci2+r1+lONMRNtbW2Dd999d1scx09v/Luvr29M69b7x3F8lDGmYK29s1qt/kr/OwFrLrvKsRFAAAEEEEBABYIJWEmSHCcilxljviAim5xzrxGRI4wxv7DW/sgYc4Jzbrxarb63vb19QVNT0+tFZMBau1BE3mOMeUeaphuZIuSNjwACCCCAAAJzLeBjwJq+BuvyNE2/kSTJc0XkQhE5IU3TP3d1dT3bGHOlMeZvdbovSRKd0vyMiJySpumOBlx3d3dblmWfFJG/PvnJT/7ALbfcchprsOb6bcXxEUAAAQQQOLAFfAxYu5wizEew3rxjx47Tt27dOl4qlTqdcxq4TtJAVS6XD7PW6ujWav13kiTvE5HnGWMWOud0vdfXReRc59wpBKwD+03Pq0cAAQQQQGCuBfa7gJVl2ZpisXi8tfbTIvJPaZr+n66urtcbY8oErLl+O3F8BBBAAAEEEFCB/S5gTUxMnN7U1PRmY0yzTgneddddZmho6BPGGN3PixEs3vcIIIAAAgggMOcC3gWstra2dSLy8yiKBvNXPzI6OjrY0tJyrIjs1RShiDw9nz78WBRFOkX4Ll3wTsCa8/cTT4AAAggggAACvo1giUjU2dl5dBzHi6d0ZzJgFYvF+bpNQ39/v263YJcvX75w/vz5yxYsWHBTX19fvaenp2VoaOipbW1tN+u/u7q6joii6JAsy+4tFAp3OufmVyqV37S3ty9t7IO1cuXKg8fGxg5btGjRoD6GdwQCCCCAAAIIIDAbAo/QRqNy42Vnrtlpo9HZeEEcAwEEEEAAAQQQeKQFvLpUziONwfMjgAACCCCAAAKzIcDFnmdDkWMggAACCCCAAAJTBGYMWOKcOesr6xdncdY2G2JxZp1IcfgrZ/fePRvH4xgIIIAAAggggICvAjMHLF8rpi4EEEAAAQQQQMBzAQKW5w2iPAQQQAABBBAIT4CAFV7PqBgBBBBAAAEEPBcgYHneIMpDAAEEEEAAgfAECFjh9YyKEUAAAQQQQMBzAQKW5w2iPAQQQAABBBAIT4CAFV7PqBgBBBBAAAEEPBcgYHneIMpDAAEEEEAAgfAEZgxYTsTcvPasxRMyOxuNNhdi5+oyvHztV9hoNLz3CRUjgAACCCCAwD4IzBiwNn/o7POMMecYkdZ9ON6MdzWie8PLsHHyxb/Y31563Nq++mwcl2MggAACCCCAAAK+CewUsHTk6sYPnX1uZMzFc1TsiHHujOUfvPS704+/bNmy5kWLFn3VGPMvlUploPHzFStWPCPLssuzLDtucHDwnt3VVSqVPu6cuyNN08/ORf1dXV0vNcZc5Zx7UbVa/b8zPUe5XH6MtbYvjuPVmzZtumEuauGYCCCAAAIIIOCnwE4Ba8vasw62UdRnRI6eq5KdyI1Hf+DL7XMRsMrl8mFRFE1s3Ljxj3NRf1dX14XGmJJzrtLW1nZ+X9+uR+IIWHOhzzERQAABBBAIQ2CngDWw9sxDi1Hx5yJy6Fy+hKM+8OWdnntvRrBqtdrIvHnzOpxztzrnlkVR1BLH8dZGoJoesHp6elqGhoY69H7GmPsWLFgwkIeiOEmSI6Mouqderx8Sx/FCa+2d1Wr1VzO97iRJnuicu0JEvmWMOc9a++KBgYHbG/dfuXLlwbVabTI4GmPustZe0xjBWr58eZPWLSLzp9Y7l8YcGwEEEEAAAQQeGYHgAlaxWGzRqTdjjAaszxtj2qy1bzLGvDpN01umThG2t7cvKBQKn4qi6L9E5A/Oub8VkSeMjY29uaWlxRpjrnTO/Y1OSVpr7xWR94jIx6rV6nW7aEdUKpXe6pxbOTY29oaWlpZLnHNfr1ar39f7JknyWP13FEVXisgtIvJc59z5cRwfo1OESZL8gzFmu4j8WkQeOzEx8b3Nmzff98i0nWdFAAEEEEAAgbkUCDlgra1UKleuXLlyXq1W+4aGrmq1+vlSqXSBrsFqbW39/PDw8Mecc3FjKk9HkVpaWi7TUShjzL9rwLLWbs1/bpMkOV9EjhgbG/u7LVu2TEyF7+7ubsuy7FoRuVSft1QqnSUiKxYuXHiejoiVSqX3OueiNE0/rI/r6Og4NI7jn8dxfFKtVrsniqJr6vX6GTfccMNv5rKhHBsBBBBAAAEEHnmBYANWY+otSZKiiHxBR6jSNP1IqVTSUHVHoVC4rF6v/9g59/FqtfrtBnWpVDrfOTcuIl/OA9Z11Wr1S/rzrq6u10dR9FLn3Jo0TUemtidJkm4R+XyhUHjJxo0b7+zs7NTpxe8aY146Ojr6u5aWln/V8JWm6Y/1cTpdODExoQHr1cVi8dbx8XEdFZvvnHtTmqYbH/nWUwECCCCAAAIIzJWAVwFLR5iam5svjeP4ov7+/v4poWiFc+5zhULhhdba+VPPztvXgJUkybtERKfmvrYvASsfoTpDRP6idTnnjDHmSSJy8Y4dOy5etGjRN2YKWDpFWCqVOp1zF4jIs4wx3xsdHdVRMp2W5IYAAggggAAC+5mAVwFLbZMk0XVQNk3Tj+fWjbVPLWmafqJcLi/dm4C1mynCL0RR9FVr7eDeBixdy9XU1HS1MebD/f39v8zrMuVyuddae15LS8tLxsfH3zJ1irBcLi+31l4fx/FLGts09PT0FIaGhp5vjPlSHMcnsn3DfvbbxMtBAAEEEECgERKmSzySZxHmAeuxOhJkjNH1Trc453SU6AQNMDfddNOd07c/mGkES/fBOuqoow5pbm7+nIj8wBijZ/sd65xr3bZt29olS5ZEexmwGkHq7621xw8MDNzVMMsXtn83juO31Wq1uwqFwhettV+OouhOa+3LdKNWXeQ+MjLyv01NTSdFUaQL3B+li+1rtdq7WeTO7yECCCCAAAL7p4B3I1jKvHz58oXz5s0r6f82xkyMjIxsbkynNbY7GB0dvTn/b6ZUKj21Xq+PDw4O3l4ul588dR8sPdb8+fPbnXNNWZZtHxgYuFFHyERkcpsGEflrmqZ/nhLuHpWm6c0ikjVCaEdHx5PiOG6d9t/1x1GSJMtrtdqdmzdvvkvvVygUJre3KBaLm2u12rJGnbp9hHPuidNfz/75tuJVIYAAAgggcGALeLXR6IHdCl49AggggAACCOwvAl5dKmd/QeV1IIAAAggggMCBLcDFng/s/vPqEUAAAQQQQGAOBGYMWHrR55vXnrV4QrK22Xje5kLsXF2Gl6/9yt2zcTyOgQACCCCAAAII+CowY8DytWDqQgABBBBAAAEEfBcgYPneIepDAAEEEEAAgeAECFjBtYyCEUAAAQQQQMB3AQKW7x2iPgQQQAABBBAIToCAFVzLKBgBBBBAAAEEfBcgYPneIepDAAEEEEAAgeAECFjBtYyCEUAAAQQQQMB3AQKW7x2iPgQQQAABBBAITmDmgOWcuXDD+sXGFGdlo9GitW7CZMPvOKaXjUaDe5tQMAIIIIAAAgjsi8CMAevTv7z2vEjkHDHSui8HnPm+xom4YRH54vaxxZeuPe64+uwcl6MggAACCCCAAAJ+CewcsJwzn97w7XMjIxfPRalGZMQZOeOtzzzlu1OP39PT0zI8PPwVEbmjtbX1PX19fY0AZsrlcq+19ryWlpaXjI6OflZErq9Wq1dNr2/FihXPyLLsqiiKevr7+/93Nuvv6ekpDA8Pf0xETrbWPm9gYOD2mY4/l3XM5mviWAgggAACCCAwNwI7BawLf7nu4FgKfWLk6Ll5ysmj3vjWlae0Tzt+I0j9vbX2+IGBgbv051OCVzVN0wtLpdJTJyYmtm/evPkvD2fA6uzsXBpF0ZUiUnPOfb5arX6fgDWH7xAOjQACCCCAQMACOwWsT2/49qGRuJ+LyKFz+breuvKUnZ67vb19QVNT09XGmA/39/f/Up+/s7PzSVEUfd8Ys6pSqfy6VCo9bWrA6u7ufnyWZcustWN6f2PM5VNHsLq6uo6IougQ/XlbW9tgX1/f5P1EJE6S5EhjzBL9R7FY3Lxhw4YZ14eVSqUe59x7nHM/NMY8p7W1tXfKKJvsrg4d/brvvvs6nXML6vX6bYODgzr65ebSl2MjgAACCCCAwCMn4FXAUoZSqfRe51yUpumH9d9dXV0nGmNOb21tfbUGmq6urq82pgiTJOkWkY855y6O43jIWvsmEXl6HrD+kiTJq5xzz3XOfTOKohXOuaZqtfohPW6SJG80xhwiIn3W2kOMMWuyLDt/cHDwt7tqR5IknxOR/9HnFpHvGmNO1cCXH2vGOu666657HvWoR33IOfdHY8yN1trmWq226cYbb9z+yLWdZ0YAAQQQQACBuRTwLmB1dnaujKLofS0tLWuKxeLo8PDwp5xzP21MyTUCVrFY/GGWZdeKyKWVSkWn7qRcLj/PWvt5DVjW2gXGmIvGxsZee9NNN915zDHHPHp8fLzPGHOmhhxjzGenTkWWSqWznHPPSNP0bSJip6J3d3cfUqvVro3j+PULFiy4JV8rdlOapp/o7u5esLs6RGS+tVbrPDVN01vmspkcGwEEEEAAAQT8EPAuYCVJ8igR+XEURW93zv2vc269tfbExqLyRsCy1m6M4/gaEeltBJckSQ43xnzDGHNKlmUrjTEXishtOXVBRDpEZI3I5PqyI8bGxv5uy5YtE3k4K2dZ9o6hoaEzt27dOj6lPVGSJG/QY8ZxfMrGjRuH80X3k2vFdNpvd3VYa3Wxvga7bSLytkqlMuBH66kCAQQQQAABBOZKwLuApeuVhoaGPmGMbusgutD96NbW1rMaa6f2JWDpGX/VavXMaSNSGpjOnyFgvXl8fPzsRuhS9O7u7rZ8hGqRc+7eKY04JIqis2u12h27C1h6NqNOZTrnLjTGaMC7Psuy1w0ODt4zV03luAgggAACCCDwyAp4F7CUo6ur69k6EqVn7Ol0YX9//7rGovDdTRGWSqU1zrm1OkVYr9cPjqLoknyE689TmfPj72qK8NFpmupWDPffyuXy8izLvlQsFnX06s7GDxprxQqFwmenTxFOraOxXcTy5cubWlpajnXOfTyKonMYyXpk3/g8OwIIIIAAAnMp4GXAysOI7nP19PHx8R5dQ9VAmLrIvaur66Ui8h5d6B7HcT1f5L5MA5YuLl+yZMlaY8zjsiy7XEfEjDFPHRsb+6qOUJVKpbXOOV2Ldb0uco+i6KXOufPTNH1AGEuS5P3OucdVq9U3TG1Evlbs84VC4cW1Wq08Ux36GGutBsa78sX0L2hqajp/d2cszmXDOTYCCCCAAAIIzL2AlwFLX3a5XD4sy7LmarX6q6kM07dpaGzDICIjxWJxa61WWzY6OjqYT/NFnZ2dR8dxvNgYMzEyMrJ5y5Ytk9N8OhW5Y8eOjjiOF+q/R0dHK42fTRvtOqJYLA5v3Ljxj1P/u+7PNTQ01DE+Pn6TPm43ddR07y4ReezunmfuW80zIIAAAggggMDDJeDTRqMP12vmeRBAAAEEEEAAgTkV8OZSOXP6Kjk4AggggAACCCDwMApwseeHEZunQgABBBBAAIEDQ2DGgCXOmQs3rF9sTLFtNiiK1roJkw2/45jeGS9HMxvPwzEQQAABBBBAAIFHWmDmgPVIV8bzI4AAAggggAACgQoQsAJtHGUjgAACCCCAgL8CBCx/e0NlCCCAAAIIIBCoAAEr0MZRNgIIIIAAAgj4K0DA8rc3VIYAAggggAACgQoQsAJtHGUjgAACCCCAgL8CBCx/e0NlCCCAAAIIIBCoAAEr0MZRNgIIIIAAAgj4K0DA8rc3VIYAAggggAACgQoQsAJtHGUjgAACCCCAgL8CBCx/e0NlCCCAAAIIIBCoAAEr0MZRNgIIIIAAAgj4K0DA8rc3VIYAAggggAACgQoQsAJtHGUjgAACCCCAgL8CBCx/e0NlCCCAAAIIIBCoAAEr0MZRNgIIIIAAAgj4K0DA8rc3VIYAAggggAACgQoQsAJtHGUjgAACCCCAgL8CBCx/e0NlCCCAAAIIIBCoAAEr0MZRNgIIIIAAAgj4K0DA8rc3VIYAAggggAACgQoQsAJtHGUjgAACCCCAgL8CBCx/e0NlCCCAAAIIIBCoAAEr0MZRNgIIIIAAAgj4K0DA8rc3VIYAAggggAACgQoQsAJtHGUjgAACCCCAgL8CBCx/e0NlCCCAAAIIIBCoAAEr0MZRNgIIIIAAAgj4K0DA8rc3VIYAAggggAACgQoQsAJtHGUjgAACCCCAgL8CBCx/e0NlCCCAAAIIIBCoAAEr0MZRNgIIIIAAAgj4K0DA8rc3VIYAAggggAACgQoQsAJtHGUjgAACCCCAgL8CBCx/e0NlCCCAAAIIIBCoAAEr0MZRNgIIIIAAAgj4K0DA8rc3VIYAAggggAACgQoQsAJtHGUjgAACCCCAgL8CBCx/e0NlCCCAAAIIIBCoAAEr0MZRNgIIIIAAAgj4K0DA8rc3VIYAAggggAACgQoQsAJtHGUjgAACCCCAgL8CBCx/e0NlCCCAAAIIIBCoAAEr0MZRNgIIIIAAAgj4K0DA8rc3VIYAAggggAACgQoQsAJtHGUjgAACCCCAgL8CBCx/e0NlCCCAAAIIIBCoAAEr0MZRNgIIIIAAAgj4K0DA8rc3VIYAAggggAACgQoQsAJtHGUjgAACCCCAgL8CBCx/e0NlCCCAAAIIIBCoAAEr0MZRNgIIIIAAAgj4K0DA8rc3VIYAAggggAACgQoQsAJtHGUjgAACCCCAgL8CBCx/e0NlCCCAAAIIIBCoAAEr0MZRNgIIIIAAAgj4K0DA8rc3VIYAAggggAACgQoQsAJtHGUjgAACCCCAgL8CBCx/e0NlCCCAAAIIIBCoAAEr0MZRNgIIIIAAAgj4K0DA8rc3VIYAAggggAACgQoQsAJtHGUjgAACCCCAgL8CBCx/e0NlCCCAAAIIIBCoAAEr0MZRNgIIIIAAAgj4K0DA8rc3VIYAAggggAACgQoQsAJtHGUjgAACCCCAgL8CBCx/e0NlCCCAAAIIIBCoAAEr0MZRNgIIIIAAAgj4K0DA8rc3VIYAAggggAACgQoQsAJtHGUjgAACCCCAgL8CBCx/e0NlCCCAAAIIIBCoAAEr0MZRNgIIIIAAAgj4K0DA8rc3VIYAAggggAACgQoQsAJtHGUjgAACCCCAgL8CBCx/e0NlCCCAAAIIIBCoAAEr0MZRNgIIIIAAAgj4K0DA8rc3VIYAAggggAACgQoQsAJtHGUjgAACCCCAgL8CBCx/e0NlCCCAAAIIIBCoAAEr0MZRNgIIIIAAAgj4K0DA8rc3VIYAAggggAACgQoQsAJtHGUjgAACCCCAgL8CBCx/e0NlCCCAAAIIIBCoAAEr0MZRNgIIIIAAAgj4K0DA8rc3VIYAAggggAACgQoQsAJtHGUjgAACCCCAgL8CBCx/e0NlCCCAAAIIIBCoAAEr0MZRNgIIIIAAAgj4K0DA8rc3VIYAAggggAACgQoQsAJtHGUjgAACCCCAgL8CBCx/e0NlCCCAAAIIIBCoAAEr0MZRNgIIIIAAAgj4K0DA8rc3VIYAAggggAACgQoQsAJtHGUjgAACCCCAgL8CBCx/e0NlCCCAAAIIIBCoAAEr0MZRNgIIIIAAAgj4K0DA8rc3VIYAAggggAACgQoQsAJtHGUjgAACCCCAgL8CBCx/e0NlCCCAAAIIIBCoAAEr0MZRNgIIIIAAAgj4K0DA8rc3VIYAAggggAACgQoQsAJtHGUjgAACCCCAgL8CBCx/e0NlCCCAAAIIIBCoAAEr0MZRNgIIIIAAAgj4K0DA8rc3VIYAAggggAACgQoQsAJtHGUjgAACCCCAgL8CBCx/e0NlCCCAAAIIIBCoAAEr0MZRNgIIIIAAAgj4K0DA8rc3VIYAAggggAACgQoQsAJtHGUjgAACCCCAgL8CBCx/e0NlCCCAAAIIIBCoAAEr0MZRNgIIIIAAAgj4K0DA8rc3VIYAAggggAACgQoQsAJtHGUjgAACCCCAgL8CBCx/e0NlCCCAAAIIIBCoAAEr0MZRNgIIIIAAAgj4K0DA8rc3VIYAAggggAACgQoQsAJtHGUjgAACCCCAgL8CBCx/e0NlCCCAAAIIIBCoAAEr0MZRNgIIIIAAAgj4K0DA8rc3VIYAAggggAACgQoQsAJtHGUjgAACCCCAgL8CBCx/e0NlCCCAAAIIIBCoAAEr0MZRNgIIIIAAAgj4K0DA8rc3VIYAAggggAACgQoQsAJtHGUjgAACCCCAgL8CBCx/e0NlCCCAAAIIIBCoAAEr0MZRNgIIIIAAAgj4K0DA8rc3VIYAAggggAACgQoQsAJtHGUjgAACCCCAgL8CBCx/e0NlCCCAAAIIIBCoAAEr0MZRNgIIIIAAAgj4K0DA8rc3VIYAAggggAACgQoQsAJtHGUjgAACCCCAgL8CBCx/e0NlCCCAAAIIIBCoAAEr0MZRNgIIIIAAAgj4K0DA8rc3VIYAAggggAACgQoQsAJtHGUjgAACCCCAgL8CBCx/e0NlCCCAAAIIIBCoAAEr0MZRNgIIIIAAAgj4K0DA8rc3VIYAAggggAACgQoQsAJtHGUjgAACCCCAgL8CBCx/e0NlCCCAAAIIIBCoAAEr0MZRNgIIIIAAAgj4K0DA8rc3VIYAAggggAACgQoQsAJtHGUjgAACCCCAgL8CBCx/e0NlCCCAAAIIIBCoAAEr0MZRNgIIIIAAAgj4K0DA8rc3VIYAAggggAACgQoQsAJtHGUjgAACCCCAgL8CBCx/e0NlCCCAAAIIIBCoAAEr0MZRNgIIIIAAAgj4K0DA8rc3VIYAAggggAACgQoQsAJtHGUjgAACCCCAgL8CBCx/e0NlCCCAAAIIIBCoAAEr0MZRNgIIIIAAAgj4K0DA8rc3VIYAAggggAACgQoQsAJtHGUjgAACCCCAgL8CBCx/e0NlCCCAAAIIIBCoAAEr0MZRNgIIIIAAAgj4K0DA8rc3VIYAAggggAACgQoQsAJtHGUjgAACCCCAgL8CBCx/e0NlCCCAAAIIIBCoAAEr0MZRNgIIIIAAAgj4K0DA8rc3VIYAAggggAACgQoQsAJtHGUjgAACCCCAgL8CBCx/e0NlCCCAAAIIIBCoAAEr0MZRNgIIIIAAAgj4K0DA8rc3VIYAAggggAACgQoQsAJtHGUjgAACCCCAgL8CBCx/e0NlCCCAAAIIIBCoAAEr0MZRNgIIIIAAAgj4K0DA8rc3VIYAAggggAACgQoQsAJtHGUjgAACCCCAgL8CBCx/e0NlCCCAAAIIIBCoAAEr0MZRNgIIIIAAAgj4K0DA8rc3VIYAAggggAACgQoQsAJtHGUjgAACCCCAgL8CBCx/e0NlCCCAAAIIIBCoAAEr0MZRNgIIIIAAAgj4K0DA8rc3VKkeRWUAAAZnSURBVIYAAggggAACgQoQsAJtHGUjgAACCCCAgL8CBCx/e0NlCCCAAAIIIBCoAAEr0MZRNgIIIIAAAgj4K0DA8rc3VIYAAggggAACgQoQsAJtHGUjgAACCCCAgL8CBCx/e0NlCCCAAAIIIBCoAAEr0MZRNgIIIIAAAgj4K0DA8rc3VIYAAggggAACgQoQsAJtHGUjgAACCCCAgL8CBCx/e0NlCCCAAAIIIBCoAAEr0MZRNgIIIIAAAgj4K0DA8rc3VIYAAggggAACgQoQsAJtHGUjgAACCCCAgL8CBCx/e0NlCCCAAAIIIBCoAAEr0MZRNgIIIIAAAgj4K0DA8rc3VIYAAggggAACgQoQsAJtHGUjgAACCCCAgL8CBCx/e0NlCCCAAAIIIBCoAAEr0MZRNgIIIIAAAgj4K0DA8rc3VIYAAggggAACgQoQsAJtHGUjgAACCCCAgL8CBCx/e0NlCCCAAAIIIBCoAAEr0MZRNgIIIIAAAgj4K0DA8rc3VIYAAggggAACgQoQsAJtHGUjgAACCCCAgL8CBCx/e0NlCCCAAAIIIBCoAAEr0MZRNgIIIIAAAgj4K0DA8rc3VIYAAggggAACgQoQsAJtHGUjgAACCCCAgL8CBCx/e0NlCCCAAAIIIBCoAAEr0MZRNgIIIIAAAgj4K0DA8rc3VIYAAggggAACgQoQsAJtHGUjgAACCCCAgL8CBCx/e0NlCCCAAAIIIBCoAAEr0MZRNgIIIIAAAgj4K0DA8rc3VIYAAggggAACgQoQsAJtHGUjgAACCCCAgL8CBCx/e0NlCCCAAAIIIBCoAAEr0MZRNgIIIIAAAgj4K0DA8rc3VIYAAggggAACgQoQsAJtHGUjgAACCCCAgL8CBCx/e0NlCCCAAAIIIBCoAAEr0MZRNgIIIIAAAgj4K0DA8rc3VIYAAggggAACgQoQsAJtHGUjgAACCCCAgL8CBCx/e0NlCCCAAAIIIBCoAAEr0MZRNgIIIIAAAgj4K0DA8rc3VIYAAggggAACgQoQsAJtHGUjgAACCCCAgL8CBCx/e0NlCCCAAAIIIBCoAAEr0MZRNgIIIIAAAgj4K0DA8rc3VIYAAggggAACgQoQsAJtHGUjgAACCCCAgL8CBCx/e0NlCCCAAAIIIBCoAAEr0MZRNgIIIIAAAgj4K0DA8rc3VIYAAggggAACgQoQsAJtHGUjgAACCCCAgL8CBCx/e0NlCCCAAAIIIBCoAAEr0MZRNgIIIIAAAgj4K0DA8rc3VIYAAggggAACgQoQsAJtHGUjgAACCCCAgL8CBCx/e0NlCCCAAAIIIBCoAAEr0MZRNgIIIIAAAgj4K0DA8rc3VIYAAggggAACgQoQsAJtHGUjgAACCCCAgL8CBCx/e0NlCCCAAAIIIBCoAAEr0MZRNgIIIIAAAgj4K0DA8rc3VIYAAggggAACgQoQsAJtHGUjgAACCCCAgL8CBCx/e0NlCCCAAAIIIBCoAAEr0MZRNgIIIIAAAgj4K0DA8rc3VIYAAggggAACgQoQsAJtHGUjgAACCCCAgL8CBCx/e0NlCCCAAAIIIBCoAAEr0MZRNgIIIIAAAgj4K0DA8rc3VIYAAggggAACgQoQsAJtHGUjgAACCCCAgL8CBCx/e0NlCCCAAAIIIBCoAAEr0MZRNgIIIIAAAgj4K0DA8rc3VIYAAggggAACgQoQsAJtHGUjgAACCCCAgL8CBCx/e0NlCCCAAAIIIBCoAAEr0MZRNgIIIIAAAgj4K0DA8rc3VIYAAggggAACgQoQsAJtHGUjgAACCCCAgL8CBCx/e0NlCCCAAAIIIBCoAAEr0MZRNgIIIIAAAgj4K0DA8rc3VIYAAggggAACgQoQsAJtHGUjgAACCCCAgL8CBCx/e0NlCCCAAAIIIBCoAAEr0MZRNgIIIIAAAgj4K0DA8rc3VIYAAggggAACgQoQsAJtHGUjgAACCCCAgL8CBCx/e0NlCCCAAAIIIBCoAAEr0MZRNgIIIIAAAgj4K0DA8rc3VIYAAggggAACgQoQsAJtHGUjgAACCCCAgL8CBCx/e0NlCCCAAAIIIBCoAAEr0MZRNgIIIIAAAgj4K0DA8rc3VIYAAggggAACgQoQsAJtHGUjgAACCCCAgL8CBCx/e0NlCCCAAAIIIBCoAAEr0MZRNgIIIIAAAgj4K/D/ADgaVVNDGVrZAAAAAElFTkSuQmCC" alt="cc"></p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAlgAAAGQCAYAAAByNR6YAAAAAXNSR0IArs4c6QAAIABJREFUeF7t3X+cnFddL/BznpndbNomgVtKVVRQinJNSTc7u40BlMQfoMC92EL5IbfY0vJLvCDyEgSuWlREULFcFG4BSwGtQKX+APWKIPEH9La7s0lDU7lYaOXnhRIgTZrdzcw8577OOhOn2/zYJKdsSt/7Twk7+51n3vN9nvk855znmRj8ECBAgAABAgQIFBWIRaspRoAAAQIECBAgEAQsTUCAAAECBAgQKCwgYBUGVY4AAQIECBAgIGDpAQIECBAgQIBAYQEBqzCocgQIECBAgAABAUsPECBAgAABAgQKCwhYhUGVI0CAAAECBAgIWHqAAAECBAgQIFBYQMAqDKocAQIECBAgQEDA0gMECBAgQIAAgcICAlZhUOUIECBAgAABAgKWHiBAgAABAgQIFBYQsAqDKkeAAAECBAgQELD0AAECBAgQIECgsICAVRhUOQIECBAgQICAgKUHCBAgQIAAAQKFBQSswqDKESBAgAABAgQELD1AgAABAgQIECgsIGAVBlWOAAECBAgQICBg6QECBAgQIECAQGEBAaswqHIECBAgQIAAAQFLDxAgQIAAAQIECgsIWIVBlSNAgAABAgQICFjL7IEUQtzWap0eer3TlvknR3xYHWOqUtqzdceOb5Sop0YRgbj+8RecObK/M1aiWqM5Us93w9d2bbtmX4l6J1ONS6+++szuQlxdYptGq0bd7a76+pWXPGlviXorWeOjl13WXJc++8AY69ES29FsntIbW9v4ysNe9KaFEvXuazWumJkZ2Xfn57+tGk2NEq89pU7njoUzvnzZ1q3dEvXU+NYWELCW+f7+4+T4L8ZYPSuFVCRghRBSCOGOEOLv/PD07B/3/73MrfGw0gKPePQT7t8YW315CmFTiGlVmfqxTiF8LtXxFZ/4yDXXlam5slWee8X71nVW1b8XQtocQiwSRFMIKYbw+ZTSr1x18TO2rewrPP5n3/naF9y/caD72ymGHwohFAlYIYReDPErKaQXn/0rb5s+/q277/3l5f/4pxtiM74lxHhmCKFIwAohdEII19cj6WUvmXzyl+57ql7xsQgIWEfRSiFU/zQ1/vIQ4m8eC+zyH5v2pio95THX3/ihQ/3Nxo0bf6CqqpeHEL67//s3r1mz5s+2bdt2j55BtVqtrSGE/75nz55n3HLLLUc8ez733HPP6fV6H08p7YgxHuhv51XtdvvdIYR6+Rb/8chWqzUSQnhzCOFz7Xb7N463znKf+5wfu+CKENNzl/v4Y3lcDPGrvU79Q5/Y9v5PLv27ycnJjSml94cQvhBCyO9p9rum1+t9eMeOHf+Wg/fGjRsfHGO8ptFoPH16evozx/Lch3vsli1bxvbt2/fgmZmZfz0W24uues/vxRB+vsQ23L1G3BvqtOUdz3767NLfTU1NfVtd19tijHtTSoMRwY/0e+OEN6fVap0SY3xPXdcfnJ2dfevExMTTQgiPm52dffZyit/42xee2pgbe08I4YnLefwxPyaFz9apt3XDZVfe7f3v739X9Xq9rTv+Y0S8arVa/yM/z9H2n1artS6E8Ocxxl+YmZnZfszbdvQ/yNvy+yGEjWNjY4/92Mc+dtiRymM57hzpad/w8Q88qAoHcr+cdfTNO65H/EM9H3/qJVvPu8sMxNTU1Pq6rt+TUnrq7Ozsvwwqb9q0aW2v17s2hPD2uq7XVlX1xJTS09vt9v7hZx8fH79fo9H4aIzxlTMzM39zXFt2hD+ampp6ZF3Xf1lV1Qunp6ffd7gT+2/28bf06zxZ6glYR3kn/rHV+vZQpY+GkL7/nnrTUkoffczMjh9ZWv/ss88+c9WqVW9PKb1qdnZ2Z/791NTUd5166qlfOgkD1nurqtoyPT39/wo5xcnJye/rdrsLg6BRqO7dyjzisU9+eJXijQVHHe6+qSm+/8YPX/OUwwSsN4QQfqrdbu/ZsmVLc8+ePVNVVT271+u9fseOHf/6kIc8ZOz000//gTVr1ty8bdu2+RIOGzdu3FxV1Uv27Nlz4dEC9OD5nvvO9313J9SfDCkUmRo85OtI4S+uvOhp58UY8wjvwZ9BwGo0Gk+74YYb8ntV+qfRarV+IITw1Xa7/aVjDVg7f+3Zm6vQ+GgIodDo591fXozhRet/+W1vWvqbEw1YuefuvPPOs/fv33/Lrl27ik9nt/Ix9N8D3KkxxvzB/g+He/NKBazLP37ts2IMVxYcuVq6yQdSDD/68z94/j8P/2IoSP3VzMzMGwcnLzl49Xq9t46MjJzf7XarEMID2u32zXmE8psZsFqt1stjjD+eUvrymjVrLjnc8UTAKnN4EbCO4vj3kxu+vxkXD5z5IHHP/KRw+w/PbH/gYQ6cefpwS7vd/uohnrzauHHjIxqNxv1DCPvn5uZ27Nq1a3EEadOmTd/Z6/UWz94ajcYt119//efz/56amvreuq67dV3nvwnbt2//xJYtW6o777wzj6ScmlLanXf8Vqv1w3kEq6qqF3e73e+pqqru9Xo3DZ0hH9yc/gH+kAErP19VVQc6nc6aqqrO7PV6+9atW7djEBDXr19/2imnnLIhpTTa7Xa/MDIyMtrpdL6wY8eOPcMBa8OGDWeMjo7ev9Fo3JlfV13X82vXrs11BoFj8QMyxnh6HkW7/fbbZ2+77bZlhZENP37+f42h+ot75s09WPXj3S/Grbt2XTMY4Vv8RX8E62DAGjx6cnLy8SGEHz/ttNN+8bbbbmsOAtbtt99er169ejzG+NkQwvd2Op0v5gC6fv36UweO+XfDI12bN2/+T51OZ0OunVL6v/3/Pi3GeH5d16/u9Xqf2Llz51eO9vqf/c73bk0p/f3RHnciv08h3TC6cMfWtz7veXc5sz9CwFoM4jHGTl3X+QP89Lquvzw7O/upQT/0/z0YTYjj4+MPbjabD8nb2e12b+sH+DzKctwBa9ern/OTKYa/PpHXvoy/ffPZv/K2Fx5PwBofH187MjLyoBDC7m63+33NZrO7f//+nTlQHSpgbdiw4YGNRuPhjUajGu6nPPK5d+/e7PTZqqryCVCz1+t98gj9k9+fC0MIz08p7YoxrjnttNMuGtpvF9+/fHyNMd6ZUrpfSukFg5Hz/ojO2fn4M9jeZTiFN153bR71ftVyHnvcj0npmS9+5JOvXvr3k5OTTw8hXNpoNM6//vrr7+jv55eklM5pt9sv6gfOgwErHwNXr149mR+XezXGePXwCFZ+fIxx8QQ/77/5BGDwnId7nw71mh796Efff//+/e9LKf1JVVWvqOv6Sdu3b88hb/Gn3weLnwP5RCOllEeqP9sfAU2D96nX6309f24cy8j3cRvfy/9QwDrKG7iSAau/Q3wwxrhjfn7+JYPwNNgZ9u3b9wt1XX9bCOGDVVU9LqX0+Xa7/aZWq/XQ/OEcY8xTUt+eUvrphYWFS2+66aYvT05Ovi6l9JSqqn6x2+1+enR09NZut5vPtD4XY/z7uq5XNRqNm+u6zuHsHSGEP00p/XWM8VEhhO+Yn59/8fB25G05UsDqP9/5KaXfrKrq1rzTVlX1J9PT0+/dsGHDqc1m8y15TUMI4V9ijHlaMh+MLw4h5DPDg1OEExMTF8QYXx9jvKKu6/8TY3x8SmlhdnZ28SA6MTHx1Kqq8tqX96eUHptHEnbv3v2q5YSsR/zYeU+qYuPP7+F9+ZgC1jnnnPOgZrP57m63e2FVVc3BFGEO0nmqLISQp/be1Ov1PtXpdL46NjZ2eQjhn3JAzlM9IYRXtNvt68fHxx/WaDRen1J6T1VVXw4hrO52u7dUVfWEYw1YF1959Y+EqvrIPel0rAFr6Ez73JTSq/O25Q+P/AERQri6ruuvZ4sQwmtnZ2c/mAN/t9vd2Gg0dtd1fWZVVRf1er1Lqqr6xolMEe56zXN+MvXu2YCVUnrLI3717T97PAGr1Wo9Znh/rqpqcz52LCwsvHRsbCyPSB6cImy1WptSSq+sqirva72qqi5OKf1NnvKfmpp6SF3XfxtCuCmE8JYY43emlM4bHF+WbtujHvWoNfPz838VY8wj8Tfl/Tf33fT09Of6++2PxBh/Lsb4lpRSniJ/aQghj+I+aWxs7H6rVq3K+/y1dV3nqeFq+/btH15O/11+3bWviSG8cjmPPd7H1KH3316y+YJ8AnyXn02bNp3Z6XSubTQaz52ent61fv360bGxsXfkYJN7cGJi4rmDKcLR0dGxAwcOvD0fA2OM+TiYA86vxRifmqcI+/tvDovvSmlx/e9Pxxifn0PWkd6nQ4WfHPxSWlwG8dQY42tCCDfMzMz8Yd74PEr+gAc8IO8/p9Z1fW0+GU4p5ed9Zw5YExMTW2KMj40x/u98Mtwf6b3bVP7xWn6r/p2AdRIHrLxpeYQjhHB5Sul7Uko/+7Wvfe3DOTRs3LjxnKqqXtXpdC7euXPnnePj4w9pNBp5Lc9T2+32pwcvK08p1nV9dUrpDbOzs3+WA09d1+tmZ2ef3z/APbGqqvPn5uaePxyc+kP1eWTl8XlnPlz9oYC1dA3WpXk7DvF854UQznvoQx968Wc+85l8hjQxGKrOB+OFhYUPppQuO0zAemGn0/nJ/HpbrdYjQgh/0Gg0zuv1ennk7YqRkZHn5JG6XGdubi4f4F45PT191IXBJ2PAGh6x6XQ6+cN/cQ3WIGDFGC+bmZnJa37yyN3LQghr16xZ88t5ZLDVav1MPhCPjY09ZX5+/tfzQGW73X7ncKsfz1TMyRCwhtZg5ZHA3xrqk1NyH+VBqX379uX9ZcPY2NgTPvaxj+VeyT75pONn2+12XqS8+NMfScgBPwf5f74PBKxD7s/9MLoYsFJKOfh8KE8fD6byJicnvz+ldE1d1/+l2Ww2csCqqurS/Ps8Jdbtdj+UUnpdPr4sPZz215BekY9L8/Pzu3PQyIFpZmbm/f3wlde9/cb27dsXLwKZmJg4Lwe6b3zjGxesXbv2Z2KMT56fn3/ysU5drmTA6vfW/4wx3pgDTH+U+nfqun769u3bbx8OWDHGZwxGtvLfPfKRj3zgwsJCXjv20tNOO+3v9u3b99shhL+bmZlZHB1ttVq/3t8H8vTnYd+n7du35/WbB3/6ay6vykEuT11OTEzkE6xn7d69+8L8eZLXZqWUfvnAgQNPycfXzZs3r+50Ou9OKe3MAavVal0ZY/zIzMxMXlfrZ5kCAtZJHrDy5uUh5FWrVuWzh3w2d93c3NwLxsbG8khPXvx+a35MPquIMY43Go1Hzs/P3zIyMvIHIYQHhxDy1OPD87B7XrzbH1H6YrvdzqNWeYfNB4LppTvO0g/gI62BWcYI1vDzLS6e7/V6z242m3nB57bZ2dm8remss85atW7duj/JIzOHCljDi47zSESv18uLSS/Ia79CCL8bQlhc0xBjrFJK+bVf3G638/TuEX9O1oCVUro2pXRhntJdGrAGa5EGH3AhhFPy9E//hZ6eHfLIZVVV/6vT6Tznxhtv/NS3QsBaugbrEGtFck/nxd3fNQhU+QMtxjiV/z06OppD/OUxxvz778gXj6SULooxfuA+ELAOXrQyvD/3er3bBiNY/VGkxROXG264YbGf8oftwsLCu6uqek2Mcc9gv8sf4ksvDli6o+U1PyGEB7Xb7XwyVU9OTuapssfOz89feMoppzwspfTeTqfzuBtvvDFf5JGXMEz1er1fuOOOOy5au3btuTHGHCz+otPpPC9/8B9tXx78fqUD1sTExBNzeBodHb10YWEhu/XWrFnzinwCtCRg/V4+1g2Ov/lYPzY29v4Y4+WdTmdns9nM69XyaOxc/7V9Zw6oKaU/GpxgHup9WnqxQqvVengI4b15YX1efJ8vnKmq6m+qqnpBDsqtVusFMcaHzczM5NHvcMEFFzRuvfXWX8uzBP2AlWcKnhVCuGLNmjWX39NrgJf7Pp/sjxOw7gUBa7CJmzZteli3280fBPms5weHd4jBY/I8+t69e18bQviJEMKLBkElpTR9qIA1OTmZzy4P7uCDOvfCgPXTx3Omm1/vyRiwJicnc2h8Vh5ZHB0dzWsw7jKCtTRgHWoEoT/N+KfdbvdnBKx/D1gxxpfl4JlSenmermm1Wq9OKd18bw5YeQF1SumqkZGRx1133XVfW/IBubfdbr++P0V43AHrwIEDeQT016uqymsgF09sjhaw+iNUf5mnpYcCQjOf+KWUHpfXdx0pYOWLLyYnJ5+XUsrrzh6a/zs7O/uu5az9WemAlWcO8glSr9d7aVVVlw+PCB5jwDrc/ntwBH84YA3ep3a7nddIHfzpB9scnobXWuYTjL/MwW/v3r3POVLA2rx58/36Jyb5uFTnJQbT09P5hPYuF6Oc7IHnm719Ata9KGD1D1hXd7vdl46Ojj5geEh3KBgNLjd/Rx6yH6yByGc8hwlYBxdfHmmEo/QI1ujo6DMPHDiQ15McnCLsT9nkM9Z8ILjbGqzDjWDFGE+pqupdw2s7jmVHOtkCVl6bNjIyclVK6e2zs7N/O3ybhsEU4SBgDQJ1Sqmxdu3alw2fWfZ/l9du5LUfHxg2GR4pWO5VhCfDFOGJjmDFGH8/3xaj3W5/KK+NWb169Tvrus7TY/faEaz+1Pofp5Rek9fd5fe5P03+R1VV5ank7Uc6YVoygnW4KcIcbJ5QVVW+3cCyAtbU1NRj6jrfMy08dnCRzvBUVUopT3PldXIHpwj7QeCCvAZr0Jf5Io2FhYU8erL1jjvueOpy+nWlA9bgdeZbMsQYG3m6fnB7iiNNEfaXdOQpwp/LU4R79+495P7barUecJgpwsX3afiiqKVrwAbHgYmJiR+KMb6xruvHNZvNPJp4cIpw8LkRQvjw8G0+zj333O/r9Xp5qvmGo93+41iOwd+qjxWwTuKA1V+sni9Zn+lv5qNSSmt279592amnntocGxt7U77yJi9KzGeDvV7vu2ZnZ985OTl5UUrpJ+q6viJf6RNC+KV88D1UwMoHrwMHDuR1KJ+OMX5oySL3Q57xLr1Mvj9F+IH+AvbFM+gQwpdmZmY+NTk5+VsppbtNEearhPqLWN8eY/yzuq5vywvXQwj5VgaHXOR+uICVz6QnJycvSyk9KMa4uOg0pXTW/Pz8e5azdmOlA1Z+n2KMr87vZQgh35Pokrqu35pHWPJrOVLAyr/v90leRPyufCFBvlKr1+ul/PeD9R8ppbcOFrnPzc39U7PZXJcX0eeFyp1O5x+WcxXhyRCwYox5TcriGsN8NdPevXs/uW7dunyPpcH90o44RRhjzP31YyGEvL7knBDCC/MHy705YGWLiYmJvFj80hhjvjClk0eIYowLMzMzeT1jNrnLfe0ON0WYw1ie3sr3SarrOk/dd2KMecTvmsFFAssJWEMB44tLg39/sXWext1SVdWP1nX9jDwllpc55MX1Mcb5HLDWrl2bt7lZVdW+uq7zCOQ3Zmdn37acD+OVDlh5G/sBM9/L6tXtdvt1Q8Hm4CL3/v7+3hhjHiH8dEopX6jzssEi9/77+kshhDfm40Ov1zu92Wxuz1cJH+l9GjbqB6mr+rfRWby4IP/0T+Tymtffzeu+Vq9e/baU0hdijB/s9Xr56u9fDSH8YQ5SGzdufGaz2fxSr9dr5H7I6xYHYX4578d99TEC1kkcsPo7wcHLpZdeHjt8We3wbQuG//+U0uC+VHvyYvXBbRMGt23Iz5GvIDnjjDMm+ge4xds0jI+Pr8mXdU9PT+fL2+v+2f743NzczUtDy/BlxkOciwFramoq3+LhwOD58mXXw3UHlxnnv2s2m7fmez81Go03TE9PzxzqNg0zMzOLtxkYXC6+e/fum/Mizf79o/IatMU77c/Nzc0sJ1wtGq/gbRqGb1PRD4bdpbfDGL4P1uA2DUvfh8Hl7DHG5pLbEiwu5j7EZd6Ll8f3er1864wjXWZ/8C1dyds0DPqvv9ZscZvy/nDWWWfddOutt541dL+00L8Nw6rcfzlr91//2vzv9evXj+TbXOQ6+fYDjUYjX/6/f+fOnbuHb9OQ+zLfFmTQb0f7gFjJ2zT0t+0ut59YejuUpfvd8P58xhlnzC+9D9bhbvOydL/rX2Rx8PYWA6fB/lhV1ReGbyuQf99fU3p2vs1Kvihhz549i/ttfj/HxsY+1+12vz0fd4ZvH7P09Rzt/VjJ2zQMtq1/Zd6Gbrf7qeHb2yy9TcPw/jk6Onrz3Nzcd4+NjX2mP917uNuKLE7NHe59GvbJ9eu6ftDw7XGGwt5/HhkZ2ZuPz8PH8aqq/q2u63zrnMX7EI6Pj69rNBpn5+PL8G1/jvY+3Nd/L2AdpQNW8kaj3+rN2R89W9U/ADc2bty4taqqn2s0GpcM1hV8MwxW8kaj34zXV+o5VvJGo6Vewz1VZyVvNHpPvaZ7c92VutHovdnMtpcXELCOYrrSX5VT/i0/eSr2A9YzQwjn5zPhfFlzt9v93Xv6zu2HElipr8o5ed6N5W3JSn1VzvK2buUetZJflbNyr/rkfeaV+qqck1fElq2EgIC1THVf9rxMqHvpw3zZ8/LeOF/2fHine+rLnlMKt+evyfFlz8vr0cGj8pc9VyPVm1MI+WbMvuz52Pg8uoCAgLVMxBRC3NZqnR56vcU1Pif6U8eYqpT2bP2PL2c90ZL+/sQF4vrHX3DmyP7O2ImXCqHRHKnnu+Fru7ZdU/z73Ups34nUuPTqq8/sLsQi30k4WjXqbnfV16+85EmH/RLgE9nWb+bffvSyy5rr0mcfGGOd73Z9wj/N5im9sbWNrzzsRW864heun/ATfYsWuGJmZmSh+5Uze2kh3x7ihH9S6nTuWDjjy5dt3ZrvOu+HwBEFBCwNQoAAAQIECBAoLCBgFQZVjgABAgQIECAgYOkBAgQIECBAgEBhAQGrMKhyBAgQIECAAAEBSw8QIECAAAECBAoLCFiFQZUjQIAAAQIECAhYeoAAAQIECBAgUFhAwCoMqhwBAgQIECBAQMDSAwQIECBAgACBwgICVmFQ5QgQIECAAAECApYeIECAAAECBAgUFhCwCoMqR4AAAQIECBAQsPQAAQIECBAgQKCwgIBVGFQ5AgQIECBAgICApQcIECBAgAABAoUFBKzCoMoRIECAAAECBAQsPUCAAAECBAgQKCwgYBUGVY4AAQIECBAgIGDpAQIECBAgQIBAYQEBqzCocgQIECBAgAABAUsPECBAgAABAgQKCwhYhUGVI0CAAAECBAgIWHqAAAECBAgQIFBYQMAqDKocAQIECBAgQEDA0gMECBAgQIAAgcICAlZhUOUIECBAgAABAgKWHiBAgAABAgQIFBYQsAqDKkeAAAECBAgQELD0AAECBAgQIECgsICAVRhUOQIECBAgQICAgKUHCBAgQIAAAQKFBQSswqDKESBAgAABAgQELD1AgAABAgQIECgsIGAVBlWOAAECBAgQICBg6QECBAgQIECAQGEBAaswqHIECBAgQIAAAQFLDxAgQIAAAQIECgsIWIVBlSNAgAABAgQICFh6gAABAgQIECBQWEDAKgyqHAECBAgQIEBAwNIDBAgQIECAAIHCAgJWYVDlCBAgQIAAAQIClh4gQIAAAQIECBQWELAKgypHgAABAgQIEBCw9AABAgQIECBAoLCAgFUYVDkCBAgQIECAgIClBwgQIECAAAEChQUErMKgyhEgQIAAAQIEBCw9QIAAAQIECBAoLCBgFQZVjgABAgQIECAgYOkBAgQIECBAgEBhAQGrMKhyBAgQIECAAAEBSw8QIECAAAECBAoLCFiFQZUjQIAAAQIECAhYeoAAAQIECBAgUFhAwCoMqhwBAgQIECBAQMDSAwQIECBAgACBwgICVmFQ5QgQIECAAAECApYeIECAAAECBAgUFhCwCoMqR4AAAQIECBAQsPQAAQIECBAgQKCwgIBVGFQ5AgQIECBAgICApQcIECBAgAABAoUFBKzCoMoRIECAAAECBAQsPUCAAAECBAgQKCwgYBUGVY4AAQIECBAgIGDpAQIECBAgQIBAYQEBqzCocgQIECBAgAABAUsPECBAgAABAgQKCwhYhUGVI0CAAAECBAgIWHqAAAECBAgQIFBYQMAqDKocAQIECBAgQEDA0gMECBAgQIAAgcICAlZhUOUIECBAgAABAgKWHiBAgAABAgQIFBYQsAqDKkeAAAECBAgQELD0AAECBAgQIECgsICAVRhUOQIECBAgQICAgKUHCBAgQIAAAQKFBQSswqDKESBAgAABAgQELD1AgAABAgQIECgsIGAVBlWOAAECBAgQICBg6QECBAgQIECAQGEBAaswqHIECBAgQIAAAQFLDxAgQIAAAQIECgsIWIVBlSNAgAABAgQICFh6gAABAgQIECBQWEDAKgyqHAECBAgQIEBAwNIDBAgQIECAAIHCAgJWYVDlCBAgQIAAAQIClh4gQIAAAQIECBQWELAKgypHgAABAgQIEBCw9AABAgQIECBAoLCAgFUYVDkCBAgQIECAgIClBwgQIECAAAEChQUErMKgyhEgQIAAAQIEBCw9QIAAAQIECBAoLCBgFQZVjgABAgQIECAgYOkBAgQIECBAgEBhAQGrMKhyBAgQIECAAAEBSw8QIECAAAECBAoLCFiFQZUjQIAAAQIECAhYeoAAAQIECBAgUFhAwCoMqhwBAgQIECBAQMDSAwQIECBAgACBwgICVmFQ5QgQIECAAAECApYeIECAAAECBAgUFhCwCoMqR4AAAQIECBAQsPQAAQIECBAgQKCwgIBVGFQ5AgQIECBAgICApQcIECBAgAABAoUFBKzCoMoRIECAAAECBAQsPUCAAAECBAgQKCwgYBUGVY4AAQIECBAgIGDpAQIECBAgQIBAYQEBqzCocgQIECBAgAABAUsPECBAgAABAgQKCwhYhUGVI0CAAAECBAgIWHqAAAECBAgQIFBYQMAqDKocAQIECBAgQEDA0gMECBAgQIAAgcICAlZhUOWhTu1CAAAMUUlEQVQIECBAgAABAgKWHiBAgAABAgQIFBYQsAqDKkeAAAECBAgQELD0AAECBAgQIECgsICAVRhUOQIECBAgQICAgKUHCBAgQIAAAQKFBQSswqDKESBAgAABAgQELD1AgAABAgQIECgsIGAVBlWOAAECBAgQICBg6QECBAgQIECAQGEBAaswqHIECBAgQIAAAQFLDxAgQIAAAQIECgsIWIVBlSNAgAABAgQICFh6gAABAgQIECBQWEDAKgyqHAECBAgQIEBAwNIDBAgQIECAAIHCAgJWYVDlCBAgQIAAAQIClh4gQIAAAQIECBQWELAKgypHgAABAgQIEBCw9AABAgQIECBAoLCAgFUYVDkCBAgQIECAgIClBwgQIECAAAEChQUErMKgyhEgQIAAAQIEBCw9QIAAAQIECBAoLCBgFQZVjgABAgQIECAgYOkBAgQIECBAgEBhAQGrMKhyBAgQIECAAAEBSw8QIECAAAECBAoLCFiFQZUjQIAAAQIECAhYeoAAAQIECBAgUFhAwCoMqhwBAgQIECBAQMDSAwQIECBAgACBwgICVmFQ5QgQIECAAAECApYeIECAAAECBAgUFhCwCoMqR4AAAQIECBAQsPQAAQIECBAgQKCwgIBVGFQ5AgQIECBAgICApQcIECBAgAABAoUFBKzCoMoRIECAAAECBAQsPUCAAAECBAgQKCwgYBUGVY4AAQIECBAgIGDpAQIECBAgQIBAYQEBqzCocgQIECBAgAABAUsPECBAgAABAgQKCwhYhUGVI0CAAAECBAgIWHqAAAECBAgQIFBYQMAqDKocAQIECBAgQEDA0gMECBAgQIAAgcICAlZhUOUIECBAgAABAgKWHiBAgAABAgQIFBYQsAqDKkeAAAECBAgQELD0AAECBAgQIECgsICAVRhUOQIECBAgQICAgKUHCBAgQIAAAQKFBQSswqDKESBAgAABAgQELD1AgAABAgQIECgsIGAVBlWOAAECBAgQICBg6QECBAgQIECAQGEBAaswqHIECBAgQIAAAQFLDxAgQIAAAQIECgsIWIVBlSNAgAABAgQICFh6gAABAgQIECBQWEDAKgyqHAECBAgQIEBAwNIDBAgQIECAAIHCAgJWYVDlCBAgQIAAAQIClh4gQIAAAQIECBQWELAKgypHgAABAgQIEBCw9AABAgQIECBAoLCAgFUYVDkCBAgQIECAgIClBwgQIECAAAEChQUErMKgyhEgQIAAAQIEBCw9QIAAAQIECBAoLCBgFQZVjgABAgQIECAgYOkBAgQIECBAgEBhAQGrMKhyBAgQIECAAAEBSw8QIECAAAECBAoLCFiFQZUjQIAAAQIECAhYeoAAAQIECBAgUFhAwCoMqhwBAgQIECBAQMDSAwQIECBAgACBwgICVmFQ5QgQIECAAAECApYeIECAAAECBAgUFhCwCoMqR4AAAQIECBAQsPQAAQIECBAgQKCwgIBVGFQ5AgQIECBAgICApQcIECBAgAABAoUFBKzCoMoRIECAAAECBAQsPUCAAAECBAgQKCwgYBUGVY4AAQIECBAgIGDpAQIECBAgQIBAYQEBqzCocgQIECBAgAABAUsPECBAgAABAgQKCwhYhUGVI0CAAAECBAgIWHqAAAECBAgQIFBYQMAqDKocAQIECBAgQEDA0gMECBAgQIAAgcICAlZhUOUIECBAgAABAgKWHiBAgAABAgQIFBYQsAqDKkeAAAECBAgQELD0AAECBAgQIECgsICAVRhUOQIECBAgQICAgKUHCBAgQIAAAQKFBQSswqDKESBAgAABAgQELD1AgAABAgQIECgsIGAVBlWOAAECBAgQICBg6QECBAgQIECAQGEBAaswqHIECBAgQIAAAQFLDxAgQIAAAQIECgsIWIVBlSNAgAABAgQICFh6gAABAgQIECBQWEDAKgyqHAECBAgQIEBAwNIDBAgQIECAAIHCAgJWYVDlCBAgQIAAAQIClh4gQIAAAQIECBQWELAKgypHgAABAgQIEBCw9AABAgQIECBAoLCAgFUYVDkCBAgQIECAgIClBwgQIECAAAEChQUErMKgyhEgQIAAAQIEBCw9QIAAAQIECBAoLCBgFQZVjgABAgQIECAgYOkBAgQIECBAgEBhAQGrMKhyBAgQIECAAAEBSw8QIECAAAECBAoLCFiFQZUjQIAAAQIECAhYeoAAAQIECBAgUFhAwCoMqhwBAgQIECBAQMDSAwQIECBAgACBwgICVmFQ5QgQIECAAAECApYeIECAAAECBAgUFhCwCoMqR4AAAQIECBAQsPQAAQIECBAgQKCwgIBVGFQ5AgQIECBAgICApQcIECBAgAABAoUFBKzCoMoRIECAAAECBAQsPUCAAAECBAgQKCwgYBUGVY4AAQIECBAgIGDpAQIECBAgQIBAYQEBqzCocgQIECBAgAABAUsPECBAgAABAgQKCwhYhUGVI0CAAAECBAgIWHqAAAECBAgQIFBYQMAqDKocAQIECBAgQEDA0gMECBAgQIAAgcICAlZhUOUIECBAgAABAgKWHiBAgAABAgQIFBYQsAqDKkeAAAECBAgQELD0AAECBAgQIECgsICAVRhUOQIECBAgQICAgKUHCBAgQIAAAQKFBQSswqDKESBAgAABAgQELD1AgAABAgQIECgsIGAVBlWOAAECBAgQICBg6QECBAgQIECAQGEBAaswqHIECBAgQIAAAQFLDxAgQIAAAQIECgsIWIVBlSNAgAABAgQICFh6gAABAgQIECBQWEDAKgyqHAECBAgQIEBAwNIDBAgQIECAAIHCAgJWYVDlCBAgQIAAAQIClh4gQIAAAQIECBQWELAKgypHgAABAgQIEBCw9AABAgQIECBAoLCAgFUYVDkCBAgQIECAgIClBwgQIECAAAEChQUErMKgyhEgQIAAAQIEBCw9QIAAAQIECBAoLCBgFQZVjgABAgQIECAgYOkBAgQIECBAgEBhAQGrMKhyBAgQIECAAAEBSw8QIECAAAECBAoLCFiFQZUjQIAAAQIECAhYeoAAAQIECBAgUFhAwCoMqhwBAgQIECBAQMDSAwQIECBAgACBwgICVmFQ5QgQIECAAAECApYeIECAAAECBAgUFhCwCoMqR4AAAQIECBAQsPQAAQIECBAgQKCwgIBVGFQ5AgQIECBAgICApQcIECBAgAABAoUFBKzCoMoRIECAAAECBAQsPUCAAAECBAgQKCwgYBUGVY4AAQIECBAgIGDpAQIECBAgQIBAYQEBqzCocgQIECBAgAABAUsPECBAgAABAgQKCwhYhUGVI0CAAAECBAgIWHqAAAECBAgQIFBYQMAqDKocAQIECBAgQEDA0gMECBAgQIAAgcICAlZhUOUIECBAgAABAgKWHiBAgAABAgQIFBYQsAqDKkeAAAECBAgQELD0AAECBAgQIECgsICAVRhUOQIECBAgQICAgKUHCBAgQIAAAQKFBQSswqDKESBAgAABAgQELD1AgAABAgQIECgsIGAVBlWOAAECBAgQICBg6QECBAgQIECAQGEBAaswqHIECBAgQIAAAQFLDxAgQIAAAQIECgsIWIVBlSNAgAABAgQICFh6gAABAgQIECBQWEDAKgyqHAECBAgQIEBAwNIDBAgQIECAAIHCAgJWYVDlCBAgQIAAAQIClh4gQIAAAQIECBQWELAKgypHgAABAgQIEBCw9AABAgQIECBAoLCAgFUYVDkCBAgQIECAgIClBwgQIECAAAEChQUErMKgyhEgQIAAAQIEBCw9QIAAAQIECBAoLCBgFQZVjgABAgQIECAgYOkBAgQIECBAgEBhAQGrMKhyBAgQIECAAAEBSw8QIECAAAECBAoLCFiFQZUjQIAAAQIECAhYeoAAAQIECBAgUFhAwCoMqhwBAgQIECBAQMDSAwQIECBAgACBwgICVmFQ5QgQIECAAAECApYeIECAAAECBAgUFhCwCoMqR4AAAQIECBAQsPQAAQIECBAgQKCwgIBVGFQ5AgQIECBAgICApQcIECBAgAABAoUFBKzCoMoRIECAAAECBAQsPUCAAAECBAgQKCwgYBUGVY4AAQIECBAgIGDpAQIECBAgQIBAYQEBqzCocgQIECBAgAABAUsPECBAgAABAgQKCwhYhUGVI0CAAAECBAgIWHqAAAECBAgQIFBYQMAqDKocAQIECBAgQOD/A39v/4EZILe8AAAAAElFTkSuQmCC" alt="cc"></p>
]]></content>
      <categories>
        <category>java</category>
      </categories>
  </entry>
</search>
